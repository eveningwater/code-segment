<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµè§ˆå™¨ç¯å¢ƒæ£€æµ‹ä¸åˆ†æå·¥å…· - isBrowserå®æˆ˜</title>
    
    <!-- å¼•å…¥è‡ªå®šä¹‰æ’ä»¶ -->
    <link rel="stylesheet" href="../../demo/plugins/modal/style.css">
    <link rel="stylesheet" href="../../demo/plugins/checkbox/style.css">
    <link rel="stylesheet" href="../../demo/plugins/input-number/style.css">
    <link rel="stylesheet" href="../../demo/plugins/notification/style.css">
    <link rel="stylesheet" href="../../demo/plugins/select/style.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .panel:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .panel h2 {
            color: #4a5568;
            margin-bottom: 20px;
            font-size: 1.5rem;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 10px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
        }

        .input-group input,
        .input-group textarea,
        .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus,
        .input-group textarea:focus,
        .input-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: #718096;
        }

        .btn-success {
            background: #48bb78;
        }

        .btn-danger {
            background: #f56565;
        }

        .btn-warning {
            background: #ed8936;
        }

        .btn-info {
            background: #38b2ac;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .result-display {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            min-height: 200px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            overflow-y: auto;
            max-height: 400px;
        }

        .result-item {
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            background: white;
        }

        .result-item.success {
            border-left-color: #48bb78;
            background: #f0fff4;
        }

        .result-item.error {
            border-left-color: #f56565;
            background: #fff5f5;
        }

        .result-item.warning {
            border-left-color: #ed8936;
            background: #fffaf0;
        }

        .env-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .env-status.browser {
            background: #48bb78;
            color: white;
        }

        .env-status.node {
            background: #ed8936;
            color: white;
        }

        .env-status.unknown {
            background: #718096;
            color: white;
        }

        .stats-panel {
            grid-column: 1 / -1;
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-item {
            text-align: center;
            padding: 20px;
            background: #f7fafc;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #718096;
            font-size: 14px;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .feature-card {
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            background: #f7fafc;
            transition: all 0.3s ease;
        }

        .feature-card:hover {
            border-color: #667eea;
            background: white;
            transform: translateY(-2px);
        }

        .feature-card h4 {
            color: #4a5568;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .feature-status {
            font-size: 12px;
            font-weight: 600;
            padding: 2px 8px;
            border-radius: 12px;
        }

        .feature-status.available {
            background: #48bb78;
            color: white;
        }

        .feature-status.unavailable {
            background: #f56565;
            color: white;
        }

        .browser-info {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .browser-info.browser-env {
            border-color: #48bb78;
            background: #f0fff4;
        }

        .browser-info.node-env {
            border-color: #ed8936;
            background: #fffaf0;
        }

        .advanced-options {
            margin-top: 20px;
            padding: 20px;
            background: #f7fafc;
            border-radius: 8px;
            border: 2px solid #e2e8f0;
        }

        .advanced-options h3 {
            color: #4a5568;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .analysis-item {
            padding: 10px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
        }

        .analysis-label {
            font-weight: 600;
            color: #4a5568;
            font-size: 12px;
            margin-bottom: 5px;
        }

        .analysis-value {
            color: #718096;
            font-size: 14px;
        }

        .history-panel {
            grid-column: 1 / -1;
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .history-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid #e2e8f0;
            transition: background-color 0.3s ease;
        }

        .history-item:hover {
            background: #f7fafc;
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .history-info {
            flex: 1;
        }

        .history-time {
            color: #718096;
            font-size: 12px;
        }

        .clear-history {
            color: #f56565;
            cursor: pointer;
            font-size: 12px;
            text-decoration: underline;
        }

        .clear-history:hover {
            color: #e53e3e;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .feature-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸŒ æµè§ˆå™¨ç¯å¢ƒæ£€æµ‹ä¸åˆ†æå·¥å…·</h1>
            <p>åŸºäº isBrowser å‡½æ•°çš„å¼ºå¤§ç¯å¢ƒæ£€æµ‹ç³»ç»Ÿ</p>
        </div>

        <div class="main-content">
            <!-- ç¯å¢ƒæ£€æµ‹é¢æ¿ -->
            <div class="panel">
                <h2>ğŸ” ç¯å¢ƒæ£€æµ‹æ§åˆ¶</h2>
                
                <div class="input-group">
                    <label for="test-code">è‡ªå®šä¹‰æ£€æµ‹ä»£ç :</label>
                    <textarea id="test-code" rows="4" placeholder="è¾“å…¥è‡ªå®šä¹‰çš„ç¯å¢ƒæ£€æµ‹ä»£ç &#10;ä¾‹å¦‚:&#10;typeof window !== 'undefined'&#10;typeof document !== 'undefined'&#10;typeof navigator !== 'undefined'"></textarea>
                </div>

                <div class="controls">
                    <button class="btn" id="detect-btn">ğŸ” æ£€æµ‹ç¯å¢ƒ</button>
                    <button class="btn btn-success" id="detailed-analysis-btn">ğŸ“Š è¯¦ç»†åˆ†æ</button>
                    <button class="btn btn-info" id="api-test-btn">ğŸ§ª APIæµ‹è¯•</button>
                    <button class="btn btn-warning" id="export-btn">ğŸ“¤ å¯¼å‡ºæŠ¥å‘Š</button>
                    <button class="btn btn-secondary" id="clear-btn">ğŸ—‘ï¸ æ¸…ç©º</button>
                </div>

                <div class="advanced-options">
                    <h3>âš™ï¸ é«˜çº§é€‰é¡¹</h3>
                    <div id="advanced-options"></div>
                </div>
            </div>

            <!-- ç»“æœé¢æ¿ -->
            <div class="panel">
                <h2>ğŸ“Š æ£€æµ‹ç»“æœ</h2>
                
                <div class="controls">
                    <button class="btn btn-danger" id="clear-results-btn">ğŸ—‘ï¸ æ¸…ç©ºç»“æœ</button>
                    <button class="btn btn-info" id="copy-results-btn">ğŸ“‹ å¤åˆ¶ç»“æœ</button>
                </div>

                <div id="browser-info" class="browser-info" style="display: none;">
                    <div id="env-content"></div>
                </div>

                <div id="result-display" class="result-display">
                    <div style="text-align: center; color: #718096; padding: 40px;">
                        <div style="font-size: 3rem; margin-bottom: 10px;">ğŸŒ</div>
                        <div>ç‚¹å‡»æ£€æµ‹ç¯å¢ƒæŒ‰é’®å¼€å§‹åˆ†æ</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç¯å¢ƒç»Ÿè®¡é¢æ¿ -->
        <div class="stats-panel">
            <h2>ğŸ“ˆ ç¯å¢ƒç»Ÿè®¡</h2>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-number" id="total-detections">0</div>
                    <div class="stat-label">æ€»æ£€æµ‹æ¬¡æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="browser-detections">0</div>
                    <div class="stat-label">æµè§ˆå™¨ç¯å¢ƒ</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="node-detections">0</div>
                    <div class="stat-label">Node.jsç¯å¢ƒ</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="api-tests">0</div>
                    <div class="stat-label">APIæµ‹è¯•æ¬¡æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="available-apis">0</div>
                    <div class="stat-label">å¯ç”¨APIæ•°é‡</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="performance-score">0</div>
                    <div class="stat-label">æ€§èƒ½è¯„åˆ†</div>
                </div>
            </div>
        </div>

        <!-- æµè§ˆå™¨ç‰¹æ€§æ£€æµ‹é¢æ¿ -->
        <div class="stats-panel">
            <h2>ğŸ§ª æµè§ˆå™¨ç‰¹æ€§æ£€æµ‹</h2>
            <div class="feature-grid" id="feature-grid">
                <!-- åŠ¨æ€ç”Ÿæˆç‰¹æ€§æ£€æµ‹å¡ç‰‡ -->
            </div>
        </div>

        <!-- APIæµ‹è¯•é¢æ¿ -->
        <div class="stats-panel" id="api-test-panel" style="display: none;">
            <h2>ğŸ”¬ æµè§ˆå™¨APIæµ‹è¯•</h2>
            <div class="feature-grid" id="api-test-grid">
                <!-- åŠ¨æ€ç”ŸæˆAPIæµ‹è¯•é¡¹ -->
            </div>
        </div>

        <!-- å†å²è®°å½•é¢æ¿ -->
        <div class="history-panel">
            <h2>ğŸ“š æ£€æµ‹å†å²</h2>
            <div class="controls">
                <button class="btn btn-secondary" id="load-history-btn">ğŸ“¥ åŠ è½½å†å²</button>
                <span class="clear-history" id="clear-history-btn">æ¸…ç©ºå†å²</span>
            </div>
            <div id="history-list" class="history-list">
                <div style="text-align: center; color: #718096; padding: 20px;">
                    æš‚æ— æ£€æµ‹å†å²è®°å½•
                </div>
            </div>
        </div>
    </div>

    <!-- å¼•å…¥è‡ªå®šä¹‰æ’ä»¶ -->
    <script src="../../demo/plugins/modal/index.js"></script>
    <script src="../../demo/plugins/checkbox/index.js"></script>
    <script src="../../demo/plugins/input-number/index.js"></script>
    <script src="../../demo/plugins/notification/index.js"></script>
    <script src="../../demo/plugins/select/index.js"></script>

    <script>
        // æ ¸å¿ƒ isBrowser å‡½æ•°
        const isBrowser = () => ![typeof window, typeof document].includes('undefined');

        // æµè§ˆå™¨ç¯å¢ƒæ£€æµ‹å·¥å…·ç±»
        class BrowserDetector {
            constructor() {
                this.notification = new Notification();
                this.results = [];
                this.history = [];
                this.stats = {
                    totalDetections: 0,
                    browserDetections: 0,
                    nodeDetections: 0,
                    apiTests: 0,
                    availableApis: 0,
                    performanceScore: 0
                };
                
                this.advancedOptions = {
                    showDetailedInfo: true,
                    includeAPITests: true,
                    includePerformanceTests: false,
                    autoSaveHistory: true,
                    showCodeSnippets: true
                };

                // æµè§ˆå™¨ç‰¹æ€§åˆ—è¡¨
                this.browserFeatures = [
                    { name: 'Windowå¯¹è±¡', test: () => typeof window !== 'undefined', critical: true },
                    { name: 'Documentå¯¹è±¡', test: () => typeof document !== 'undefined', critical: true },
                    { name: 'Navigatorå¯¹è±¡', test: () => typeof navigator !== 'undefined', critical: false },
                    { name: 'Locationå¯¹è±¡', test: () => typeof location !== 'undefined', critical: false },
                    { name: 'Historyå¯¹è±¡', test: () => typeof history !== 'undefined', critical: false },
                    { name: 'LocalStorage', test: () => typeof localStorage !== 'undefined', critical: false },
                    { name: 'SessionStorage', test: () => typeof sessionStorage !== 'undefined', critical: false },
                    { name: 'Consoleå¯¹è±¡', test: () => typeof console !== 'undefined', critical: false },
                    { name: 'XMLHttpRequest', test: () => typeof XMLHttpRequest !== 'undefined', critical: false },
                    { name: 'Fetch API', test: () => typeof fetch !== 'undefined', critical: false },
                    { name: 'WebSocket', test: () => typeof WebSocket !== 'undefined', critical: false },
                    { name: 'Geolocation', test: () => navigator && 'geolocation' in navigator, critical: false },
                    { name: 'Service Worker', test: () => 'serviceWorker' in navigator, critical: false },
                    { name: 'Web Workers', test: () => typeof Worker !== 'undefined', critical: false },
                    { name: 'IndexedDB', test: () => typeof indexedDB !== 'undefined', critical: false },
                    { name: 'Canvas', test: () => {
                        try {
                            const canvas = document.createElement('canvas');
                            return canvas.getContext && canvas.getContext('2d');
                        } catch (e) {
                            return false;
                        }
                    }, critical: false },
                    { name: 'WebGL', test: () => {
                        try {
                            const canvas = document.createElement('canvas');
                            return canvas.getContext && (canvas.getContext('webgl') || canvas.getContext('experimental-webgl'));
                        } catch (e) {
                            return false;
                        }
                    }, critical: false },
                    { name: 'FileReader', test: () => typeof FileReader !== 'undefined', critical: false },
                    { name: 'Blob', test: () => typeof Blob !== 'undefined', critical: false },
                    { name: 'FormData', test: () => typeof FormData !== 'undefined', critical: false }
                ];
                
                this.init();
            }

            init() {
                this.setupControls();
                this.setupEventListeners();
                this.loadHistory();
                this.updateStats();
                this.detectBrowserFeatures();
                this.performInitialDetection();
            }

            setupControls() {
                // é«˜çº§é€‰é¡¹å¤é€‰æ¡†
                try {
                    const container = document.querySelector('#advanced-options');
                    if (container) {
                        this.advancedOptionsGroup = Checkbox.createCheckboxGroup({
                            items: [
                                { label: 'æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯', checked: true },
                                { label: 'åŒ…å«APIæµ‹è¯•', checked: true },
                                { label: 'åŒ…å«æ€§èƒ½æµ‹è¯•', checked: false },
                                { label: 'è‡ªåŠ¨ä¿å­˜å†å²', checked: true },
                                { label: 'æ˜¾ç¤ºä»£ç ç‰‡æ®µ', checked: true }
                            ],
                            onChange: (values) => {
                                this.advancedOptions.showDetailedInfo = values[0];
                                this.advancedOptions.includeAPITests = values[1];
                                this.advancedOptions.includePerformanceTests = values[2];
                                this.advancedOptions.autoSaveHistory = values[3];
                                this.advancedOptions.showCodeSnippets = values[4];
                            }
                        });
                        
                        container.appendChild(this.advancedOptionsGroup.container);
                    }
                } catch (error) {
                    console.warn('å¤é€‰æ¡†æ’ä»¶åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤é€‰é¡¹');
                }
            }

            setupEventListeners() {
                // æ£€æµ‹ç¯å¢ƒæŒ‰é’®
                document.getElementById('detect-btn').addEventListener('click', () => {
                    this.detectEnvironment();
                });

                // è¯¦ç»†åˆ†ææŒ‰é’®
                document.getElementById('detailed-analysis-btn').addEventListener('click', () => {
                    this.performDetailedAnalysis();
                });

                // APIæµ‹è¯•æŒ‰é’®
                document.getElementById('api-test-btn').addEventListener('click', () => {
                    this.performAPITests();
                });

                // å¯¼å‡ºæŠ¥å‘ŠæŒ‰é’®
                document.getElementById('export-btn').addEventListener('click', () => {
                    this.exportReport();
                });

                // æ¸…ç©ºæŒ‰é’®
                document.getElementById('clear-btn').addEventListener('click', () => {
                    this.clearInput();
                });

                // æ¸…ç©ºç»“æœæŒ‰é’®
                document.getElementById('clear-results-btn').addEventListener('click', () => {
                    this.clearResults();
                });

                // å¤åˆ¶ç»“æœæŒ‰é’®
                document.getElementById('copy-results-btn').addEventListener('click', () => {
                    this.copyResults();
                });

                // åŠ è½½å†å²æŒ‰é’®
                document.getElementById('load-history-btn').addEventListener('click', () => {
                    this.loadHistory();
                });

                // æ¸…ç©ºå†å²æŒ‰é’®
                document.getElementById('clear-history-btn').addEventListener('click', () => {
                    this.clearHistory();
                });
            }

            performInitialDetection() {
                // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æµ‹ç¯å¢ƒ
                this.detectEnvironment();
            }

            detectEnvironment() {
                const testCode = document.getElementById('test-code').value.trim();
                const startTime = performance.now();
                
                // åŸºç¡€ç¯å¢ƒæ£€æµ‹
                const isBrowserEnv = isBrowser();
                const isNodeEnv = this.isNode();
                
                // è‡ªå®šä¹‰ä»£ç æ‰§è¡Œ
                let customTestResult = null;
                let customTestError = null;
                
                if (testCode) {
                    try {
                        customTestResult = eval(testCode);
                    } catch (error) {
                        customTestError = error.message;
                    }
                }

                const endTime = performance.now();
                const executionTime = endTime - startTime;

                const result = {
                    timestamp: new Date(),
                    isBrowser: isBrowserEnv,
                    isNode: isNodeEnv,
                    executionTime: executionTime,
                    customCode: testCode,
                    customResult: customTestResult,
                    customError: customTestError,
                    userAgent: navigator ? navigator.userAgent : 'N/A',
                    platform: navigator ? navigator.platform : 'N/A',
                    language: navigator ? navigator.language : 'N/A',
                    cookieEnabled: navigator ? navigator.cookieEnabled : false,
                    onLine: navigator ? navigator.onLine : false,
                    details: this.getEnvironmentDetails()
                };

                this.results.unshift(result);
                this.updateResultsDisplay();
                this.updateStats();
                this.showEnvironmentInfo(result);
                
                if (this.advancedOptions.autoSaveHistory) {
                    this.saveToHistory(result);
                }

                this.notification.success(`ç¯å¢ƒæ£€æµ‹å®Œæˆ: ${isBrowserEnv ? 'ğŸŒ æµè§ˆå™¨ç¯å¢ƒ' : 'ğŸŸ¢ Node.jsç¯å¢ƒ'}`);
            }

            isNode() {
                return typeof process !== 'undefined' && 
                       process.versions && 
                       process.versions.node;
            }

            getEnvironmentDetails() {
                const details = {
                    windowDefined: typeof window !== 'undefined',
                    documentDefined: typeof document !== 'undefined',
                    navigatorDefined: typeof navigator !== 'undefined',
                    processDefined: typeof process !== 'undefined',
                    globalDefined: typeof global !== 'undefined',
                    moduleDefined: typeof module !== 'undefined',
                    requireDefined: typeof require !== 'undefined',
                    exportsDefined: typeof exports !== 'undefined'
                };

                // æµè§ˆå™¨ç‰¹å®šä¿¡æ¯
                if (typeof window !== 'undefined') {
                    details.windowInnerWidth = window.innerWidth;
                    details.windowInnerHeight = window.innerHeight;
                    details.screenWidth = screen ? screen.width : 'N/A';
                    details.screenHeight = screen ? screen.height : 'N/A';
                    details.devicePixelRatio = window.devicePixelRatio || 1;
                }

                // æ–‡æ¡£ä¿¡æ¯
                if (typeof document !== 'undefined') {
                    details.documentReady = document.readyState;
                    details.documentTitle = document.title;
                    details.documentURL = document.URL;
                    details.documentDomain = document.domain;
                }

                return details;
            }

            showEnvironmentInfo(result) {
                const infoContainer = document.getElementById('browser-info');
                const envContent = document.getElementById('env-content');
                
                let statusClass = result.isBrowser ? 'browser-env' : 'node-env';
                let statusIcon = result.isBrowser ? 'ğŸŒ' : 'ğŸŸ¢';
                let envType = result.isBrowser ? 'æµè§ˆå™¨ç¯å¢ƒ' : 'Node.jsç¯å¢ƒ';

                infoContainer.className = `browser-info ${statusClass}`;
                infoContainer.style.display = 'block';

                let infoHtml = `
                    <div style="margin-bottom: 15px;">
                        <strong>ç¯å¢ƒæ£€æµ‹ç»“æœ:</strong> ${statusIcon} ${envType}
                        <span class="env-status ${result.isBrowser ? 'browser' : 'node'}">${envType}</span>
                    </div>
                `;

                if (this.advancedOptions.showDetailedInfo) {
                    infoHtml += `
                        <div class="analysis-grid">
                            <div class="analysis-item">
                                <div class="analysis-label">æ‰§è¡Œæ—¶é—´</div>
                                <div class="analysis-value">${result.executionTime.toFixed(2)}ms</div>
                            </div>
                            <div class="analysis-item">
                                <div class="analysis-label">ç”¨æˆ·ä»£ç†</div>
                                <div class="analysis-value">${result.userAgent.substring(0, 50)}...</div>
                            </div>
                            <div class="analysis-item">
                                <div class="analysis-label">å¹³å°</div>
                                <div class="analysis-value">${result.platform}</div>
                            </div>
                            <div class="analysis-item">
                                <div class="analysis-label">è¯­è¨€</div>
                                <div class="analysis-value">${result.language}</div>
                            </div>
                            <div class="analysis-item">
                                <div class="analysis-label">åœ¨çº¿çŠ¶æ€</div>
                                <div class="analysis-value">${result.onLine ? 'åœ¨çº¿' : 'ç¦»çº¿'}</div>
                            </div>
                            <div class="analysis-item">
                                <div class="analysis-label">Cookieå¯ç”¨</div>
                                <div class="analysis-value">${result.cookieEnabled ? 'æ˜¯' : 'å¦'}</div>
                            </div>
                        </div>
                    `;

                    if (result.customCode) {
                        infoHtml += `
                            <div style="margin-top: 20px;">
                                <strong>è‡ªå®šä¹‰ä»£ç ç»“æœ:</strong><br>
                                ${result.customError ? 
                                    `<span style="color: #f56565;">é”™è¯¯: ${result.customError}</span>` : 
                                    `<span style="color: #48bb78;">ç»“æœ: ${JSON.stringify(result.customResult)}</span>`
                                }
                            </div>
                        `;
                    }
                }

                envContent.innerHTML = infoHtml;
            }

            detectBrowserFeatures() {
                const featureGrid = document.getElementById('feature-grid');
                featureGrid.innerHTML = '';

                let availableCount = 0;

                this.browserFeatures.forEach(feature => {
                    const isAvailable = feature.test();
                    if (isAvailable) availableCount++;

                    const featureCard = document.createElement('div');
                    featureCard.className = 'feature-card fade-in';
                    
                    featureCard.innerHTML = `
                        <h4>
                            ${feature.name}
                            <span class="feature-status ${isAvailable ? 'available' : 'unavailable'}">
                                ${isAvailable ? 'å¯ç”¨' : 'ä¸å¯ç”¨'}
                            </span>
                        </h4>
                        <p>${this.getFeatureDescription(feature.name)}</p>
                        ${feature.critical ? '<p style="color: #ed8936; font-size: 11px; margin-top: 5px;">âš ï¸ å…³é”®ç‰¹æ€§</p>' : ''}
                    `;

                    featureGrid.appendChild(featureCard);
                });

                // æ›´æ–°å¯ç”¨APIç»Ÿè®¡
                this.stats.availableApis = availableCount;
                document.getElementById('available-apis').textContent = availableCount;
            }

            getFeatureDescription(featureName) {
                const descriptions = {
                    'Windowå¯¹è±¡': 'å…¨å±€çª—å£å¯¹è±¡ï¼Œæµè§ˆå™¨ç¯å¢ƒçš„æ ¸å¿ƒ',
                    'Documentå¯¹è±¡': 'DOMæ–‡æ¡£å¯¹è±¡ï¼Œç”¨äºæ“ä½œé¡µé¢å…ƒç´ ',
                    'Navigatorå¯¹è±¡': 'æµè§ˆå™¨ä¿¡æ¯å¯¹è±¡ï¼ŒåŒ…å«ç”¨æˆ·ä»£ç†ç­‰ä¿¡æ¯',
                    'Locationå¯¹è±¡': 'å½“å‰é¡µé¢ä½ç½®ä¿¡æ¯',
                    'Historyå¯¹è±¡': 'æµè§ˆå™¨å†å²è®°å½•æ“ä½œ',
                    'LocalStorage': 'æœ¬åœ°å­˜å‚¨APIï¼ŒæŒä¹…åŒ–æ•°æ®',
                    'SessionStorage': 'ä¼šè¯å­˜å‚¨APIï¼Œä¸´æ—¶æ•°æ®',
                    'Consoleå¯¹è±¡': 'æ§åˆ¶å°è¾“å‡ºï¼Œè°ƒè¯•å·¥å…·',
                    'XMLHttpRequest': 'ä¼ ç»Ÿçš„AJAXè¯·æ±‚å¯¹è±¡',
                    'Fetch API': 'ç°ä»£çš„ç½‘ç»œè¯·æ±‚API',
                    'WebSocket': 'åŒå‘é€šä¿¡åè®®æ”¯æŒ',
                    'Geolocation': 'åœ°ç†ä½ç½®è·å–API',
                    'Service Worker': 'ç¦»çº¿ç¼“å­˜å’Œåå°å¤„ç†',
                    'Web Workers': 'å¤šçº¿ç¨‹å¤„ç†æ”¯æŒ',
                    'IndexedDB': 'å®¢æˆ·ç«¯æ•°æ®åº“å­˜å‚¨',
                    'Canvas': '2Då›¾å½¢ç»˜åˆ¶API',
                    'WebGL': '3Då›¾å½¢æ¸²æŸ“API',
                    'FileReader': 'æ–‡ä»¶è¯»å–API',
                    'Blob': 'äºŒè¿›åˆ¶æ•°æ®å¤„ç†',
                    'FormData': 'è¡¨å•æ•°æ®å°è£…'
                };
                return descriptions[featureName] || 'æµè§ˆå™¨ç‰¹æ€§æ£€æµ‹';
            }

            performDetailedAnalysis() {
                const analysisResult = {
                    timestamp: new Date(),
                    type: 'detailed-analysis',
                    environment: isBrowser() ? 'browser' : 'node',
                    performance: this.getPerformanceMetrics(),
                    memory: this.getMemoryInfo(),
                    screen: this.getScreenInfo(),
                    connection: this.getConnectionInfo(),
                    capabilities: this.getCapabilities()
                };

                this.showDetailedAnalysis(analysisResult);
                this.notification.success('è¯¦ç»†åˆ†æå®Œæˆ');
            }

            getPerformanceMetrics() {
                if (typeof performance === 'undefined') return null;

                const timing = performance.timing;
                if (!timing) return null;

                return {
                    navigationStart: timing.navigationStart,
                    loadEventEnd: timing.loadEventEnd,
                    domContentLoaded: timing.domContentLoadedEventEnd - timing.navigationStart,
                    pageLoad: timing.loadEventEnd - timing.navigationStart,
                    dnsLookup: timing.domainLookupEnd - timing.domainLookupStart,
                    tcpConnect: timing.connectEnd - timing.connectStart,
                    serverResponse: timing.responseEnd - timing.requestStart,
                    domProcessing: timing.domComplete - timing.domLoading
                };
            }

            getMemoryInfo() {
                if (typeof performance === 'undefined' || !performance.memory) return null;

                return {
                    usedJSHeapSize: performance.memory.usedJSHeapSize,
                    totalJSHeapSize: performance.memory.totalJSHeapSize,
                    jsHeapSizeLimit: performance.memory.jsHeapSizeLimit
                };
            }

            getScreenInfo() {
                if (typeof screen === 'undefined') return null;

                return {
                    width: screen.width,
                    height: screen.height,
                    availWidth: screen.availWidth,
                    availHeight: screen.availHeight,
                    colorDepth: screen.colorDepth,
                    pixelDepth: screen.pixelDepth
                };
            }

            getConnectionInfo() {
                if (typeof navigator === 'undefined' || !navigator.connection) return null;

                const conn = navigator.connection;
                return {
                    effectiveType: conn.effectiveType,
                    downlink: conn.downlink,
                    rtt: conn.rtt,
                    saveData: conn.saveData
                };
            }

            getCapabilities() {
                const capabilities = {};
                
                // æ£€æµ‹å„ç§Web API
                capabilities.webGL = this.hasWebGL();
                capabilities.webGL2 = this.hasWebGL2();
                capabilities.webAssembly = typeof WebAssembly !== 'undefined';
                capabilities.sharedArrayBuffer = typeof SharedArrayBuffer !== 'undefined';
                capabilities.bigInt = typeof BigInt !== 'undefined';
                capabilities.asyncIterator = typeof Symbol !== 'undefined' && Symbol.asyncIterator;
                capabilities.proxy = typeof Proxy !== 'undefined';
                capabilities.reflect = typeof Reflect !== 'undefined';
                capabilities.weakMap = typeof WeakMap !== 'undefined';
                capabilities.weakSet = typeof WeakSet !== 'undefined';
                capabilities.map = typeof Map !== 'undefined';
                capabilities.set = typeof Set !== 'undefined';

                return capabilities;
            }

            hasWebGL() {
                try {
                    const canvas = document.createElement('canvas');
                    return !!(window.WebGLRenderingContext && canvas.getContext('webgl'));
                } catch (e) {
                    return false;
                }
            }

            hasWebGL2() {
                try {
                    const canvas = document.createElement('canvas');
                    return !!(window.WebGL2RenderingContext && canvas.getContext('webgl2'));
                } catch (e) {
                    return false;
                }
            }

            showDetailedAnalysis(analysis) {
                const container = document.getElementById('result-display');
                const analysisItem = document.createElement('div');
                analysisItem.className = 'result-item success fade-in';
                
                let analysisHtml = `
                    <div style="font-weight: bold; color: #4a5568; margin-bottom: 10px;">
                        ğŸ“Š è¯¦ç»†ç¯å¢ƒåˆ†æ - ${analysis.timestamp.toLocaleString()}
                    </div>
                `;

                if (analysis.performance) {
                    analysisHtml += `
                        <div style="margin-bottom: 15px;">
                            <strong>æ€§èƒ½æŒ‡æ ‡:</strong><br>
                            é¡µé¢åŠ è½½æ—¶é—´: ${analysis.performance.pageLoad}ms<br>
                            DOMåŠ è½½æ—¶é—´: ${analysis.performance.domContentLoaded}ms<br>
                            DNSæŸ¥è¯¢æ—¶é—´: ${analysis.performance.dnsLookup}ms<br>
                            æœåŠ¡å™¨å“åº”æ—¶é—´: ${analysis.performance.serverResponse}ms
                        </div>
                    `;
                }

                if (analysis.memory) {
                    analysisHtml += `
                        <div style="margin-bottom: 15px;">
                            <strong>å†…å­˜ä¿¡æ¯:</strong><br>
                            å·²ä½¿ç”¨å †å†…å­˜: ${(analysis.memory.usedJSHeapSize / 1024 / 1024).toFixed(2)}MB<br>
                            æ€»å †å†…å­˜: ${(analysis.memory.totalJSHeapSize / 1024 / 1024).toFixed(2)}MB<br>
                            å †å†…å­˜é™åˆ¶: ${(analysis.memory.jsHeapSizeLimit / 1024 / 1024).toFixed(2)}MB
                        </div>
                    `;
                }

                if (analysis.screen) {
                    analysisHtml += `
                        <div style="margin-bottom: 15px;">
                            <strong>å±å¹•ä¿¡æ¯:</strong><br>
                            åˆ†è¾¨ç‡: ${analysis.screen.width}x${analysis.screen.height}<br>
                            å¯ç”¨åŒºåŸŸ: ${analysis.screen.availWidth}x${analysis.screen.availHeight}<br>
                            é¢œè‰²æ·±åº¦: ${analysis.screen.colorDepth}ä½
                        </div>
                    `;
                }

                if (analysis.capabilities) {
                    const caps = analysis.capabilities;
                    analysisHtml += `
                        <div style="margin-bottom: 15px;">
                            <strong>æµè§ˆå™¨èƒ½åŠ›:</strong><br>
                            WebGL: ${caps.webGL ? 'âœ…' : 'âŒ'} | 
                            WebGL2: ${caps.webGL2 ? 'âœ…' : 'âŒ'} | 
                            WebAssembly: ${caps.webAssembly ? 'âœ…' : 'âŒ'}<br>
                            BigInt: ${caps.bigInt ? 'âœ…' : 'âŒ'} | 
                            Proxy: ${caps.proxy ? 'âœ…' : 'âŒ'} | 
                            SharedArrayBuffer: ${caps.sharedArrayBuffer ? 'âœ…' : 'âŒ'}
                        </div>
                    `;
                }

                analysisItem.innerHTML = analysisHtml;
                container.insertBefore(analysisItem, container.firstChild);
            }

            performAPITests() {
                const apiTestPanel = document.getElementById('api-test-panel');
                const apiTestGrid = document.getElementById('api-test-grid');
                
                apiTestPanel.style.display = 'block';
                apiTestGrid.innerHTML = '';

                const apiTests = [
                    {
                        name: 'DOMæ“ä½œ',
                        test: () => {
                            try {
                                const div = document.createElement('div');
                                div.innerHTML = 'test';
                                return div.textContent === 'test';
                            } catch (e) {
                                return false;
                            }
                        }
                    },
                    {
                        name: 'JSONå¤„ç†',
                        test: () => {
                            try {
                                const obj = { test: 'value' };
                                return JSON.parse(JSON.stringify(obj)).test === 'value';
                            } catch (e) {
                                return false;
                            }
                        }
                    },
                    {
                        name: 'Promiseæ”¯æŒ',
                        test: () => typeof Promise !== 'undefined'
                    },
                    {
                        name: 'async/await',
                        test: () => {
                            try {
                                eval('(async () => {})');
                                return true;
                            } catch (e) {
                                return false;
                            }
                        }
                    },
                    {
                        name: 'ES6æ¨¡å—',
                        test: () => typeof Symbol !== 'undefined'
                    },
                    {
                        name: 'Fetch API',
                        test: () => typeof fetch !== 'undefined'
                    }
                ];

                let passedTests = 0;

                apiTests.forEach(apiTest => {
                    const testResult = apiTest.test();
                    if (testResult) passedTests++;

                    const testCard = document.createElement('div');
                    testCard.className = 'feature-card fade-in';
                    
                    testCard.innerHTML = `
                        <h5>
                            ${apiTest.name}
                            <span class="test-result ${testResult ? 'pass' : 'fail'}">
                                ${testResult ? 'é€šè¿‡' : 'å¤±è´¥'}
                            </span>
                        </h5>
                        <p>APIåŠŸèƒ½æµ‹è¯•ç»“æœ</p>
                    `;

                    apiTestGrid.appendChild(testCard);
                });

                this.stats.apiTests++;
                document.getElementById('api-tests').textContent = this.stats.apiTests;

                // è®¡ç®—æ€§èƒ½è¯„åˆ†
                const score = Math.round((passedTests / apiTests.length) * 100);
                this.stats.performanceScore = score;
                document.getElementById('performance-score').textContent = score;

                this.notification.success(`APIæµ‹è¯•å®Œæˆ: ${passedTests}/${apiTests.length} é¡¹é€šè¿‡`);
            }

            updateResultsDisplay() {
                const container = document.getElementById('result-display');
                
                // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡æ£€æµ‹ï¼Œæ¸…ç©ºé»˜è®¤å†…å®¹
                if (this.results.length === 1) {
                    container.innerHTML = '';
                }

                this.results.slice(0, 10).forEach((result, index) => {
                    const resultItem = document.createElement('div');
                    resultItem.className = `result-item ${result.isBrowser ? 'success' : 'warning'} fade-in`;
                    
                    let detailsHtml = '';
                    if (this.advancedOptions.showDetailedInfo) {
                        detailsHtml = `
                            <div style="color: #718096; font-size: 13px; margin-bottom: 5px;">
                                <strong>æ‰§è¡Œæ—¶é—´:</strong> ${result.executionTime.toFixed(2)}ms<br>
                                <strong>ç”¨æˆ·ä»£ç†:</strong> ${result.userAgent.substring(0, 100)}...<br>
                                <strong>å¹³å°:</strong> ${result.platform}<br>
                                <strong>æ£€æµ‹æ—¶é—´:</strong> ${result.timestamp.toLocaleString()}
                            </div>
                        `;
                    }

                    resultItem.innerHTML = `
                        <div class="env-info">
                            ç¯å¢ƒç±»å‹: ${result.isBrowser ? 'ğŸŒ æµè§ˆå™¨ç¯å¢ƒ' : 'ğŸŸ¢ Node.jsç¯å¢ƒ'}
                            <span class="env-status ${result.isBrowser ? 'browser' : 'node'}">
                                ${result.isBrowser ? 'Browser' : 'Node.js'}
                            </span>
                        </div>
                        ${detailsHtml}
                        <div class="result-info ${result.isBrowser}">
                            isBrowser() = ${result.isBrowser}
                        </div>
                    `;

                    // åªæ·»åŠ æ–°çš„ç»“æœé¡¹ï¼Œé¿å…é‡å¤
                    if (index === 0) {
                        container.insertBefore(resultItem, container.firstChild);
                    }
                });
            }

            updateStats() {
                this.stats.totalDetections = this.results.length;
                this.stats.browserDetections = this.results.filter(r => r.isBrowser).length;
                this.stats.nodeDetections = this.results.filter(r => !r.isBrowser).length;

                document.getElementById('total-detections').textContent = this.stats.totalDetections;
                document.getElementById('browser-detections').textContent = this.stats.browserDetections;
                document.getElementById('node-detections').textContent = this.stats.nodeDetections;
            }

            clearInput() {
                document.getElementById('test-code').value = '';
                this.notification.info('è¾“å…¥å·²æ¸…ç©º');
            }

            clearResults() {
                this.results = [];
                document.getElementById('result-display').innerHTML = `
                    <div style="text-align: center; color: #718096; padding: 40px;">
                        <div style="font-size: 3rem; margin-bottom: 10px;">ğŸŒ</div>
                        <div>ç‚¹å‡»æ£€æµ‹ç¯å¢ƒæŒ‰é’®å¼€å§‹åˆ†æ</div>
                    </div>
                `;
                document.getElementById('browser-info').style.display = 'none';
                document.getElementById('api-test-panel').style.display = 'none';
                this.updateStats();
                this.notification.info('ç»“æœå·²æ¸…ç©º');
            }

            copyResults() {
                const results = this.results.map(r => 
                    `${r.timestamp.toLocaleString()}: ${r.isBrowser ? 'æµè§ˆå™¨ç¯å¢ƒ' : 'Node.jsç¯å¢ƒ'} (${r.executionTime.toFixed(2)}ms)`
                ).join('\n');
                
                navigator.clipboard.writeText(results).then(() => {
                    this.notification.success('ç»“æœå·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                }).catch(() => {
                    this.notification.error('å¤åˆ¶å¤±è´¥');
                });
            }

            exportReport() {
                const report = {
                    timestamp: new Date().toISOString(),
                    summary: {
                        totalDetections: this.stats.totalDetections,
                        browserDetections: this.stats.browserDetections,
                        nodeDetections: this.stats.nodeDetections,
                        apiTests: this.stats.apiTests,
                        availableApis: this.stats.availableApis,
                        performanceScore: this.stats.performanceScore
                    },
                    currentEnvironment: {
                        isBrowser: isBrowser(),
                        userAgent: navigator ? navigator.userAgent : 'N/A',
                        platform: navigator ? navigator.platform : 'N/A',
                        language: navigator ? navigator.language : 'N/A'
                    },
                    browserFeatures: this.browserFeatures.map(feature => ({
                        name: feature.name,
                        available: feature.test(),
                        critical: feature.critical
                    })),
                    detectionResults: this.results,
                    generatedBy: 'Browser Environment Detector v1.0'
                };

                const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `browser-environment-report-${new Date().toISOString().slice(0, 19)}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                this.notification.success('ç¯å¢ƒæŠ¥å‘Šå·²å¯¼å‡º');
            }

            saveToHistory(result) {
                const historyItem = {
                    ...result,
                    action: 'ç¯å¢ƒæ£€æµ‹'
                };
                
                this.history.unshift(historyItem);
                if (this.history.length > 50) {
                    this.history = this.history.slice(0, 50);
                }
                
                this.updateHistoryDisplay();
                this.saveHistory();
            }

            updateHistoryDisplay() {
                const container = document.getElementById('history-list');
                
                if (this.history.length === 0) {
                    container.innerHTML = '<div style="text-align: center; color: #718096; padding: 20px;">æš‚æ— æ£€æµ‹å†å²è®°å½•</div>';
                    return;
                }

                container.innerHTML = '';
                this.history.forEach((item, index) => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item fade-in';
                    
                    historyItem.innerHTML = `
                        <div class="history-info">
                            <div><strong>${item.isBrowser ? 'æµè§ˆå™¨ç¯å¢ƒ' : 'Node.jsç¯å¢ƒ'}</strong> - ${item.executionTime.toFixed(2)}ms</div>
                            <div class="history-time">${item.timestamp.toLocaleString()}</div>
                        </div>
                        <div class="history-action">
                            <span class="env-status ${item.isBrowser ? 'browser' : 'node'}">
                                ${item.isBrowser ? 'Browser' : 'Node.js'}
                            </span>
                        </div>
                    `;

                    container.appendChild(historyItem);
                });
            }

            saveHistory() {
                try {
                    localStorage.setItem('browserDetectorHistory', JSON.stringify(this.history));
                } catch (error) {
                    console.warn('ä¿å­˜å†å²è®°å½•å¤±è´¥:', error);
                }
            }

            loadHistory() {
                try {
                    const saved = localStorage.getItem('browserDetectorHistory');
                    if (saved) {
                        this.history = JSON.parse(saved).map(item => ({
                            ...item,
                            timestamp: new Date(item.timestamp)
                        }));
                        this.updateHistoryDisplay();
                        this.notification.success('å†å²è®°å½•å·²åŠ è½½');
                    }
                } catch (error) {
                    console.warn('åŠ è½½å†å²è®°å½•å¤±è´¥:', error);
                }
            }

            clearHistory() {
                this.history = [];
                this.updateHistoryDisplay();
                this.saveHistory();
                this.notification.info('å†å²è®°å½•å·²æ¸…ç©º');
            }
        }

        // åˆå§‹åŒ–åº”ç”¨
        document.addEventListener('DOMContentLoaded', () => {
            new BrowserDetector();
        });
    </script>
</body>
</html>
