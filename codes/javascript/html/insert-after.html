<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Âä®ÊÄÅÂÜÖÂÆπÊèíÂÖ•Âô®‰∏éÈ°µÈù¢ÊûÑÂª∫Â∑•ÂÖ∑</title>
    <link rel="stylesheet" href="../../demo/plugins/modal/style.css">
    <link rel="stylesheet" href="../../demo/plugins/checkbox/style.css">
    <link rel="stylesheet" href="../../demo/plugins/input-number/style.css">
    <link rel="stylesheet" href="../../demo/plugins/select/style.css">
    <link rel="stylesheet" href="../../demo/plugins/notification/style.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .app-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .app-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .app-header p {
            font-size: 1.1rem;
            color: #666;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
        }

        .control-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            height: fit-content;
        }

        .control-section {
            margin-bottom: 25px;
        }

        .control-section h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .element-selector {
            margin-bottom: 15px;
        }

        .element-selector label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .element-selector select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
        }

        .insert-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .insert-type {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .insert-type label {
            font-weight: 600;
            color: #555;
        }

        .insert-type select {
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
        }

        .content-input {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .content-input label {
            font-weight: 600;
            color: #555;
        }

        .content-input textarea {
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            min-height: 100px;
            resize: vertical;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        }

        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }

        .preview-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .preview-header h3 {
            color: #333;
        }

        .preview-actions {
            display: flex;
            gap: 10px;
        }

        .preview-container {
            min-height: 500px;
            border: 2px dashed #e9ecef;
            border-radius: 10px;
            padding: 20px;
            background: #f8f9fa;
        }

        .preview-container.empty {
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 1.1rem;
        }

        .demo-element {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            position: relative;
        }

        .demo-element:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
        }

        .element-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .demo-element:hover .element-controls {
            opacity: 1;
        }

        .element-btn {
            padding: 4px 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            background: #6c757d;
            color: white;
        }

        .element-btn:hover {
            background: #495057;
        }

        .element-btn.delete {
            background: #dc3545;
        }

        .element-btn.delete:hover {
            background: #c82333;
        }

        .template-gallery {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #e9ecef;
        }

        .template-gallery h4 {
            margin-bottom: 15px;
            color: #333;
        }

        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .template-item {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .template-item:hover {
            border-color: #4facfe;
            background: #e3f2fd;
            transform: translateY(-2px);
        }

        .template-item h5 {
            margin-bottom: 8px;
            color: #333;
        }

        .template-item p {
            font-size: 0.9rem;
            color: #666;
        }

        .history-panel {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #e9ecef;
        }

        .history-panel h4 {
            margin-bottom: 15px;
            color: #333;
        }

        .history-list {
            max-height: 200px;
            overflow-y: auto;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 10px;
        }

        .history-item {
            padding: 8px;
            margin-bottom: 5px;
            background: white;
            border-radius: 4px;
            border-left: 3px solid #4facfe;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .history-item:hover {
            background: #e3f2fd;
            transform: translateX(5px);
        }

        .history-item .time {
            color: #666;
            font-size: 0.8rem;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .app-header h1 {
                font-size: 2rem;
            }

            .preview-actions {
                flex-direction: column;
            }

            .template-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="app-container">
        <header class="app-header">
            <h1>üîß Âä®ÊÄÅÂÜÖÂÆπÊèíÂÖ•Âô®</h1>
            <p>Âü∫‰∫é insertAfter ÂáΩÊï∞ÁöÑÈ°µÈù¢ÊûÑÂª∫Â∑•ÂÖ∑</p>
        </header>

        <main class="main-content">
            <div class="control-panel">
                <div class="control-section">
                    <h3>üéØ ÁõÆÊ†áÂÖÉÁ¥†ÈÄâÊã©</h3>
                    <div class="element-selector">
                        <label>ÈÄâÊã©ÁõÆÊ†áÂÖÉÁ¥†:</label>
                        <div id="target-selector"></div>
                    </div>
                </div>

                <div class="control-section">
                    <h3>üìù ÊèíÂÖ•ÂÜÖÂÆπÈÖçÁΩÆ</h3>
                    <div class="insert-controls">
                        <div class="insert-type">
                            <label>ÊèíÂÖ•Á±ªÂûã:</label>
                            <div id="insert-type"></div>
                        </div>

                        <div class="content-input">
                            <label>ÂÜÖÂÆπÂÜÖÂÆπ:</label>
                            <textarea id="content-input" placeholder="ËØ∑ËæìÂÖ•Ë¶ÅÊèíÂÖ•ÁöÑÂÜÖÂÆπ..."></textarea>
                        </div>

                        <div class="action-buttons">
                            <button id="insert-btn" class="btn btn-primary">ÊèíÂÖ•ÂÜÖÂÆπ</button>
                            <button id="clear-btn" class="btn btn-warning">Ê∏ÖÁ©∫È¢ÑËßà</button>
                            <button id="export-btn" class="btn btn-success">ÂØºÂá∫HTML</button>
                        </div>
                    </div>
                </div>

                <div class="control-section">
                    <h3>‚öôÔ∏è È´òÁ∫ßÈÄâÈ°π</h3>
                    <div id="advanced-options">
                        <!-- Â§çÈÄâÊ°ÜÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
                    </div>
                </div>
            </div>

            <div class="preview-panel">
                <div class="preview-header">
                    <h3>üëÅÔ∏è ÂÆûÊó∂È¢ÑËßà</h3>
                    <div class="preview-actions">
                        <button id="undo-btn" class="btn btn-secondary">Êí§ÈîÄ</button>
                        <button id="redo-btn" class="btn btn-secondary">ÈáçÂÅö</button>
                        <button id="reset-btn" class="btn btn-warning">ÈáçÁΩÆ</button>
                    </div>
                </div>

                <div class="preview-container" id="preview-container">
                    <div class="preview-container empty">
                        <div>
                            <h4>üéâ Ê¨¢Ëøé‰ΩøÁî®Âä®ÊÄÅÂÜÖÂÆπÊèíÂÖ•Âô®ÔºÅ</h4>
                            <p>Âú®Â∑¶‰æßÈÖçÁΩÆÊèíÂÖ•ÂÜÖÂÆπÔºåËøôÈáåÂ∞ÜÊòæÁ§∫ÂÆûÊó∂È¢ÑËßàÊïàÊûú</p>
                        </div>
                    </div>
                </div>

                <div class="template-gallery">
                    <h4>üìã Âø´ÈÄüÊ®°Êùø</h4>
                    <div class="template-grid">
                        <div class="template-item" data-template="card">
                            <h5>‰ø°ÊÅØÂç°Áâá</h5>
                            <p>ÂàõÂª∫‰∏Ä‰∏™ÁæéËßÇÁöÑ‰ø°ÊÅØÂç°Áâá</p>
                        </div>
                        <div class="template-item" data-template="form">
                            <h5>ËÅîÁ≥ªË°®Âçï</h5>
                            <p>ÊèíÂÖ•‰∏Ä‰∏™ÂÆåÊï¥ÁöÑËÅîÁ≥ªË°®Âçï</p>
                        </div>
                        <div class="template-item" data-template="gallery">
                            <h5>ÂõæÁâáÁîªÂªä</h5>
                            <p>ÂàõÂª∫‰∏Ä‰∏™ÂìçÂ∫îÂºèÂõæÁâáÁîªÂªä</p>
                        </div>
                        <div class="template-item" data-template="table">
                            <h5>Êï∞ÊçÆË°®Ê†º</h5>
                            <p>ÊèíÂÖ•‰∏Ä‰∏™ÂèØÊéíÂ∫èÁöÑÊï∞ÊçÆË°®Ê†º</p>
                        </div>
                    </div>
                </div>

                <div class="history-panel">
                    <h4>üìö Êìç‰ΩúÂéÜÂè≤</h4>
                    <div class="history-list" id="history-list">
                        <div class="history-item">
                            <div>È°µÈù¢ÂàùÂßãÂåñ</div>
                            <div class="time">ÂàöÂàö</div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- ÂºïÂÖ•Êèí‰ª∂ -->
    <script src="../../demo/plugins/modal/index.js"></script>
    <script src="../../demo/plugins/checkbox/index.js"></script>
    <script src="../../demo/plugins/input-number/index.js"></script>
    <script src="../../demo/plugins/select/index.js"></script>
    <script src="../../demo/plugins/notification/index.js"></script>

    <script>
        // Ê†∏ÂøÉÂáΩÊï∞
        const insertAfter = (el, html) => el.insertAdjacentHTML('afterend', html);

        // È°µÈù¢ÊûÑÂª∫Âô®‰∏ªÁ±ª
        class PageBuilder {
            constructor() {
                this.currentTarget = null;
                this.insertHistory = [];
                this.undoStack = [];
                this.redoStack = [];
                this.elementCounter = 0;
                this.advancedOptions = {
                    animations: true,
                    customStyling: true,
                    responsive: true
                };

                this.modal = new Modal();
                this.notification = new Notification();

                this.init();
            }

            init() {
                this.setupControls();
                this.setupEventListeners();
                this.populateTargetSelector();
                this.addToHistory('È°µÈù¢ÂàùÂßãÂåñ', 'Á≥ªÁªü');
            }

            setupControls() {
                // ÁõÆÊ†áÂÖÉÁ¥†ÈÄâÊã©Âô®
                this.targetSelector = new Select({
                    container: '#target-selector',
                    options: [
                        { value: 'preview-container', label: 'È¢ÑËßàÂÆπÂô® (ÈªòËÆ§)' }
                    ],
                    onChange: (value) => {
                        // ÂèØ‰ª•Âú®ËøôÈáåÊ∑ªÂä†ÈÄâÊã©ÁõÆÊ†áÂÖÉÁ¥†ÂêéÁöÑÈÄªËæë
                    }
                });

                // ÊèíÂÖ•Á±ªÂûãÈÄâÊã©Âô®
                this.insertTypeSelect = new Select({
                    container: '#insert-type',
                    options: [
                        { value: 'html', label: 'HTMLÂÖÉÁ¥†' },
                        { value: 'text', label: 'Á∫ØÊñáÊú¨' },
                        { value: 'component', label: 'ÁªÑ‰ª∂Ê®°Êùø' },
                        { value: 'form', label: 'Ë°®ÂçïÂÖÉÁ¥†' },
                        { value: 'media', label: 'Â™í‰ΩìÂÖÉÁ¥†' }
                    ],
                    onChange: (value) => {
                        this.updateContentPlaceholder(value);
                    }
                });

                // È´òÁ∫ßÈÄâÈ°πÂ§çÈÄâÊ°Ü
                try {
                    const container = document.querySelector('#advanced-options');
                    if (container) {
                        this.advancedOptionsGroup = Checkbox.createCheckboxGroup({
                            items: [
                                { label: 'ÂêØÁî®Âä®ÁîªÊïàÊûú', checked: true },
                                { label: 'Ëá™ÂÆö‰πâÊ†∑Âºè', checked: true },
                                { label: 'ÂìçÂ∫îÂºèËÆæËÆ°', checked: true }
                            ],
                            onChange: (values) => {
                                this.advancedOptions.animations = values[0];
                                this.advancedOptions.customStyling = values[1];
                                this.advancedOptions.responsive = values[2];
                            }
                        });

                        container.appendChild(this.advancedOptionsGroup.container);
                    }
                } catch (error) {
                    console.warn('Â§çÈÄâÊ°ÜÊèí‰ª∂Âä†ËΩΩÂ§±Ë¥•Ôºå‰ΩøÁî®ÈªòËÆ§ÈÄâÈ°π');
                }
            }

            setupEventListeners() {
                // ÊèíÂÖ•ÊåâÈíÆ
                document.getElementById('insert-btn').addEventListener('click', () => {
                    this.insertContent();
                });

                // Ê∏ÖÁ©∫ÊåâÈíÆ
                document.getElementById('clear-btn').addEventListener('click', () => {
                    this.clearPreview();
                });

                // ÂØºÂá∫ÊåâÈíÆ
                document.getElementById('export-btn').addEventListener('click', () => {
                    this.exportHTML();
                });

                // Êí§ÈîÄÊåâÈíÆ
                document.getElementById('undo-btn').addEventListener('click', () => {
                    this.undo();
                });

                // ÈáçÂÅöÊåâÈíÆ
                document.getElementById('redo-btn').addEventListener('click', () => {
                    this.redo();
                });

                // ÈáçÁΩÆÊåâÈíÆ
                document.getElementById('reset-btn').addEventListener('click', () => {
                    this.resetPreview();
                });

                // ÊèíÂÖ•Á±ªÂûãÂèòÂåñÂ∑≤Âú®setupControls‰∏≠ÈÄöËøáSelectÊèí‰ª∂ÁöÑonChangeÂ§ÑÁêÜ

                // Ê®°ÊùøÁÇπÂáª
                document.querySelectorAll('.template-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const template = item.dataset.template;
                        this.loadTemplate(template);
                    });
                });
            }

            populateTargetSelector() {
                // ÁõÆÊ†áÈÄâÊã©Âô®Â∑≤Âú®setupControls‰∏≠ÂàùÂßãÂåñ
                // ÁõëÂê¨Âä®ÊÄÅÊ∑ªÂä†ÁöÑÂÖÉÁ¥†
                this.observeDOMChanges();
            }

            observeDOMChanges() {
                const observer = new MutationObserver((mutations) => {
                    mutations.forEach((mutation) => {
                        if (mutation.type === 'childList') {
                            this.updateTargetSelector();
                        }
                    });
                });

                const previewContainer = document.getElementById('preview-container');
                observer.observe(previewContainer, { childList: true, subtree: true });
            }

            updateTargetSelector() {
                const previewContainer = document.getElementById('preview-container');

                // Ëé∑ÂèñÊñ∞ÂàõÂª∫ÁöÑÂÖÉÁ¥†
                const elements = previewContainer.querySelectorAll('.demo-element');

                // ÊûÑÂª∫Êñ∞ÁöÑÈÄâÈ°πÊï∞ÁªÑ
                const options = [
                    { value: 'preview-container', label: 'È¢ÑËßàÂÆπÂô® (ÈªòËÆ§)' }
                ];

                elements.forEach((element, index) => {
                    options.push({
                        value: `element-${index}`,
                        label: `ÂÖÉÁ¥† ${index + 1} (${element.tagName.toLowerCase()})`
                    });
                });

                // Êõ¥Êñ∞SelectÊèí‰ª∂ÁöÑÈÄâÈ°π
                if (this.targetSelector) {
                    this.targetSelector.setOptions(options);
                }
            }

            updateContentPlaceholder(type) {
                const textarea = document.getElementById('content-input');
                const placeholders = {
                    'html': '<div class="custom-element">\n  <h3>Ê†áÈ¢ò</h3>\n  <p>ÂÜÖÂÆπÊèèËø∞</p>\n</div>',
                    'text': 'ËøôÊòØ‰∏ÄÊÆµÁ∫ØÊñáÊú¨ÂÜÖÂÆπÔºåÂèØ‰ª•Áõ¥Êé•ÊèíÂÖ•Âà∞È°µÈù¢‰∏≠„ÄÇ',
                    'component': '<div class="component">\n  <header>ÁªÑ‰ª∂Â§¥ÈÉ®</header>\n  <main>ÁªÑ‰ª∂‰∏ª‰Ωì</main>\n  <footer>ÁªÑ‰ª∂Â∫ïÈÉ®</footer>\n</div>',
                    'form': '<form class="contact-form">\n  <input type="text" placeholder="ÂßìÂêç">\n  <input type="email" placeholder="ÈÇÆÁÆ±">\n  <textarea placeholder="Ê∂àÊÅØ"></textarea>\n  <button type="submit">Êèê‰∫§</button>\n</form>',
                    'media': '<div class="media-container">\n  <img src="https://via.placeholder.com/300x200" alt="Á§∫‰æãÂõæÁâá">\n  <video controls>\n    <source src="video.mp4" type="video/mp4">\n  </video>\n</div>'
                };

                textarea.placeholder = placeholders[type] || 'ËØ∑ËæìÂÖ•Ë¶ÅÊèíÂÖ•ÁöÑÂÜÖÂÆπ...';
            }

            insertContent() {
                const targetSelector = this.targetSelector ? this.targetSelector.getValue() : 'preview-container';
                const insertType = this.insertTypeSelect ? this.insertTypeSelect.getValue() : 'html';
                const content = document.getElementById('content-input').value.trim();

                if (!content) {
                    this.notification.warning('ËØ∑ËæìÂÖ•Ë¶ÅÊèíÂÖ•ÁöÑÂÜÖÂÆπ');
                    return;
                }

                let targetElement;
                if (targetSelector === 'preview-container') {
                    targetElement = document.getElementById('preview-container');
                } else if (targetSelector.startsWith('element-')) {
                    const index = parseInt(targetSelector.split('-')[1]);
                    const elements = document.querySelectorAll('.demo-element');
                    targetElement = elements[index];
                }

                if (!targetElement) {
                    this.notification.error('ËØ∑ÈÄâÊã©ÊúâÊïàÁöÑÁõÆÊ†áÂÖÉÁ¥†');
                    return;
                }

                // ‰øùÂ≠òÂΩìÂâçÁä∂ÊÄÅÁî®‰∫éÊí§ÈîÄ
                this.saveState();

                // ÊèíÂÖ•ÂÜÖÂÆπ
                const elementId = `demo-element-${++this.elementCounter}`;
                const wrappedContent = this.wrapContent(content, insertType, elementId);

                insertAfter(targetElement, wrappedContent);

                // ÁßªÈô§Á©∫Áä∂ÊÄÅÊèêÁ§∫
                const emptyState = document.querySelector('.preview-container.empty');
                if (emptyState) {
                    emptyState.remove();
                }

                // Êõ¥Êñ∞ÁõÆÊ†áÈÄâÊã©Âô®
                this.updateTargetSelector();

                // Ê∑ªÂä†Âà∞ÂéÜÂè≤ËÆ∞ÂΩï
                this.addToHistory(`ÊèíÂÖ•${insertType}ÂÜÖÂÆπ`, content.substring(0, 50));

                this.notification.success('ÂÜÖÂÆπÊèíÂÖ•ÊàêÂäüÔºÅ');
            }

            wrapContent(content, type, elementId) {
                let wrappedContent = '';

                if (type === 'html') {
                    wrappedContent = content;
                } else if (type === 'text') {
                    wrappedContent = `<p>${content}</p>`;
                } else {
                    wrappedContent = content;
                }

                // ÂåÖË£ÖÂú®demo-element‰∏≠
                return `
                    <div class="demo-element" id="${elementId}">
                        <div class="element-controls">
                            <button class="element-btn edit" onclick="pageBuilder.editElement('${elementId}')">ÁºñËæë</button>
                            <button class="element-btn delete" onclick="pageBuilder.deleteElement('${elementId}')">Âà†Èô§</button>
                        </div>
                        ${wrappedContent}
                    </div>
                `;
            }

            loadTemplate(templateName) {
                const templates = {
                    card: `
                        <div class="info-card">
                            <div class="card-header">
                                <h3>‰ø°ÊÅØÂç°Áâá</h3>
                                <span class="badge">NEW</span>
                            </div>
                            <div class="card-body">
                                <p>ËøôÊòØ‰∏Ä‰∏™‰ø°ÊÅØÂç°ÁâáÁöÑÁ§∫‰æãÔºåÂ±ïÁ§∫‰∫ÜÂ¶Ç‰Ωï‰ΩøÁî®Ê®°ÊùøÂø´ÈÄüÂàõÂª∫ÂÜÖÂÆπ„ÄÇ</p>
                                <div class="card-actions">
                                    <button class="btn btn-primary">‰∫ÜËß£Êõ¥Â§ö</button>
                                    <button class="btn btn-secondary">ÂÖ≥Èó≠</button>
                                </div>
                            </div>
                        </div>
                    `,
                    form: `
                        <form class="contact-form">
                            <h3>ËÅîÁ≥ªÊàë‰ª¨</h3>
                            <div class="form-group">
                                <label>ÂßìÂêç:</label>
                                <input type="text" placeholder="ËØ∑ËæìÂÖ•ÊÇ®ÁöÑÂßìÂêç" required>
                            </div>
                            <div class="form-group">
                                <label>ÈÇÆÁÆ±:</label>
                                <input type="email" placeholder="ËØ∑ËæìÂÖ•ÊÇ®ÁöÑÈÇÆÁÆ±" required>
                            </div>
                            <div class="form-group">
                                <label>Ê∂àÊÅØ:</label>
                                <textarea placeholder="ËØ∑ËæìÂÖ•ÊÇ®ÁöÑÊ∂àÊÅØ" rows="4" required></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary">ÂèëÈÄÅÊ∂àÊÅØ</button>
                        </form>
                    `,
                    gallery: `
                        <div class="image-gallery">
                            <h3>ÂõæÁâáÁîªÂªä</h3>
                            <div class="gallery-grid">
                                <img src="https://via.placeholder.com/200x150/4facfe/ffffff?text=ÂõæÁâá1" alt="ÂõæÁâá1">
                                <img src="https://via.placeholder.com/200x150/00f2fe/ffffff?text=ÂõæÁâá2" alt="ÂõæÁâá2">
                                <img src="https://via.placeholder.com/200x150/56ab2f/ffffff?text=ÂõæÁâá3" alt="ÂõæÁâá3">
                                <img src="https://via.placeholder.com/200x150/f093fb/ffffff?text=ÂõæÁâá4" alt="ÂõæÁâá4">
                            </div>
                        </div>
                    `,
                    table: `
                        <div class="data-table">
                            <h3>Êï∞ÊçÆË°®Ê†º</h3>
                            <table>
                                <thead>
                                    <tr>
                                        <th>ÂßìÂêç</th>
                                        <th>Âπ¥ÈæÑ</th>
                                        <th>ËÅå‰∏ö</th>
                                        <th>Êìç‰Ωú</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Âº†‰∏â</td>
                                        <td>25</td>
                                        <td>Â∑•Á®ãÂ∏à</td>
                                        <td><button class="btn btn-secondary">ÁºñËæë</button></td>
                                    </tr>
                                    <tr>
                                        <td>ÊùéÂõõ</td>
                                        <td>30</td>
                                        <td>ËÆæËÆ°Â∏à</td>
                                        <td><button class="btn btn-secondary">ÁºñËæë</button></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    `
                };

                const content = templates[templateName];
                if (content) {
                    document.getElementById('content-input').value = content;
                    if (this.insertTypeSelect) {
                        this.insertTypeSelect.setValue('html');
                    }
                    this.notification.success(`Â∑≤Âä†ËΩΩ ${templateName} Ê®°Êùø`);
                }
            }

            editElement(elementId) {
                const element = document.getElementById(elementId);
                if (!element) return;

                const content = element.innerHTML.replace(/<div class="element-controls">[\s\S]*?<\/div>/, '').trim();

                this.modal.prompt('ÁºñËæëÂÖÉÁ¥†ÂÜÖÂÆπ:', content).then((newContent) => {
                    if (newContent && newContent !== content) {
                        this.saveState();

                        // Êõ¥Êñ∞ÂÖÉÁ¥†ÂÜÖÂÆπ
                        const controls = element.querySelector('.element-controls');
                        element.innerHTML = controls.outerHTML + newContent;

                        this.addToHistory('ÁºñËæëÂÖÉÁ¥†', newContent.substring(0, 50));
                        this.notification.success('ÂÖÉÁ¥†ÁºñËæëÊàêÂäüÔºÅ');
                    }
                });
            }

            deleteElement(elementId) {
                const element = document.getElementById(elementId);
                if (!element) return;

                this.modal.confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™ÂÖÉÁ¥†ÂêóÔºü').then((confirmed) => {
                    if (confirmed) {
                        this.saveState();
                        element.remove();

                        // Ê£ÄÊü•ÊòØÂê¶ËøòÊúâÂÖ∂‰ªñÂÖÉÁ¥†
                        const remainingElements = document.querySelectorAll('.demo-element');
                        if (remainingElements.length === 0) {
                            this.showEmptyState();
                        }

                        this.updateTargetSelector();
                        this.addToHistory('Âà†Èô§ÂÖÉÁ¥†', elementId);
                        this.notification.success('ÂÖÉÁ¥†Âà†Èô§ÊàêÂäüÔºÅ');
                    }
                });
            }

            saveState() {
                const currentState = document.getElementById('preview-container').innerHTML;
                this.undoStack.push(currentState);
                this.redoStack = []; // Ê∏ÖÁ©∫ÈáçÂÅöÊ†à
            }

            undo() {
                if (this.undoStack.length === 0) {
                    this.notification.warning('Ê≤°ÊúâÂèØÊí§ÈîÄÁöÑÊìç‰Ωú');
                    return;
                }

                const currentState = document.getElementById('preview-container').innerHTML;
                this.redoStack.push(currentState);

                const previousState = this.undoStack.pop();
                document.getElementById('preview-container').innerHTML = previousState;

                this.updateTargetSelector();
                this.addToHistory('Êí§ÈîÄÊìç‰Ωú', 'Êí§ÈîÄ');
                this.notification.success('Êìç‰ΩúÂ∑≤Êí§ÈîÄ');
            }

            redo() {
                if (this.redoStack.length === 0) {
                    this.notification.warning('Ê≤°ÊúâÂèØÈáçÂÅöÁöÑÊìç‰Ωú');
                    return;
                }

                const currentState = document.getElementById('preview-container').innerHTML;
                this.undoStack.push(currentState);

                const nextState = this.redoStack.pop();
                document.getElementById('preview-container').innerHTML = nextState;

                this.updateTargetSelector();
                this.addToHistory('ÈáçÂÅöÊìç‰Ωú', 'ÈáçÂÅö');
                this.notification.success('Êìç‰ΩúÂ∑≤ÈáçÂÅö');
            }

            clearPreview() {
                this.modal.confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâÂÜÖÂÆπÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄ„ÄÇ').then((confirmed) => {
                    if (confirmed) {
                        this.saveState();
                        document.getElementById('preview-container').innerHTML = '';
                        this.showEmptyState();
                        this.updateTargetSelector();
                        this.addToHistory('Ê∏ÖÁ©∫È¢ÑËßà', 'Ê∏ÖÁ©∫ÊâÄÊúâÂÜÖÂÆπ');
                        this.notification.success('È¢ÑËßàÂÜÖÂÆπÂ∑≤Ê∏ÖÁ©∫');
                    }
                });
            }

            resetPreview() {
                this.modal.confirm('Á°ÆÂÆöË¶ÅÈáçÁΩÆ‰∏∫ÂàùÂßãÁä∂ÊÄÅÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄ„ÄÇ').then((confirmed) => {
                    if (confirmed) {
                        this.saveState();
                        this.showEmptyState();
                        this.updateTargetSelector();
                        this.addToHistory('ÈáçÁΩÆÈ¢ÑËßà', 'ÈáçÁΩÆ‰∏∫ÂàùÂßãÁä∂ÊÄÅ');
                        this.notification.success('È¢ÑËßàÂ∑≤ÈáçÁΩÆ');
                    }
                });
            }

            showEmptyState() {
                const container = document.getElementById('preview-container');
                container.innerHTML = `
                    <div class="preview-container empty">
                        <div>
                            <h4>üéâ Ê¨¢Ëøé‰ΩøÁî®Âä®ÊÄÅÂÜÖÂÆπÊèíÂÖ•Âô®ÔºÅ</h4>
                            <p>Âú®Â∑¶‰æßÈÖçÁΩÆÊèíÂÖ•ÂÜÖÂÆπÔºåËøôÈáåÂ∞ÜÊòæÁ§∫ÂÆûÊó∂È¢ÑËßàÊïàÊûú</p>
                        </div>
                    </div>
                `;
            }

            exportHTML() {
                const previewContainer = document.getElementById('preview-container');
                const html = previewContainer.innerHTML;

                if (!html || html.includes('preview-container empty')) {
                    this.notification.warning('Ê≤°ÊúâÂÜÖÂÆπÂèØÂØºÂá∫');
                    return;
                }

                const fullHTML = `
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÂØºÂá∫ÁöÑÈ°µÈù¢</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .demo-element { margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .btn { padding: 8px 16px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-primary { background: #007bff; color: white; }
        .btn-secondary { background: #6c757d; color: white; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; }
        .form-group input, .form-group textarea { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        .gallery-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .gallery-grid img { width: 100%; height: auto; border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: #f8f9fa; }
    </style>
</head>
<body>
    ${html}
</body>
</html>`;

                const blob = new Blob([fullHTML], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `page-${Date.now()}.html`;
                a.click();
                URL.revokeObjectURL(url);

                this.addToHistory('ÂØºÂá∫HTML', 'ÂØºÂá∫ÂÆåÊï¥È°µÈù¢');
                this.notification.success('HTMLÊñá‰ª∂ÂØºÂá∫ÊàêÂäüÔºÅ');
            }

            addToHistory(action, content) {
                const historyList = document.getElementById('history-list');
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';

                const time = new Date().toLocaleTimeString();
                historyItem.innerHTML = `
                    <div>${action}: ${content}</div>
                    <div class="time">${time}</div>
                `;

                historyList.insertBefore(historyItem, historyList.firstChild);

                // ÈôêÂà∂ÂéÜÂè≤ËÆ∞ÂΩïÊï∞Èáè
                if (historyList.children.length > 10) {
                    historyList.removeChild(historyList.lastChild);
                }
            }
        }

        // ÂàùÂßãÂåñÂ∫îÁî®
        let pageBuilder;
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                pageBuilder = new PageBuilder();
            });
        } else {
            pageBuilder = new PageBuilder();
        }
    </script>
</body>

</html>