<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠ¨æ€å†…å®¹æ’å…¥å™¨ä¸é¡µé¢æ„å»ºå·¥å…·</title>
    <link rel="stylesheet" href="../../demo/plugins/modal/style.css">
    <link rel="stylesheet" href="../../demo/plugins/checkbox/style.css">
    <link rel="stylesheet" href="../../demo/plugins/input-number/style.css">
    <link rel="stylesheet" href="../../demo/plugins/select/style.css">
    <link rel="stylesheet" href="../../demo/plugins/notification/style.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .app-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .app-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .app-header p {
            font-size: 1.1rem;
            color: #666;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
        }

        .control-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            height: fit-content;
        }

        .control-section {
            margin-bottom: 25px;
        }

        .control-section h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .element-selector {
            margin-bottom: 15px;
        }

        .element-selector label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .element-selector select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
        }

        .insert-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .insert-type {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .insert-type label {
            font-weight: 600;
            color: #555;
        }

        .insert-type select {
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
        }

        .content-input {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .content-input label {
            font-weight: 600;
            color: #555;
        }

        .content-input textarea {
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            min-height: 100px;
            resize: vertical;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        }

        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }

        .preview-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .preview-header h3 {
            color: #333;
        }

        .preview-actions {
            display: flex;
            gap: 10px;
        }

        .preview-container {
            min-height: 500px;
            border: 2px dashed #e9ecef;
            border-radius: 10px;
            padding: 20px;
            background: #f8f9fa;
        }

        .preview-container.empty {
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 1.1rem;
        }

        .demo-element {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            position: relative;
        }

        .demo-element:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
        }

        .element-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .demo-element:hover .element-controls {
            opacity: 1;
        }

        .element-btn {
            padding: 4px 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            background: #6c757d;
            color: white;
        }

        .element-btn:hover {
            background: #495057;
        }

        .element-btn.delete {
            background: #dc3545;
        }

        .element-btn.delete:hover {
            background: #c82333;
        }

        .template-gallery {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #e9ecef;
        }

        .template-gallery h4 {
            margin-bottom: 15px;
            color: #333;
        }

        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .template-item {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .template-item:hover {
            border-color: #4facfe;
            background: #e3f2fd;
            transform: translateY(-2px);
        }

        .template-item h5 {
            margin-bottom: 8px;
            color: #333;
        }

        .template-item p {
            font-size: 0.9rem;
            color: #666;
        }

        .history-panel {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #e9ecef;
        }

        .history-panel h4 {
            margin-bottom: 15px;
            color: #333;
        }

        .history-list {
            max-height: 200px;
            overflow-y: auto;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 10px;
        }

        .history-item {
            padding: 8px;
            margin-bottom: 5px;
            background: white;
            border-radius: 4px;
            border-left: 3px solid #4facfe;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .history-item:hover {
            background: #e3f2fd;
            transform: translateX(5px);
        }

        .history-item .time {
            color: #666;
            font-size: 0.8rem;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .app-header h1 {
                font-size: 2rem;
            }

            .preview-actions {
                flex-direction: column;
            }

            .template-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="app-container">
        <header class="app-header">
            <h1>ğŸ”§ åŠ¨æ€å†…å®¹æ’å…¥å™¨</h1>
            <p>åŸºäº insertAfter å‡½æ•°çš„é¡µé¢æ„å»ºå·¥å…·</p>
        </header>

        <main class="main-content">
            <div class="control-panel">
                <div class="control-section">
                    <h3>ğŸ¯ ç›®æ ‡å…ƒç´ é€‰æ‹©</h3>
                    <div class="element-selector">
                        <label>é€‰æ‹©ç›®æ ‡å…ƒç´ :</label>
                        <div id="target-selector"></div>
                    </div>
                </div>

                <div class="control-section">
                    <h3>ğŸ“ æ’å…¥å†…å®¹é…ç½®</h3>
                    <div class="insert-controls">
                        <div class="insert-type">
                            <label>æ’å…¥ç±»å‹:</label>
                            <div id="insert-type"></div>
                        </div>

                        <div class="content-input">
                            <label>å†…å®¹å†…å®¹:</label>
                            <textarea id="content-input" placeholder="è¯·è¾“å…¥è¦æ’å…¥çš„å†…å®¹..."></textarea>
                        </div>

                        <div class="action-buttons">
                            <button id="insert-btn" class="btn btn-primary">æ’å…¥å†…å®¹</button>
                            <button id="clear-btn" class="btn btn-warning">æ¸…ç©ºé¢„è§ˆ</button>
                            <button id="export-btn" class="btn btn-success">å¯¼å‡ºHTML</button>
                        </div>
                    </div>
                </div>

                <div class="control-section">
                    <h3>âš™ï¸ é«˜çº§é€‰é¡¹</h3>
                    <div id="advanced-options">
                        <!-- å¤é€‰æ¡†å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>

            <div class="preview-panel">
                <div class="preview-header">
                    <h3>ğŸ‘ï¸ å®æ—¶é¢„è§ˆ</h3>
                    <div class="preview-actions">
                        <button id="undo-btn" class="btn btn-secondary">æ’¤é”€</button>
                        <button id="redo-btn" class="btn btn-secondary">é‡åš</button>
                        <button id="reset-btn" class="btn btn-warning">é‡ç½®</button>
                    </div>
                </div>

                <div class="preview-container" id="preview-container">
                    <div class="preview-container empty">
                        <div>
                            <h4>ğŸ‰ æ¬¢è¿ä½¿ç”¨åŠ¨æ€å†…å®¹æ’å…¥å™¨ï¼</h4>
                            <p>åœ¨å·¦ä¾§é…ç½®æ’å…¥å†…å®¹ï¼Œè¿™é‡Œå°†æ˜¾ç¤ºå®æ—¶é¢„è§ˆæ•ˆæœ</p>
                        </div>
                    </div>
                </div>

                <div class="template-gallery">
                    <h4>ğŸ“‹ å¿«é€Ÿæ¨¡æ¿</h4>
                    <div class="template-grid">
                        <div class="template-item" data-template="card">
                            <h5>ä¿¡æ¯å¡ç‰‡</h5>
                            <p>åˆ›å»ºä¸€ä¸ªç¾è§‚çš„ä¿¡æ¯å¡ç‰‡</p>
                        </div>
                        <div class="template-item" data-template="form">
                            <h5>è”ç³»è¡¨å•</h5>
                            <p>æ’å…¥ä¸€ä¸ªå®Œæ•´çš„è”ç³»è¡¨å•</p>
                        </div>
                        <div class="template-item" data-template="gallery">
                            <h5>å›¾ç‰‡ç”»å»Š</h5>
                            <p>åˆ›å»ºä¸€ä¸ªå“åº”å¼å›¾ç‰‡ç”»å»Š</p>
                        </div>
                        <div class="template-item" data-template="table">
                            <h5>æ•°æ®è¡¨æ ¼</h5>
                            <p>æ’å…¥ä¸€ä¸ªå¯æ’åºçš„æ•°æ®è¡¨æ ¼</p>
                        </div>
                    </div>
                </div>

                <div class="history-panel">
                    <h4>ğŸ“š æ“ä½œå†å²</h4>
                    <div class="history-list" id="history-list">
                        <div class="history-item">
                            <div>é¡µé¢åˆå§‹åŒ–</div>
                            <div class="time">åˆšåˆš</div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- å¼•å…¥æ’ä»¶ -->
    <script src="../../demo/plugins/modal/index.js"></script>
    <script src="../../demo/plugins/checkbox/index.js"></script>
    <script src="../../demo/plugins/input-number/index.js"></script>
    <script src="../../demo/plugins/select/index.js"></script>
    <script src="../../demo/plugins/notification/index.js"></script>

    <script>
        // æ ¸å¿ƒå‡½æ•°
        const insertAfter = (el, html) => el.insertAdjacentHTML('afterend', html);

        // é¡µé¢æ„å»ºå™¨ä¸»ç±»
        class PageBuilder {
            constructor() {
                this.currentTarget = null;
                this.insertHistory = [];
                this.undoStack = [];
                this.redoStack = [];
                this.elementCounter = 0;
                this.advancedOptions = {
                    animations: true,
                    customStyling: true,
                    responsive: true
                };

                this.modal = new Modal();
                this.notification = new Notification();

                this.init();
            }

            init() {
                this.setupControls();
                this.setupEventListeners();
                this.populateTargetSelector();
                this.addToHistory('é¡µé¢åˆå§‹åŒ–', 'ç³»ç»Ÿ');
            }

            setupControls() {
                // ç›®æ ‡å…ƒç´ é€‰æ‹©å™¨
                this.targetSelector = new Select({
                    container: '#target-selector',
                    options: [
                        { value: 'preview-container', label: 'é¢„è§ˆå®¹å™¨ (é»˜è®¤)' }
                    ],
                    onChange: (value) => {
                        // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ é€‰æ‹©ç›®æ ‡å…ƒç´ åçš„é€»è¾‘
                    }
                });

                // æ’å…¥ç±»å‹é€‰æ‹©å™¨
                this.insertTypeSelect = new Select({
                    container: '#insert-type',
                    options: [
                        { value: 'html', label: 'HTMLå…ƒç´ ' },
                        { value: 'text', label: 'çº¯æ–‡æœ¬' },
                        { value: 'component', label: 'ç»„ä»¶æ¨¡æ¿' },
                        { value: 'form', label: 'è¡¨å•å…ƒç´ ' },
                        { value: 'media', label: 'åª’ä½“å…ƒç´ ' }
                    ],
                    onChange: (value) => {
                        this.updateContentPlaceholder(value);
                    }
                });

                // é«˜çº§é€‰é¡¹å¤é€‰æ¡†
                try {
                    const container = document.querySelector('#advanced-options');
                    if (container) {
                        this.advancedOptionsGroup = Checkbox.createCheckboxGroup({
                            items: [
                                { label: 'å¯ç”¨åŠ¨ç”»æ•ˆæœ', checked: true },
                                { label: 'è‡ªå®šä¹‰æ ·å¼', checked: true },
                                { label: 'å“åº”å¼è®¾è®¡', checked: true }
                            ],
                            onChange: (values) => {
                                this.advancedOptions.animations = values[0];
                                this.advancedOptions.customStyling = values[1];
                                this.advancedOptions.responsive = values[2];
                            }
                        });

                        container.appendChild(this.advancedOptionsGroup.container);
                    }
                } catch (error) {
                    console.warn('å¤é€‰æ¡†æ’ä»¶åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤é€‰é¡¹');
                }
            }

            setupEventListeners() {
                // æ’å…¥æŒ‰é’®
                document.getElementById('insert-btn').addEventListener('click', () => {
                    this.insertContent();
                });

                // æ¸…ç©ºæŒ‰é’®
                document.getElementById('clear-btn').addEventListener('click', () => {
                    this.clearPreview();
                });

                // å¯¼å‡ºæŒ‰é’®
                document.getElementById('export-btn').addEventListener('click', () => {
                    this.exportHTML();
                });

                // æ’¤é”€æŒ‰é’®
                document.getElementById('undo-btn').addEventListener('click', () => {
                    this.undo();
                });

                // é‡åšæŒ‰é’®
                document.getElementById('redo-btn').addEventListener('click', () => {
                    this.redo();
                });

                // é‡ç½®æŒ‰é’®
                document.getElementById('reset-btn').addEventListener('click', () => {
                    this.resetPreview();
                });

                // æ’å…¥ç±»å‹å˜åŒ–å·²åœ¨setupControlsä¸­é€šè¿‡Selectæ’ä»¶çš„onChangeå¤„ç†

                // æ¨¡æ¿ç‚¹å‡»
                document.querySelectorAll('.template-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const template = item.dataset.template;
                        this.loadTemplate(template);
                    });
                });
            }

            populateTargetSelector() {
                // ç›®æ ‡é€‰æ‹©å™¨å·²åœ¨setupControlsä¸­åˆå§‹åŒ–
                // ç›‘å¬åŠ¨æ€æ·»åŠ çš„å…ƒç´ 
                this.observeDOMChanges();
            }

            observeDOMChanges() {
                const observer = new MutationObserver((mutations) => {
                    mutations.forEach((mutation) => {
                        if (mutation.type === 'childList') {
                            this.updateTargetSelector();
                        }
                    });
                });

                const previewContainer = document.getElementById('preview-container');
                observer.observe(previewContainer, { childList: true, subtree: true });
            }

            updateTargetSelector() {
                const previewContainer = document.getElementById('preview-container');

                // è·å–æ–°åˆ›å»ºçš„å…ƒç´ 
                const elements = previewContainer.querySelectorAll('.demo-element');

                // æ„å»ºæ–°çš„é€‰é¡¹æ•°ç»„
                const options = [
                    { value: 'preview-container', label: 'é¢„è§ˆå®¹å™¨ (é»˜è®¤)' }
                ];

                elements.forEach((element, index) => {
                    options.push({
                        value: `element-${index}`,
                        label: `å…ƒç´  ${index + 1} (${element.tagName.toLowerCase()})`
                    });
                });

                // æ›´æ–°Selectæ’ä»¶çš„é€‰é¡¹
                if (this.targetSelector) {
                    this.targetSelector.setOptions(options);
                }
            }

            updateContentPlaceholder(type) {
                const textarea = document.getElementById('content-input');
                const placeholders = {
                    'html': '<div class="custom-element">\n  <h3>æ ‡é¢˜</h3>\n  <p>å†…å®¹æè¿°</p>\n</div>',
                    'text': 'è¿™æ˜¯ä¸€æ®µçº¯æ–‡æœ¬å†…å®¹ï¼Œå¯ä»¥ç›´æ¥æ’å…¥åˆ°é¡µé¢ä¸­ã€‚',
                    'component': '<div class="component">\n  <header>ç»„ä»¶å¤´éƒ¨</header>\n  <main>ç»„ä»¶ä¸»ä½“</main>\n  <footer>ç»„ä»¶åº•éƒ¨</footer>\n</div>',
                    'form': '<form class="contact-form">\n  <input type="text" placeholder="å§“å">\n  <input type="email" placeholder="é‚®ç®±">\n  <textarea placeholder="æ¶ˆæ¯"></textarea>\n  <button type="submit">æäº¤</button>\n</form>',
                    'media': '<div class="media-container">\n  <img src="https://via.placeholder.com/300x200" alt="ç¤ºä¾‹å›¾ç‰‡">\n  <video controls>\n    <source src="video.mp4" type="video/mp4">\n  </video>\n</div>'
                };

                textarea.placeholder = placeholders[type] || 'è¯·è¾“å…¥è¦æ’å…¥çš„å†…å®¹...';
            }

            insertContent() {
                const targetSelector = this.targetSelector ? this.targetSelector.getValue() : 'preview-container';
                const insertType = this.insertTypeSelect ? this.insertTypeSelect.getValue() : 'html';
                const content = document.getElementById('content-input').value.trim();

                if (!content) {
                    this.notification.warning('è¯·è¾“å…¥è¦æ’å…¥çš„å†…å®¹');
                    return;
                }

                let targetElement;
                if (targetSelector === 'preview-container') {
                    targetElement = document.getElementById('preview-container');
                } else if (targetSelector.startsWith('element-')) {
                    const index = parseInt(targetSelector.split('-')[1]);
                    const elements = document.querySelectorAll('.demo-element');
                    targetElement = elements[index];
                }

                if (!targetElement) {
                    this.notification.error('è¯·é€‰æ‹©æœ‰æ•ˆçš„ç›®æ ‡å…ƒç´ ');
                    return;
                }

                // ä¿å­˜å½“å‰çŠ¶æ€ç”¨äºæ’¤é”€
                this.saveState();

                // æ’å…¥å†…å®¹
                const elementId = `demo-element-${++this.elementCounter}`;
                const wrappedContent = this.wrapContent(content, insertType, elementId);

                insertAfter(targetElement, wrappedContent);

                // ç§»é™¤ç©ºçŠ¶æ€æç¤º
                const emptyState = document.querySelector('.preview-container.empty');
                if (emptyState) {
                    emptyState.remove();
                }

                // æ›´æ–°ç›®æ ‡é€‰æ‹©å™¨
                this.updateTargetSelector();

                // æ·»åŠ åˆ°å†å²è®°å½•
                this.addToHistory(`æ’å…¥${insertType}å†…å®¹`, content.substring(0, 50));

                this.notification.success('å†…å®¹æ’å…¥æˆåŠŸï¼');
            }

            wrapContent(content, type, elementId) {
                let wrappedContent = '';

                if (type === 'html') {
                    wrappedContent = content;
                } else if (type === 'text') {
                    wrappedContent = `<p>${content}</p>`;
                } else {
                    wrappedContent = content;
                }

                // åŒ…è£…åœ¨demo-elementä¸­
                return `
                    <div class="demo-element" id="${elementId}">
                        <div class="element-controls">
                            <button class="element-btn edit" onclick="pageBuilder.editElement('${elementId}')">ç¼–è¾‘</button>
                            <button class="element-btn delete" onclick="pageBuilder.deleteElement('${elementId}')">åˆ é™¤</button>
                        </div>
                        ${wrappedContent}
                    </div>
                `;
            }

            loadTemplate(templateName) {
                const templates = {
                    card: `
                        <div class="info-card">
                            <div class="card-header">
                                <h3>ä¿¡æ¯å¡ç‰‡</h3>
                                <span class="badge">NEW</span>
                            </div>
                            <div class="card-body">
                                <p>è¿™æ˜¯ä¸€ä¸ªä¿¡æ¯å¡ç‰‡çš„ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨æ¨¡æ¿å¿«é€Ÿåˆ›å»ºå†…å®¹ã€‚</p>
                                <div class="card-actions">
                                    <button class="btn btn-primary">äº†è§£æ›´å¤š</button>
                                    <button class="btn btn-secondary">å…³é—­</button>
                                </div>
                            </div>
                        </div>
                    `,
                    form: `
                        <form class="contact-form">
                            <h3>è”ç³»æˆ‘ä»¬</h3>
                            <div class="form-group">
                                <label>å§“å:</label>
                                <input type="text" placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å" required>
                            </div>
                            <div class="form-group">
                                <label>é‚®ç®±:</label>
                                <input type="email" placeholder="è¯·è¾“å…¥æ‚¨çš„é‚®ç®±" required>
                            </div>
                            <div class="form-group">
                                <label>æ¶ˆæ¯:</label>
                                <textarea placeholder="è¯·è¾“å…¥æ‚¨çš„æ¶ˆæ¯" rows="4" required></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary">å‘é€æ¶ˆæ¯</button>
                        </form>
                    `,
                    gallery: `
                        <div class="image-gallery">
                            <h3>å›¾ç‰‡ç”»å»Š</h3>
                            <div class="gallery-grid">
                                <img src="https://via.placeholder.com/200x150/4facfe/ffffff?text=å›¾ç‰‡1" alt="å›¾ç‰‡1">
                                <img src="https://via.placeholder.com/200x150/00f2fe/ffffff?text=å›¾ç‰‡2" alt="å›¾ç‰‡2">
                                <img src="https://via.placeholder.com/200x150/56ab2f/ffffff?text=å›¾ç‰‡3" alt="å›¾ç‰‡3">
                                <img src="https://via.placeholder.com/200x150/f093fb/ffffff?text=å›¾ç‰‡4" alt="å›¾ç‰‡4">
                            </div>
                        </div>
                    `,
                    table: `
                        <div class="data-table">
                            <h3>æ•°æ®è¡¨æ ¼</h3>
                            <table>
                                <thead>
                                    <tr>
                                        <th>å§“å</th>
                                        <th>å¹´é¾„</th>
                                        <th>èŒä¸š</th>
                                        <th>æ“ä½œ</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>å¼ ä¸‰</td>
                                        <td>25</td>
                                        <td>å·¥ç¨‹å¸ˆ</td>
                                        <td><button class="btn btn-secondary">ç¼–è¾‘</button></td>
                                    </tr>
                                    <tr>
                                        <td>æå››</td>
                                        <td>30</td>
                                        <td>è®¾è®¡å¸ˆ</td>
                                        <td><button class="btn btn-secondary">ç¼–è¾‘</button></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    `
                };

                const content = templates[templateName];
                if (content) {
                    document.getElementById('content-input').value = content;
                    if (this.insertTypeSelect) {
                        this.insertTypeSelect.setValue('html');
                    }
                    this.notification.success(`å·²åŠ è½½ ${templateName} æ¨¡æ¿`);
                }
            }

            editElement(elementId) {
                const element = document.getElementById(elementId);
                if (!element) return;

                const content = element.innerHTML.replace(/<div class="element-controls">[\s\S]*?<\/div>/, '').trim();

                this.modal.prompt('ç¼–è¾‘å…ƒç´ å†…å®¹:', content).then((newContent) => {
                    if (newContent && newContent !== content) {
                        this.saveState();

                        // æ›´æ–°å…ƒç´ å†…å®¹
                        const controls = element.querySelector('.element-controls');
                        element.innerHTML = controls.outerHTML + newContent;

                        this.addToHistory('ç¼–è¾‘å…ƒç´ ', newContent.substring(0, 50));
                        this.notification.success('å…ƒç´ ç¼–è¾‘æˆåŠŸï¼');
                    }
                });
            }

            deleteElement(elementId) {
                const element = document.getElementById(elementId);
                if (!element) return;

                this.modal.confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå…ƒç´ å—ï¼Ÿ').then((confirmed) => {
                    if (confirmed) {
                        this.saveState();
                        element.remove();

                        // æ£€æŸ¥æ˜¯å¦è¿˜æœ‰å…¶ä»–å…ƒç´ 
                        const remainingElements = document.querySelectorAll('.demo-element');
                        if (remainingElements.length === 0) {
                            this.showEmptyState();
                        }

                        this.updateTargetSelector();
                        this.addToHistory('åˆ é™¤å…ƒç´ ', elementId);
                        this.notification.success('å…ƒç´ åˆ é™¤æˆåŠŸï¼');
                    }
                });
            }

            saveState() {
                const currentState = document.getElementById('preview-container').innerHTML;
                this.undoStack.push(currentState);
                this.redoStack = []; // æ¸…ç©ºé‡åšæ ˆ
            }

            undo() {
                if (this.undoStack.length === 0) {
                    this.notification.warning('æ²¡æœ‰å¯æ’¤é”€çš„æ“ä½œ');
                    return;
                }

                const currentState = document.getElementById('preview-container').innerHTML;
                this.redoStack.push(currentState);

                const previousState = this.undoStack.pop();
                document.getElementById('preview-container').innerHTML = previousState;

                this.updateTargetSelector();
                this.addToHistory('æ’¤é”€æ“ä½œ', 'æ’¤é”€');
                this.notification.success('æ“ä½œå·²æ’¤é”€');
            }

            redo() {
                if (this.redoStack.length === 0) {
                    this.notification.warning('æ²¡æœ‰å¯é‡åšçš„æ“ä½œ');
                    return;
                }

                const currentState = document.getElementById('preview-container').innerHTML;
                this.undoStack.push(currentState);

                const nextState = this.redoStack.pop();
                document.getElementById('preview-container').innerHTML = nextState;

                this.updateTargetSelector();
                this.addToHistory('é‡åšæ“ä½œ', 'é‡åš');
                this.notification.success('æ“ä½œå·²é‡åš');
            }

            clearPreview() {
                this.modal.confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†…å®¹å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚').then((confirmed) => {
                    if (confirmed) {
                        this.saveState();
                        document.getElementById('preview-container').innerHTML = '';
                        this.showEmptyState();
                        this.updateTargetSelector();
                        this.addToHistory('æ¸…ç©ºé¢„è§ˆ', 'æ¸…ç©ºæ‰€æœ‰å†…å®¹');
                        this.notification.success('é¢„è§ˆå†…å®¹å·²æ¸…ç©º');
                    }
                });
            }

            resetPreview() {
                this.modal.confirm('ç¡®å®šè¦é‡ç½®ä¸ºåˆå§‹çŠ¶æ€å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚').then((confirmed) => {
                    if (confirmed) {
                        this.saveState();
                        this.showEmptyState();
                        this.updateTargetSelector();
                        this.addToHistory('é‡ç½®é¢„è§ˆ', 'é‡ç½®ä¸ºåˆå§‹çŠ¶æ€');
                        this.notification.success('é¢„è§ˆå·²é‡ç½®');
                    }
                });
            }

            showEmptyState() {
                const container = document.getElementById('preview-container');
                container.innerHTML = `
                    <div class="preview-container empty">
                        <div>
                            <h4>ğŸ‰ æ¬¢è¿ä½¿ç”¨åŠ¨æ€å†…å®¹æ’å…¥å™¨ï¼</h4>
                            <p>åœ¨å·¦ä¾§é…ç½®æ’å…¥å†…å®¹ï¼Œè¿™é‡Œå°†æ˜¾ç¤ºå®æ—¶é¢„è§ˆæ•ˆæœ</p>
                        </div>
                    </div>
                `;
            }

            exportHTML() {
                const previewContainer = document.getElementById('preview-container');
                const html = previewContainer.innerHTML;

                if (!html || html.includes('preview-container empty')) {
                    this.notification.warning('æ²¡æœ‰å†…å®¹å¯å¯¼å‡º');
                    return;
                }

                const fullHTML = `
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯¼å‡ºçš„é¡µé¢</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .demo-element { margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .btn { padding: 8px 16px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-primary { background: #007bff; color: white; }
        .btn-secondary { background: #6c757d; color: white; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; }
        .form-group input, .form-group textarea { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        .gallery-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .gallery-grid img { width: 100%; height: auto; border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: #f8f9fa; }
    </style>
</head>
<body>
    ${html}
</body>
</html>`;

                const blob = new Blob([fullHTML], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `page-${Date.now()}.html`;
                a.click();
                URL.revokeObjectURL(url);

                this.addToHistory('å¯¼å‡ºHTML', 'å¯¼å‡ºå®Œæ•´é¡µé¢');
                this.notification.success('HTMLæ–‡ä»¶å¯¼å‡ºæˆåŠŸï¼');
            }

            addToHistory(action, content) {
                const historyList = document.getElementById('history-list');
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';

                const time = new Date().toLocaleTimeString();
                historyItem.innerHTML = `
                    <div>${action}: ${content}</div>
                    <div class="time">${time}</div>
                `;

                historyList.insertBefore(historyItem, historyList.firstChild);

                // é™åˆ¶å†å²è®°å½•æ•°é‡
                if (historyList.children.length > 10) {
                    historyList.removeChild(historyList.lastChild);
                }
            }
        }

        // åˆå§‹åŒ–åº”ç”¨
        let pageBuilder;
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                pageBuilder = new PageBuilder();
            });
        } else {
            pageBuilder = new PageBuilder();
        }
    </script>
</body>

</html>