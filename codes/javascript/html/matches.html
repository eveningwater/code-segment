<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯¹è±¡åŒ¹é…éªŒè¯å¹³å° - matches</title>
    <link rel="stylesheet" href="../../demo/plugins/modal/style.css">
    <link rel="stylesheet" href="../../demo/plugins/checkbox/style.css">
    <link rel="stylesheet" href="../../demo/plugins/notification/style.css">
    <link rel="stylesheet" href="../../demo/plugins/select/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            min-height: 100vh;
            color: #1f2937;
            line-height: 1.6;
            padding-bottom: 40px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 36px;
            color: white;
        }

        .header h1 {
            font-size: 2.7rem;
            margin-bottom: 12px;
            font-weight: 800;
            text-shadow: 0 3px 8px rgba(15, 23, 42, 0.35);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.95;
            max-width: 900px;
            margin: 0 auto;
        }

        .main-content {
            display: grid;
            grid-template-columns: 450px 1fr;
            gap: 26px;
            margin-bottom: 28px;
        }

        .card {
            background: rgba(255, 255, 255, 0.97);
            border-radius: 20px;
            padding: 26px;
            box-shadow: 0 14px 32px rgba(15, 23, 42, 0.15);
            margin-bottom: 10px;
        }

        .card h2 {
            font-size: 1.55rem;
            margin-bottom: 20px;
            color: #1f2937;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .input-section {
            margin-bottom: 22px;
        }

        .input-group {
            margin-bottom: 18px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
            font-size: 0.98rem;
        }

        .input-field,
        .textarea-field {
            width: 100%;
            padding: 14px;
            border: 2px solid #e5e7eb;
            border-radius: 14px;
            font-size: 1.05rem;
            font-family: 'Monaco', 'Menlo', monospace;
            transition: all 0.25s ease;
        }

        .textarea-field {
            min-height: 140px;
            resize: vertical;
        }

        .input-field:focus,
        .textarea-field:focus {
            outline: none;
            border-color: #ec4899;
            box-shadow: 0 0 0 3px rgba(236, 72, 153, 0.25);
        }

        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 16px;
        }

        .btn {
            padding: 12px 22px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ec4899, #be185d);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #22c55e, #15803d);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }

        .btn-info {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #b91c1c);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(236, 72, 153, 0.3);
        }

        .btn:active {
            transform: scale(0.97);
        }

        .btn-block {
            width: 100%;
            justify-content: center;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        .object-display,
        .match-results {
            background: #f8fafc;
            border-radius: 18px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .object-list {
            display: grid;
            gap: 14px;
        }

        .object-card {
            background: white;
            border-radius: 16px;
            padding: 18px;
            box-shadow: 0 4px 12px rgba(15, 23, 42, 0.1);
            border-left: 4px solid #ec4899;
        }

        .object-card.matched {
            border-left-color: #22c55e;
        }

        .object-card.not-matched {
            border-left-color: #ef4444;
        }

        .object-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .object-id {
            background: linear-gradient(135deg, #ec4899, #be185d);
            color: white;
            padding: 6px 12px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 0.9rem;
        }

        .match-badge {
            padding: 6px 12px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 0.85rem;
        }

        .match-badge.true {
            background: #dcfce7;
            color: #15803d;
        }

        .match-badge.false {
            background: #fee2e2;
            color: #b91c1c;
        }

        .object-content {
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.95rem;
            color: #1f2937;
            background: #f8fafc;
            padding: 12px;
            border-radius: 10px;
            overflow-x: auto;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        .comparison-card {
            background: white;
            border-radius: 14px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(15, 23, 42, 0.1);
        }

        .comparison-card h4 {
            font-size: 0.95rem;
            color: #ec4899;
            margin-bottom: 10px;
        }

        .comparison-card ul {
            list-style: none;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.85rem;
            color: #475569;
        }

        .comparison-card li {
            margin-bottom: 6px;
            padding-left: 20px;
            position: relative;
        }

        .comparison-card li::before {
            content: 'â€¢';
            position: absolute;
            left: 0;
            color: #ec4899;
        }

        .comparison-card li.match {
            color: #15803d;
        }

        .comparison-card li.mismatch {
            color: #b91c1c;
        }

        .history-list {
            max-height: 320px;
            overflow-y: auto;
            background: #f1f5f9;
            border-radius: 12px;
            padding: 12px;
        }

        .history-item {
            background: white;
            padding: 14px;
            margin-bottom: 10px;
            border-radius: 12px;
            border-left: 4px solid #ec4899;
            transition: transform 0.2s ease;
        }

        .history-item:hover {
            transform: translateX(4px);
        }

        .history-time {
            font-size: 0.75rem;
            color: #64748b;
            margin-bottom: 6px;
        }

        .history-summary {
            font-family: 'Monaco', monospace;
            font-size: 0.9rem;
            color: #1f2937;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        .stat-card {
            background: white;
            border-radius: 14px;
            padding: 18px;
            text-align: center;
            box-shadow: 0 3px 12px rgba(15, 23, 42, 0.1);
        }

        .stat-number {
            font-size: 1.8rem;
            font-weight: 800;
            color: #ec4899;
        }

        .stat-label {
            font-size: 0.85rem;
            color: #64748b;
            margin-top: 4px;
        }

        .code-block {
            margin-top: 16px;
            border-radius: 12px;
            overflow: hidden;
        }

        .code-block pre {
            margin: 0;
            padding: 20px;
            background: #1e293b;
            overflow-x: auto;
        }

        .empty-state {
            text-align: center;
            padding: 36px 20px;
            color: #64748b;
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 12px;
            opacity: 0.5;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            border-radius: 999px;
            background: linear-gradient(135deg, #ec4899, #be185d);
            color: white;
            font-size: 0.8rem;
            font-weight: 600;
            margin: 4px;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 2.2rem;
            }
        }

        .modal-content {
            max-height: 420px;
            overflow-y: auto;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” å¯¹è±¡åŒ¹é…éªŒè¯å¹³å°</h1>
            <p>åŸºäº matches å‡½æ•°çš„å¯¹è±¡å±æ€§åŒ¹é…å·¥å…·ï¼Œæ”¯æŒå•å¯¹è±¡éªŒè¯ã€æ‰¹é‡åŒ¹é…ã€è¯¦ç»†å¯¹æ¯”åˆ†æã€å†å²è¿½è¸ªä¸ä»£ç é¢„è§ˆ</p>
        </div>

        <div class="main-content">
            <div class="sidebar">
                <div class="card">
                    <h2>ğŸ“ å¯¹è±¡é…ç½®</h2>
                    <div class="input-section">
                        <div class="input-group">
                            <label>å¾…åŒ¹é…å¯¹è±¡ (JSON)</label>
                            <textarea id="objectInput" class="textarea-field" placeholder='{"age": 25, "hair": "long", "beard": true}'></textarea>
                        </div>
                        <div class="input-group">
                            <label>åŒ¹é…æ¡ä»¶å¯¹è±¡ (Source)</label>
                            <textarea id="sourceInput" class="textarea-field" placeholder='{"hair": "long", "beard": true}'></textarea>
                        </div>
                        <div class="button-group">
                            <button class="btn btn-primary btn-block" onclick="window.matchTool?.addObject()">â• æ·»åŠ å¯¹è±¡</button>
                        </div>
                        <div class="button-group">
                            <button class="btn btn-success" onclick="window.matchTool?.matchAll()">âš¡ æ‰§è¡ŒåŒ¹é…</button>
                            <button class="btn btn-info" onclick="window.matchTool?.loadSample()">ğŸ“„ ç¤ºä¾‹æ•°æ®</button>
                            <button class="btn btn-warning" onclick="window.matchTool?.generateRandom()">ğŸ² éšæœºç”Ÿæˆ</button>
                            <button class="btn btn-danger" onclick="window.matchTool?.clearAll()">ğŸ§¹ æ¸…ç©º</button>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2>âš™ï¸ é«˜çº§é€‰é¡¹</h2>
                    <div class="input-section">
                        <div id="checkboxGroup"></div>
                    </div>
                </div>

                <div class="card">
                    <h2>ğŸ—‚ï¸ å†å²è®°å½• (<span id="historyCount">0</span>)</h2>
                    <div class="history-list" id="historyList">
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ“œ</div>
                            <p>æš‚æ— åŒ¹é…å†å²</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="visualization">
                <div class="card">
                    <h2>ğŸ“¦ å¯¹è±¡åˆ—è¡¨</h2>
                    <div class="object-display" id="objectDisplay">
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ“‹</div>
                            <p>æ·»åŠ å¯¹è±¡åå°†åœ¨æ­¤å±•ç¤º</p>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2>âœ… åŒ¹é…ç»“æœ</h2>
                    <div class="match-results" id="matchResults">
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ¯</div>
                            <p>æ‰§è¡ŒåŒ¹é…åå°†åœ¨æ­¤å±•ç¤ºç»“æœ</p>
                        </div>
                    </div>
                </div>

                <div class="card" id="analysisCard" style="display:none;">
                    <h2>ğŸ“Š å¯¹æ¯”åˆ†æ</h2>
                    <div class="comparison-grid" id="comparisonGrid"></div>
                </div>

                <div class="card" id="codeSection" style="display:none;">
                    <h2>ğŸ’» æ‰§è¡Œä»£ç </h2>
                    <div class="code-block">
                        <pre><code class="language-javascript" id="codePreview">// ä»£ç å°†åœ¨è¿™é‡Œæ˜¾ç¤º</code></pre>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>ğŸ“ˆ ç»Ÿè®¡ä¿¡æ¯</h2>
            <div class="stats-grid" id="statsGrid"></div>
        </div>

        <div class="card">
            <h2>ğŸ“– å‡½æ•°è¯´æ˜</h2>
            <div style="background:#f8fafc;padding:20px;border-radius:14px;">
                <h3 style="color:#ec4899;margin-bottom:12px;">matches å‡½æ•°ï¼ˆå¯¹è±¡å±æ€§åŒ¹é…ï¼‰</h3>
                <div class="code-block">
                    <pre><code class="language-javascript">const matches = (obj, source) => 
  Object.keys(source).every(key => 
    obj.hasOwnProperty(key) && source[key] === obj[key]
  );</code></pre>
                </div>

                <h3 style="color:#ec4899;margin:20px 0 12px;">å‡½æ•°è¯´æ˜</h3>
                <p style="color:#374151;line-height:1.8;">
                    <strong>matches</strong> å‡½æ•°ç”¨äºæ£€æŸ¥å¯¹è±¡ <code>obj</code> æ˜¯å¦åŒ…å« <code>source</code> å¯¹è±¡ä¸­çš„æ‰€æœ‰é”®å€¼å¯¹ã€‚
                    åªæœ‰å½“ <code>obj</code> æ‹¥æœ‰ <code>source</code> ä¸­çš„æ‰€æœ‰é”®ï¼Œå¹¶ä¸”å¯¹åº”çš„å€¼ä¹Ÿä¸¥æ ¼ç›¸ç­‰æ—¶ï¼Œæ‰è¿”å› <code>true</code>ã€‚
                    å¸¸ç”¨äºæ•°æ®è¿‡æ»¤ã€æ¡ä»¶éªŒè¯ã€å¯¹è±¡ç­›é€‰ç­‰åœºæ™¯ã€‚
                </p>

                <h3 style="color:#ec4899;margin:20px 0 12px;">ä½¿ç”¨æ–¹å¼</h3>
                <div class="code-block">
                    <pre><code class="language-javascript">matches({ age: 25, hair: 'long', beard: true }, { hair: 'long', beard: true });
// true

matches({ hair: 'long', beard: true }, { age: 25, hair: 'long', beard: true });
// false

// æ•°ç»„è¿‡æ»¤ç¤ºä¾‹
const users = [
  { name: 'Alice', age: 25, active: true },
  { name: 'Bob', age: 30, active: true },
  { name: 'Charlie', age: 25, active: false }
];
users.filter(user => matches(user, { age: 25, active: true }));
// [{ name: 'Alice', age: 25, active: true }]</code></pre>
                </div>

                <h3 style="color:#ec4899;margin:20px 0 12px;">å…¸å‹åœºæ™¯</h3>
                <div>
                    <span class="badge">æ•°æ®è¿‡æ»¤</span>
                    <span class="badge">æ¡ä»¶éªŒè¯</span>
                    <span class="badge">å¯¹è±¡ç­›é€‰</span>
                    <span class="badge">æƒé™æ£€æŸ¥</span>
                    <span class="badge">æœç´¢åŒ¹é…</span>
                    <span class="badge">è¡¨å•éªŒè¯</span>
                </div>
            </div>
        </div>
    </div>

    <script src="../../demo/plugins/modal/index.js"></script>
    <script src="../../demo/plugins/checkbox/index.js"></script>
    <script src="../../demo/plugins/notification/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
        const matches = (obj, source) => Object.keys(source).every(key => obj.hasOwnProperty(key) && source[key] === obj[key]);

        class MatchTool {
            constructor() {
                this.plugins = {};
                this.objects = [];
                this.source = null;
                this.history = [];
                this.stats = {
                    totalMatches: 0,
                    totalObjects: 0,
                    matchedCount: 0,
                    unmatchedCount: 0
                };
                this.objectId = 1;
                this.checkboxOptions = [
                    { id: 'showOriginal', label: 'æ˜¾ç¤ºåŸå§‹å¯¹è±¡', checked: true },
                    { id: 'showMatched', label: 'æ˜¾ç¤ºåŒ¹é…ç»“æœ', checked: true },
                    { id: 'showAnalysis', label: 'æ˜¾ç¤ºå¯¹æ¯”åˆ†æ', checked: true },
                    { id: 'showCode', label: 'æ˜¾ç¤ºä»£ç é¢„è§ˆ', checked: true },
                    { id: 'showNotifications', label: 'æ˜¾ç¤ºé€šçŸ¥æé†’', checked: true }
                ];
                this.init();
            }

            async init() {
                try {
                    await this.loadPlugins();
                    this.setupCheckboxes();
                    this.initHighlight();
                    this.updateStats();
                    this.showWelcomeMessage();
                } catch (error) {
                    console.error('åˆå§‹åŒ–å¤±è´¥:', error);
                    this.showError('åˆå§‹åŒ–å¤±è´¥: ' + error.message);
                }
            }

            initHighlight() {
                if (window.hljs) {
                    document.querySelectorAll('pre code').forEach((block) => hljs.highlightElement(block));
                }
            }

            async loadPlugins() {
                try {
                    this.plugins.modal = new Modal();
                    this.plugins.notification = new Notification();
                } catch (error) {
                    console.warn('éƒ¨åˆ†æ’ä»¶åŠ è½½å¤±è´¥:', error);
                }
            }

            setupCheckboxes() {
                const container = document.getElementById('checkboxGroup');
                if (!container) return;
                try {
                    const group = Checkbox.createCheckboxGroup({
                        items: this.checkboxOptions.map(option => ({
                            id: option.id,
                            label: option.label,
                            checked: option.checked
                        })),
                        onChange: () => {}
                    });
                    container.appendChild(group.container);
                    this.plugins.checkboxGroup = group;
                } catch (error) {
                    console.warn('å¤é€‰æ¡†æ’ä»¶åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨åŸç”Ÿå¤é€‰æ¡†:', error);
                    this.checkboxOptions.forEach(option => {
                        const div = document.createElement('div');
                        div.style.marginBottom = '10px';
                        div.innerHTML = `<input type="checkbox" id="${option.id}" ${option.checked ? 'checked' : ''}>` +
                            `<label for="${option.id}" style="margin-left:6px;">${option.label}</label>`;
                        container.appendChild(div);
                    });
                }
            }

            getCheckboxValue(id) {
                if (this.plugins.checkboxGroup) {
                    try {
                        const states = this.plugins.checkboxGroup.getAllChecked();
                        const index = this.checkboxOptions.findIndex(option => option.id === id);
                        if (index !== -1) {
                            return states[index] || false;
                        }
                    } catch (error) {
                        console.warn('è¯»å–å¤é€‰æ¡†çŠ¶æ€å¤±è´¥ï¼Œä½¿ç”¨åŸç”Ÿæ–¹æ³•:', error);
                    }
                }
                const checkbox = document.getElementById(id);
                return checkbox ? checkbox.checked : false;
            }

            addObject() {
                const objectInput = document.getElementById('objectInput');
                const sourceInput = document.getElementById('sourceInput');
                if (!objectInput || !sourceInput) return;

                const objectStr = objectInput.value.trim();
                const sourceStr = sourceInput.value.trim();

                if (!objectStr) {
                    this.showError('è¯·è¾“å…¥å¾…åŒ¹é…å¯¹è±¡');
                    return;
                }

                if (!sourceStr) {
                    this.showError('è¯·è¾“å…¥åŒ¹é…æ¡ä»¶å¯¹è±¡');
                    return;
                }

                try {
                    const obj = JSON.parse(objectStr);
                    const source = JSON.parse(sourceStr);
                    
                    if (typeof obj !== 'object' || obj === null || Array.isArray(obj)) {
                        throw new Error('å¾…åŒ¹é…å¯¹è±¡å¿…é¡»æ˜¯æ™®é€šå¯¹è±¡');
                    }
                    if (typeof source !== 'object' || source === null || Array.isArray(source)) {
                        throw new Error('åŒ¹é…æ¡ä»¶å¿…é¡»æ˜¯æ™®é€šå¯¹è±¡');
                    }

                    this.objects.push({
                        id: this.objectId++,
                        obj,
                        source,
                        matched: null,
                        timestamp: new Date().toLocaleString('zh-CN')
                    });

                    this.source = source;
                    this.displayObjects();
                    objectInput.value = '';
                    this.showNotification('å¯¹è±¡å·²æ·»åŠ ', 'success');
                } catch (error) {
                    this.showError('JSON è§£æå¤±è´¥: ' + error.message);
                }
            }

            matchAll() {
                if (this.objects.length === 0) {
                    this.showError('è¯·å…ˆæ·»åŠ è‡³å°‘ä¸€ä¸ªå¯¹è±¡');
                    return;
                }

                const sourceInput = document.getElementById('sourceInput');
                if (sourceInput && sourceInput.value.trim()) {
                    try {
                        this.source = JSON.parse(sourceInput.value.trim());
                    } catch (error) {
                        this.showError('åŒ¹é…æ¡ä»¶å¯¹è±¡ JSON è§£æå¤±è´¥: ' + error.message);
                        return;
                    }
                }

                if (!this.source || Object.keys(this.source).length === 0) {
                    this.showError('è¯·è®¾ç½®åŒ¹é…æ¡ä»¶å¯¹è±¡');
                    return;
                }

                const start = performance.now();
                this.objects = this.objects.map(item => {
                    const matched = matches(item.obj, this.source);
                    return { ...item, matched, source: this.source };
                });
                const end = performance.now();
                const time = Math.round((end - start) * 1000) / 1000;

                this.stats.totalMatches++;
                this.stats.totalObjects += this.objects.length;
                this.stats.matchedCount = this.objects.filter(item => item.matched).length;
                this.stats.unmatchedCount = this.objects.length - this.stats.matchedCount;

                this.displayObjects();
                this.displayResults();
                this.updateStats();
                this.addToHistory(this.objects.length, this.stats.matchedCount, time);

                if (this.getCheckboxValue('showAnalysis')) {
                    this.displayAnalysis();
                }

                if (this.getCheckboxValue('showCode')) {
                    this.showCode();
                }

                this.showNotification(`åŒ¹é…å®Œæˆï¼š${this.stats.matchedCount}/${this.objects.length} åŒ¹é…æˆåŠŸï¼Œç”¨æ—¶ ${time}Î¼s`, 'success');
            }

            displayObjects() {
                const container = document.getElementById('objectDisplay');
                if (!container) return;

                if (!this.getCheckboxValue('showOriginal')) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ™ˆ</div>
                            <p>å·²å…³é—­åŸå§‹å¯¹è±¡å±•ç¤º</p>
                        </div>`;
                    return;
                }

                if (this.objects.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ“‹</div>
                            <p>æ·»åŠ å¯¹è±¡åå°†åœ¨æ­¤å±•ç¤º</p>
                        </div>`;
                    return;
                }

                const html = this.objects.map(item => {
                    const cardClass = item.matched === null ? '' : (item.matched ? 'matched' : 'not-matched');
                    return `
                        <div class="object-card ${cardClass}">
                            <div class="object-header">
                                <div class="object-id">å¯¹è±¡ #${item.id}</div>
                                ${item.matched !== null ? `
                                    <div class="match-badge ${item.matched}">${item.matched ? 'âœ“ åŒ¹é…' : 'âœ— ä¸åŒ¹é…'}</div>
                                ` : ''}
                            </div>
                            <div class="object-content">${JSON.stringify(item.obj, null, 2)}</div>
                            <div style="margin-top:8px;font-size:0.8rem;color:#64748b;">æ·»åŠ æ—¶é—´ï¼š${item.timestamp}</div>
                            <button class="btn btn-sm btn-danger" style="margin-top:8px;" onclick="window.matchTool?.removeObject(${item.id})">ç§»é™¤</button>
                        </div>
                    `;
                }).join('');

                container.innerHTML = `<div class="object-list">${html}</div>`;
            }

            displayResults() {
                const container = document.getElementById('matchResults');
                if (!container) return;

                if (!this.getCheckboxValue('showMatched')) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ™ˆ</div>
                            <p>å·²å…³é—­åŒ¹é…ç»“æœå±•ç¤º</p>
                        </div>`;
                    return;
                }

                if (this.objects.length === 0 || this.objects.every(item => item.matched === null)) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ¯</div>
                            <p>æ‰§è¡ŒåŒ¹é…åå°†åœ¨æ­¤å±•ç¤ºç»“æœ</p>
                        </div>`;
                    return;
                }

                const matched = this.objects.filter(item => item.matched);
                const unmatched = this.objects.filter(item => !item.matched);

                container.innerHTML = `
                    <div style="margin-bottom:16px;">
                        <h3 style="color:#15803d;margin-bottom:12px;">âœ“ åŒ¹é…æˆåŠŸ (${matched.length})</h3>
                        ${matched.length > 0 ? `
                            <div class="object-list">
                                ${matched.map(item => `
                                    <div class="object-card matched">
                                        <div class="object-header">
                                            <div class="object-id">å¯¹è±¡ #${item.id}</div>
                                            <div class="match-badge true">åŒ¹é…</div>
                                        </div>
                                        <div class="object-content">${JSON.stringify(item.obj, null, 2)}</div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : '<p style="color:#64748b;">æš‚æ— åŒ¹é…å¯¹è±¡</p>'}
                    </div>
                    <div>
                        <h3 style="color:#b91c1c;margin-bottom:12px;">âœ— ä¸åŒ¹é… (${unmatched.length})</h3>
                        ${unmatched.length > 0 ? `
                            <div class="object-list">
                                ${unmatched.map(item => `
                                    <div class="object-card not-matched">
                                        <div class="object-header">
                                            <div class="object-id">å¯¹è±¡ #${item.id}</div>
                                            <div class="match-badge false">ä¸åŒ¹é…</div>
                                        </div>
                                        <div class="object-content">${JSON.stringify(item.obj, null, 2)}</div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : '<p style="color:#64748b;">æ‰€æœ‰å¯¹è±¡å‡åŒ¹é…</p>'}
                    </div>
                `;
            }

            displayAnalysis() {
                const card = document.getElementById('analysisCard');
                const grid = document.getElementById('comparisonGrid');
                if (!card || !grid) return;

                if (this.objects.length === 0 || !this.source) {
                    card.style.display = 'none';
                    return;
                }

                const sourceKeys = Object.keys(this.source);
                const keyAnalysis = sourceKeys.map(key => {
                    const matched = this.objects.filter(item => item.matched && item.obj.hasOwnProperty(key) && item.obj[key] === this.source[key]).length;
                    const total = this.objects.length;
                    return { key, value: this.source[key], matched, total, rate: total > 0 ? Math.round((matched / total) * 100) : 0 };
                });

                grid.innerHTML = `
                    <div class="comparison-card">
                        <h4>åŒ¹é…æ¡ä»¶</h4>
                        <div class="object-content" style="margin-top:10px;">${JSON.stringify(this.source, null, 2)}</div>
                    </div>
                    <div class="comparison-card">
                        <h4>é”®å€¼åŒ¹é…ç»Ÿè®¡</h4>
                        <ul>
                            ${keyAnalysis.map(item => `
                                <li class="${item.matched === item.total ? 'match' : 'mismatch'}">
                                    ${item.key}: ${JSON.stringify(item.value)} (${item.matched}/${item.total}, ${item.rate}%)
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                    <div class="comparison-card">
                        <h4>åŒ¹é…æ¦‚è§ˆ</h4>
                        <ul>
                            <li>æ€»å¯¹è±¡æ•°ï¼š${this.objects.length}</li>
                            <li class="match">åŒ¹é…æˆåŠŸï¼š${this.stats.matchedCount}</li>
                            <li class="mismatch">ä¸åŒ¹é…ï¼š${this.stats.unmatchedCount}</li>
                            <li>åŒ¹é…ç‡ï¼š${this.objects.length > 0 ? Math.round((this.stats.matchedCount / this.objects.length) * 100) : 0}%</li>
                        </ul>
                    </div>
                `;

                card.style.display = 'block';
            }

            addToHistory(count, matched, time) {
                this.history.unshift({
                    time: new Date().toLocaleString('zh-CN'),
                    count,
                    matched,
                    unmatched: count - matched,
                    execTime: time,
                    source: JSON.stringify(this.source).slice(0, 60) + (JSON.stringify(this.source).length > 60 ? '...' : '')
                });
                if (this.history.length > 40) this.history.pop();
                this.updateHistoryDisplay();
            }

            updateHistoryDisplay() {
                const container = document.getElementById('historyList');
                const count = document.getElementById('historyCount');
                if (!container) return;
                if (count) count.textContent = this.history.length;

                if (this.history.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ“œ</div>
                            <p>æš‚æ— åŒ¹é…å†å²</p>
                        </div>`;
                    return;
                }

                container.innerHTML = this.history.slice(0, 20).map(item => `
                    <div class="history-item">
                        <div class="history-time">${item.time} â€¢ ${item.execTime}Î¼s</div>
                        <div class="history-summary">å¯¹è±¡ï¼š${item.count} ï½œ åŒ¹é…ï¼š${item.matched} ï½œ ä¸åŒ¹é…ï¼š${item.unmatched}</div>
                        <div style="color:#64748b;font-size:0.8rem;margin-top:6px;">æ¡ä»¶ï¼š${item.source}</div>
                    </div>
                `).join('');
            }

            updateStats() {
                const grid = document.getElementById('statsGrid');
                if (!grid) return;
                const matchRate = this.objects.length > 0 ? Math.round((this.stats.matchedCount / this.objects.length) * 100) : 0;
                grid.innerHTML = `
                    <div class="stat-card">
                        <div class="stat-number">${this.stats.totalMatches}</div>
                        <div class="stat-label">åŒ¹é…æ¬¡æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${this.stats.totalObjects}</div>
                        <div class="stat-label">ç´¯è®¡å¯¹è±¡</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${this.stats.matchedCount}</div>
                        <div class="stat-label">åŒ¹é…æˆåŠŸ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${matchRate}%</div>
                        <div class="stat-label">åŒ¹é…ç‡</div>
                    </div>
                `;
            }

            showCode() {
                const section = document.getElementById('codeSection');
                const preview = document.getElementById('codePreview');
                if (!preview) return;

                if (this.objects.length === 0 || !this.source) {
                    if (section) section.style.display = 'none';
                    return;
                }

                const sampleObj = this.objects[0].obj;
                const code = `const matches = (obj, source) => 
  Object.keys(source).every(key => 
    obj.hasOwnProperty(key) && source[key] === obj[key]
  );

const source = ${JSON.stringify(this.source, null, 2)};

// å•ä¸ªå¯¹è±¡åŒ¹é…
const obj1 = ${JSON.stringify(sampleObj, null, 2)};
const result1 = matches(obj1, source);
console.log(result1); // ${matches(sampleObj, this.source)}

// æ‰¹é‡åŒ¹é…
const objects = ${JSON.stringify(this.objects.map(item => item.obj).slice(0, 3), null, 2)};
const results = objects.map(obj => matches(obj, source));
console.log(results); // ${JSON.stringify(this.objects.slice(0, 3).map(item => item.matched))}

// è¿‡æ»¤åŒ¹é…çš„å¯¹è±¡
const matched = objects.filter(obj => matches(obj, source));
console.log(matched);`;

                preview.textContent = code;
                if (window.hljs) {
                    delete preview.dataset.highlighted;
                    preview.className = 'language-javascript';
                    hljs.highlightElement(preview);
                }
                if (section) section.style.display = 'block';
            }

            removeObject(id) {
                this.objects = this.objects.filter(item => item.id !== id);
                this.displayObjects();
                this.displayResults();
                this.displayAnalysis();
                this.showNotification(`å·²ç§»é™¤å¯¹è±¡ #${id}`, 'info');
            }

            clearAll() {
                this.objects = [];
                this.source = null;
                const objectInput = document.getElementById('objectInput');
                const sourceInput = document.getElementById('sourceInput');
                if (objectInput) objectInput.value = '';
                if (sourceInput) sourceInput.value = '';
                this.displayObjects();
                this.displayResults();
                const analysisCard = document.getElementById('analysisCard');
                if (analysisCard) analysisCard.style.display = 'none';
                const codeSection = document.getElementById('codeSection');
                if (codeSection) codeSection.style.display = 'none';
                this.showNotification('å·²æ¸…ç©ºå…¨éƒ¨æ•°æ®', 'info');
            }

            loadSample() {
                const objectInput = document.getElementById('objectInput');
                const sourceInput = document.getElementById('sourceInput');
                if (objectInput && sourceInput) {
                    objectInput.value = JSON.stringify({ age: 25, hair: 'long', beard: true, name: 'John' }, null, 2);
                    sourceInput.value = JSON.stringify({ hair: 'long', beard: true }, null, 2);
                }
                this.showNotification('ç¤ºä¾‹æ•°æ®å·²åŠ è½½', 'info');
            }

            generateRandom() {
                const templates = [
                    { age: 25, hair: 'long', beard: true, name: 'Alice' },
                    { age: 30, hair: 'short', beard: false, name: 'Bob' },
                    { age: 25, hair: 'long', beard: false, name: 'Charlie' },
                    { age: 28, hair: 'long', beard: true, name: 'David' },
                    { age: 25, hair: 'short', beard: true, name: 'Eve' }
                ];
                const sourceInput = document.getElementById('sourceInput');
                if (sourceInput && !sourceInput.value.trim()) {
                    sourceInput.value = JSON.stringify({ hair: 'long', beard: true }, null, 2);
                }
                templates.forEach(template => {
                    this.objects.push({
                        id: this.objectId++,
                        obj: template,
                        source: null,
                        matched: null,
                        timestamp: new Date().toLocaleString('zh-CN')
                    });
                });
                this.displayObjects();
                this.showNotification('å·²ç”Ÿæˆéšæœºå¯¹è±¡', 'info');
            }

            showNotification(message, type) {
                if (this.plugins.notification && this.getCheckboxValue('showNotifications')) {
                    this.plugins.notification.show(message, type);
                } else {
                    console.log(`${type.toUpperCase()}: ${message}`);
                }
            }

            showError(message) {
                this.showNotification(message, 'error');
            }

            showWelcomeMessage() {
                if (this.plugins.modal) {
                    this.plugins.modal.show({
                        title: 'ğŸ‰ æ¬¢è¿ä½¿ç”¨å¯¹è±¡åŒ¹é…éªŒè¯å¹³å°',
                        content: `
                            <div style="padding:18px;">
                                <div style="font-size:46px;text-align:center;margin-bottom:12px;">ğŸ”</div>
                                <p style="color:#1f2937;line-height:1.8;">
                                    ä½¿ç”¨ <strong>matches</strong> å‡½æ•°å¿«é€ŸéªŒè¯å¯¹è±¡æ˜¯å¦åŒ…å«æŒ‡å®šæ¡ä»¶çš„æ‰€æœ‰é”®å€¼å¯¹ï¼Œæ”¯æŒæ‰¹é‡åŒ¹é…ã€è¯¦ç»†å¯¹æ¯”åˆ†æã€å†å²è¿½è¸ªä¸ä»£ç é¢„è§ˆã€‚
                                </p>
                                <div style="background:#fce7f3;border-left:4px solid #ec4899;padding:12px;border-radius:12px;color:#9f1239;margin-top:12px;">
                                    <strong>äº®ç‚¹ï¼š</strong> å®æ—¶åŒ¹é…éªŒè¯ã€æ‰¹é‡å¯¹è±¡å¤„ç†ã€é”®å€¼å¯¹æ¯”åˆ†æã€åŒ¹é…ç‡ç»Ÿè®¡ã€ä»£ç ä¸€é”®å¤åˆ¶ã€‚
                                </div>
                                <ul style="color:#1f2937;margin-left:18px;margin-top:12px;line-height:1.8;">
                                    <li>æ”¯æŒå•ä¸ªæˆ–æ‰¹é‡å¯¹è±¡åŒ¹é…éªŒè¯</li>
                                    <li>å¯è§†åŒ–å±•ç¤ºåŒ¹é…æˆåŠŸä¸å¤±è´¥çš„å¯¹è±¡</li>
                                    <li>è¯¦ç»†åˆ†ææ¯ä¸ªé”®å€¼çš„åŒ¹é…æƒ…å†µ</li>
                                    <li>å†å²è®°å½•è¿½è¸ªåŒ¹é…æ“ä½œ</li>
                                </ul>
                            </div>
                        `,
                        type: 'alert'
                    });
                }
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            window.matchTool = new MatchTool();
        });

        if (document.readyState !== 'loading' && !window.matchTool) {
            window.matchTool = new MatchTool();
        }
    </script>
</body>

</html>
