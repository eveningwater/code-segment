<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOM ç»“æ„åˆ†æå™¨å’Œæ ·å¼è°ƒè¯•å·¥å…· - getParentsUntil å®æˆ˜åº”ç”¨</title>
    <!-- å¼•å…¥æ’ä»¶æ ·å¼ -->
    <link rel="stylesheet" href="../../demo/plugins/input-number/style.css">
    <link rel="stylesheet" href="../../demo/plugins/modal/style.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            margin-bottom: 30px;
        }

        .demo-area {
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            position: relative;
            min-height: 600px;
        }

        .demo-area h2 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #2d3748;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .icon {
            width: 24px;
            height: 24px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
        }

        /* æ¼”ç¤ºç½‘ç«™ç»“æ„ */
        .demo-website {
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            overflow: hidden;
            margin-top: 20px;
            position: relative;
        }

        .demo-header {
            background: linear-gradient(45deg, #4299e1, #3182ce);
            color: white;
            padding: 15px 20px;
            position: relative;
        }

        .demo-nav {
            background: #2d3748;
            padding: 10px 20px;
        }

        .demo-nav ul {
            display: flex;
            gap: 20px;
            list-style: none;
        }

        .demo-nav a {
            color: #e2e8f0;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .demo-nav a:hover {
            background: #4a5568;
            color: white;
        }

        .demo-content {
            display: grid;
            grid-template-columns: 200px 1fr 200px;
            min-height: 400px;
        }

        .demo-sidebar {
            background: #f7fafc;
            padding: 20px;
            border-right: 1px solid #e2e8f0;
        }

        .demo-main {
            padding: 20px;
            background: white;
        }

        .demo-aside {
            background: #f7fafc;
            padding: 20px;
            border-left: 1px solid #e2e8f0;
        }

        .demo-article {
            background: #fff5f5;
            border: 1px solid #fed7d7;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }

        .demo-section {
            background: #f0fff4;
            border: 1px solid #c6f6d5;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }

        .demo-widget {
            background: #ebf8ff;
            border: 1px solid #bee3f8;
            border-radius: 8px;
            padding: 12px;
            margin: 8px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .demo-widget:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .demo-footer {
            background: #2d3748;
            color: white;
            padding: 20px;
            text-align: center;
        }

        /* æ§åˆ¶é¢æ¿ */
        .control-panel {
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            height: fit-content;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            width: 100%;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #718096, #4a5568);
            box-shadow: 0 4px 12px rgba(113, 128, 150, 0.3);
        }

        .btn-danger {
            background: linear-gradient(45deg, #e53e3e, #c53030);
            box-shadow: 0 4px 12px rgba(229, 62, 62, 0.3);
        }

        /* åˆ†æç»“æœ */
        .analysis-results {
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
        }

        .path-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .path-item:hover {
            background: #f7fafc;
            border-color: #667eea;
            transform: translateX(5px);
        }

        .path-item.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border-color: transparent;
        }

        .element-tag {
            background: #667eea;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 12px;
        }

        .element-info {
            flex: 1;
        }

        .element-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .element-details {
            font-size: 12px;
            opacity: 0.7;
        }

        .element-styles {
            background: #f8f9fa;
            border-radius: 6px;
            padding: 10px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }

        .style-property {
            display: flex;
            justify-content: space-between;
            padding: 2px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .style-property:last-child {
            border-bottom: none;
        }

        .property-name {
            color: #d73a49;
            font-weight: 600;
        }

        .property-value {
            color: #032f62;
        }

        /* é«˜äº®æ•ˆæœ */
        .highlight-element {
            position: relative;
            animation: highlightPulse 2s infinite;
        }

        .highlight-element::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 8px;
            z-index: -1;
            opacity: 0.3;
        }

        @keyframes highlightPulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }
        }

        /* å·¥å…·æç¤º */
        .tooltip {
            position: absolute;
            background: #2d3748;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .tooltip.show {
            opacity: 1;
        }

        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.8rem;
            opacity: 0.9;
        }

        /* å“åº”å¼ */
        @media (max-width: 1200px) {
            .main-layout {
                grid-template-columns: 1fr;
            }

            .demo-content {
                grid-template-columns: 1fr;
            }

            .demo-sidebar,
            .demo-aside {
                display: none;
            }
        }

        /* é€‰æ‹©å™¨è¾“å…¥æ¡† */
        .selector-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            transition: all 0.2s ease;
        }

        .selector-input:focus {
            border-color: #667eea;
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* å…ƒç´ é€‰æ‹©æ¨¡å¼ */
        .selecting-mode .demo-website * {
            cursor: crosshair !important;
            transition: all 0.2s ease;
        }

        .selecting-mode .demo-website *:hover {
            background-color: rgba(102, 126, 234, 0.2) !important;
            outline: 2px solid #667eea;
        }

        .mode-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #667eea;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: 600;
            z-index: 1000;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {

            0%,
            20%,
            50%,
            80%,
            100% {
                transform: translateY(0);
            }

            40% {
                transform: translateY(-10px);
            }

            60% {
                transform: translateY(-5px);
            }
        }

        /* æ’ä»¶æ ·å¼è¦†ç›– */
        .ew-input-number {
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .ew-input-number:focus-within {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” DOM ç»“æ„åˆ†æå™¨å’Œæ ·å¼è°ƒè¯•å·¥å…·</h1>
            <p>åŸºäº getParentsUntil æ–¹æ³•çš„å®æˆ˜åº”ç”¨ç¤ºä¾‹ - å‰ç«¯å¼€å‘è€…çš„å¾—åŠ›åŠ©æ‰‹</p>
        </div>

        <div class="main-layout">
            <!-- æ¼”ç¤ºåŒºåŸŸ -->
            <div class="demo-area">
                <h2>
                    <span class="icon">ğŸŒ</span>
                    æ¼”ç¤ºç½‘ç«™ç»“æ„
                </h2>

                <div class="demo-website" id="demoWebsite">
                    <header class="demo-header" data-element="header">
                        <h1>æ¼”ç¤ºç½‘ç«™æ ‡é¢˜</h1>
                        <p>è¿™æ˜¯ä¸€ä¸ªç”¨äºæ¼”ç¤º DOM ç»“æ„åˆ†æçš„ç¤ºä¾‹ç½‘ç«™</p>
                    </header>

                    <nav class="demo-nav" data-element="nav">
                        <ul>
                            <li><a href="#" data-element="nav-link">é¦–é¡µ</a></li>
                            <li><a href="#" data-element="nav-link">äº§å“</a></li>
                            <li><a href="#" data-element="nav-link">æœåŠ¡</a></li>
                            <li><a href="#" data-element="nav-link">å…³äºæˆ‘ä»¬</a></li>
                        </ul>
                    </nav>

                    <div class="demo-content">
                        <aside class="demo-sidebar" data-element="sidebar">
                            <h3>ä¾§è¾¹æ </h3>
                            <div class="demo-widget" data-element="widget">
                                <h4>ç”¨æˆ·ä¿¡æ¯</h4>
                                <p>å½“å‰ç”¨æˆ·çŠ¶æ€</p>
                            </div>
                            <div class="demo-widget" data-element="widget">
                                <h4>å¿«é€Ÿé“¾æ¥</h4>
                                <p>å¸¸ç”¨åŠŸèƒ½å…¥å£</p>
                            </div>
                        </aside>

                        <main class="demo-main" data-element="main">
                            <article class="demo-article" data-element="article">
                                <h2>ä¸»è¦æ–‡ç« æ ‡é¢˜</h2>
                                <p>è¿™æ˜¯æ–‡ç« çš„ä¸»è¦å†…å®¹åŒºåŸŸï¼ŒåŒ…å«äº†ä¸°å¯Œçš„æ–‡æœ¬ä¿¡æ¯ã€‚</p>
                                <section class="demo-section" data-element="section">
                                    <h3>æ–‡ç« ç« èŠ‚</h3>
                                    <p>è¿™æ˜¯æ–‡ç« çš„ä¸€ä¸ªå­ç« èŠ‚ï¼Œç”¨äºæ¼”ç¤ºåµŒå¥—çš„DOMç»“æ„ã€‚</p>
                                    <div class="demo-widget" data-element="inner-widget">
                                        <span data-element="target-span">ğŸ¯ ç‚¹å‡»æˆ‘åˆ†æDOMè·¯å¾„</span>
                                    </div>
                                </section>
                            </article>
                        </main>

                        <aside class="demo-aside" data-element="aside">
                            <h3>å³ä¾§æ </h3>
                            <div class="demo-widget" data-element="widget">
                                <h4>ç›¸å…³æ¨è</h4>
                                <p>æ¨èå†…å®¹åˆ—è¡¨</p>
                            </div>
                        </aside>
                    </div>

                    <footer class="demo-footer" data-element="footer">
                        <p>&copy; 2024 æ¼”ç¤ºç½‘ç«™. åŸºäº getParentsUntil çš„DOMåˆ†æå·¥å…·</p>
                    </footer>
                </div>
            </div>

            <!-- æ§åˆ¶é¢æ¿ -->
            <div class="control-panel">
                <h2>
                    <span class="icon">âš™ï¸</span>
                    åˆ†ææ§åˆ¶å°
                </h2>

                <div class="form-group">
                    <label>ç›®æ ‡é€‰æ‹©å™¨</label>
                    <input type="text" class="selector-input" id="targetSelector"
                        placeholder="ä¾‹å¦‚: [data-element='target-span']" value="[data-element='target-span']">
                </div>

                <div class="form-group">
                    <label>ç»ˆæ­¢é€‰æ‹©å™¨</label>
                    <input type="text" class="selector-input" id="stopSelector" placeholder="ä¾‹å¦‚: .demo-website"
                        value=".demo-website">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>åˆ†ææ·±åº¦é™åˆ¶</label>
                        <div id="depthLimitInput"></div>
                    </div>
                    <div class="form-group">
                        <label>é«˜äº®æŒç»­æ—¶é—´(ç§’)</label>
                        <div id="highlightDurationInput"></div>
                    </div>
                </div>

                <button class="btn" onclick="analyzeDOM()">
                    ğŸ” åˆ†æ DOM è·¯å¾„
                </button>

                <button class="btn btn-secondary" onclick="toggleSelectMode()">
                    ğŸ¯ åˆ‡æ¢é€‰æ‹©æ¨¡å¼
                </button>

                <button class="btn btn-secondary" onclick="exportAnalysis()">
                    ğŸ“„ å¯¼å‡ºåˆ†ææŠ¥å‘Š
                </button>

                <button class="btn btn-danger" onclick="clearAnalysis()">
                    ğŸ—‘ï¸ æ¸…é™¤åˆ†æç»“æœ
                </button>

                <!-- ç»Ÿè®¡ä¿¡æ¯ -->
                <div class="stats-grid" style="margin-top: 20px;">
                    <div class="stat-card">
                        <div class="stat-value" id="pathLength">0</div>
                        <div class="stat-label">è·¯å¾„é•¿åº¦</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalElements">0</div>
                        <div class="stat-label">æ€»å…ƒç´ æ•°</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- åˆ†æç»“æœ -->
        <div class="analysis-results" id="analysisResults" style="display: none;">
            <h2>
                <span class="icon">ğŸ“Š</span>
                DOM è·¯å¾„åˆ†æç»“æœ
            </h2>
            <div id="pathContainer"></div>
        </div>
    </div>

    <!-- æ¨¡å¼æŒ‡ç¤ºå™¨ -->
    <div class="mode-indicator" id="modeIndicator" style="display: none;">
        ğŸ¯ å…ƒç´ é€‰æ‹©æ¨¡å¼å·²æ¿€æ´» - ç‚¹å‡»ä»»æ„å…ƒç´ è¿›è¡Œåˆ†æ
    </div>

    <!-- å·¥å…·æç¤º -->
    <div class="tooltip" id="tooltip"></div>

    <!-- å¼•å…¥æ’ä»¶ -->
    <script src="../../demo/plugins/input-number/index.js"></script>
    <script src="../../demo/plugins/modal/index.js"></script>

    <script>
        // æ ¸å¿ƒå‡½æ•°ï¼šè·å–çˆ¶å…ƒç´ ç›´åˆ°æŒ‡å®šé€‰æ‹©å™¨
        const getParentsUntil = (el, selector) => {
            const parents = [];
            let _el = el.parentNode;
            while (_el && typeof _el.matches === 'function') {
                parents.unshift(_el);
                if (_el.matches(selector)) {
                    return parents;
                } else {
                    _el = _el.parentNode;
                }
            }
            return parents;
        };

        // å…¨å±€å˜é‡
        let isSelectMode = false;
        let currentAnalysis = null;
        let highlightTimeout = null;
        let depthLimitInput, highlightDurationInput, modal;

        // åˆå§‹åŒ–æ’ä»¶
        function initPlugins() {
            depthLimitInput = new InputNumber({
                container: document.getElementById('depthLimitInput'),
                min: 1,
                max: 20,
                step: 1,
                value: 10
            });

            highlightDurationInput = new InputNumber({
                container: document.getElementById('highlightDurationInput'),
                min: 1,
                max: 10,
                step: 1,
                value: 3
            });

            modal = new Modal();
        }

        // åˆ†æDOMè·¯å¾„
        function analyzeDOM() {
            const targetSelector = document.getElementById('targetSelector').value.trim();
            const stopSelector = document.getElementById('stopSelector').value.trim();
            const depthLimit = depthLimitInput.getValue();

            if (!targetSelector) {
                showAlert('è¯·è¾“å…¥ç›®æ ‡é€‰æ‹©å™¨', 'error');
                return;
            }

            try {
                const targetElement = document.querySelector(targetSelector);
                if (!targetElement) {
                    showAlert('æœªæ‰¾åˆ°ç›®æ ‡å…ƒç´ ï¼Œè¯·æ£€æŸ¥é€‰æ‹©å™¨', 'error');
                    return;
                }

                // ä½¿ç”¨æ ¸å¿ƒå‡½æ•°è·å–çˆ¶å…ƒç´ è·¯å¾„
                let parents = getParentsUntil(targetElement, stopSelector || 'body');

                // åº”ç”¨æ·±åº¦é™åˆ¶
                if (parents.length > depthLimit) {
                    parents = parents.slice(-depthLimit);
                }

                // æ·»åŠ ç›®æ ‡å…ƒç´ æœ¬èº«
                parents.push(targetElement);

                currentAnalysis = {
                    target: targetElement,
                    parents: parents,
                    selector: targetSelector,
                    stopSelector: stopSelector,
                    timestamp: new Date()
                };

                renderAnalysisResults(currentAnalysis);
                updateStats(currentAnalysis);
                highlightElements(parents);

                showAlert(`DOMè·¯å¾„åˆ†æå®Œæˆï¼æ‰¾åˆ° ${parents.length} ä¸ªå…ƒç´ `, 'success');

            } catch (error) {
                showAlert(`åˆ†æå‡ºé”™: ${error.message}`, 'error');
                console.error('DOMåˆ†æé”™è¯¯:', error);
            }
        }

        // æ¸²æŸ“åˆ†æç»“æœ
        function renderAnalysisResults(analysis) {
            const container = document.getElementById('pathContainer');
            const resultsSection = document.getElementById('analysisResults');

            let html = `
                <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <h3 style="color: #667eea; margin-bottom: 10px;">ğŸ“‹ åˆ†ææ¦‚è§ˆ</h3>
                    <p><strong>ç›®æ ‡é€‰æ‹©å™¨:</strong> <code>${analysis.selector}</code></p>
                    <p><strong>ç»ˆæ­¢é€‰æ‹©å™¨:</strong> <code>${analysis.stopSelector || 'æ— '}</code></p>
                    <p><strong>åˆ†ææ—¶é—´:</strong> ${analysis.timestamp.toLocaleString()}</p>
                    <p><strong>è·¯å¾„æ·±åº¦:</strong> ${analysis.parents.length} å±‚</p>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h3 style="color: #2d3748; margin-bottom: 15px;">ğŸ”— DOM è·¯å¾„é“¾</h3>
            `;

            analysis.parents.forEach((element, index) => {
                const isTarget = index === analysis.parents.length - 1;
                const tagName = element.tagName.toLowerCase();
                const className = element.className || '';
                const id = element.id || '';
                const dataElement = element.getAttribute('data-element') || '';

                // è·å–å…ƒç´ çš„ä¸€äº›å…³é”®æ ·å¼
                const computedStyle = window.getComputedStyle(element);
                const keyStyles = {
                    'display': computedStyle.display,
                    'position': computedStyle.position,
                    'width': computedStyle.width,
                    'height': computedStyle.height,
                    'background-color': computedStyle.backgroundColor,
                    'color': computedStyle.color,
                    'padding': computedStyle.padding,
                    'margin': computedStyle.margin
                };

                html += `
                    <div class="path-item ${isTarget ? 'active' : ''}" 
                         onclick="highlightSingleElement(this, ${index})"
                         onmouseenter="showElementTooltip(event, ${index})"
                         onmouseleave="hideElementTooltip()">
                        
                        <div class="element-tag">${tagName}</div>
                        
                        <div class="element-info">
                            <div class="element-name">
                                ${tagName}${id ? `#${id}` : ''}${className ? `.${className.split(' ').join('.')}` : ''}
                                ${isTarget ? ' ğŸ¯' : ''}
                            </div>
                            <div class="element-details">
                                ${dataElement ? `data-element="${dataElement}" | ` : ''}
                                ${element.children.length} ä¸ªå­å…ƒç´  | 
                                æ·±åº¦: ${index + 1}
                            </div>
                        </div>
                        
                        <div style="font-size: 12px; color: #666;">
                            å±‚çº§ ${index + 1}
                        </div>
                    </div>
                    
                    <div class="element-styles" id="styles-${index}" style="display: none;">
                        <h4 style="margin-bottom: 10px; color: #2d3748;">è®¡ç®—æ ·å¼ (å…³é”®å±æ€§)</h4>
                `;

                Object.entries(keyStyles).forEach(([property, value]) => {
                    if (value && value !== 'rgba(0, 0, 0, 0)' && value !== 'auto' && value !== 'none') {
                        html += `
                            <div class="style-property">
                                <span class="property-name">${property}:</span>
                                <span class="property-value">${value}</span>
                            </div>
                        `;
                    }
                });

                html += '</div>';
            });

            html += '</div>';
            container.innerHTML = html;
            resultsSection.style.display = 'block';

            // æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }

        // é«˜äº®å…ƒç´ 
        function highlightElements(elements) {
            // æ¸…é™¤ä¹‹å‰çš„é«˜äº®
            document.querySelectorAll('.highlight-element').forEach(el => {
                el.classList.remove('highlight-element');
            });

            // æ·»åŠ æ–°çš„é«˜äº®
            elements.forEach(el => {
                el.classList.add('highlight-element');
            });

            // è®¾ç½®è‡ªåŠ¨æ¸…é™¤é«˜äº®
            const duration = highlightDurationInput.getValue() * 1000;
            clearTimeout(highlightTimeout);
            highlightTimeout = setTimeout(() => {
                document.querySelectorAll('.highlight-element').forEach(el => {
                    el.classList.remove('highlight-element');
                });
            }, duration);
        }

        // é«˜äº®å•ä¸ªå…ƒç´ 
        function highlightSingleElement(pathItem, index) {
            // åˆ‡æ¢æ ·å¼æ˜¾ç¤º
            const stylesDiv = document.getElementById(`styles-${index}`);
            const isVisible = stylesDiv.style.display !== 'none';

            // éšè—æ‰€æœ‰æ ·å¼é¢æ¿
            document.querySelectorAll('[id^="styles-"]').forEach(div => {
                div.style.display = 'none';
            });

            // ç§»é™¤æ‰€æœ‰activeçŠ¶æ€
            document.querySelectorAll('.path-item').forEach(item => {
                item.classList.remove('active');
            });

            if (!isVisible) {
                stylesDiv.style.display = 'block';
                pathItem.classList.add('active');

                // é«˜äº®å¯¹åº”çš„DOMå…ƒç´ 
                if (currentAnalysis) {
                    const element = currentAnalysis.parents[index];
                    document.querySelectorAll('.highlight-element').forEach(el => {
                        el.classList.remove('highlight-element');
                    });
                    element.classList.add('highlight-element');
                }
            }
        }

        // åˆ‡æ¢é€‰æ‹©æ¨¡å¼
        function toggleSelectMode() {
            isSelectMode = !isSelectMode;
            const body = document.body;
            const indicator = document.getElementById('modeIndicator');

            if (isSelectMode) {
                body.classList.add('selecting-mode');
                indicator.style.display = 'block';
                addElementClickListeners();
                showAlert('å…ƒç´ é€‰æ‹©æ¨¡å¼å·²æ¿€æ´»ï¼Œç‚¹å‡»ä»»æ„å…ƒç´ è¿›è¡Œåˆ†æ', 'success');
            } else {
                body.classList.remove('selecting-mode');
                indicator.style.display = 'none';
                removeElementClickListeners();
                showAlert('å…ƒç´ é€‰æ‹©æ¨¡å¼å·²å…³é—­', 'success');
            }
        }

        // æ·»åŠ å…ƒç´ ç‚¹å‡»ç›‘å¬å™¨
        function addElementClickListeners() {
            const demoWebsite = document.getElementById('demoWebsite');
            demoWebsite.addEventListener('click', handleElementClick, true);
        }

        // ç§»é™¤å…ƒç´ ç‚¹å‡»ç›‘å¬å™¨
        function removeElementClickListeners() {
            const demoWebsite = document.getElementById('demoWebsite');
            demoWebsite.removeEventListener('click', handleElementClick, true);
        }

        // å¤„ç†å…ƒç´ ç‚¹å‡»
        function handleElementClick(event) {
            if (!isSelectMode) return;

            event.preventDefault();
            event.stopPropagation();

            const element = event.target;
            const selector = generateSelector(element);

            // æ›´æ–°é€‰æ‹©å™¨è¾“å…¥æ¡†
            document.getElementById('targetSelector').value = selector;

            // å…³é—­é€‰æ‹©æ¨¡å¼
            toggleSelectMode();

            // è‡ªåŠ¨åˆ†æ
            setTimeout(() => {
                analyzeDOM();
            }, 100);
        }

        // ç”Ÿæˆå…ƒç´ é€‰æ‹©å™¨
        function generateSelector(element) {
            if (element.id) {
                return `#${element.id}`;
            }

            if (element.getAttribute('data-element')) {
                return `[data-element='${element.getAttribute('data-element')}']`;
            }

            if (element.className) {
                const classes = element.className.split(' ').filter(c => c.trim());
                if (classes.length > 0) {
                    return `.${classes.join('.')}`;
                }
            }

            return element.tagName.toLowerCase();
        }

        // æ˜¾ç¤ºå…ƒç´ æç¤º
        function showElementTooltip(event, index) {
            if (!currentAnalysis) return;

            const tooltip = document.getElementById('tooltip');
            const element = currentAnalysis.parents[index];
            const rect = element.getBoundingClientRect();

            tooltip.innerHTML = `
                <strong>${element.tagName.toLowerCase()}</strong><br>
                ä½ç½®: ${Math.round(rect.left)}, ${Math.round(rect.top)}<br>
                å°ºå¯¸: ${Math.round(rect.width)} Ã— ${Math.round(rect.height)}
            `;

            tooltip.style.left = event.pageX + 10 + 'px';
            tooltip.style.top = event.pageY - 10 + 'px';
            tooltip.classList.add('show');
        }

        // éšè—å…ƒç´ æç¤º
        function hideElementTooltip() {
            const tooltip = document.getElementById('tooltip');
            tooltip.classList.remove('show');
        }

        // å¯¼å‡ºåˆ†ææŠ¥å‘Š
        function exportAnalysis() {
            if (!currentAnalysis) {
                showAlert('è¯·å…ˆè¿›è¡ŒDOMåˆ†æ', 'error');
                return;
            }

            const report = generateAnalysisReport(currentAnalysis);

            modal.show({
                title: 'ğŸ“„ DOMåˆ†ææŠ¥å‘Š',
                content: `
                    <div style="max-height: 400px; overflow-y: auto;">
                        <pre style="background: #f8f9fa; padding: 15px; border-radius: 6px; font-size: 12px; line-height: 1.4;">${report}</pre>
                    </div>
                    <div style="margin-top: 15px;">
                        <button class="btn" onclick="downloadReport()">ğŸ’¾ ä¸‹è½½æŠ¥å‘Š</button>
                    </div>
                `,
                onConfirm: () => { }
            });
        }

        // ç”Ÿæˆåˆ†ææŠ¥å‘Š
        function generateAnalysisReport(analysis) {
            let report = `DOM ç»“æ„åˆ†ææŠ¥å‘Š
${'='.repeat(50)}

åˆ†ææ—¶é—´: ${analysis.timestamp.toLocaleString()}
ç›®æ ‡é€‰æ‹©å™¨: ${analysis.selector}
ç»ˆæ­¢é€‰æ‹©å™¨: ${analysis.stopSelector || 'æ— '}
è·¯å¾„æ·±åº¦: ${analysis.parents.length} å±‚

DOM è·¯å¾„è¯¦æƒ…:
${'-'.repeat(30)}
`;

            analysis.parents.forEach((element, index) => {
                const tagName = element.tagName.toLowerCase();
                const className = element.className || '';
                const id = element.id || '';
                const dataElement = element.getAttribute('data-element') || '';

                report += `
${index + 1}. ${tagName}${id ? `#${id}` : ''}${className ? `.${className.split(' ').join('.')}` : ''}
   ${dataElement ? `data-element="${dataElement}"` : ''}
   å­å…ƒç´ æ•°é‡: ${element.children.length}
   ${index === analysis.parents.length - 1 ? 'ğŸ¯ [ç›®æ ‡å…ƒç´ ]' : ''}
`;
            });

            report += `
${'='.repeat(50)}
æŠ¥å‘Šç”Ÿæˆå·¥å…·: DOM ç»“æ„åˆ†æå™¨
åŸºäºæ–¹æ³•: getParentsUntil()
`;

            return report;
        }

        // ä¸‹è½½æŠ¥å‘Š
        function downloadReport() {
            const report = generateAnalysisReport(currentAnalysis);
            const blob = new Blob([report], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `DOMåˆ†ææŠ¥å‘Š_${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showAlert('æŠ¥å‘Šä¸‹è½½æˆåŠŸï¼', 'success');
        }

        // æ¸…é™¤åˆ†æç»“æœ
        function clearAnalysis() {
            currentAnalysis = null;
            document.getElementById('analysisResults').style.display = 'none';
            document.getElementById('pathContainer').innerHTML = '';

            // æ¸…é™¤é«˜äº®
            document.querySelectorAll('.highlight-element').forEach(el => {
                el.classList.remove('highlight-element');
            });

            // é‡ç½®ç»Ÿè®¡
            updateStats(null);

            showAlert('åˆ†æç»“æœå·²æ¸…é™¤', 'success');
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats(analysis) {
            const pathLength = analysis ? analysis.parents.length : 0;
            const totalElements = analysis ?
                analysis.parents.reduce((sum, el) => sum + el.querySelectorAll('*').length + 1, 0) : 0;

            document.getElementById('pathLength').textContent = pathLength;
            document.getElementById('totalElements').textContent = totalElements;
        }

        // æ˜¾ç¤ºæç¤ºä¿¡æ¯
        function showAlert(message, type = 'success') {
            const alertClass = type === 'success' ? 'âœ…' : 'âŒ';

            // åˆ›å»ºä¸´æ—¶æç¤ºå…ƒç´ 
            const alert = document.createElement('div');
            alert.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: ${type === 'success' ? '#48bb78' : '#f56565'};
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                font-weight: 600;
                z-index: 10000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                animation: slideDown 0.3s ease;
            `;
            alert.textContent = `${alertClass} ${message}`;

            document.body.appendChild(alert);

            setTimeout(() => {
                alert.style.animation = 'slideUp 0.3s ease forwards';
                setTimeout(() => {
                    document.body.removeChild(alert);
                }, 300);
            }, 3000);
        }

        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function () {
            initPlugins();

            // æ·»åŠ CSSåŠ¨ç”»
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideDown {
                    from { opacity: 0; transform: translateX(-50%) translateY(-20px); }
                    to { opacity: 1; transform: translateX(-50%) translateY(0); }
                }
                @keyframes slideUp {
                    from { opacity: 1; transform: translateX(-50%) translateY(0); }
                    to { opacity: 0; transform: translateX(-50%) translateY(-20px); }
                }
            `;
            document.head.appendChild(style);

            // æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯
            setTimeout(() => {
                showAlert('ğŸ‰ æ¬¢è¿ä½¿ç”¨DOMç»“æ„åˆ†æå™¨ï¼ç‚¹å‡»ç›®æ ‡å…ƒç´ æˆ–ä½¿ç”¨é€‰æ‹©å™¨å¼€å§‹åˆ†æ', 'success');
            }, 1000);
        });
    </script>
</body>

</html>