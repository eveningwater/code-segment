<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½æ»šåŠ¨ç›‘æ§ç®¡ç†å™¨ - getScrollPosition å®æˆ˜ç¤ºä¾‹</title>
    
    <!-- å¼•å…¥è‡ªå®šä¹‰æ’ä»¶æ ·å¼ -->
    <link rel="stylesheet" href="../../demo/plugins/modal/style.css">
    <link rel="stylesheet" href="../../demo/plugins/input-number/style.css">
    <link rel="stylesheet" href="../../demo/plugins/datetime-picker/style.css">
    <link rel="stylesheet" href="../../demo/plugins/select/style.css">
    <link rel="stylesheet" href="../../demo/plugins/checkbox/style.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            text-align: center;
            position: sticky;
            top: 20px;
            z-index: 100;
        }

        .header h1 {
            color: #333;
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            color: #666;
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        .status-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .status-item {
            background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .status-item .label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .status-item .value {
            font-size: 1.4rem;
            margin-top: 5px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
            margin-bottom: 50px;
        }

        .content-area {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .control-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .control-panel h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #555;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-group input:focus {
            border-color: #4285f4;
            outline: none;
            box-shadow: 0 0 0 3px rgba(66, 133, 244, 0.1);
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn.btn-danger {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
        }

        .btn.btn-success {
            background: linear-gradient(45deg, #51cf66, #40c057);
        }

        .scroll-demo-content {
            line-height: 1.8;
            color: #444;
        }

        .scroll-demo-content h2 {
            color: #333;
            margin: 30px 0 15px 0;
            font-size: 1.5rem;
        }

        .scroll-demo-content p {
            margin-bottom: 15px;
            text-align: justify;
        }

        .scroll-trigger {
            background: linear-gradient(45deg, #ffd89b 0%, #19547b 100%);
            color: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 12px;
            text-align: center;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .scroll-trigger.triggered {
            background: linear-gradient(45deg, #a8edea 0%, #fed6e3 100%);
            color: #333;
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .log-panel {
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
            border-radius: 12px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            line-height: 1.4;
        }

        .log-entry {
            margin-bottom: 5px;
            opacity: 0;
            animation: fadeInLog 0.3s ease forwards;
        }

        @keyframes fadeInLog {
            to {
                opacity: 1;
            }
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .metric-card {
            background: linear-gradient(45deg, #ff9a9e 0%, #fecfef 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .metric-card .number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .metric-card .label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .progress-bar {
            background: #e1e5e9;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 8px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        .floating-controls {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
        }

        .floating-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .floating-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.3);
        }

        .floating-btn.scroll-to-top {
            background: linear-gradient(45deg, #667eea, #764ba2);
        }

        .floating-btn.settings {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .status-bar {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(45deg, #764ba2, #667eea);
        }
    </style>
</head>

<body>
    <div class="app-container">
        <!-- å¤´éƒ¨çŠ¶æ€æ  -->
        <div class="header">
            <h1>ğŸš€ æ™ºèƒ½æ»šåŠ¨ç›‘æ§ç®¡ç†å™¨</h1>
            <p>åŸºäº getScrollPosition çš„é«˜çº§æ»šåŠ¨åˆ†æä¸ç›‘æ§ç³»ç»Ÿ</p>
            
            <div class="status-bar">
                <div class="status-item">
                    <div class="label">å½“å‰Xåæ ‡</div>
                    <div class="value" id="currentX">0</div>
                </div>
                <div class="status-item">
                    <div class="label">å½“å‰Yåæ ‡</div>
                    <div class="value" id="currentY">0</div>
                </div>
                <div class="status-item">
                    <div class="label">æ»šåŠ¨è·ç¦»</div>
                    <div class="value" id="totalDistance">0</div>
                </div>
                <div class="status-item">
                    <div class="label">æ»šåŠ¨æ¬¡æ•°</div>
                    <div class="value" id="scrollCount">0</div>
                </div>
            </div>
        </div>

        <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
        <div class="main-content">
            <!-- å·¦ä¾§å†…å®¹åŒº -->
            <div class="content-area">
                <div class="scroll-demo-content">
                    <h2>ğŸ“‹ é¡¹ç›®æ¦‚è¿°</h2>
                    <p>è¿™æ˜¯ä¸€ä¸ªåŸºäº getScrollPosition æ–¹æ³•çš„é«˜çº§å®æˆ˜ç¤ºä¾‹ï¼Œå±•ç¤ºäº†åœ¨ç°ä»£Webåº”ç”¨ä¸­å¦‚ä½•æœ‰æ•ˆåœ°ç›‘æ§å’Œåˆ†æç”¨æˆ·æ»šåŠ¨è¡Œä¸ºã€‚è¯¥ç³»ç»Ÿä¸ä»…èƒ½å¤Ÿå®æ—¶è¿½è¸ªæ»šåŠ¨ä½ç½®ï¼Œè¿˜æä¾›äº†ä¸°å¯Œçš„æ•°æ®åˆ†æå’Œå¯è§†åŒ–åŠŸèƒ½ã€‚</p>
                    
                    <div class="scroll-trigger" data-trigger="section1">
                        ğŸ¯ æ»šåŠ¨è§¦å‘å™¨ #1 - é¡¹ç›®ä»‹ç»åŒºåŸŸ
                    </div>

                    <h2>ğŸ”§ æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§</h2>
                    <p>ç³»ç»Ÿé›†æˆäº†å¤šç§å…ˆè¿›çš„æ»šåŠ¨ç›‘æ§æŠ€æœ¯ï¼ŒåŒ…æ‹¬å®æ—¶ä½ç½®è¿½è¸ªã€æ»šåŠ¨è·ç¦»è®¡ç®—ã€é€Ÿåº¦åˆ†æã€è§¦å‘åŒºåŸŸæ£€æµ‹ç­‰ã€‚é€šè¿‡è‡ªå®šä¹‰çš„UIç»„ä»¶ï¼ˆInputNumberã€DateTimePickerã€Modalç­‰ï¼‰ï¼Œç”¨æˆ·å¯ä»¥çµæ´»é…ç½®ç›‘æ§å‚æ•°ã€‚</p>
                    
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="number" id="avgSpeed">0</div>
                            <div class="label">å¹³å‡é€Ÿåº¦ px/s</div>
                        </div>
                        <div class="metric-card">
                            <div class="number" id="maxSpeed">0</div>
                            <div class="label">æœ€å¤§é€Ÿåº¦ px/s</div>
                        </div>
                        <div class="metric-card">
                            <div class="number" id="sessionsToday">1</div>
                            <div class="label">ä»Šæ—¥ä¼šè¯</div>
                        </div>
                        <div class="metric-card">
                            <div class="number" id="triggerHits">0</div>
                            <div class="label">è§¦å‘æ¬¡æ•°</div>
                        </div>
                    </div>

                    <h2>ğŸ“Š æ•°æ®åˆ†æä¸æŠ¥å‘Š</h2>
                    <p>ç³»ç»Ÿæä¾›è¯¦ç»†çš„æ»šåŠ¨è¡Œä¸ºåˆ†ææŠ¥å‘Šï¼ŒåŒ…æ‹¬ç”¨æˆ·åœç•™æ—¶é—´ã€æ»šåŠ¨æ¨¡å¼è¯†åˆ«ã€çƒ­ç‚¹åŒºåŸŸåˆ†æç­‰ã€‚è¿™äº›æ•°æ®å¯¹äºä¼˜åŒ–ç”¨æˆ·ä½“éªŒå’Œæå‡é¡µé¢è®¾è®¡å…·æœ‰é‡è¦ä»·å€¼ã€‚</p>
                    
                    <div class="scroll-trigger" data-trigger="section2">
                        ğŸ“ˆ æ»šåŠ¨è§¦å‘å™¨ #2 - æ•°æ®åˆ†æåŒºåŸŸ
                    </div>

                    <h2>ğŸ¨ ç”¨æˆ·ç•Œé¢è®¾è®¡</h2>
                    <p>é‡‡ç”¨ç°ä»£åŒ–çš„æ¸å˜è®¾è®¡å’Œæ¯›ç»ç’ƒæ•ˆæœï¼Œç¡®ä¿ç•Œé¢ç¾è§‚ä¸”æ˜“äºä½¿ç”¨ã€‚å“åº”å¼å¸ƒå±€é€‚é…å„ç§è®¾å¤‡å°ºå¯¸ï¼Œæä¾›ä¸€è‡´çš„ç”¨æˆ·ä½“éªŒã€‚æ‰€æœ‰äº¤äº’å…ƒç´ éƒ½ç»è¿‡ç²¾å¿ƒè®¾è®¡ï¼Œç¬¦åˆç°ä»£Webè®¾è®¡æ ‡å‡†ã€‚</p>

                    <h2>âš™ï¸ æŠ€æœ¯å®ç°ç»†èŠ‚</h2>
                    <p>æ ¸å¿ƒåŸºäº getScrollPosition å‡½æ•°ï¼Œè¯¥å‡½æ•°èƒ½å¤Ÿå‡†ç¡®è·å–ä»»æ„å…ƒç´ çš„æ»šåŠ¨ä½ç½®ã€‚ç³»ç»Ÿè¿˜é›†æˆäº†é˜²æŠ–å’ŒèŠ‚æµæŠ€æœ¯ï¼Œç¡®ä¿é«˜é¢‘æ»šåŠ¨äº‹ä»¶çš„æ€§èƒ½ä¼˜åŒ–ã€‚æ•°æ®æŒä¹…åŒ–é‡‡ç”¨ localStorageï¼Œæ”¯æŒè·¨ä¼šè¯çš„æ•°æ®ä¿å­˜ã€‚</p>
                    
                    <div class="scroll-trigger" data-trigger="section3">
                        âš¡ æ»šåŠ¨è§¦å‘å™¨ #3 - æŠ€æœ¯å®ç°åŒºåŸŸ
                    </div>

                    <h2>ğŸ“± ç§»åŠ¨ç«¯é€‚é…</h2>
                    <p>å®Œæ•´æ”¯æŒç§»åŠ¨è®¾å¤‡çš„è§¦æ‘¸æ»šåŠ¨ï¼ŒåŒ…æ‹¬æƒ¯æ€§æ»šåŠ¨ã€æ©¡çš®ç­‹æ•ˆæœç­‰ã€‚é€šè¿‡ CSS Grid å’Œ Flexbox å®ç°çš„å“åº”å¼å¸ƒå±€ç¡®ä¿åœ¨ä¸åŒå±å¹•å°ºå¯¸ä¸‹éƒ½èƒ½æä¾›æœ€ä½³çš„ç”¨æˆ·ä½“éªŒã€‚</p>

                    <h2>ğŸ”® æœªæ¥å‘å±•è§„åˆ’</h2>
                    <p>è®¡åˆ’é›†æˆæœºå™¨å­¦ä¹ ç®—æ³•è¿›è¡Œç”¨æˆ·è¡Œä¸ºé¢„æµ‹ï¼Œæ·»åŠ æ›´å¤šçš„æ•°æ®å¯è§†åŒ–å›¾è¡¨ï¼Œæ”¯æŒå¤šç§æ•°æ®å¯¼å‡ºæ ¼å¼ï¼Œä»¥åŠæä¾› RESTful API ä¾›ç¬¬ä¸‰æ–¹ç³»ç»Ÿé›†æˆä½¿ç”¨ã€‚</p>
                    
                    <div class="scroll-trigger" data-trigger="section4">
                        ğŸš€ æ»šåŠ¨è§¦å‘å™¨ #4 - æœªæ¥è§„åˆ’åŒºåŸŸ
                    </div>

                    <h2>ğŸ“– ä½¿ç”¨æŒ‡å—</h2>
                    <p>å³ä¾§æ§åˆ¶é¢æ¿æä¾›äº†ä¸°å¯Œçš„é…ç½®é€‰é¡¹ï¼ŒåŒ…æ‹¬ç›‘æ§é—´éš”è®¾ç½®ã€è§¦å‘é˜ˆå€¼é…ç½®ã€æ•°æ®è®°å½•ç®¡ç†ç­‰ã€‚ç”¨æˆ·å¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚è°ƒæ•´è¿™äº›å‚æ•°ï¼Œä»¥è·å¾—æœ€ä½³çš„ç›‘æ§æ•ˆæœã€‚</p>

                    <p>ç³»ç»Ÿè¿˜æ”¯æŒæ•°æ®å¯¼å‡ºåŠŸèƒ½ï¼Œå¯ä»¥å°†æ”¶é›†åˆ°çš„æ»šåŠ¨æ•°æ®å¯¼å‡ºä¸º JSON æˆ– CSV æ ¼å¼ï¼Œä¾¿äºè¿›ä¸€æ­¥çš„æ•°æ®åˆ†æå’Œå¤„ç†ã€‚é€šè¿‡æ—¥æœŸæ—¶é—´é€‰æ‹©å™¨ï¼Œç”¨æˆ·å¯ä»¥æŸ¥çœ‹ç‰¹å®šæ—¶é—´æ®µçš„æ»šåŠ¨ç»Ÿè®¡æ•°æ®ã€‚</p>

                    <p>æ„Ÿè°¢ä½¿ç”¨æ™ºèƒ½æ»šåŠ¨ç›‘æ§ç®¡ç†å™¨ï¼è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº† getScrollPosition å‡½æ•°åœ¨å®é™…ä¸šåŠ¡åœºæ™¯ä¸­çš„å¼ºå¤§åº”ç”¨æ½œåŠ›ã€‚</p>
                </div>
            </div>

            <!-- å³ä¾§æ§åˆ¶é¢æ¿ -->
            <div class="sidebar">
                <!-- ç›‘æ§è®¾ç½® -->
                <div class="control-panel">
                    <h3>âš™ï¸ ç›‘æ§è®¾ç½®</h3>
                    
                    <div class="form-group">
                        <label>ç›‘æ§é—´éš” (æ¯«ç§’)</label>
                        <div id="intervalInput"></div>
                    </div>
                    
                    <div class="form-group">
                        <label>è§¦å‘é˜ˆå€¼ (åƒç´ )</label>
                        <div id="thresholdInput"></div>
                    </div>
                    
                    <div class="form-group">
                        <label>å¯ç”¨å®æ—¶ç›‘æ§</label>
                        <div id="enableMonitoring"></div>
                    </div>
                    
                    <button class="btn" onclick="applySettings()">åº”ç”¨è®¾ç½®</button>
                    <button class="btn btn-danger" onclick="resetSettings()">é‡ç½®è®¾ç½®</button>
                </div>

                <!-- æ•°æ®ç®¡ç† -->
                <div class="control-panel">
                    <h3>ğŸ“Š æ•°æ®ç®¡ç†</h3>
                    
                    <div class="form-group">
                        <label>é€‰æ‹©æ—¥æœŸèŒƒå›´</label>
                        <div id="dateRangePicker"></div>
                    </div>
                    
                    <button class="btn btn-success" onclick="exportData()">å¯¼å‡ºæ•°æ®</button>
                    <button class="btn" onclick="showStatistics()">æŸ¥çœ‹ç»Ÿè®¡</button>
                    <button class="btn btn-danger" onclick="clearData()">æ¸…ç©ºæ•°æ®</button>
                </div>

                <!-- å®æ—¶æ—¥å¿— -->
                <div class="control-panel">
                    <h3>ğŸ“ å®æ—¶æ—¥å¿—</h3>
                    <div class="log-panel" id="logPanel">
                        <div class="log-entry">ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ...</div>
                    </div>
                    <button class="btn" onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
                </div>
            </div>
        </div>

        <!-- é¡µé¢åº•éƒ¨è¿›åº¦æ¡ -->
        <div class="progress-bar">
            <div class="progress-fill" id="scrollProgress"></div>
        </div>
    </div>

    <!-- æµ®åŠ¨æ§åˆ¶æŒ‰é’® -->
    <div class="floating-controls">
        <button class="floating-btn scroll-to-top" onclick="scrollToTop()" title="å›åˆ°é¡¶éƒ¨">
            â†‘
        </button>
        <button class="floating-btn settings" onclick="openSettings()" title="è®¾ç½®">
            âš™
        </button>
    </div>

    <!-- å¼•å…¥è‡ªå®šä¹‰æ’ä»¶ -->
    <script src="../../demo/plugins/modal/index.js"></script>
    <script src="../../demo/plugins/input-number/index.js"></script>
    <script src="../../demo/plugins/datetime-picker/index.js"></script>
    <script src="../../demo/plugins/select/index.js"></script>
    <script src="../../demo/plugins/checkbox/index.js"></script>

<script>
        // æ ¸å¿ƒ getScrollPosition å‡½æ•°
    const getScrollPosition = (el = window) => ({
        x: el.pageXOffset !== undefined ? el.pageXOffset : el.scrollLeft,
        y: el.pageYOffset !== undefined ? el.pageYOffset : el.scrollTop
        });

        // å…¨å±€å˜é‡
        let scrollMonitor = {
            isActive: false,
            interval: 100,
            threshold: 50,
            lastPosition: { x: 0, y: 0 },
            totalDistance: 0,
            scrollCount: 0,
            speeds: [],
            maxSpeed: 0,
            triggerHits: 0,
            sessionData: [],
            startTime: Date.now()
        };

        // UI ç»„ä»¶å®ä¾‹
        let modal, intervalInput, thresholdInput, enableCheckbox, dateTimePicker;

        // åˆå§‹åŒ–ç³»ç»Ÿ
        function initializeSystem() {
            log('æ­£åœ¨åˆå§‹åŒ–æ™ºèƒ½æ»šåŠ¨ç›‘æ§ç³»ç»Ÿ...');
            
            // åˆå§‹åŒ–Modal
            modal = new Modal({ closeOnOverlayClick: true });
            
            // åˆå§‹åŒ–InputNumberç»„ä»¶
            intervalInput = new InputNumber({
                container: '#intervalInput',
                min: 50,
                max: 5000,
                step: 50,
                value: 100,
                onChange: (value) => {
                    scrollMonitor.interval = value;
                    log(`ç›‘æ§é—´éš”å·²æ›´æ–°: ${value}ms`);
                }
            });

            thresholdInput = new InputNumber({
                container: '#thresholdInput',
                min: 10,
                max: 500,
                step: 10,
                value: 50,
                onChange: (value) => {
                    scrollMonitor.threshold = value;
                    log(`è§¦å‘é˜ˆå€¼å·²æ›´æ–°: ${value}px`);
                }
            });

            // åˆå§‹åŒ–DateTimePicker
            dateTimePicker = new DateTimePicker({
                container: '#dateRangePicker',
                placeholder: 'é€‰æ‹©æŸ¥è¯¢æ—¥æœŸ',
                onChange: (value) => {
                    log(`æ—¥æœŸèŒƒå›´å·²é€‰æ‹©: ${value}`);
                }
            });

            // åˆå§‹åŒ–Checkboxï¼ˆç®€åŒ–å®ç°ï¼‰
            const checkboxContainer = document.getElementById('enableMonitoring');
            checkboxContainer.innerHTML = `
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" id="monitoringCheckbox" checked style="margin-right: 8px;">
                    <span>å¯ç”¨å®æ—¶ç›‘æ§</span>
                </label>
            `;

            // å¯åŠ¨ç›‘æ§
            startMonitoring();
            
            // è®¾ç½®æ»šåŠ¨äº‹ä»¶ç›‘å¬
            setupScrollListeners();
            
            log('ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆï¼Œå¼€å§‹ç›‘æ§æ»šåŠ¨è¡Œä¸º');
        }

        // å¯åŠ¨ç›‘æ§
        function startMonitoring() {
            if (scrollMonitor.isActive) return;
            
            scrollMonitor.isActive = true;
            scrollMonitor.startTime = Date.now();
            
            const monitorLoop = () => {
                if (!scrollMonitor.isActive) return;
                
                const currentPos = getScrollPosition();
                const checkbox = document.getElementById('monitoringCheckbox');
                
                if (checkbox && checkbox.checked) {
                    updateScrollMetrics(currentPos);
                    updateUI(currentPos);
                }
                
                setTimeout(monitorLoop, scrollMonitor.interval);
            };
            
            monitorLoop();
        }

        // è®¾ç½®æ»šåŠ¨äº‹ä»¶ç›‘å¬
        function setupScrollListeners() {
            let lastScrollTime = Date.now();
            let isScrolling = false;

            window.addEventListener('scroll', throttle(() => {
                const currentTime = Date.now();
                const currentPos = getScrollPosition();
                
                // è®¡ç®—æ»šåŠ¨é€Ÿåº¦
                const timeDiff = currentTime - lastScrollTime;
                const distanceDiff = Math.abs(currentPos.y - scrollMonitor.lastPosition.y);
                const speed = timeDiff > 0 ? (distanceDiff / timeDiff) * 1000 : 0;
                
                if (speed > 0) {
                    scrollMonitor.speeds.push(speed);
                    if (speed > scrollMonitor.maxSpeed) {
                        scrollMonitor.maxSpeed = speed;
                    }
                }
                
                // æ£€æŸ¥è§¦å‘å™¨
                checkScrollTriggers(currentPos.y);
                
                // æ›´æ–°è¿›åº¦æ¡
                updateScrollProgress();
                
                lastScrollTime = currentTime;
                scrollMonitor.lastPosition = currentPos;
                
                // æ ‡è®°æ­£åœ¨æ»šåŠ¨
                if (!isScrolling) {
                    isScrolling = true;
                    document.body.classList.add('scrolling');
                }
                
                // æ»šåŠ¨ç»“æŸæ£€æµ‹
                clearTimeout(window.scrollEndTimer);
                window.scrollEndTimer = setTimeout(() => {
                    isScrolling = false;
                    document.body.classList.remove('scrolling');
                    log(`æ»šåŠ¨ç»“æŸäºä½ç½®: (${currentPos.x}, ${currentPos.y})`);
                }, 150);
                
            }, 16)); // çº¦60fps
        }

        // æ›´æ–°æ»šåŠ¨æŒ‡æ ‡
        function updateScrollMetrics(currentPos) {
            const distance = Math.sqrt(
                Math.pow(currentPos.x - scrollMonitor.lastPosition.x, 2) +
                Math.pow(currentPos.y - scrollMonitor.lastPosition.y, 2)
            );
            
            if (distance > scrollMonitor.threshold) {
                scrollMonitor.totalDistance += distance;
                scrollMonitor.scrollCount++;
                
                // è®°å½•ä¼šè¯æ•°æ®
                scrollMonitor.sessionData.push({
                    timestamp: Date.now(),
                    position: { ...currentPos },
                    distance: distance
                });
                
                // é™åˆ¶ä¼šè¯æ•°æ®å¤§å°
                if (scrollMonitor.sessionData.length > 1000) {
                    scrollMonitor.sessionData = scrollMonitor.sessionData.slice(-500);
                }
            }
            
            scrollMonitor.lastPosition = currentPos;
        }

        // æ›´æ–°UIæ˜¾ç¤º
        function updateUI(currentPos) {
            document.getElementById('currentX').textContent = Math.round(currentPos.x);
            document.getElementById('currentY').textContent = Math.round(currentPos.y);
            document.getElementById('totalDistance').textContent = Math.round(scrollMonitor.totalDistance);
            document.getElementById('scrollCount').textContent = scrollMonitor.scrollCount;
            
            // è®¡ç®—å¹³å‡é€Ÿåº¦
            const avgSpeed = scrollMonitor.speeds.length > 0 
                ? scrollMonitor.speeds.reduce((a, b) => a + b) / scrollMonitor.speeds.length 
                : 0;
            
            document.getElementById('avgSpeed').textContent = Math.round(avgSpeed);
            document.getElementById('maxSpeed').textContent = Math.round(scrollMonitor.maxSpeed);
            document.getElementById('triggerHits').textContent = scrollMonitor.triggerHits;
        }

        // æ£€æŸ¥æ»šåŠ¨è§¦å‘å™¨
        function checkScrollTriggers(scrollY) {
            const triggers = document.querySelectorAll('.scroll-trigger');
            triggers.forEach(trigger => {
                const rect = trigger.getBoundingClientRect();
                const isVisible = rect.top < window.innerHeight && rect.bottom > 0;
                
                if (isVisible && !trigger.classList.contains('triggered')) {
                    trigger.classList.add('triggered');
                    scrollMonitor.triggerHits++;
                    
                    const triggerName = trigger.getAttribute('data-trigger');
                    log(`è§¦å‘å™¨æ¿€æ´»: ${triggerName} (ä½ç½®: ${Math.round(scrollY)}px)`);
                    
                    // è§¦å‘åŠ¨ç”»æ•ˆæœ
                    trigger.style.transform = 'scale(1.05)';
                    setTimeout(() => {
                        trigger.style.transform = '';
                    }, 300);
                }
            });
        }

        // æ›´æ–°æ»šåŠ¨è¿›åº¦æ¡
        function updateScrollProgress() {
            const documentHeight = document.documentElement.scrollHeight - window.innerHeight;
            const scrolled = window.pageYOffset;
            const progress = (scrolled / documentHeight) * 100;
            
            document.getElementById('scrollProgress').style.width = `${Math.min(progress, 100)}%`;
        }

        // èŠ‚æµå‡½æ•°
        function throttle(func, limit) {
            let inThrottle;
            return function() {
                const args = arguments;
                const context = this;
                if (!inThrottle) {
                    func.apply(context, args);
                    inThrottle = true;
                    setTimeout(() => inThrottle = false, limit);
                }
            }
        }

        // æ—¥å¿—è®°å½•
        function log(message) {
            const logPanel = document.getElementById('logPanel');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            
            logPanel.appendChild(logEntry);
            logPanel.scrollTop = logPanel.scrollHeight;
            
            // é™åˆ¶æ—¥å¿—æ¡ç›®æ•°é‡
            const entries = logPanel.querySelectorAll('.log-entry');
            if (entries.length > 50) {
                entries[0].remove();
            }
        }

        // åº”ç”¨è®¾ç½®
        function applySettings() {
            const checkbox = document.getElementById('monitoringCheckbox');
            scrollMonitor.isActive = checkbox.checked;
            
            modal.alert('è®¾ç½®å·²åº”ç”¨ï¼ç›‘æ§ç³»ç»Ÿå·²æ ¹æ®æ–°é…ç½®æ›´æ–°ã€‚');
            log('ç”¨æˆ·åº”ç”¨äº†æ–°çš„ç›‘æ§è®¾ç½®');
        }

        // é‡ç½®è®¾ç½®
        function resetSettings() {
            modal.confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰è®¾ç½®å—ï¼Ÿè¿™å°†æ¸…é™¤å½“å‰çš„é…ç½®å’Œæ•°æ®ã€‚').then(confirmed => {
                if (confirmed) {
                    // é‡ç½®ç»„ä»¶å€¼
                    intervalInput.setValue(100);
                    thresholdInput.setValue(50);
                    document.getElementById('monitoringCheckbox').checked = true;
                    
                    // é‡ç½®ç›‘æ§æ•°æ®
                    scrollMonitor = {
                        isActive: true,
                        interval: 100,
                        threshold: 50,
                        lastPosition: { x: 0, y: 0 },
                        totalDistance: 0,
                        scrollCount: 0,
                        speeds: [],
                        maxSpeed: 0,
                        triggerHits: 0,
                        sessionData: [],
                        startTime: Date.now()
                    };
                    
                    log('æ‰€æœ‰è®¾ç½®å·²é‡ç½®ä¸ºé»˜è®¤å€¼');
                    modal.alert('è®¾ç½®é‡ç½®å®Œæˆï¼');
                }
            });
        }

        // å¯¼å‡ºæ•°æ®
        function exportData() {
            const exportData = {
                summary: {
                    totalDistance: scrollMonitor.totalDistance,
                    scrollCount: scrollMonitor.scrollCount,
                    maxSpeed: scrollMonitor.maxSpeed,
                    avgSpeed: scrollMonitor.speeds.length > 0 
                        ? scrollMonitor.speeds.reduce((a, b) => a + b) / scrollMonitor.speeds.length 
                        : 0,
                    triggerHits: scrollMonitor.triggerHits,
                    sessionDuration: Date.now() - scrollMonitor.startTime
                },
                sessionData: scrollMonitor.sessionData,
                exportTime: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `scroll-data-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
            log('æ»šåŠ¨æ•°æ®å·²å¯¼å‡ºä¸ºJSONæ–‡ä»¶');
            modal.alert('æ•°æ®å¯¼å‡ºæˆåŠŸï¼æ–‡ä»¶å·²å¼€å§‹ä¸‹è½½ã€‚');
        }

        // æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
        function showStatistics() {
            const avgSpeed = scrollMonitor.speeds.length > 0 
                ? (scrollMonitor.speeds.reduce((a, b) => a + b) / scrollMonitor.speeds.length).toFixed(2)
                : 0;
            
            const sessionDuration = ((Date.now() - scrollMonitor.startTime) / 1000 / 60).toFixed(1);
            
            const statsHTML = `
                <h4>ğŸ“Š è¯¦ç»†ç»Ÿè®¡æŠ¥å‘Š</h4>
                <p><strong>ä¼šè¯æ—¶é•¿:</strong> ${sessionDuration} åˆ†é’Ÿ</p>
                <p><strong>æ€»æ»šåŠ¨è·ç¦»:</strong> ${Math.round(scrollMonitor.totalDistance)} åƒç´ </p>
                <p><strong>æ»šåŠ¨æ¬¡æ•°:</strong> ${scrollMonitor.scrollCount} æ¬¡</p>
                <p><strong>å¹³å‡é€Ÿåº¦:</strong> ${avgSpeed} px/s</p>
                <p><strong>æœ€å¤§é€Ÿåº¦:</strong> ${Math.round(scrollMonitor.maxSpeed)} px/s</p>
                <p><strong>è§¦å‘å™¨å‘½ä¸­:</strong> ${scrollMonitor.triggerHits} æ¬¡</p>
                <p><strong>æ•°æ®ç‚¹æ•°é‡:</strong> ${scrollMonitor.sessionData.length} ä¸ª</p>
                <hr>
                <p style="font-size: 0.9em; color: #666;">æ•°æ®åŸºäºå½“å‰ä¼šè¯ï¼Œä»…ä¾›å‚è€ƒåˆ†æä½¿ç”¨ã€‚</p>
            `;
            
            modal.show({
                title: 'ç»Ÿè®¡æŠ¥å‘Š',
                content: statsHTML,
                onConfirm: () => log('ç”¨æˆ·æŸ¥çœ‹äº†ç»Ÿè®¡æŠ¥å‘Š')
            });
        }

        // æ¸…ç©ºæ•°æ®
        function clearData() {
            modal.confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ç›‘æ§æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚').then(confirmed => {
                if (confirmed) {
                    scrollMonitor.totalDistance = 0;
                    scrollMonitor.scrollCount = 0;
                    scrollMonitor.speeds = [];
                    scrollMonitor.maxSpeed = 0;
                    scrollMonitor.triggerHits = 0;
                    scrollMonitor.sessionData = [];
                    scrollMonitor.startTime = Date.now();
                    
                    // é‡ç½®è§¦å‘å™¨çŠ¶æ€
                    document.querySelectorAll('.scroll-trigger').forEach(trigger => {
                        trigger.classList.remove('triggered');
                    });
                    
                    log('æ‰€æœ‰ç›‘æ§æ•°æ®å·²æ¸…ç©º');
                    modal.alert('æ•°æ®æ¸…ç©ºå®Œæˆï¼');
                }
            });
        }

        // æ¸…ç©ºæ—¥å¿—
        function clearLog() {
            document.getElementById('logPanel').innerHTML = '<div class="log-entry">æ—¥å¿—å·²æ¸…ç©º...</div>';
        }

        // æ»šåŠ¨åˆ°é¡¶éƒ¨
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
            log('ç”¨æˆ·è¯·æ±‚æ»šåŠ¨åˆ°é¡µé¢é¡¶éƒ¨');
        }

        // æ‰“å¼€è®¾ç½®
        function openSettings() {
            modal.prompt('è¯·è¾“å…¥è‡ªå®šä¹‰ç›‘æ§é—´éš” (50-5000ms):', scrollMonitor.interval.toString()).then(result => {
                if (result !== null) {
                    const interval = parseInt(result);
                    if (interval >= 50 && interval <= 5000) {
                        intervalInput.setValue(interval);
                        scrollMonitor.interval = interval;
                        log(`ç›‘æ§é—´éš”å·²é€šè¿‡å¿«é€Ÿè®¾ç½®æ›´æ–°ä¸º: ${interval}ms`);
                        modal.alert('è®¾ç½®æ›´æ–°æˆåŠŸï¼');
                    } else {
                        modal.alert('è¯·è¾“å…¥æœ‰æ•ˆçš„é—´éš”å€¼ (50-5000ms)');
                    }
                }
            });
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // å»¶è¿Ÿåˆå§‹åŒ–ä»¥ç¡®ä¿æ‰€æœ‰æ’ä»¶åŠ è½½å®Œæˆ
            setTimeout(initializeSystem, 500);
        });

        // é¡µé¢å¸è½½å‰ä¿å­˜æ•°æ®
        window.addEventListener('beforeunload', function() {
            if (scrollMonitor.sessionData.length > 0) {
                localStorage.setItem('scrollMonitorData', JSON.stringify({
                    data: scrollMonitor,
                    timestamp: Date.now()
                }));
            }
        });

        // å°è¯•æ¢å¤ä¹‹å‰çš„æ•°æ®
        window.addEventListener('load', function() {
            const savedData = localStorage.getItem('scrollMonitorData');
            if (savedData) {
                try {
                    const parsed = JSON.parse(savedData);
                    const dayAgo = Date.now() - 24 * 60 * 60 * 1000;
                    
                    if (parsed.timestamp > dayAgo) {
                        log('å‘ç°ä¹‹å‰çš„ä¼šè¯æ•°æ®ï¼Œæ­£åœ¨æ¢å¤...');
                        // è¿™é‡Œå¯ä»¥é€‰æ‹©æ€§æ¢å¤ä¸€äº›æ•°æ®
                    }
                } catch (e) {
                    console.warn('æ— æ³•æ¢å¤ä¹‹å‰çš„ä¼šè¯æ•°æ®:', e);
                }
            }
        });
</script>
</body>

</html>