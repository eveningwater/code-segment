<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡ä»¶ç›®å½•æµè§ˆå™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #2c3e50;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 6px;
        }

        .depth-control {
            display: flex;
            align-items: center;
        }

        .depth-control label {
            margin-right: 10px;
            font-weight: bold;
        }

        .depth-control select {
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            background-color: #fff;
            font-size: 14px;
        }

        .search-box {
            display: flex;
            align-items: center;
        }

        .search-box input {
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            width: 250px;
            font-size: 14px;
        }

        .search-box button {
            padding: 8px 16px;
            background-color: #4dabf7;
            color: white;
            border: none;
            border-radius: 4px;
            margin-left: 10px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .search-box button:hover {
            background-color: #339af0;
        }

        .file-system {
            border: 1px solid #dee2e6;
            border-radius: 6px;
            overflow: hidden;
        }

        .file-list {
            list-style: none;
        }

        .file-item {
            padding: 12px 15px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            align-items: center;
            transition: background-color 0.2s;
        }

        .file-item:last-child {
            border-bottom: none;
        }

        .file-item:hover {
            background-color: #f8f9fa;
        }

        .file-icon {
            margin-right: 10px;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .file-icon.folder {
            color: #ffc107;
        }

        .file-icon.file {
            color: #6c757d;
        }

        .file-name {
            flex-grow: 1;
        }

        .file-path {
            color: #6c757d;
            font-size: 12px;
            margin-right: 15px;
        }

        .file-size {
            color: #6c757d;
            font-size: 12px;
            width: 80px;
            text-align: right;
        }

        .breadcrumb {
            display: flex;
            list-style: none;
            padding: 10px 15px;
            background-color: #e9ecef;
            border-radius: 4px;
            margin-bottom: 15px;
            overflow-x: auto;
            white-space: nowrap;
        }

        .breadcrumb-item {
            display: flex;
            align-items: center;
        }

        .breadcrumb-item:not(:last-child)::after {
            content: '/';
            margin: 0 10px;
            color: #6c757d;
        }

        .breadcrumb-item a {
            color: #007bff;
            text-decoration: none;
        }

        .breadcrumb-item.active {
            color: #6c757d;
        }

        .stats {
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
            color: #6c757d;
            font-size: 14px;
        }

        .empty-message {
            text-align: center;
            padding: 40px;
            color: #6c757d;
            font-style: italic;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        .spinner {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid rgba(0, 123, 255, 0.3);
            border-radius: 50%;
            border-top-color: #007bff;
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 10px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>æ–‡ä»¶ç›®å½•æµè§ˆå™¨</h1>

        <div class="controls">
            <div class="depth-control">
                <label for="flatten-depth">æ‰å¹³åŒ–æ·±åº¦:</label>
                <select id="flatten-depth">
                    <option value="0">ä¸æ‰å¹³åŒ–</option>
                    <option value="1" selected>æ‰å¹³åŒ– 1 çº§</option>
                    <option value="2">æ‰å¹³åŒ– 2 çº§</option>
                    <option value="3">æ‰å¹³åŒ– 3 çº§</option>
                    <option value="-1">å®Œå…¨æ‰å¹³åŒ–</option>
                </select>
            </div>

            <div class="search-box">
                <input type="text" id="search-input" placeholder="æœç´¢æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹...">
                <button id="search-button">æœç´¢</button>
            </div>
        </div>

        <ul class="breadcrumb" id="breadcrumb">
            <li class="breadcrumb-item active">æ ¹ç›®å½•</li>
        </ul>

        <div class="file-system">
            <div id="file-container">
                <div class="loading">
                    <div class="spinner"></div>
                    <div>åŠ è½½ä¸­...</div>
                </div>
            </div>
        </div>

        <div class="stats">
            <div id="total-stats">æ€»è®¡: <span id="total-count">0</span> ä¸ªé¡¹ç›®</div>
            <div id="filtered-stats">æ˜¾ç¤º: <span id="filtered-count">0</span> ä¸ªé¡¹ç›®</div>
        </div>
    </div>

    <script>
        // flatten å‡½æ•°å®ç°
        const flatten = (arr, depth = 1) =>
            arr.reduce(
                (a, v) =>
                    a.concat(depth > 1 && Array.isArray(v) ? flatten(v, depth - 1) : v),
                []
            );

        // æ¨¡æ‹Ÿæ–‡ä»¶ç³»ç»Ÿæ•°æ®
        const fileSystemData = {
            name: 'æ ¹ç›®å½•',
            type: 'folder',
            path: '/',
            children: [
                {
                    name: 'æ–‡æ¡£',
                    type: 'folder',
                    path: '/æ–‡æ¡£',
                    children: [
                        {
                            name: 'å·¥ä½œ',
                            type: 'folder',
                            path: '/æ–‡æ¡£/å·¥ä½œ',
                            children: [
                                { name: 'é¡¹ç›®è®¡åˆ’.docx', type: 'file', path: '/æ–‡æ¡£/å·¥ä½œ/é¡¹ç›®è®¡åˆ’.docx', size: '245 KB' },
                                { name: 'ä¼šè®®è®°å½•.docx', type: 'file', path: '/æ–‡æ¡£/å·¥ä½œ/ä¼šè®®è®°å½•.docx', size: '125 KB' },
                                { name: 'é¢„ç®—è¡¨.xlsx', type: 'file', path: '/æ–‡æ¡£/å·¥ä½œ/é¢„ç®—è¡¨.xlsx', size: '1.2 MB' }
                            ]
                        },
                        {
                            name: 'ä¸ªäºº',
                            type: 'folder',
                            path: '/æ–‡æ¡£/ä¸ªäºº',
                            children: [
                                { name: 'ç®€å†.pdf', type: 'file', path: '/æ–‡æ¡£/ä¸ªäºº/ç®€å†.pdf', size: '380 KB' },
                                { name: 'æ—¥è®°.txt', type: 'file', path: '/æ–‡æ¡£/ä¸ªäºº/æ—¥è®°.txt', size: '45 KB' }
                            ]
                        },
                        { name: 'é‡è¦ç¬”è®°.txt', type: 'file', path: '/æ–‡æ¡£/é‡è¦ç¬”è®°.txt', size: '12 KB' }
                    ]
                },
                {
                    name: 'å›¾ç‰‡',
                    type: 'folder',
                    path: '/å›¾ç‰‡',
                    children: [
                        {
                            name: 'å‡æœŸç…§ç‰‡',
                            type: 'folder',
                            path: '/å›¾ç‰‡/å‡æœŸç…§ç‰‡',
                            children: [
                                { name: 'æµ·æ»©.jpg', type: 'file', path: '/å›¾ç‰‡/å‡æœŸç…§ç‰‡/æµ·æ»©.jpg', size: '2.4 MB' },
                                { name: 'å±±æ™¯.jpg', type: 'file', path: '/å›¾ç‰‡/å‡æœŸç…§ç‰‡/å±±æ™¯.jpg', size: '3.1 MB' },
                                {
                                    name: 'åŸå¸‚æ¸¸',
                                    type: 'folder',
                                    path: '/å›¾ç‰‡/å‡æœŸç…§ç‰‡/åŸå¸‚æ¸¸',
                                    children: [
                                        { name: 'åšç‰©é¦†.jpg', type: 'file', path: '/å›¾ç‰‡/å‡æœŸç…§ç‰‡/åŸå¸‚æ¸¸/åšç‰©é¦†.jpg', size: '1.8 MB' },
                                        { name: 'è¡—æ™¯.jpg', type: 'file', path: '/å›¾ç‰‡/å‡æœŸç…§ç‰‡/åŸå¸‚æ¸¸/è¡—æ™¯.jpg', size: '2.2 MB' }
                                    ]
                                }
                            ]
                        },
                        { name: 'å¤´åƒ.png', type: 'file', path: '/å›¾ç‰‡/å¤´åƒ.png', size: '450 KB' },
                        { name: 'å®¶åº­åˆå½±.jpg', type: 'file', path: '/å›¾ç‰‡/å®¶åº­åˆå½±.jpg', size: '4.5 MB' }
                    ]
                },
                {
                    name: 'éŸ³ä¹',
                    type: 'folder',
                    path: '/éŸ³ä¹',
                    children: [
                        { name: 'æœ€çˆ±æ­Œæ›².mp3', type: 'file', path: '/éŸ³ä¹/æœ€çˆ±æ­Œæ›².mp3', size: '8.2 MB' },
                        { name: 'æ–°æ­Œ.mp3', type: 'file', path: '/éŸ³ä¹/æ–°æ­Œ.mp3', size: '6.7 MB' }
                    ]
                },
                { name: 'ç³»ç»Ÿé…ç½®.ini', type: 'file', path: '/ç³»ç»Ÿé…ç½®.ini', size: '1 KB' },
                { name: 'å¿«æ·æ–¹å¼.lnk', type: 'file', path: '/å¿«æ·æ–¹å¼.lnk', size: '2 KB' }
            ]
        };

        // å½“å‰ç›®å½•è·¯å¾„
        let currentPath = '/';
        // å½“å‰æ˜¾ç¤ºçš„æ–‡ä»¶åˆ—è¡¨
        let currentFiles = [];

        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', () => {
            // åŠ è½½æ ¹ç›®å½•
            loadDirectory(currentPath);

            // æ·»åŠ æ‰å¹³åŒ–æ·±åº¦é€‰æ‹©äº‹ä»¶
            document.getElementById('flatten-depth').addEventListener('change', (e) => {
                loadDirectory(currentPath);
            });

            // æ·»åŠ æœç´¢äº‹ä»¶
            document.getElementById('search-button').addEventListener('click', () => {
                const searchTerm = document.getElementById('search-input').value.trim().toLowerCase();
                if (searchTerm) {
                    searchFiles(searchTerm);
                } else {
                    loadDirectory(currentPath);
                }
            });

            // å›è½¦é”®æœç´¢
            document.getElementById('search-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    document.getElementById('search-button').click();
                }
            });
        });

        // åŠ è½½æŒ‡å®šè·¯å¾„çš„ç›®å½•
        function loadDirectory(path) {
            currentPath = path;
            const fileContainer = document.getElementById('file-container');
            fileContainer.innerHTML = '<div class="loading"><div class="spinner"></div><div>åŠ è½½ä¸­...</div></div>';

            // æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ
            setTimeout(() => {
                // è·å–å½“å‰è·¯å¾„çš„æ–‡ä»¶å¤¹
                const currentFolder = getDirectoryByPath(path);
                if (!currentFolder) {
                    fileContainer.innerHTML = '<div class="empty-message">ç›®å½•ä¸å­˜åœ¨</div>';
                    return;
                }

                // æ›´æ–°é¢åŒ…å±‘å¯¼èˆª
                updateBreadcrumb(path);

                // è·å–æ‰å¹³åŒ–æ·±åº¦
                const depth = parseInt(document.getElementById('flatten-depth').value);

                // è·å–æ–‡ä»¶åˆ—è¡¨
                let files = [];
                if (depth === 0) {
                    // ä¸æ‰å¹³åŒ–ï¼Œåªæ˜¾ç¤ºå½“å‰ç›®å½•çš„ç›´æ¥å­é¡¹
                    files = currentFolder.children || [];
                } else {
                    // ä½¿ç”¨ flatten å‡½æ•°æ‰å¹³åŒ–ç›®å½•ç»“æ„
                    files = flattenDirectory(currentFolder, depth);
                }

                // æ›´æ–°å½“å‰æ–‡ä»¶åˆ—è¡¨
                currentFiles = files;

                // æ¸²æŸ“æ–‡ä»¶åˆ—è¡¨
                renderFileList(files);

                // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                document.getElementById('total-count').textContent = files.length;
                document.getElementById('filtered-count').textContent = files.length;
            }, 500); // æ¨¡æ‹ŸåŠ è½½å»¶è¿Ÿ
        }

        // æ ¹æ®è·¯å¾„è·å–ç›®å½•
        function getDirectoryByPath(path) {
            if (path === '/') {
                return fileSystemData;
            }

            const pathParts = path.split('/').filter(part => part);
            let currentDir = fileSystemData;

            for (const part of pathParts) {
                if (!currentDir.children) {
                    return null;
                }

                const found = currentDir.children.find(item => item.name === part);
                if (!found || found.type !== 'folder') {
                    return null;
                }

                currentDir = found;
            }

            return currentDir;
        }

        // æ‰å¹³åŒ–ç›®å½•ç»“æ„
        function flattenDirectory(directory, depth) {
            if (!directory.children) {
                return [];
            }

            if (depth === 0) {
                return directory.children;
            }

            // é€’å½’æ”¶é›†å­ç›®å½•ä¸­çš„æ–‡ä»¶
            const collectFiles = (dir) => {
                if (!dir.children) {
                    return [];
                }

                return dir.children.map(item => {
                    if (item.type === 'folder') {
                        return [item, ...collectFiles(item)];
                    }
                    return item;
                });
            };

            // æ”¶é›†æ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹
            const allFiles = collectFiles(directory);

            // ä½¿ç”¨ flatten å‡½æ•°æ‰å¹³åŒ–æ•°ç»„
            return depth === -1
                ? flatten(allFiles, Infinity) // å®Œå…¨æ‰å¹³åŒ–
                : flatten(allFiles, depth);   // æŒ‰æŒ‡å®šæ·±åº¦æ‰å¹³åŒ–
        }

        // æ¸²æŸ“æ–‡ä»¶åˆ—è¡¨
        function renderFileList(files) {
            const fileContainer = document.getElementById('file-container');

            if (files.length === 0) {
                fileContainer.innerHTML = '<div class="empty-message">æ­¤ç›®å½•ä¸ºç©º</div>';
                return;
            }

            const fileList = document.createElement('ul');
            fileList.className = 'file-list';

            files.forEach(file => {
                const fileItem = document.createElement('li');
                fileItem.className = 'file-item';

                const fileIcon = document.createElement('div');
                fileIcon.className = `file-icon ${file.type}`;
                fileIcon.innerHTML = file.type === 'folder' ? 'ğŸ“' : 'ğŸ“„';

                const fileName = document.createElement('div');
                fileName.className = 'file-name';
                fileName.textContent = file.name;

                const filePath = document.createElement('div');
                filePath.className = 'file-path';
                filePath.textContent = file.path;

                const fileSize = document.createElement('div');
                fileSize.className = 'file-size';
                if (file.size) {
                    fileSize.textContent = file.size;
                }

                fileItem.appendChild(fileIcon);
                fileItem.appendChild(fileName);
                fileItem.appendChild(filePath);
                fileItem.appendChild(fileSize);

                // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                if (file.type === 'folder') {
                    fileItem.style.cursor = 'pointer';
                    fileItem.addEventListener('click', () => {
                        loadDirectory(file.path);
                    });
                }

                fileList.appendChild(fileItem);
            });

            fileContainer.innerHTML = '';
            fileContainer.appendChild(fileList);
        }

        // æ›´æ–°é¢åŒ…å±‘å¯¼èˆª
        function updateBreadcrumb(path) {
            const breadcrumb = document.getElementById('breadcrumb');
            breadcrumb.innerHTML = '';

            const pathParts = path.split('/').filter(part => part);
            let currentPath = '/';

            // æ·»åŠ æ ¹ç›®å½•
            const rootItem = document.createElement('li');
            rootItem.className = 'breadcrumb-item';
            const rootLink = document.createElement('a');
            rootLink.href = '#';
            rootLink.textContent = 'æ ¹ç›®å½•';
            rootLink.addEventListener('click', (e) => {
                e.preventDefault();
                loadDirectory('/');
            });
            rootItem.appendChild(rootLink);
            breadcrumb.appendChild(rootItem);

            // æ·»åŠ è·¯å¾„éƒ¨åˆ†
            pathParts.forEach((part, index) => {
                currentPath += part + '/';
                const item = document.createElement('li');
                item.className = 'breadcrumb-item';

                if (index === pathParts.length - 1) {
                    // æœ€åä¸€é¡¹ï¼ˆå½“å‰ç›®å½•ï¼‰
                    item.classList.add('active');
                    item.textContent = part;
                } else {
                    // å¯ç‚¹å‡»çš„è·¯å¾„
                    const link = document.createElement('a');
                    link.href = '#';
                    link.textContent = part;
                    const pathToNavigate = currentPath;
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        loadDirectory(pathToNavigate);
                    });
                    item.appendChild(link);
                }

                breadcrumb.appendChild(item);
            });
        }

        // æœç´¢æ–‡ä»¶
        function searchFiles(term) {
            const fileContainer = document.getElementById('file-container');
            fileContainer.innerHTML = '<div class="loading"><div class="spinner"></div><div>æœç´¢ä¸­...</div></div>';

            // æ¨¡æ‹Ÿæœç´¢å»¶è¿Ÿ
            setTimeout(() => {
                // é€’å½’æœç´¢æ–‡ä»¶ç³»ç»Ÿ
                const searchInDirectory = (directory) => {
                    let results = [];

                    if (!directory.children) {
                        return results;
                    }

                    directory.children.forEach(item => {
                        // æ£€æŸ¥åç§°æ˜¯å¦åŒ¹é…
                        if (item.name.toLowerCase().includes(term)) {
                            results.push(item);
                        }

                        // å¦‚æœæ˜¯æ–‡ä»¶å¤¹ï¼Œé€’å½’æœç´¢
                        if (item.type === 'folder') {
                            results = results.concat(searchInDirectory(item));
                        }
                    });

                    return results;
                };

                // æ‰§è¡Œæœç´¢
                const searchResults = searchInDirectory(fileSystemData);

                // æ›´æ–°å½“å‰æ–‡ä»¶åˆ—è¡¨
                currentFiles = searchResults;

                // æ¸²æŸ“æœç´¢ç»“æœ
                renderFileList(searchResults);

                // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                document.getElementById('total-count').textContent = fileSystemData.children.length;
                document.getElementById('filtered-count').textContent = searchResults.length;

                // æ›´æ–°é¢åŒ…å±‘å¯¼èˆªï¼Œæ·»åŠ æœç´¢æŒ‡ç¤º
                const breadcrumb = document.getElementById('breadcrumb');
                breadcrumb.innerHTML = '';

                const rootItem = document.createElement('li');
                rootItem.className = 'breadcrumb-item';
                const rootLink = document.createElement('a');
                rootLink.href = '#';
                rootLink.textContent = 'æ ¹ç›®å½•';
                rootLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    loadDirectory('/');
                });
                rootItem.appendChild(rootLink);
                breadcrumb.appendChild(rootItem);

                const searchItem = document.createElement('li');
                searchItem.className = 'breadcrumb-item active';
                searchItem.textContent = `æœç´¢: "${term}"`;
                breadcrumb.appendChild(searchItem);
            }, 800); // æ¨¡æ‹Ÿæœç´¢å»¶è¿Ÿ
        }
    </script>
</body>

</html>