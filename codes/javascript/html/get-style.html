<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSSæ ·å¼åˆ†æå™¨</title>
    <link rel="stylesheet" href="../../demo/plugins/modal/style.css">
    <link rel="stylesheet" href="../../demo/plugins/select/style.css">
    <link rel="stylesheet" href="../../demo/plugins/input-number/style.css">
    <link rel="stylesheet" href="../../demo/plugins/notification/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }

        .demo-area {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .demo-area:hover {
            border-color: #4facfe;
            box-shadow: 0 10px 25px rgba(79, 172, 254, 0.1);
        }

        .demo-area h3 {
            color: #495057;
            margin-bottom: 20px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .demo-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #dee2e6;
            min-height: 400px;
            position: relative;
        }

        .demo-element {
            padding: 20px;
            margin: 10px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
            text-align: center;
        }

        .demo-element:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .demo-element.selected {
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.2);
        }

        .demo-element.primary {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .demo-element.secondary {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .demo-element.warning {
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
            color: #212529;
        }

        .demo-element.danger {
            background: linear-gradient(135deg, #dc3545 0%, #e74c3c 100%);
            color: white;
        }

        .demo-element.info {
            background: linear-gradient(135deg, #17a2b8 0%, #6f42c1 100%);
            color: white;
        }

        .demo-element.light {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #495057;
            border: 1px solid #dee2e6;
        }

        .demo-element.dark {
            background: linear-gradient(135deg, #343a40 0%, #495057 100%);
            color: white;
        }

        .analysis-panel {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #e9ecef;
        }

        .analysis-panel h3 {
            color: #495057;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }

        .current-element {
            background: white;
            border: 2px solid #4facfe;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            min-height: 60px;
        }

        .style-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .style-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid #dee2e6;
            transition: transform 0.2s ease;
            cursor: pointer;
        }

        .style-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .style-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #4facfe;
            display: block;
            margin-bottom: 5px;
            word-break: break-all;
        }

        .style-label {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 5px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-warning:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #495057;
            font-weight: 500;
        }

        .style-details {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            max-height: 300px;
            overflow-y: auto;
        }

        .style-property {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f1f3f4;
        }

        .style-property:last-child {
            border-bottom: none;
        }

        .property-name {
            font-weight: 500;
            color: #495057;
            font-family: 'Courier New', monospace;
        }

        .property-value {
            color: #6c757d;
            font-family: 'Courier New', monospace;
            max-width: 200px;
            text-align: right;
            word-break: break-all;
        }

        .code-generator {
            background: #2d3748;
            color: #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
            overflow-x: auto;
        }

        .code-generator h4 {
            color: #4facfe;
            margin-bottom: 15px;
        }

        .code-generator pre {
            background: transparent !important;
            margin: 0;
            padding: 0;
            border: none;
            border-radius: 0;
        }

        .code-generator code {
            background: transparent !important;
            padding: 0;
            border: none;
            border-radius: 0;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .code-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .code-actions .btn {
            font-size: 0.8rem;
            padding: 8px 15px;
        }

        .comparison-section {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px solid #e9ecef;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }

        .comparison-item {
            background: white;
            border-radius: 10px;
            padding: 15px;
            border: 1px solid #dee2e6;
        }

        .comparison-title {
            font-weight: 500;
            color: #495057;
            margin-bottom: 10px;
            text-align: center;
        }

        .history-section {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px solid #e9ecef;
        }

        .history-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #4facfe;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .history-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .history-text {
            font-weight: 500;
            color: #495057;
            margin-bottom: 5px;
        }

        .history-meta {
            font-size: 0.8rem;
            color: #6c757d;
        }

        .empty-state {
            text-align: center;
            color: #6c757d;
            font-style: italic;
            padding: 40px 20px;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4facfe;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
                padding: 20px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .style-grid {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: column;
            }

            .comparison-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>CSSæ ·å¼åˆ†æå™¨</h1>
            <p>å®æ—¶åˆ†æå…ƒç´ æ ·å¼ï¼Œç”ŸæˆCSSä»£ç ï¼Œå¯¹æ¯”æ ·å¼å·®å¼‚</p>
        </div>

        <div class="main-content">
            <div class="demo-area">
                <h3>ğŸ¯ æ¼”ç¤ºå…ƒç´ </h3>
                <div class="demo-container" id="demoContainer">
                    <div class="demo-element primary" onclick="selectElement(this)">
                        ğŸ¨ ä¸»è¦å…ƒç´ 
                    </div>
                    <div class="demo-element secondary" onclick="selectElement(this)">
                        ğŸŒŸ æ¬¡è¦å…ƒç´ 
                    </div>
                    <div class="demo-element warning" onclick="selectElement(this)">
                        âš ï¸ è­¦å‘Šå…ƒç´ 
                    </div>
                    <div class="demo-element danger" onclick="selectElement(this)">
                        ğŸš¨ å±é™©å…ƒç´ 
                    </div>
                    <div class="demo-element info" onclick="selectElement(this)">
                        â„¹ï¸ ä¿¡æ¯å…ƒç´ 
                    </div>
                    <div class="demo-element light" onclick="selectElement(this)">
                        ğŸ’¡ æµ…è‰²å…ƒç´ 
                    </div>
                    <div class="demo-element dark" onclick="selectElement(this)">
                        ğŸŒ™ æ·±è‰²å…ƒç´ 
                    </div>
                </div>
            </div>

            <div class="analysis-panel">
                <h3>ğŸ” æ ·å¼åˆ†æ</h3>
                
                <div class="current-element" id="currentElement">
                    <em>è¯·é€‰æ‹©ä¸€ä¸ªå…ƒç´ è¿›è¡Œåˆ†æ...</em>
                </div>

                <div class="style-grid" id="styleGrid" style="display: none;">
                    <div class="style-card" onclick="showStyleDetails('width')">
                        <span class="style-value" id="widthValue">-</span>
                        <span class="style-label">å®½åº¦</span>
                    </div>
                    <div class="style-card" onclick="showStyleDetails('height')">
                        <span class="style-value" id="heightValue">-</span>
                        <span class="style-label">é«˜åº¦</span>
                    </div>
                    <div class="style-card" onclick="showStyleDetails('background-color')">
                        <span class="style-value" id="bgColorValue">-</span>
                        <span class="style-label">èƒŒæ™¯è‰²</span>
                    </div>
                    <div class="style-card" onclick="showStyleDetails('color')">
                        <span class="style-value" id="colorValue">-</span>
                        <span class="style-label">æ–‡å­—é¢œè‰²</span>
                    </div>
                    <div class="style-card" onclick="showStyleDetails('font-size')">
                        <span class="style-value" id="fontSizeValue">-</span>
                        <span class="style-label">å­—ä½“å¤§å°</span>
                    </div>
                    <div class="style-card" onclick="showStyleDetails('padding')">
                        <span class="style-value" id="paddingValue">-</span>
                        <span class="style-label">å†…è¾¹è·</span>
                    </div>
                    <div class="style-card" onclick="showStyleDetails('margin')">
                        <span class="style-value" id="marginValue">-</span>
                        <span class="style-label">å¤–è¾¹è·</span>
                    </div>
                    <div class="style-card" onclick="showStyleDetails('border-radius')">
                        <span class="style-value" id="borderRadiusValue">-</span>
                        <span class="style-label">åœ†è§’</span>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="analyzeAllStyles()">
                        ğŸ“Š å®Œæ•´åˆ†æ
                    </button>
                    <button class="btn btn-success" onclick="generateCSS()">
                        ğŸ’» ç”ŸæˆCSS
                    </button>
                    <button class="btn btn-warning" onclick="compareStyles()">
                        ğŸ”„ æ ·å¼å¯¹æ¯”
                    </button>
                    <button class="btn btn-secondary" onclick="saveToHistory()">
                        ğŸ’¾ ä¿å­˜åˆ†æ
                    </button>
                    <button class="btn btn-danger" onclick="clearSelection()">
                        ğŸ§¹ æ¸…é™¤é€‰æ‹©
                    </button>
                </div>

                <div class="form-group">
                    <label for="styleProperty">æ ·å¼å±æ€§ï¼š</label>
                    <div id="styleProperty"></div>
                </div>

                <div class="form-group">
                    <label for="analysisDepth">åˆ†ææ·±åº¦ï¼š</label>
                    <div id="analysisDepth"></div>
                </div>

                <div class="style-details" id="styleDetails" style="display: none;">
                    <h4>ğŸ“‹ è¯¦ç»†æ ·å¼ä¿¡æ¯</h4>
                    <div id="styleDetailsContent"></div>
                </div>

                <div class="code-generator" id="codeGenerator" style="display: none;">
                    <h4>ğŸ’» ç”Ÿæˆçš„CSSä»£ç </h4>
                    <pre><code class="language-css" id="generatedCode"></code></pre>
                    <div class="code-actions">
                        <button class="btn btn-primary" onclick="copyGeneratedCode()">
                            ğŸ“‹ å¤åˆ¶ä»£ç 
                        </button>
                        <button class="btn btn-success" onclick="downloadCSS()">
                            ğŸ’¾ ä¸‹è½½CSS
                        </button>
                        <button class="btn btn-secondary" onclick="formatCSS()">
                            ğŸ¨ æ ¼å¼åŒ–
                        </button>
                    </div>
                </div>

                <div class="comparison-section" id="comparisonSection" style="display: none;">
                    <h4>ğŸ”„ æ ·å¼å¯¹æ¯”</h4>
                    <div class="comparison-grid" id="comparisonGrid"></div>
                </div>

                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>æ­£åœ¨åˆ†æä¸­...</p>
                </div>

                <div class="history-section">
                    <h4>ğŸ“š åˆ†æå†å²</h4>
                    <div id="historyList">
                        <div class="empty-state">æš‚æ— åˆ†æå†å²</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ’ä»¶è„šæœ¬ -->
    <script src="../../demo/plugins/modal/index.js"></script>
    <script src="../../demo/plugins/select/index.js"></script>
    <script src="../../demo/plugins/input-number/index.js"></script>
    <script src="../../demo/plugins/notification/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-css.min.js"></script>

    <script>
        // è·å–æ ·å¼çš„æ ¸å¿ƒæ–¹æ³•
        const getStyle = (el, ruleName) => getComputedStyle(el)[ruleName];

        // å…¨å±€å˜é‡
        let currentElement = null;
        let analysisHistory = JSON.parse(localStorage.getItem('styleAnalysisHistory') || '[]');
        let previousElement = null;
        let stylePropertySelect = null;
        let analysisDepthInput = null;
        let notificationPlugin = null;

        // åˆå§‹åŒ–æ’ä»¶
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–é€‰æ‹©æ’ä»¶
            stylePropertySelect = new Select({
                container: '#styleProperty',
                placeholder: 'é€‰æ‹©æ ·å¼å±æ€§',
                onChange: function(value) {
                    console.log('æ ·å¼å±æ€§æ”¹å˜:', value);
                }
            });
            
            // è®¾ç½®é€‰æ‹©æ’ä»¶é€‰é¡¹
            stylePropertySelect.setOptions([
                { value: 'layout', label: 'å¸ƒå±€å±æ€§' },
                { value: 'typography', label: 'å­—ä½“å±æ€§' },
                { value: 'background', label: 'èƒŒæ™¯å±æ€§' },
                { value: 'border', label: 'è¾¹æ¡†å±æ€§' },
                { value: 'spacing', label: 'é—´è·å±æ€§' },
                { value: 'effects', label: 'æ•ˆæœå±æ€§' }
            ]);

            // åˆå§‹åŒ–æ•°å­—è¾“å…¥æ’ä»¶
            analysisDepthInput = new InputNumber({
                container: '#analysisDepth',
                min: 1,
                max: 10,
                step: 1,
                value: 3,
                onChange: function(value) {
                    console.log('åˆ†ææ·±åº¦æ”¹å˜:', value);
                }
            });

            // åˆå§‹åŒ–æ¨¡æ€æ¡†æ’ä»¶
            window.modalPlugin = new Modal({
                closeOnOverlayClick: true
            });

            // åˆå§‹åŒ–é€šçŸ¥æ’ä»¶
            notificationPlugin = new Notification({
                position: 'top-right',
                duration: 3000,
                maxCount: 5
            });

            // åŠ è½½å†å²è®°å½•
            loadHistory();
        });

        // é€‰æ‹©å…ƒç´ 
        function selectElement(element) {
            // æ¸…é™¤ä¹‹å‰çš„é€‰æ‹©
            clearElementSelection();
            
            currentElement = element;
            element.classList.add('selected');
            
            updateCurrentElementDisplay(element);
            analyzeBasicStyles(element);
        }

        // æ¸…é™¤å…ƒç´ é€‰æ‹©
        function clearElementSelection() {
            const selectedElements = document.querySelectorAll('.demo-element.selected');
            selectedElements.forEach(el => {
                el.classList.remove('selected');
            });
        }

        // æ›´æ–°å½“å‰å…ƒç´ æ˜¾ç¤º
        function updateCurrentElementDisplay(element) {
            const display = document.getElementById('currentElement');
            const className = element.className.split(' ').find(cls => cls !== 'demo-element' && cls !== 'selected');
            
            display.innerHTML = `
                <strong>å½“å‰é€‰ä¸­ï¼š</strong>
                <span style="color: #4facfe; font-weight: bold;">${element.textContent.trim()}</span>
                <br>
                <small style="color: #6c757d;">ç±»å: ${className || 'æ— '} | æ ‡ç­¾: ${element.tagName.toLowerCase()}</small>
            `;
            display.style.borderColor = '#4facfe';
        }

        // åˆ†æåŸºç¡€æ ·å¼
        function analyzeBasicStyles(element) {
            const styleProperties = [
                'width', 'height', 'background-color', 'color', 
                'font-size', 'padding', 'margin', 'border-radius'
            ];

            styleProperties.forEach(prop => {
                const value = getStyle(element, prop);
                const elementId = prop.replace('-', '') + 'Value';
                const targetElement = document.getElementById(elementId);
                if (targetElement) {
                    targetElement.textContent = value;
                }
            });

            // æ˜¾ç¤ºæ ·å¼ç½‘æ ¼
            document.getElementById('styleGrid').style.display = 'grid';
        }

        // å®Œæ•´æ ·å¼åˆ†æ
        function analyzeAllStyles() {
            if (!currentElement) {
                showNotification('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªå…ƒç´ ', 'error');
                return;
            }

            showLoading(true);
            
            // æ¨¡æ‹Ÿåˆ†æè¿‡ç¨‹
            setTimeout(() => {
                const allStyles = getAllComputedStyles(currentElement);
                showStyleDetailsModal(allStyles);
                showLoading(false);
            }, 1500);
        }

        // è·å–æ‰€æœ‰è®¡ç®—æ ·å¼
        function getAllComputedStyles(element) {
            const computedStyle = getComputedStyle(element);
            const styles = {};
            
            // è·å–æ‰€æœ‰CSSå±æ€§
            for (let i = 0; i < computedStyle.length; i++) {
                const property = computedStyle[i];
                const value = computedStyle.getPropertyValue(property);
                if (value && value !== 'normal' && value !== 'none' && value !== '0px') {
                    styles[property] = value;
                }
            }
            
            return styles;
        }

        // æ˜¾ç¤ºæ ·å¼è¯¦æƒ…æ¨¡æ€æ¡†
        function showStyleDetailsModal(styles) {
            const styleGroups = {
                layout: ['width', 'height', 'display', 'position', 'top', 'left', 'right', 'bottom'],
                typography: ['font-family', 'font-size', 'font-weight', 'line-height', 'text-align', 'color'],
                background: ['background-color', 'background-image', 'background-size', 'background-position'],
                border: ['border', 'border-radius', 'border-color', 'border-width', 'border-style'],
                spacing: ['margin', 'padding', 'gap'],
                effects: ['box-shadow', 'opacity', 'transform', 'transition']
            };

            let modalContent = '<div style="max-height: 400px; overflow-y: auto;">';
            modalContent += '<h3>å®Œæ•´æ ·å¼åˆ†æç»“æœ</h3>';
            
            Object.keys(styleGroups).forEach(group => {
                modalContent += `<h4 style="color: #4facfe; margin: 15px 0 10px 0;">${getGroupName(group)}</h4>`;
                modalContent += '<div style="background: #f8f9fa; padding: 10px; border-radius: 5px; margin-bottom: 10px;">';
                
                styleGroups[group].forEach(prop => {
                    if (styles[prop]) {
                        modalContent += `
                            <div style="display: flex; justify-content: space-between; margin: 5px 0;">
                                <span style="font-family: monospace; color: #495057;">${prop}:</span>
                                <span style="font-family: monospace; color: #6c757d;">${styles[prop]}</span>
                            </div>
                        `;
                    }
                });
                
                modalContent += '</div>';
            });
            
            modalContent += '</div>';

            window.modalPlugin.show({
                title: 'æ ·å¼åˆ†æç»“æœ',
                content: modalContent
            });
        }

        // è·å–ç»„å
        function getGroupName(group) {
            const names = {
                layout: 'å¸ƒå±€å±æ€§',
                typography: 'å­—ä½“å±æ€§',
                background: 'èƒŒæ™¯å±æ€§',
                border: 'è¾¹æ¡†å±æ€§',
                spacing: 'é—´è·å±æ€§',
                effects: 'æ•ˆæœå±æ€§'
            };
            return names[group] || group;
        }

        // ç”ŸæˆCSSä»£ç 
        function generateCSS() {
            if (!currentElement) {
                showNotification('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªå…ƒç´ ', 'error');
                return;
            }

            const styles = getAllComputedStyles(currentElement);
            const className = currentElement.className.split(' ').find(cls => cls !== 'demo-element' && cls !== 'selected');
            
            let cssCode = `.${className || 'element'} {\n`;
            
            Object.keys(styles).forEach(prop => {
                cssCode += `  ${prop}: ${styles[prop]};\n`;
            });
            
            cssCode += '}';

            const codeGenerator = document.getElementById('codeGenerator');
            const generatedCode = document.getElementById('generatedCode');
            
            // è®¾ç½®ä»£ç å†…å®¹å¹¶åº”ç”¨è¯­æ³•é«˜äº®
            generatedCode.textContent = cssCode;
            Prism.highlightElement(generatedCode);
            codeGenerator.style.display = 'block';
            
            showNotification('CSSä»£ç å·²ç”Ÿæˆ');
        }

        // æ ·å¼å¯¹æ¯”
        function compareStyles() {
            if (!currentElement) {
                showNotification('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªå…ƒç´ ', 'error');
                return;
            }

            if (!previousElement) {
                previousElement = currentElement;
                showNotification('å·²ä¿å­˜å½“å‰å…ƒç´ ï¼Œè¯·é€‰æ‹©å¦ä¸€ä¸ªå…ƒç´ è¿›è¡Œå¯¹æ¯”', 'info');
                return;
            }

            const currentStyles = getAllComputedStyles(currentElement);
            const previousStyles = getAllComputedStyles(previousElement);
            
            const comparisonSection = document.getElementById('comparisonSection');
            const comparisonGrid = document.getElementById('comparisonGrid');
            
            comparisonGrid.innerHTML = `
                <div class="comparison-item">
                    <div class="comparison-title">${previousElement.textContent.trim()}</div>
                    <div style="font-size: 0.9rem; color: #6c757d;">
                        ${Object.keys(previousStyles).length} ä¸ªæ ·å¼å±æ€§
                    </div>
                </div>
                <div class="comparison-item">
                    <div class="comparison-title">${currentElement.textContent.trim()}</div>
                    <div style="font-size: 0.9rem; color: #6c757d;">
                        ${Object.keys(currentStyles).length} ä¸ªæ ·å¼å±æ€§
                    </div>
                </div>
            `;
            
            comparisonSection.style.display = 'block';
            showNotification('æ ·å¼å¯¹æ¯”å®Œæˆ');
            
            previousElement = null;
        }

        // ä¿å­˜åˆ°å†å²
        function saveToHistory() {
            if (!currentElement) {
                showNotification('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªå…ƒç´ ', 'error');
                return;
            }

            const styles = getAllComputedStyles(currentElement);
            const historyItem = {
                id: Date.now(),
                elementText: currentElement.textContent.trim(),
                elementClass: currentElement.className,
                styles: styles,
                timestamp: new Date().toLocaleString(),
                styleCount: Object.keys(styles).length
            };

            analysisHistory.unshift(historyItem);
            
            // åªä¿ç•™æœ€è¿‘20æ¡è®°å½•
            if (analysisHistory.length > 20) {
                analysisHistory = analysisHistory.slice(0, 20);
            }

            localStorage.setItem('styleAnalysisHistory', JSON.stringify(analysisHistory));
            loadHistory();
            showNotification('å·²ä¿å­˜åˆ°å†å²è®°å½•');
        }

        // æ¸…é™¤é€‰æ‹©
        function clearSelection() {
            clearElementSelection();
            currentElement = null;
            previousElement = null;
            
            document.getElementById('currentElement').innerHTML = '<em>è¯·é€‰æ‹©ä¸€ä¸ªå…ƒç´ è¿›è¡Œåˆ†æ...</em>';
            document.getElementById('currentElement').style.borderColor = '#4facfe';
            document.getElementById('styleGrid').style.display = 'none';
            document.getElementById('styleDetails').style.display = 'none';
            document.getElementById('codeGenerator').style.display = 'none';
            document.getElementById('comparisonSection').style.display = 'none';
            
            showNotification('å·²æ¸…é™¤é€‰æ‹©');
        }

        // æ˜¾ç¤ºæ ·å¼è¯¦æƒ…
        function showStyleDetails(property) {
            if (!currentElement) {
                showNotification('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªå…ƒç´ ', 'error');
                return;
            }

            const value = getStyle(currentElement, property);
            const styleDetails = document.getElementById('styleDetails');
            const styleDetailsContent = document.getElementById('styleDetailsContent');
            
            styleDetailsContent.innerHTML = `
                <div class="style-property">
                    <span class="property-name">${property}:</span>
                    <span class="property-value">${value}</span>
                </div>
                <div style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                    <strong>è¯´æ˜ï¼š</strong>${getPropertyDescription(property)}
                </div>
            `;
            
            styleDetails.style.display = 'block';
        }

        // è·å–å±æ€§æè¿°
        function getPropertyDescription(property) {
            const descriptions = {
                'width': 'å…ƒç´ çš„å®½åº¦ï¼Œå¯ä»¥æ˜¯å›ºå®šå€¼ã€ç™¾åˆ†æ¯”æˆ–auto',
                'height': 'å…ƒç´ çš„é«˜åº¦ï¼Œå¯ä»¥æ˜¯å›ºå®šå€¼ã€ç™¾åˆ†æ¯”æˆ–auto',
                'background-color': 'å…ƒç´ çš„èƒŒæ™¯é¢œè‰²',
                'color': 'æ–‡å­—é¢œè‰²',
                'font-size': 'å­—ä½“å¤§å°',
                'padding': 'å†…è¾¹è·ï¼Œå…ƒç´ å†…å®¹ä¸è¾¹æ¡†ä¹‹é—´çš„è·ç¦»',
                'margin': 'å¤–è¾¹è·ï¼Œå…ƒç´ ä¸å…¶ä»–å…ƒç´ ä¹‹é—´çš„è·ç¦»',
                'border-radius': 'è¾¹æ¡†åœ†è§’åŠå¾„'
            };
            return descriptions[property] || 'è¯¥å±æ€§çš„è¯¦ç»†è¯´æ˜';
        }

        // åŠ è½½å†å²è®°å½•
        function loadHistory() {
            const historyList = document.getElementById('historyList');
            
            if (analysisHistory.length === 0) {
                historyList.innerHTML = '<div class="empty-state">æš‚æ— åˆ†æå†å²</div>';
                return;
            }

            historyList.innerHTML = analysisHistory.map(item => `
                <div class="history-item" onclick="loadHistoryItem('${item.id}')">
                    <div class="history-text">${item.elementText}</div>
                    <div class="history-meta">
                        <span>æ ·å¼æ•°é‡: ${item.styleCount}</span> | 
                        <span>ç±»å: ${item.elementClass}</span> | 
                        <span>æ—¶é—´: ${item.timestamp}</span>
                    </div>
                </div>
            `).join('');
        }

        // åŠ è½½å†å²é¡¹ç›®
        function loadHistoryItem(id) {
            const item = analysisHistory.find(h => h.id == id);
            if (item) {
                showNotification(`å†å²è®°å½•: ${item.elementText} - ${item.styleCount} ä¸ªæ ·å¼å±æ€§`);
            }
        }

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        // å¤åˆ¶ç”Ÿæˆçš„ä»£ç 
        function copyGeneratedCode() {
            const generatedCode = document.getElementById('generatedCode');
            const codeText = generatedCode.textContent;
            
            navigator.clipboard.writeText(codeText).then(() => {
                showNotification('ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            }).catch(() => {
                // é™çº§æ–¹æ¡ˆ
                const textArea = document.createElement('textarea');
                textArea.value = codeText;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showNotification('ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            });
        }

        // ä¸‹è½½CSSæ–‡ä»¶
        function downloadCSS() {
            const generatedCode = document.getElementById('generatedCode');
            const codeText = generatedCode.textContent;
            const className = currentElement ? 
                currentElement.className.split(' ').find(cls => cls !== 'demo-element' && cls !== 'selected') || 'element' : 
                'element';
            
            const blob = new Blob([codeText], { type: 'text/css' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${className}-styles.css`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('CSSæ–‡ä»¶å·²ä¸‹è½½');
        }

        // æ ¼å¼åŒ–CSSä»£ç 
        function formatCSS() {
            const generatedCode = document.getElementById('generatedCode');
            const codeText = generatedCode.textContent;
            
            // ç®€å•çš„CSSæ ¼å¼åŒ–
            let formattedCode = codeText
                .replace(/\s*{\s*/g, ' {\n  ')
                .replace(/\s*;\s*/g, ';\n  ')
                .replace(/\s*}\s*/g, '\n}\n')
                .replace(/\n\s*\n/g, '\n')
                .trim();
            
            generatedCode.textContent = formattedCode;
            Prism.highlightElement(generatedCode);
            
            showNotification('CSSä»£ç å·²æ ¼å¼åŒ–');
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type = 'success') {
            if (notificationPlugin) {
                notificationPlugin.show(message, type);
            } else {
                console.log(`[${type.toUpperCase()}] ${message}`);
            }
        }
    </script>
</body>
</html>