<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½äº¤äº’é€‚é…ç³»ç»Ÿ - onUserInputChange</title>
    <!-- å¼•å…¥æ’ä»¶æ ·å¼ -->
    <link rel="stylesheet" href="../../demo/plugins/modal/style.css">
    <link rel="stylesheet" href="../../demo/plugins/checkbox/style.css">
    <link rel="stylesheet" href="../../demo/plugins/notification/style.css">
    <link rel="stylesheet" href="../../demo/plugins/select/style.css">
    <link rel="stylesheet" href="../../demo/plugins/input-number/style.css">
    <link rel="stylesheet" href="../../demo/plugins/datetime-picker/style.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #1f2937;
            line-height: 1.6;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 800;
            text-shadow: 0 3px 8px rgba(15, 23, 42, 0.35);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.95;
        }

        .input-type-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            margin-top: 10px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .input-type-indicator.active {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .input-type-icon {
            font-size: 1.2rem;
        }

        .main-content {
            display: grid;
            grid-template-columns: 380px 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }

        .card {
            background: rgba(255, 255, 255, 0.97);
            border-radius: 20px;
            padding: 24px;
            box-shadow: 0 14px 32px rgba(15, 23, 42, 0.15);
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .card h2 {
            font-size: 1.4rem;
            margin-bottom: 18px;
            color: #1f2937;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .input-group {
            margin-bottom: 16px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
            font-size: 0.95rem;
        }

        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 16px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            /* é»˜è®¤é¼ æ ‡æ¨¡å¼æ ·å¼ */
            min-height: 40px;
            min-width: 100px;
        }

        /* è§¦æ‘¸æ¨¡å¼ä¸‹çš„æŒ‰é’®æ ·å¼ */
        body.touch-mode .btn {
            min-height: 48px;
            min-width: 120px;
            padding: 14px 24px;
            font-size: 1rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #22c55e, #15803d);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #fbbf24, #d97706);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #b91c1c);
            color: white;
        }

        .btn-info {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .btn:active {
            transform: scale(0.97);
        }

        /* è§¦æ‘¸æ¨¡å¼ä¸‹ç¦ç”¨hoveræ•ˆæœ */
        body.touch-mode .btn:hover {
            transform: none;
        }

        .btn-block {
            width: 100%;
            justify-content: center;
        }

        .demo-area {
            background: #f8fafc;
            border-radius: 16px;
            padding: 30px;
            min-height: 400px;
        }

        .demo-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 24px;
            /* é»˜è®¤é¼ æ ‡æ¨¡å¼é—´è· */
            gap: 12px;
        }

        /* è§¦æ‘¸æ¨¡å¼ä¸‹å¢åŠ é—´è· */
        body.touch-mode .demo-controls {
            gap: 16px;
        }

        .demo-item {
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            /* é»˜è®¤é¼ æ ‡æ¨¡å¼ */
            cursor: pointer;
        }

        body.touch-mode .demo-item {
            cursor: default;
        }

        .demo-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        body.touch-mode .demo-item:hover {
            transform: none;
        }

        .demo-item.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            transform: scale(1.05);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }

        .stat-card {
            background: white;
            border-radius: 14px;
            padding: 16px;
            text-align: center;
            box-shadow: 0 3px 12px rgba(15, 23, 42, 0.1);
        }

        .stat-number {
            font-size: 1.8rem;
            font-weight: 800;
            color: #667eea;
            font-family: 'Monaco', 'Menlo', monospace;
        }

        .stat-label {
            font-size: 0.85rem;
            color: #64748b;
            margin-top: 4px;
        }

        .history-list {
            max-height: 300px;
            overflow-y: auto;
            background: #f8fafc;
            border-radius: 12px;
            padding: 12px;
        }

        .history-item {
            background: white;
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 10px;
            border-left: 3px solid #667eea;
            transition: all 0.2s ease;
        }

        .history-item:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .history-time {
            font-size: 0.75rem;
            color: #64748b;
            margin-bottom: 4px;
        }

        .history-info {
            font-size: 0.85rem;
            color: #1f2937;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #64748b;
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .select-container,
        .input-number-container,
        .datetime-container {
            margin-bottom: 16px;
        }

        .checkbox-container {
            margin-top: 12px;
        }

        .adaptive-info {
            background: linear-gradient(135deg, #e0e7ff, #ddd6fe);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .adaptive-info h3 {
            color: #667eea;
            margin-bottom: 12px;
            font-size: 1.1rem;
        }

        .adaptive-info-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(102, 126, 234, 0.2);
        }

        .adaptive-info-item:last-child {
            border-bottom: none;
        }

        .adaptive-info-label {
            font-weight: 600;
            color: #374151;
        }

        .adaptive-info-value {
            color: #667eea;
            font-weight: 700;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 2rem;
            }
        }

        /* è§¦æ‘¸æ¨¡å¼ä¸‹çš„å…¨å±€è°ƒæ•´ */
        body.touch-mode .card {
            padding: 28px;
        }

        body.touch-mode .input-group {
            margin-bottom: 20px;
        }

        /* é¼ æ ‡æ¨¡å¼ä¸‹çš„ç²¾ç»†äº¤äº’ */
        body.mouse-mode .demo-item {
            cursor: pointer;
        }

        body.mouse-mode .btn {
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¯ æ™ºèƒ½äº¤äº’é€‚é…ç³»ç»Ÿ</h1>
            <p>åŸºäº onUserInputChange å‡½æ•°çš„æ™ºèƒ½UIé€‚é…å·¥å…·ï¼Œè‡ªåŠ¨æ£€æµ‹å¹¶é€‚é…é¼ æ ‡/è§¦æ‘¸è¾“å…¥æ–¹å¼</p>
            <div class="input-type-indicator" id="inputTypeIndicator">
                <span class="input-type-icon" id="inputTypeIcon">ğŸ–±ï¸</span>
                <span id="inputTypeText">é¼ æ ‡æ¨¡å¼</span>
            </div>
        </div>

        <div class="main-content">
            <!-- å·¦ä¾§æ§åˆ¶é¢æ¿ -->
            <div class="sidebar">
                <div class="card">
                    <h2>âš™ï¸ é€‚é…é…ç½®</h2>
                    <div class="input-group">
                        <label>é¢„è®¾é…ç½®æ–¹æ¡ˆ</label>
                        <div id="presetSelect" class="select-container"></div>
                    </div>
                    <div class="input-group">
                        <label>è§¦æ‘¸æ¨¡å¼æŒ‰é’®æœ€å°é«˜åº¦ (px)</label>
                        <div id="touchButtonHeight" class="input-number-container"></div>
                    </div>
                    <div class="input-group">
                        <label>è§¦æ‘¸æ¨¡å¼æŒ‰é’®æœ€å°å®½åº¦ (px)</label>
                        <div id="touchButtonWidth" class="input-number-container"></div>
                    </div>
                    <div class="input-group">
                        <label>è§¦æ‘¸æ¨¡å¼é—´è· (px)</label>
                        <div id="touchSpacing" class="input-number-container"></div>
                    </div>
                    <div id="checkboxGroup" class="checkbox-container"></div>
                </div>

                <div class="card">
                    <h2>ğŸ“Š ç»Ÿè®¡ä¿¡æ¯</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="mouseCount">0</div>
                            <div class="stat-label">é¼ æ ‡åˆ‡æ¢æ¬¡æ•°</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="touchCount">0</div>
                            <div class="stat-label">è§¦æ‘¸åˆ‡æ¢æ¬¡æ•°</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="totalSwitches">0</div>
                            <div class="stat-label">æ€»åˆ‡æ¢æ¬¡æ•°</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="currentMode">-</div>
                            <div class="stat-label">å½“å‰æ¨¡å¼</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2>ğŸ”„ æ“ä½œæ§åˆ¶</h2>
                    <div class="button-group">
                        <button class="btn btn-primary btn-block" onclick="window.adaptiveSystem?.testInput()">
                            ğŸ§ª æµ‹è¯•è¾“å…¥åˆ‡æ¢
                        </button>
                        <button class="btn btn-success btn-sm" onclick="window.adaptiveSystem?.exportStats()">
                            ğŸ’¾ å¯¼å‡ºç»Ÿè®¡
                        </button>
                        <button class="btn btn-warning btn-sm" onclick="window.adaptiveSystem?.resetStats()">
                            ğŸ”„ é‡ç½®ç»Ÿè®¡
                        </button>
                        <button class="btn btn-info btn-sm" onclick="window.adaptiveSystem?.showHistory()">
                            ğŸ“œ æŸ¥çœ‹å†å²
                        </button>
                    </div>
                </div>

                <div class="card">
                    <h2>ğŸ“œ åˆ‡æ¢å†å²</h2>
                    <div class="history-list" id="historyList">
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ“</div>
                            <p style="font-size: 0.9rem;">è¾“å…¥æ–¹å¼åˆ‡æ¢å†å²å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å³ä¾§æ¼”ç¤ºåŒºåŸŸ -->
            <div class="visualization">
                <div class="card">
                    <h2>ğŸ¨ å®æ—¶é€‚é…æ¼”ç¤º</h2>
                    <div class="adaptive-info">
                        <h3>å½“å‰é€‚é…çŠ¶æ€</h3>
                        <div class="adaptive-info-item">
                            <span class="adaptive-info-label">è¾“å…¥æ–¹å¼</span>
                            <span class="adaptive-info-value" id="currentInputType">é¼ æ ‡</span>
                        </div>
                        <div class="adaptive-info-item">
                            <span class="adaptive-info-label">æŒ‰é’®æœ€å°é«˜åº¦</span>
                            <span class="adaptive-info-value" id="currentButtonHeight">40px</span>
                        </div>
                        <div class="adaptive-info-item">
                            <span class="adaptive-info-label">æŒ‰é’®æœ€å°å®½åº¦</span>
                            <span class="adaptive-info-value" id="currentButtonWidth">100px</span>
                        </div>
                        <div class="adaptive-info-item">
                            <span class="adaptive-info-label">å…ƒç´ é—´è·</span>
                            <span class="adaptive-info-value" id="currentSpacing">12px</span>
                        </div>
                        <div class="adaptive-info-item">
                            <span class="adaptive-info-label">è‡ªåŠ¨é€‚é…</span>
                            <span class="adaptive-info-value" id="autoAdaptStatus">å·²å¯ç”¨</span>
                        </div>
                    </div>
                    <div class="demo-area">
                        <h3 style="margin-bottom: 20px; color: #1f2937;">äº¤äº’å…ƒç´ æ¼”ç¤º</h3>
                        <div class="demo-controls" id="demoControls">
                            <div class="demo-item" data-action="action1">
                                <div style="font-size: 1.5rem; margin-bottom: 8px;">ğŸ¯</div>
                                <div style="font-weight: 600;">æ“ä½œä¸€</div>
                            </div>
                            <div class="demo-item" data-action="action2">
                                <div style="font-size: 1.5rem; margin-bottom: 8px;">âš¡</div>
                                <div style="font-weight: 600;">æ“ä½œäºŒ</div>
                            </div>
                            <div class="demo-item" data-action="action3">
                                <div style="font-size: 1.5rem; margin-bottom: 8px;">ğŸš€</div>
                                <div style="font-weight: 600;">æ“ä½œä¸‰</div>
                            </div>
                            <div class="demo-item" data-action="action4">
                                <div style="font-size: 1.5rem; margin-bottom: 8px;">â­</div>
                                <div style="font-weight: 600;">æ“ä½œå››</div>
                            </div>
                            <div class="demo-item" data-action="action5">
                                <div style="font-size: 1.5rem; margin-bottom: 8px;">ğŸ’¡</div>
                                <div style="font-weight: 600;">æ“ä½œäº”</div>
                            </div>
                            <div class="demo-item" data-action="action6">
                                <div style="font-size: 1.5rem; margin-bottom: 8px;">ğŸ¨</div>
                                <div style="font-weight: 600;">æ“ä½œå…­</div>
                            </div>
                        </div>
                        <div class="button-group" style="margin-top: 24px;">
                            <button class="btn btn-primary" onclick="window.adaptiveSystem?.handleDemoAction('primary')">
                                ä¸»è¦æ“ä½œ
                            </button>
                            <button class="btn btn-success" onclick="window.adaptiveSystem?.handleDemoAction('success')">
                                æˆåŠŸæ“ä½œ
                            </button>
                            <button class="btn btn-warning" onclick="window.adaptiveSystem?.handleDemoAction('warning')">
                                è­¦å‘Šæ“ä½œ
                            </button>
                            <button class="btn btn-danger" onclick="window.adaptiveSystem?.handleDemoAction('danger')">
                                å±é™©æ“ä½œ
                            </button>
                        </div>
                        <div style="margin-top: 24px; padding: 16px; background: white; border-radius: 12px;">
                            <div style="font-weight: 600; margin-bottom: 8px; color: #1f2937;">æ“ä½œåé¦ˆ:</div>
                            <div id="demoFeedback" style="color: #64748b; font-size: 0.9rem;">ç­‰å¾…æ“ä½œ...</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2>ğŸ“– å‡½æ•°è¯´æ˜</h2>
                    <div style="background:#f8fafc;padding:20px;border-radius:14px;">
                        <h3 style="color:#667eea;margin-bottom:12px;">onUserInputChange å‡½æ•°ï¼ˆç”¨æˆ·è¾“å…¥æ›´æ”¹æ£€æµ‹ï¼‰</h3>
                        <div style="background:#1e293b;color:#e2e8f0;padding:16px;border-radius:10px;font-family:'Monaco','Menlo',monospace;font-size:0.85rem;overflow-x:auto;margin-bottom:16px;">
                            <span style="color:#c792ea;">const</span> <span style="color:#82aaff;">onUserInputChange</span> = <span style="color:#c792ea;">callback</span> => {<br>
                            &nbsp;&nbsp;<span style="color:#c792ea;">let</span> type = <span style="color:#c3e88d;">'mouse'</span>,<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;lastTime = <span style="color:#f78c6c;">0</span>;<br>
                            &nbsp;&nbsp;<span style="color:#c792ea;">const</span> <span style="color:#82aaff;">mouseMoveHandler</span> = () => {<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#c792ea;">const</span> now = <span style="color:#82aaff;">performance.now</span>();<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#c792ea;">if</span> (now - lastTime &lt; <span style="color:#f78c6c;">20</span>) {<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type = <span style="color:#c3e88d;">'mouse'</span>;<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#82aaff;">callback</span>(type);<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;document.<span style="color:#82aaff;">removeEventListener</span>(<span style="color:#c3e88d;">'mousemove'</span>, mouseMoveHandler);<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;}<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;lastTime = now;<br>
                            &nbsp;&nbsp;}<br>
                            &nbsp;&nbsp;document.<span style="color:#82aaff;">addEventListener</span>(<span style="color:#c3e88d;">'touchstart'</span>, () => {<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#c792ea;">if</span> (type === <span style="color:#c3e88d;">'touch'</span>) {<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#c792ea;">return</span>;<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;}<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;type = <span style="color:#c3e88d;">'touch'</span>;<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#82aaff;">callback</span>(type);<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;document.<span style="color:#82aaff;">addEventListener</span>(<span style="color:#c3e88d;">'mousemove'</span>, mouseMoveHandler);<br>
                            &nbsp;&nbsp;})<br>
                            }
                        </div>
                        <p style="color:#374151;line-height:1.8;margin-top:16px;">
                            <strong>onUserInputChange</strong> å‡½æ•°ç”¨äºæ£€æµ‹ç”¨æˆ·è¾“å…¥æ–¹å¼çš„å˜åŒ–ï¼ˆé¼ æ ‡æˆ–è§¦æ‘¸ï¼‰ã€‚
                            å½“ç”¨æˆ·ä»ä¸€ç§è¾“å…¥æ–¹å¼åˆ‡æ¢åˆ°å¦ä¸€ç§æ—¶ï¼Œä¼šè§¦å‘å›è°ƒå‡½æ•°ã€‚
                        </p>
                        <h3 style="color:#667eea;margin:20px 0 12px;">åº”ç”¨åœºæ™¯</h3>
                        <ul style="color:#374151;line-height:2;padding-left:20px;">
                            <li>æ ¹æ®è¾“å…¥æ–¹å¼è‡ªåŠ¨è°ƒæ•´UIå…ƒç´ å¤§å°å’Œé—´è·</li>
                            <li>ä¼˜åŒ–è§¦æ‘¸è®¾å¤‡çš„äº¤äº’ä½“éªŒ</li>
                            <li>åŠ¨æ€åˆ‡æ¢äº¤äº’æ¨¡å¼ï¼ˆé¼ æ ‡æ‚¬åœæ•ˆæœ vs è§¦æ‘¸ç‚¹å‡»ï¼‰</li>
                            <li>è®°å½•å’Œåˆ†æç”¨æˆ·è¾“å…¥ä¹ æƒ¯</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- å¼•å…¥æ’ä»¶è„šæœ¬ -->
    <script src="../../demo/plugins/modal/index.js"></script>
    <script src="../../demo/plugins/checkbox/index.js"></script>
    <script src="../../demo/plugins/notification/index.js"></script>
    <script src="../../demo/plugins/select/index.js"></script>
    <script src="../../demo/plugins/input-number/index.js"></script>
    <script src="../../demo/plugins/datetime-picker/index.js"></script>

    <script>
        // onUserInputChange å‡½æ•°ï¼šæ£€æµ‹ç”¨æˆ·è¾“å…¥æ–¹å¼å˜åŒ–
        const onUserInputChange = callback => {
            let type = 'mouse',
                lastTime = 0;
            const mouseMoveHandler = () => {
                const now = performance.now();
                if (now - lastTime < 20) {
                    type = 'mouse';
                    callback(type);
                    document.removeEventListener('mousemove', mouseMoveHandler);
                }
                lastTime = now;
            }
            document.addEventListener('touchstart', () => {
                if (type === 'touch') {
                    return;
                }
                type = 'touch';
                callback(type);
                document.addEventListener('mousemove', mouseMoveHandler);
            })
        }

        // æ™ºèƒ½äº¤äº’é€‚é…ç³»ç»Ÿ
        class AdaptiveSystem {
            constructor() {
                this.plugins = {};
                this.currentInputType = 'mouse';
                this.stats = {
                    mouseCount: 0,
                    touchCount: 0,
                    totalSwitches: 0
                };
                this.history = [];
                this.config = {
                    touchButtonHeight: 48,
                    touchButtonWidth: 120,
                    touchSpacing: 16,
                    autoAdapt: true,
                    showNotifications: true,
                    saveHistory: true
                };
                this.presets = {
                    'default': { touchButtonHeight: 48, touchButtonWidth: 120, touchSpacing: 16 },
                    'compact': { touchButtonHeight: 44, touchButtonWidth: 100, touchSpacing: 12 },
                    'comfortable': { touchButtonHeight: 52, touchButtonWidth: 140, touchSpacing: 20 },
                    'large': { touchButtonHeight: 56, touchButtonWidth: 160, touchSpacing: 24 }
                };
                
                this.init();
            }

            async init() {
                await this.loadPlugins();
                this.setupPlugins();
                this.setupEventListeners();
                this.loadStatsFromStorage();
                this.loadConfigFromStorage();
                this.updateUI();
                this.startInputDetection();
            }

            async loadPlugins() {
                try {
                    this.plugins.modal = new Modal();
                    this.plugins.notification = new Notification();
                } catch (error) {
                    console.warn('æ’ä»¶åŠ è½½å¤±è´¥:', error);
                }
            }

            setupPlugins() {
                // é¢„è®¾é…ç½®é€‰æ‹©å™¨
                try {
                    this.plugins.presetSelect = new Select({
                        container: '#presetSelect',
                        options: [
                            { value: 'default', label: 'é»˜è®¤é…ç½®' },
                            { value: 'compact', label: 'ç´§å‡‘æ¨¡å¼' },
                            { value: 'comfortable', label: 'èˆ’é€‚æ¨¡å¼' },
                            { value: 'large', label: 'å¤§å°ºå¯¸æ¨¡å¼' }
                        ],
                        placeholder: 'é€‰æ‹©é¢„è®¾é…ç½®',
                        onChange: (value) => {
                            if (value && this.presets[value]) {
                                const preset = this.presets[value];
                                this.config.touchButtonHeight = preset.touchButtonHeight;
                                this.config.touchButtonWidth = preset.touchButtonWidth;
                                this.config.touchSpacing = preset.touchSpacing;
                                
                                if (this.plugins.touchButtonHeight) {
                                    this.plugins.touchButtonHeight.setValue(preset.touchButtonHeight);
                                }
                                if (this.plugins.touchButtonWidth) {
                                    this.plugins.touchButtonWidth.setValue(preset.touchButtonWidth);
                                }
                                if (this.plugins.touchSpacing) {
                                    this.plugins.touchSpacing.setValue(preset.touchSpacing);
                                }
                                
                                this.applyAdaptation();
                                this.saveConfigToStorage();
                                this.showNotification(`å·²åˆ‡æ¢åˆ°${this.plugins.presetSelect.options.find(o => o.value === value)?.label}`, 'success');
                            }
                        }
                    });
                } catch (error) {
                    console.warn('é¢„è®¾é€‰æ‹©å™¨åŠ è½½å¤±è´¥:', error);
                }

                // è§¦æ‘¸æ¨¡å¼æŒ‰é’®é«˜åº¦
                try {
                    this.plugins.touchButtonHeight = new InputNumber({
                        container: '#touchButtonHeight',
                        min: 32,
                        max: 80,
                        step: 2,
                        value: this.config.touchButtonHeight,
                        onChange: (value) => {
                            this.config.touchButtonHeight = value;
                            this.applyAdaptation();
                            this.saveConfigToStorage();
                        }
                    });
                } catch (error) {
                    console.warn('æŒ‰é’®é«˜åº¦è¾“å…¥å™¨åŠ è½½å¤±è´¥:', error);
                }

                // è§¦æ‘¸æ¨¡å¼æŒ‰é’®å®½åº¦
                try {
                    this.plugins.touchButtonWidth = new InputNumber({
                        container: '#touchButtonWidth',
                        min: 80,
                        max: 200,
                        step: 4,
                        value: this.config.touchButtonWidth,
                        onChange: (value) => {
                            this.config.touchButtonWidth = value;
                            this.applyAdaptation();
                            this.saveConfigToStorage();
                        }
                    });
                } catch (error) {
                    console.warn('æŒ‰é’®å®½åº¦è¾“å…¥å™¨åŠ è½½å¤±è´¥:', error);
                }

                // è§¦æ‘¸æ¨¡å¼é—´è·
                try {
                    this.plugins.touchSpacing = new InputNumber({
                        container: '#touchSpacing',
                        min: 8,
                        max: 32,
                        step: 2,
                        value: this.config.touchSpacing,
                        onChange: (value) => {
                            this.config.touchSpacing = value;
                            this.applyAdaptation();
                            this.saveConfigToStorage();
                        }
                    });
                } catch (error) {
                    console.warn('é—´è·è¾“å…¥å™¨åŠ è½½å¤±è´¥:', error);
                }

                // å¤é€‰æ¡†ç»„
                try {
                    const container = document.getElementById('checkboxGroup');
                    if (container) {
                        const group = Checkbox.createCheckboxGroup({
                            items: [
                                { id: 'autoAdapt', label: 'å¯ç”¨è‡ªåŠ¨é€‚é…', checked: this.config.autoAdapt },
                                { id: 'showNotifications', label: 'æ˜¾ç¤ºé€šçŸ¥æé†’', checked: this.config.showNotifications },
                                { id: 'saveHistory', label: 'ä¿å­˜åˆ‡æ¢å†å²', checked: this.config.saveHistory }
                            ],
                            onChange: (states) => {
                                this.config.autoAdapt = states[0];
                                this.config.showNotifications = states[1];
                                this.config.saveHistory = states[2];
                                this.saveConfigToStorage();
                                if (!this.config.autoAdapt) {
                                    this.showNotification('è‡ªåŠ¨é€‚é…å·²ç¦ç”¨', 'warning');
                                }
                            }
                        });
                        container.appendChild(group.container);
                        this.plugins.checkboxGroup = group;
                    }
                } catch (error) {
                    console.warn('å¤é€‰æ¡†ç»„åŠ è½½å¤±è´¥:', error);
                }
            }

            setupEventListeners() {
                // æ¼”ç¤ºåŒºåŸŸäº¤äº’
                const demoItems = document.querySelectorAll('.demo-item');
                demoItems.forEach(item => {
                    item.addEventListener('click', () => {
                        const action = item.getAttribute('data-action');
                        this.handleDemoAction(action);
                        
                        // æ·»åŠ æ¿€æ´»æ•ˆæœ
                        demoItems.forEach(i => i.classList.remove('active'));
                        item.classList.add('active');
                        setTimeout(() => {
                            item.classList.remove('active');
                        }, 500);
                    });
                });
            }

            startInputDetection() {
                onUserInputChange((type) => {
                    if (this.currentInputType !== type) {
                        this.handleInputTypeChange(type);
                    }
                });
            }

            handleInputTypeChange(type) {
                const previousType = this.currentInputType;
                this.currentInputType = type;

                // æ›´æ–°ç»Ÿè®¡
                if (type === 'mouse') {
                    this.stats.mouseCount++;
                } else {
                    this.stats.touchCount++;
                }
                this.stats.totalSwitches++;

                // ä¿å­˜å†å²
                if (this.config.saveHistory) {
                    this.addToHistory(previousType, type);
                }

                // åº”ç”¨é€‚é…
                if (this.config.autoAdapt) {
                    this.applyAdaptation();
                }

                // æ˜¾ç¤ºé€šçŸ¥
                if (this.config.showNotifications) {
                    const typeText = type === 'mouse' ? 'é¼ æ ‡' : 'è§¦æ‘¸';
                    this.showNotification(`æ£€æµ‹åˆ°è¾“å…¥æ–¹å¼åˆ‡æ¢: ${typeText}æ¨¡å¼`, 'info');
                }

                // æ›´æ–°UI
                this.updateUI();
                this.saveStatsToStorage();
            }

            applyAdaptation() {
                const body = document.body;
                const isTouch = this.currentInputType === 'touch';

                // åˆ‡æ¢bodyç±»å
                body.classList.remove('mouse-mode', 'touch-mode');
                body.classList.add(isTouch ? 'touch-mode' : 'mouse-mode');

                // åº”ç”¨CSSå˜é‡
                if (isTouch) {
                    document.documentElement.style.setProperty('--touch-button-height', `${this.config.touchButtonHeight}px`);
                    document.documentElement.style.setProperty('--touch-button-width', `${this.config.touchButtonWidth}px`);
                    document.documentElement.style.setProperty('--touch-spacing', `${this.config.touchSpacing}px`);
                    
                    // åŠ¨æ€æ›´æ–°æŒ‰é’®æ ·å¼
                    const style = document.createElement('style');
                    style.id = 'adaptive-styles';
                    style.textContent = `
                        body.touch-mode .btn {
                            min-height: ${this.config.touchButtonHeight}px !important;
                            min-width: ${this.config.touchButtonWidth}px !important;
                            padding: ${Math.floor(this.config.touchButtonHeight * 0.3)}px ${Math.floor(this.config.touchButtonWidth * 0.2)}px !important;
                        }
                        body.touch-mode .demo-controls {
                            gap: ${this.config.touchSpacing}px !important;
                        }
                    `;
                    const existingStyle = document.getElementById('adaptive-styles');
                    if (existingStyle) {
                        existingStyle.remove();
                    }
                    document.head.appendChild(style);
                } else {
                    const existingStyle = document.getElementById('adaptive-styles');
                    if (existingStyle) {
                        existingStyle.remove();
                    }
                }

                this.updateAdaptiveInfo();
            }

            updateUI() {
                // æ›´æ–°è¾“å…¥æ–¹å¼æŒ‡ç¤ºå™¨
                const indicator = document.getElementById('inputTypeIndicator');
                const icon = document.getElementById('inputTypeIcon');
                const text = document.getElementById('inputTypeText');
                
                if (indicator && icon && text) {
                    if (this.currentInputType === 'touch') {
                        icon.textContent = 'ğŸ‘†';
                        text.textContent = 'è§¦æ‘¸æ¨¡å¼';
                    } else {
                        icon.textContent = 'ğŸ–±ï¸';
                        text.textContent = 'é¼ æ ‡æ¨¡å¼';
                    }
                    indicator.classList.add('active');
                    setTimeout(() => {
                        indicator.classList.remove('active');
                    }, 1000);
                }

                // æ›´æ–°ç»Ÿè®¡
                document.getElementById('mouseCount').textContent = this.stats.mouseCount;
                document.getElementById('touchCount').textContent = this.stats.touchCount;
                document.getElementById('totalSwitches').textContent = this.stats.totalSwitches;
                document.getElementById('currentMode').textContent = this.currentInputType === 'mouse' ? 'é¼ æ ‡' : 'è§¦æ‘¸';
            }

            updateAdaptiveInfo() {
                const isTouch = this.currentInputType === 'touch';
                document.getElementById('currentInputType').textContent = isTouch ? 'è§¦æ‘¸' : 'é¼ æ ‡';
                document.getElementById('currentButtonHeight').textContent = 
                    isTouch ? `${this.config.touchButtonHeight}px` : '40px';
                document.getElementById('currentButtonWidth').textContent = 
                    isTouch ? `${this.config.touchButtonWidth}px` : '100px';
                document.getElementById('currentSpacing').textContent = 
                    isTouch ? `${this.config.touchSpacing}px` : '12px';
                document.getElementById('autoAdaptStatus').textContent = 
                    this.config.autoAdapt ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨';
            }

            addToHistory(fromType, toType) {
                this.history.unshift({
                    time: new Date().toLocaleString('zh-CN'),
                    from: fromType,
                    to: toType,
                    timestamp: Date.now()
                });

                if (this.history.length > 50) {
                    this.history.pop();
                }

                this.renderHistory();
                this.saveHistoryToStorage();
            }

            renderHistory() {
                const container = document.getElementById('historyList');
                if (!container) return;

                if (this.history.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ“</div>
                            <p style="font-size: 0.9rem;">è¾“å…¥æ–¹å¼åˆ‡æ¢å†å²å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = this.history.slice(0, 20).map(item => `
                    <div class="history-item">
                        <div class="history-time">${item.time}</div>
                        <div class="history-info">
                            ${item.from === 'mouse' ? 'ğŸ–±ï¸ é¼ æ ‡' : 'ğŸ‘† è§¦æ‘¸'} â†’ 
                            ${item.to === 'mouse' ? 'ğŸ–±ï¸ é¼ æ ‡' : 'ğŸ‘† è§¦æ‘¸'}
                        </div>
                    </div>
                `).join('');
            }

            handleDemoAction(action) {
                const feedback = document.getElementById('demoFeedback');
                if (feedback) {
                    const actionNames = {
                        'action1': 'æ“ä½œä¸€',
                        'action2': 'æ“ä½œäºŒ',
                        'action3': 'æ“ä½œä¸‰',
                        'action4': 'æ“ä½œå››',
                        'action5': 'æ“ä½œäº”',
                        'action6': 'æ“ä½œå…­',
                        'primary': 'ä¸»è¦æ“ä½œ',
                        'success': 'æˆåŠŸæ“ä½œ',
                        'warning': 'è­¦å‘Šæ“ä½œ',
                        'danger': 'å±é™©æ“ä½œ'
                    };
                    const actionName = actionNames[action] || action;
                    const inputType = this.currentInputType === 'mouse' ? 'é¼ æ ‡' : 'è§¦æ‘¸';
                    feedback.textContent = `[${new Date().toLocaleTimeString()}] ä½¿ç”¨${inputType}æ–¹å¼æ‰§è¡Œäº†: ${actionName}`;
                }
            }

            testInput() {
                this.plugins.modal?.show({
                    title: 'ğŸ§ª æµ‹è¯•è¾“å…¥åˆ‡æ¢',
                    content: `
                        <div style="padding: 8px 0;">
                            <p style="margin-bottom: 12px;">è¯·å°è¯•ä»¥ä¸‹æ“ä½œæ¥æµ‹è¯•è¾“å…¥æ–¹å¼æ£€æµ‹ï¼š</p>
                            <ul style="padding-left: 20px; line-height: 2;">
                                <li>åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šè§¦æ‘¸å±å¹•</li>
                                <li>åœ¨æ¡Œé¢è®¾å¤‡ä¸Šç§»åŠ¨é¼ æ ‡</li>
                                <li>åœ¨æ”¯æŒè§¦æ‘¸çš„æ¡Œé¢è®¾å¤‡ä¸Šåˆ‡æ¢è¾“å…¥æ–¹å¼</li>
                            </ul>
                            <p style="margin-top: 12px; color: #64748b; font-size: 0.9rem;">
                                å½“å‰æ¨¡å¼: <strong>${this.currentInputType === 'mouse' ? 'é¼ æ ‡' : 'è§¦æ‘¸'}</strong>
                            </p>
                        </div>
                    `,
                    type: 'alert'
                });
            }

            exportStats() {
                const data = {
                    stats: this.stats,
                    config: this.config,
                    currentInputType: this.currentInputType,
                    exportTime: new Date().toISOString()
                };
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `adaptive-system-stats-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                this.showNotification('ç»Ÿè®¡æ•°æ®å·²å¯¼å‡º', 'success');
            }

            resetStats() {
                this.plugins.modal?.confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰ç»Ÿè®¡æ•°æ®å—ï¼Ÿ').then(confirmed => {
                    if (confirmed) {
                        this.stats = {
                            mouseCount: 0,
                            touchCount: 0,
                            totalSwitches: 0
                        };
                        this.updateUI();
                        this.saveStatsToStorage();
                        this.showNotification('ç»Ÿè®¡æ•°æ®å·²é‡ç½®', 'info');
                    }
                });
            }

            showHistory() {
                if (this.history.length === 0) {
                    this.showNotification('æš‚æ— åˆ‡æ¢å†å²', 'warning');
                    return;
                }

                const historyText = this.history.slice(0, 10).map((item, index) => 
                    `${index + 1}. ${item.time}: ${item.from} â†’ ${item.to}`
                ).join('<br>');

                this.plugins.modal?.show({
                    title: 'ğŸ“œ åˆ‡æ¢å†å²è®°å½•',
                    content: `
                        <div style="padding: 8px 0; max-height: 400px; overflow-y: auto;">
                            ${historyText}
                            ${this.history.length > 10 ? `<br><p style="color: #64748b; margin-top: 12px;">è¿˜æœ‰ ${this.history.length - 10} æ¡è®°å½•...</p>` : ''}
                        </div>
                    `,
                    type: 'alert'
                });
            }

            showNotification(message, type = 'info') {
                if (this.plugins.notification && this.config.showNotifications) {
                    this.plugins.notification.show(message, type);
                } else {
                    console.log(`${type.toUpperCase()}: ${message}`);
                }
            }

            saveStatsToStorage() {
                try {
                    localStorage.setItem('adaptiveSystem_stats', JSON.stringify(this.stats));
                } catch (error) {
                    console.warn('ä¿å­˜ç»Ÿè®¡æ•°æ®å¤±è´¥:', error);
                }
            }

            loadStatsFromStorage() {
                try {
                    const saved = localStorage.getItem('adaptiveSystem_stats');
                    if (saved) {
                        this.stats = { ...this.stats, ...JSON.parse(saved) };
                    }
                } catch (error) {
                    console.warn('åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥:', error);
                }
            }

            saveConfigToStorage() {
                try {
                    localStorage.setItem('adaptiveSystem_config', JSON.stringify(this.config));
                } catch (error) {
                    console.warn('ä¿å­˜é…ç½®å¤±è´¥:', error);
                }
            }

            loadConfigFromStorage() {
                try {
                    const saved = localStorage.getItem('adaptiveSystem_config');
                    if (saved) {
                        const savedConfig = JSON.parse(saved);
                        this.config = { ...this.config, ...savedConfig };
                        
                        // æ›´æ–°æ’ä»¶å€¼
                        if (this.plugins.touchButtonHeight) {
                            this.plugins.touchButtonHeight.setValue(this.config.touchButtonHeight);
                        }
                        if (this.plugins.touchButtonWidth) {
                            this.plugins.touchButtonWidth.setValue(this.config.touchButtonWidth);
                        }
                        if (this.plugins.touchSpacing) {
                            this.plugins.touchSpacing.setValue(this.config.touchSpacing);
                        }
                    }
                } catch (error) {
                    console.warn('åŠ è½½é…ç½®å¤±è´¥:', error);
                }
            }

            saveHistoryToStorage() {
                try {
                    localStorage.setItem('adaptiveSystem_history', JSON.stringify(this.history));
                } catch (error) {
                    console.warn('ä¿å­˜å†å²è®°å½•å¤±è´¥:', error);
                }
            }

            loadHistoryFromStorage() {
                try {
                    const saved = localStorage.getItem('adaptiveSystem_history');
                    if (saved) {
                        this.history = JSON.parse(saved);
                        this.renderHistory();
                    }
                } catch (error) {
                    console.warn('åŠ è½½å†å²è®°å½•å¤±è´¥:', error);
                }
            }
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            window.adaptiveSystem = new AdaptiveSystem();
        });

        if (document.readyState !== 'loading' && !window.adaptiveSystem) {
            window.adaptiveSystem = new AdaptiveSystem();
        }
    </script>
</body>

</html>