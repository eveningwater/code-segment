<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>remove-class</title>
    <link rel="stylesheet" href="../../demo/plugins/modal/style.css">
    <link rel="stylesheet" href="../../demo/plugins/notification/style.css">
    <link rel="stylesheet" href="../../demo/plugins/input-number/style.css">
    <link rel="stylesheet" href="../../demo/plugins/select/style.css">
    <link rel="stylesheet" href="../../demo/plugins/checkbox/style.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: "Inter", "PingFang SC", "Microsoft YaHei", sans-serif;
            background: #f1f5f9;
            color: #0f172a;
            padding: 32px;
        }
        .page {
            max-width: 1100px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .header {
            background: #ffffff;
            border-radius: 18px;
            padding: 24px 28px;
            box-shadow: 0 20px 40px rgba(15, 23, 42, 0.08);
        }
        .title-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
        }
        .title-row h1 {
            font-size: 1.8rem;
            font-weight: 700;
        }
        .subtitle {
            margin-top: 8px;
            color: #64748b;
            font-size: 0.95rem;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
        }
        .card {
            background: #ffffff;
            border-radius: 18px;
            padding: 22px;
            box-shadow: 0 18px 36px rgba(15, 23, 42, 0.08);
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        .card h2 {
            font-size: 1.2rem;
            font-weight: 700;
        }
        .form-row {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .form-row label {
            font-size: 0.9rem;
            color: #475569;
        }
        .actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
        }
        .actions button {
            border: none;
            background: #2563eb;
            color: #fff;
            padding: 10px 14px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .actions button.secondary {
            background: #0f766e;
        }
        .actions button.ghost {
            background: #e2e8f0;
            color: #1e293b;
        }
        .actions button:hover {
            transform: translateY(-1px);
            box-shadow: 0 12px 20px rgba(37, 99, 235, 0.2);
        }
        .target-box {
            min-height: 140px;
            border-radius: 16px;
            background: #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.1rem;
            color: #0f172a;
            transition: all 0.2s ease;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
        }
        .stat {
            background: #f8fafc;
            padding: 12px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }
        .stat-label {
            color: #64748b;
            font-size: 0.8rem;
            margin-bottom: 6px;
        }
        .stat-value {
            font-size: 0.95rem;
            font-weight: 600;
            color: #0f172a;
            word-break: break-all;
        }
        .tag-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .tag {
            background: #e2e8f0;
            padding: 6px 10px;
            border-radius: 999px;
            font-size: 0.8rem;
            color: #334155;
        }
        .is-primary {
            background: #2563eb;
            color: #ffffff;
        }
        .is-border {
            border: 2px solid #0ea5e9;
        }
        .is-shadow {
            box-shadow: 0 18px 30px rgba(15, 23, 42, 0.25);
        }
        .is-rounded {
            border-radius: 999px;
        }
        .is-glow {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.35), 0 12px 26px rgba(59, 130, 246, 0.4);
        }
        .is-striped {
            background-image: repeating-linear-gradient(45deg, rgba(255, 255, 255, 0.35) 0, rgba(255, 255, 255, 0.35) 8px, rgba(255, 255, 255, 0) 8px, rgba(255, 255, 255, 0) 16px);
        }
    </style>
</head>
<body>
    <div class="page">
        <div class="header">
            <div class="title-row">
                <h1>removeClass 自定义插件演示</h1>
            </div>
            <div class="subtitle">使用 InputNumber、Select、Checkbox、Modal、Notification 构建 removeClass 示例</div>
        </div>

        <div class="grid">
            <div class="card">
                <h2>操作面板</h2>
                <div class="form-row">
                    <label>样式数量</label>
                    <div id="countInput"></div>
                </div>
                <div class="form-row">
                    <label>要移除的类</label>
                    <div id="classSelect"></div>
                </div>
                <div class="form-row">
                    <label>移除模式</label>
                    <div id="modeSelect"></div>
                </div>
                <div class="form-row">
                    <label>选项</label>
                    <div id="optionCheckbox"></div>
                </div>
                <div class="actions">
                    <button id="applyBtn">应用样式</button>
                    <button id="removeBtn" class="secondary">移除类</button>
                    <button id="detailBtn" class="ghost">查看详情</button>
                    <button id="resetBtn" class="ghost">重置</button>
                </div>
            </div>

            <div class="card">
                <h2>目标元素</h2>
                <div class="target-box" id="targetBox">removeClass 目标</div>
                <div class="stats">
                    <div class="stat">
                        <div class="stat-label">已应用类</div>
                        <div class="stat-value" id="classValue">-</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">类数量</div>
                        <div class="stat-value" id="countValue">0</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">最近移除</div>
                        <div class="stat-value" id="removedValue">-</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">状态</div>
                        <div class="stat-value" id="statusValue">等待操作</div>
                    </div>
                </div>
                <div class="form-row">
                    <label>当前样式标签</label>
                    <div class="tag-list" id="classTags"></div>
                </div>
            </div>

            <div class="card">
                <h2>可用类列表</h2>
                <div class="tag-list" id="classPoolList"></div>
            </div>
        </div>
    </div>

    <script src="../../demo/plugins/modal/index.js"></script>
    <script src="../../demo/plugins/notification/index.js"></script>
    <script src="../../demo/plugins/input-number/index.js"></script>
    <script src="../../demo/plugins/select/index.js"></script>
    <script src="../../demo/plugins/checkbox/index.js"></script>
    <script>
        const removeClass = (el, className) => el.classList.remove(className);

        const classPool = [
            { value: 'is-primary', label: '主色背景' },
            { value: 'is-border', label: '描边' },
            { value: 'is-shadow', label: '阴影' },
            { value: 'is-rounded', label: '圆角' },
            { value: 'is-glow', label: '发光' },
            { value: 'is-striped', label: '条纹' }
        ];

        const modeOptions = [
            { value: 'single', label: '移除单个' },
            { value: 'all', label: '移除全部' }
        ];

        const state = {
            plugins: {
                modal: null,
                notification: null,
                checkboxGroup: null
            },
            selects: {
                classSelect: null,
                classSelectNative: null,
                modeSelect: null,
                modeSelectNative: null
            },
            inputs: {
                count: null
            },
            checkboxOptions: [],
            last: null
        };

        function initPlugins() {
            try {
                state.plugins.modal = new Modal();
                state.plugins.notification = new Notification({ position: 'top-right' });
            } catch (error) {}
        }

        function showNotification(message, type = 'info') {
            if (!getCheckboxValue('showNotifications')) return;
            if (state.plugins.notification) {
                state.plugins.notification.show(message, type);
            } else {
                console.log(message);
            }
        }

        function showModal(content) {
            if (state.plugins.modal) {
                state.plugins.modal.alert(content);
            } else {
                console.log(content);
            }
        }

        function setupInputNumber() {
            const container = document.getElementById('countInput');
            if (!container) return;
            try {
                state.inputs.count = new InputNumber({
                    container,
                    min: 1,
                    max: classPool.length,
                    step: 1,
                    value: 3,
                    onChange: () => {
                        if (getCheckboxValue('autoApply')) applyStyles();
                    }
                });
            } catch (error) {
                const input = document.createElement('input');
                input.type = 'number';
                input.min = '1';
                input.max = String(classPool.length);
                input.step = '1';
                input.value = '3';
                input.className = 'input-field';
                input.id = 'countInputNative';
                container.appendChild(input);
                input.addEventListener('input', () => {
                    if (getCheckboxValue('autoApply')) applyStyles();
                });
            }
        }

        function getCountValue() {
            if (state.inputs.count && typeof state.inputs.count.getValue === 'function') {
                try {
                    return Number(state.inputs.count.getValue());
                } catch (error) {}
            }
            const native = document.getElementById('countInputNative');
            return native ? Number(native.value) : 1;
        }

        function setupSelects() {
            const classContainer = document.getElementById('classSelect');
            const modeContainer = document.getElementById('modeSelect');
            if (classContainer) {
                try {
                    state.selects.classSelect = new Select({
                        container: classContainer,
                        options: [],
                        placeholder: '选择类名',
                        onChange: () => {
                            if (getCheckboxValue('autoRemove') && getModeValue() === 'single') {
                                removeNow();
                            }
                        }
                    });
                } catch (error) {
                    const select = document.createElement('select');
                    select.className = 'input-field';
                    select.addEventListener('change', () => {
                        if (getCheckboxValue('autoRemove') && getModeValue() === 'single') {
                            removeNow();
                        }
                    });
                    classContainer.appendChild(select);
                    state.selects.classSelectNative = select;
                }
            }
            if (modeContainer) {
                try {
                    state.selects.modeSelect = new Select({
                        container: modeContainer,
                        options: modeOptions,
                        placeholder: '选择移除模式',
                        onChange: () => {
                            if (getCheckboxValue('autoRemove') && getModeValue() === 'all') {
                                removeNow();
                            }
                        }
                    });
                    state.selects.modeSelect.setValue('single');
                } catch (error) {
                    const select = document.createElement('select');
                    select.className = 'input-field';
                    modeOptions.forEach(option => {
                        const opt = document.createElement('option');
                        opt.value = option.value;
                        opt.textContent = option.label;
                        select.appendChild(opt);
                    });
                    select.value = 'single';
                    select.addEventListener('change', () => {
                        if (getCheckboxValue('autoRemove') && getModeValue() === 'all') {
                            removeNow();
                        }
                    });
                    modeContainer.appendChild(select);
                    state.selects.modeSelectNative = select;
                }
            }
            updateClassOptions([]);
        }

        function updateClassOptions(activeClasses) {
            const options = classPool.map(item => ({
                value: item.value,
                label: activeClasses.includes(item.value) ? `${item.label}（已应用）` : item.label
            }));
            if (state.selects.classSelect && typeof state.selects.classSelect.setOptions === 'function') {
                state.selects.classSelect.setOptions(options);
                state.selects.classSelect.setValue(options[0]?.value || '');
            } else if (state.selects.classSelectNative) {
                state.selects.classSelectNative.innerHTML = '';
                options.forEach(option => {
                    const opt = document.createElement('option');
                    opt.value = option.value;
                    opt.textContent = option.label;
                    state.selects.classSelectNative.appendChild(opt);
                });
                state.selects.classSelectNative.value = options[0]?.value || '';
            }
        }

        function setupCheckboxes() {
            const container = document.getElementById('optionCheckbox');
            if (!container) return;
            const options = [
                { id: 'autoApply', label: '自动应用样式', checked: true },
                { id: 'autoRemove', label: '自动移除类', checked: false },
                { id: 'showModal', label: '使用弹窗展示详情', checked: true },
                { id: 'showNotifications', label: '显示通知', checked: true }
            ];
            state.checkboxOptions = options;
            try {
                const group = Checkbox.createCheckboxGroup({
                    items: options.map(option => ({
                        id: option.id,
                        label: option.label,
                        checked: option.checked
                    })),
                    onChange: () => {}
                });
                container.appendChild(group.container);
                state.plugins.checkboxGroup = group;
            } catch (error) {
                options.forEach(option => {
                    const div = document.createElement('div');
                    div.style.marginBottom = '10px';
                    div.innerHTML = `<input type="checkbox" id="${option.id}" ${option.checked ? 'checked' : ''}><label for="${option.id}" style="margin-left:8px; cursor:pointer;">${option.label}</label>`;
                    container.appendChild(div);
                });
            }
        }

        function getCheckboxValue(id) {
            if (state.plugins.checkboxGroup) {
                try {
                    const states = state.plugins.checkboxGroup.getAllChecked();
                    const index = state.checkboxOptions.findIndex(option => option.id === id);
                    if (index !== -1) return states[index] || false;
                } catch (error) {}
            }
            const native = document.getElementById(id);
            return native ? native.checked : false;
        }

        function getModeValue() {
            if (state.selects.modeSelect && typeof state.selects.modeSelect.getValue === 'function') {
                return state.selects.modeSelect.getValue();
            }
            return state.selects.modeSelectNative ? state.selects.modeSelectNative.value : 'single';
        }

        function getSelectedClass() {
            if (state.selects.classSelect && typeof state.selects.classSelect.getValue === 'function') {
                return state.selects.classSelect.getValue();
            }
            return state.selects.classSelectNative ? state.selects.classSelectNative.value : '';
        }

        function pickRandomClasses(count) {
            const pool = [...classPool.map(item => item.value)];
            const selected = [];
            while (selected.length < count && pool.length) {
                const index = Math.floor(Math.random() * pool.length);
                selected.push(pool.splice(index, 1)[0]);
            }
            return selected;
        }

        function getCurrentClasses() {
            const target = document.getElementById('targetBox');
            if (!target) return [];
            return classPool.map(item => item.value).filter(value => target.classList.contains(value));
        }

        function renderTags(containerId, classes) {
            const container = document.getElementById(containerId);
            if (!container) return;
            container.innerHTML = '';
            if (!classes.length) {
                const tag = document.createElement('span');
                tag.className = 'tag';
                tag.textContent = '暂无';
                container.appendChild(tag);
                return;
            }
            classes.forEach(value => {
                const tag = document.createElement('span');
                tag.className = 'tag';
                tag.textContent = value;
                container.appendChild(tag);
            });
        }

        function renderPoolList() {
            const list = classPool.map(item => item.value);
            renderTags('classPoolList', list);
        }

        function updateStats(payload) {
            document.getElementById('classValue').textContent = payload.classText;
            document.getElementById('countValue').textContent = payload.countText;
            document.getElementById('removedValue').textContent = payload.removedText;
            document.getElementById('statusValue').textContent = payload.statusText;
            renderTags('classTags', payload.currentClasses);
        }

        function applyStyles() {
            const target = document.getElementById('targetBox');
            if (!target) return;
            let count = getCountValue();
            if (!Number.isFinite(count)) count = 1;
            count = Math.min(Math.max(1, Math.round(count)), classPool.length);
            classPool.forEach(item => removeClass(target, item.value));
            const selected = pickRandomClasses(count);
            selected.forEach(value => target.classList.add(value));
            state.last = { action: 'apply', applied: selected, removed: [] };
            updateClassOptions(selected);
            updateStats({
                classText: selected.join(' ') || '-',
                countText: String(selected.length),
                removedText: '-',
                statusText: '已应用样式',
                currentClasses: selected
            });
            showNotification('样式已应用', 'success');
        }

        function removeNow() {
            const target = document.getElementById('targetBox');
            if (!target) return;
            const mode = getModeValue();
            const removed = [];
            if (mode === 'all') {
                classPool.forEach(item => {
                    if (target.classList.contains(item.value)) {
                        removeClass(target, item.value);
                        removed.push(item.value);
                    }
                });
            } else {
                const selectedClass = getSelectedClass();
                if (selectedClass && target.classList.contains(selectedClass)) {
                    removeClass(target, selectedClass);
                    removed.push(selectedClass);
                }
            }
            const remaining = getCurrentClasses();
            state.last = { action: 'remove', applied: remaining, removed };
            updateClassOptions(remaining);
            updateStats({
                classText: remaining.join(' ') || '-',
                countText: String(remaining.length),
                removedText: removed.join(' ') || '-',
                statusText: removed.length ? '已移除' : '未移除任何类',
                currentClasses: remaining
            });
            if (removed.length) {
                showNotification(`已移除 ${removed.length} 个类`, 'success');
            } else {
                showNotification('没有可移除的类', 'warning');
            }
            if (getCheckboxValue('showModal')) {
                showModal(buildDetailContent());
            }
        }

        function resetAll() {
            const target = document.getElementById('targetBox');
            if (!target) return;
            classPool.forEach(item => removeClass(target, item.value));
            updateClassOptions([]);
            updateStats({
                classText: '-',
                countText: '0',
                removedText: '-',
                statusText: '已重置',
                currentClasses: []
            });
            state.last = null;
            showNotification('已重置样式', 'info');
        }

        function buildDetailContent() {
            const last = state.last;
            const applied = last?.applied || [];
            const removed = last?.removed || [];
            const action = last?.action || '无';
            return `
                <div style="padding:12px 8px; font-size:14px; color:#1f2937;">
                    <div style="font-weight:900; margin-bottom:10px;">操作详情</div>
                    <div style="margin-bottom:8px;">动作：<strong>${action}</strong></div>
                    <div style="margin-bottom:8px;">已应用：<span style="font-family:JetBrains Mono, monospace;">${applied.length ? applied.join(', ') : '无'}</span></div>
                    <div style="margin-bottom:8px;">已移除：<span style="font-family:JetBrains Mono, monospace;">${removed.length ? removed.join(', ') : '无'}</span></div>
                </div>
            `;
        }

        function showDetails() {
            if (!getCheckboxValue('showModal')) {
                showNotification('详情弹窗已关闭', 'info');
                return;
            }
            showModal(buildDetailContent());
        }

        function bindActions() {
            const applyBtn = document.getElementById('applyBtn');
            const removeBtn = document.getElementById('removeBtn');
            const resetBtn = document.getElementById('resetBtn');
            const detailBtn = document.getElementById('detailBtn');
            if (applyBtn) applyBtn.addEventListener('click', applyStyles);
            if (removeBtn) removeBtn.addEventListener('click', removeNow);
            if (resetBtn) resetBtn.addEventListener('click', resetAll);
            if (detailBtn) detailBtn.addEventListener('click', showDetails);
        }

        function init() {
            initPlugins();
            setupCheckboxes();
            setupInputNumber();
            setupSelects();
            bindActions();
            renderPoolList();
            applyStyles();
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
