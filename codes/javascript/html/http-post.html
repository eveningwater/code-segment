<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”¨æˆ·æ³¨å†Œç³»ç»Ÿ - httpPost å®æˆ˜ç¤ºä¾‹</title>
    <link rel="stylesheet" href="../../demo/plugins/modal/style.css">
    <link rel="stylesheet" href="../../demo/plugins/notification/style.css">
    <link rel="stylesheet" href="../../demo/plugins/select/style.css">
    <link rel="stylesheet" href="../../demo/plugins/checkbox/style.css">
    <link rel="stylesheet" href="../../demo/plugins/datetime-picker/style.css">
    <link rel="stylesheet" href="../../demo/plugins/input-number/style.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .form-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .form-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #e9ecef;
        }

        .form-section h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 0.9em;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-control.error {
            border-color: #dc3545;
        }

        .form-control.success {
            border-color: #28a745;
        }

        .error-message {
            color: #dc3545;
            font-size: 0.8em;
            margin-top: 5px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 16px;
            margin: 5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(108, 117, 125, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(40, 167, 69, 0.4);
        }

        .file-upload {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .file-upload input[type=file] {
            position: absolute;
            left: -9999px;
        }

        .file-upload-label {
            display: block;
            padding: 12px 15px;
            border: 2px dashed #e9ecef;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .file-upload-label:hover {
            border-color: #667eea;
            background: #f0f2ff;
        }

        .file-preview {
            margin-top: 10px;
            padding: 10px;
            background: #e9ecef;
            border-radius: 8px;
            display: none;
        }

        .file-preview.show {
            display: block;
        }

        .file-preview img {
            max-width: 100px;
            max-height: 100px;
            border-radius: 5px;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
            margin-top: 10px;
            display: none;
        }

        .progress-bar.show {
            display: block;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s ease;
        }

        .form-actions {
            grid-column: 1 / -1;
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #e9ecef;
        }

        .result-container {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            border: 2px solid #e9ecef;
            display: none;
        }

        .result-container.show {
            display: block;
        }

        .result-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            text-align: center;
        }

        .result-data {
            display: grid;
            gap: 10px;
        }

        .result-row {
            display: flex;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .result-label {
            font-weight: 600;
            color: #333;
            min-width: 120px;
            margin-right: 15px;
        }

        .result-value {
            color: #666;
            flex: 1;
        }

        .validation-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            font-size: 0.9em;
        }

        .status-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .status-valid {
            background: #d4edda;
            color: #155724;
        }

        .status-invalid {
            background: #f8d7da;
            color: #721c24;
        }

        .password-strength {
            margin-top: 10px;
        }

        .strength-bar {
            height: 4px;
            background: #e9ecef;
            border-radius: 2px;
            overflow: hidden;
            margin-bottom: 5px;
        }

        .strength-fill {
            height: 100%;
            transition: all 0.3s ease;
        }

        .strength-weak {
            background: #dc3545;
            width: 25%;
        }

        .strength-medium {
            background: #ffc107;
            width: 50%;
        }

        .strength-strong {
            background: #28a745;
            width: 75%;
        }

        .strength-very-strong {
            background: #20c997;
            width: 100%;
        }

        .strength-text {
            font-size: 0.8em;
            color: #666;
        }

        @media (max-width: 768px) {
            .form-container {
                grid-template-columns: 1fr;
            }
            
            .form-actions {
                grid-column: 1;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ‘¤ ç”¨æˆ·æ³¨å†Œç³»ç»Ÿ</h1>
            <p>åŸºäº httpPost æ–¹æ³•çš„å®æˆ˜ç¤ºä¾‹ - è¡¨å•æäº¤ä¸æ•°æ®éªŒè¯</p>
        </div>

        <div class="content">
            <form id="registrationForm">
                <div class="form-container">
                    <!-- åŸºæœ¬ä¿¡æ¯ -->
                    <div class="form-section">
                        <h3>ğŸ“‹ åŸºæœ¬ä¿¡æ¯</h3>
                        
                        <div class="form-group">
                            <label for="username">ç”¨æˆ·å *</label>
                            <input type="text" id="username" class="form-control" placeholder="è¯·è¾“å…¥ç”¨æˆ·å">
                            <div class="error-message" id="username-error">ç”¨æˆ·åä¸èƒ½ä¸ºç©ºä¸”é•¿åº¦åœ¨3-20ä¸ªå­—ç¬¦ä¹‹é—´</div>
                            <div class="validation-status">
                                <span class="status-icon" id="username-status">?</span>
                                <span id="username-status-text">è¯·è¾“å…¥ç”¨æˆ·å</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="email">é‚®ç®±åœ°å€ *</label>
                            <input type="email" id="email" class="form-control" placeholder="è¯·è¾“å…¥é‚®ç®±åœ°å€">
                            <div class="error-message" id="email-error">è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€</div>
                            <div class="validation-status">
                                <span class="status-icon" id="email-status">?</span>
                                <span id="email-status-text">è¯·è¾“å…¥é‚®ç®±åœ°å€</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="password">å¯†ç  *</label>
                            <input type="password" id="password" class="form-control" placeholder="è¯·è¾“å…¥å¯†ç ">
                            <div class="error-message" id="password-error">å¯†ç é•¿åº¦è‡³å°‘8ä½ï¼ŒåŒ…å«å­—æ¯å’Œæ•°å­—</div>
                            <div class="password-strength">
                                <div class="strength-bar">
                                    <div class="strength-fill" id="strength-fill"></div>
                                </div>
                                <div class="strength-text" id="strength-text">å¯†ç å¼ºåº¦ï¼šæœªè®¾ç½®</div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="confirmPassword">ç¡®è®¤å¯†ç  *</label>
                            <input type="password" id="confirmPassword" class="form-control" placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç ">
                            <div class="error-message" id="confirmPassword-error">ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´</div>
                        </div>
                    </div>

                    <!-- è¯¦ç»†ä¿¡æ¯ -->
                    <div class="form-section">
                        <h3>ğŸ‘¤ è¯¦ç»†ä¿¡æ¯</h3>
                        
                        <div class="form-group">
                            <label for="fullName">çœŸå®å§“å *</label>
                            <input type="text" id="fullName" class="form-control" placeholder="è¯·è¾“å…¥çœŸå®å§“å">
                            <div class="error-message" id="fullName-error">è¯·è¾“å…¥çœŸå®å§“å</div>
                        </div>

                        <div class="form-group">
                            <label>æ€§åˆ«</label>
                            <div id="genderSelect"></div>
                        </div>

                        <div class="form-group">
                            <label>å‡ºç”Ÿæ—¥æœŸ</label>
                            <div id="birthDatePicker"></div>
                        </div>

                        <div class="form-group">
                            <label for="phone">æ‰‹æœºå·ç </label>
                            <input type="tel" id="phone" class="form-control" placeholder="è¯·è¾“å…¥æ‰‹æœºå·ç ">
                            <div class="error-message" id="phone-error">è¯·è¾“å…¥æœ‰æ•ˆçš„æ‰‹æœºå·ç </div>
                        </div>

                        <div class="form-group">
                            <label>ç”¨æˆ·ç±»å‹</label>
                            <div id="userTypeSelect"></div>
                        </div>

                        <div class="form-group">
                            <label>æ³¨å†Œæ•°é‡</label>
                            <div id="quantityInput"></div>
                        </div>
                    </div>

                    <!-- åå¥½è®¾ç½® -->
                    <div class="form-section">
                        <h3>âš™ï¸ åå¥½è®¾ç½®</h3>
                        
                        <div class="form-group">
                            <label>å…´è¶£çˆ±å¥½</label>
                            <div id="interestsCheckbox"></div>
                        </div>

                        <div class="form-group">
                            <label>é€šçŸ¥è®¾ç½®</label>
                            <div id="notificationCheckbox"></div>
                        </div>

                        <div class="form-group">
                            <label>å¤´åƒä¸Šä¼ </label>
                            <div class="file-upload">
                                <input type="file" id="avatar" accept="image/*">
                                <label for="avatar" class="file-upload-label">
                                    ğŸ“· ç‚¹å‡»é€‰æ‹©å¤´åƒæ–‡ä»¶
                                </label>
                            </div>
                            <div class="file-preview" id="filePreview">
                                <img id="previewImage" src="" alt="é¢„è§ˆ">
                            </div>
                            <div class="progress-bar" id="uploadProgress">
                                <div class="progress-fill" id="progressFill"></div>
                            </div>
                        </div>
                    </div>

                    <!-- åè®®ç¡®è®¤ -->
                    <div class="form-section">
                        <h3>ğŸ“„ åè®®ç¡®è®¤</h3>
                        
                        <div class="form-group">
                            <div id="agreementCheckbox"></div>
                        </div>

                        <div class="form-group">
                            <label for="referralCode">æ¨èç ï¼ˆå¯é€‰ï¼‰</label>
                            <input type="text" id="referralCode" class="form-control" placeholder="è¯·è¾“å…¥æ¨èç ">
                        </div>
                    </div>
                </div>

                <!-- è¡¨å•æ“ä½œ -->
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="resetForm()">é‡ç½®è¡¨å•</button>
                    <button type="button" class="btn btn-primary" onclick="validateAndSubmit()">æäº¤æ³¨å†Œ</button>
                    <button type="button" class="btn btn-success" onclick="generateDemoData()">ç”Ÿæˆæ¼”ç¤ºæ•°æ®</button>
                </div>
            </form>

            <!-- æäº¤ç»“æœ -->
            <div class="result-container" id="resultContainer">
                <div class="result-title">âœ… æ³¨å†ŒæˆåŠŸï¼</div>
                <div class="result-data" id="resultData"></div>
            </div>
        </div>
    </div>

    <!-- å¼•å…¥æ’ä»¶ -->
    <script src="../../demo/plugins/modal/index.js"></script>
    <script src="../../demo/plugins/notification/index.js"></script>
    <script src="../../demo/plugins/select/index.js"></script>
    <script src="../../demo/plugins/checkbox/index.js"></script>
    <script src="../../demo/plugins/datetime-picker/index.js"></script>
    <script src="../../demo/plugins/input-number/index.js"></script>

    <script>
        // å…¨å±€å˜é‡
        let modal, notification;
        let genderSelect, userTypeSelect, birthDatePicker, quantityInput;
        let interestsCheckbox, notificationCheckbox, agreementCheckbox;
        let formData = {};
        let avatarFile = null;

        // httpPost æ–¹æ³•
        const httpPost = (url, data, callback, error = console.error) => {
            const request = new XMLHttpRequest();
            request.open('POST', url, true);
            request.setRequestHeader('Content-type', 'application/json; charset=utf-8');
            request.onload = () => callback(request.responseText);
            request.onerror = () => error(request);
            request.send(data);
        };

        // åˆå§‹åŒ–åº”ç”¨
        function initApp() {
            // åˆå§‹åŒ–æ’ä»¶
            modal = new Modal();
            notification = new Notification({ position: 'top-right' });

            // åˆå§‹åŒ–é€‰æ‹©å™¨
            genderSelect = new Select({
                container: document.getElementById('genderSelect'),
                options: [
                    { value: 'male', label: 'ç”·' },
                    { value: 'female', label: 'å¥³' },
                    { value: 'other', label: 'å…¶ä»–' }
                ],
                placeholder: 'é€‰æ‹©æ€§åˆ«'
            });

            userTypeSelect = new Select({
                container: document.getElementById('userTypeSelect'),
                options: [
                    { value: 'personal', label: 'ä¸ªäººç”¨æˆ·' },
                    { value: 'business', label: 'ä¼ä¸šç”¨æˆ·' },
                    { value: 'developer', label: 'å¼€å‘è€…' },
                    { value: 'student', label: 'å­¦ç”Ÿ' }
                ],
                placeholder: 'é€‰æ‹©ç”¨æˆ·ç±»å‹'
            });

                         birthDatePicker = new DateTimePicker({
                 container: document.getElementById('birthDatePicker'),
                 placeholder: 'é€‰æ‹©å‡ºç”Ÿæ—¥æœŸ',
                 format: 'YYYY-MM-DD HH:mm:ss'
             });

            quantityInput = new InputNumber({
                container: document.getElementById('quantityInput'),
                min: 1,
                max: 10,
                value: 1,
                step: 1
            });

            // åˆå§‹åŒ–å¤é€‰æ¡†ç»„
            interestsCheckbox = Checkbox.createCheckboxGroup({
                container: document.getElementById('interestsCheckbox'),
                items: [
                    { label: 'æŠ€æœ¯å¼€å‘', checked: false },
                    { label: 'è®¾è®¡åˆ›æ„', checked: false },
                    { label: 'å•†ä¸šç®¡ç†', checked: false },
                    { label: 'æ•™è‚²åŸ¹è®­', checked: false },
                    { label: 'å¥åº·è¿åŠ¨', checked: false },
                    { label: 'æ—…æ¸¸æ‘„å½±', checked: false }
                ]
            });

            notificationCheckbox = Checkbox.createCheckboxGroup({
                container: document.getElementById('notificationCheckbox'),
                items: [
                    { label: 'é‚®ä»¶é€šçŸ¥', checked: true },
                    { label: 'çŸ­ä¿¡é€šçŸ¥', checked: false },
                    { label: 'æ¨é€é€šçŸ¥', checked: true },
                    { label: 'ç³»ç»Ÿå…¬å‘Š', checked: true }
                ]
            });

                         // åˆ›å»ºå•ä¸ªåè®®åŒæ„å¤é€‰æ¡†
             agreementCheckbox = new Checkbox({
                 label: 'æˆ‘å·²é˜…è¯»å¹¶åŒæ„ã€Šç”¨æˆ·åè®®ã€‹å’Œã€Šéšç§æ”¿ç­–ã€‹',
                 checked: false,
                 onChange: (checked) => {
                     console.log('åè®®åŒæ„çŠ¶æ€:', checked);
                 }
             });
             agreementCheckbox.mount(document.getElementById('agreementCheckbox'));

            // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
            setupEventListeners();
        }

        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // ç”¨æˆ·åéªŒè¯
            document.getElementById('username').addEventListener('input', validateUsername);
            document.getElementById('username').addEventListener('blur', validateUsername);

            // é‚®ç®±éªŒè¯
            document.getElementById('email').addEventListener('input', validateEmail);
            document.getElementById('email').addEventListener('blur', validateEmail);

            // å¯†ç éªŒè¯
            document.getElementById('password').addEventListener('input', validatePassword);
            document.getElementById('confirmPassword').addEventListener('input', validateConfirmPassword);

            // å…¶ä»–å­—æ®µéªŒè¯
            document.getElementById('fullName').addEventListener('blur', validateFullName);
            document.getElementById('phone').addEventListener('blur', validatePhone);

            // æ–‡ä»¶ä¸Šä¼ 
            document.getElementById('avatar').addEventListener('change', handleFileUpload);
        }

        // ç”¨æˆ·åéªŒè¯
        function validateUsername() {
            const input = document.getElementById('username');
            const value = input.value.trim();
            const errorElement = document.getElementById('username-error');
            const statusElement = document.getElementById('username-status');
            const statusText = document.getElementById('username-status-text');

            if (!value) {
                showError(input, errorElement, statusElement, statusText, 'è¯·è¾“å…¥ç”¨æˆ·å');
                return false;
            }

            if (value.length < 3 || value.length > 20) {
                showError(input, errorElement, statusElement, statusText, 'ç”¨æˆ·åé•¿åº¦åº”åœ¨3-20ä¸ªå­—ç¬¦ä¹‹é—´');
                return false;
            }

            if (!/^[a-zA-Z0-9_]+$/.test(value)) {
                showError(input, errorElement, statusElement, statusText, 'ç”¨æˆ·ååªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿');
                return false;
            }

            showSuccess(input, errorElement, statusElement, statusText, 'ç”¨æˆ·åå¯ç”¨');
            return true;
        }

        // é‚®ç®±éªŒè¯
        function validateEmail() {
            const input = document.getElementById('email');
            const value = input.value.trim();
            const errorElement = document.getElementById('email-error');
            const statusElement = document.getElementById('email-status');
            const statusText = document.getElementById('email-status-text');

            if (!value) {
                showError(input, errorElement, statusElement, statusText, 'è¯·è¾“å…¥é‚®ç®±åœ°å€');
                return false;
            }

            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(value)) {
                showError(input, errorElement, statusElement, statusText, 'è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€');
                return false;
            }

            showSuccess(input, errorElement, statusElement, statusText, 'é‚®ç®±æ ¼å¼æ­£ç¡®');
            return true;
        }

        // å¯†ç éªŒè¯
        function validatePassword() {
            const input = document.getElementById('password');
            const value = input.value;
            const errorElement = document.getElementById('password-error');
            const strengthFill = document.getElementById('strength-fill');
            const strengthText = document.getElementById('strength-text');

            if (!value) {
                showError(input, errorElement, null, null, 'è¯·è¾“å…¥å¯†ç ');
                updatePasswordStrength('', '');
                return false;
            }

            if (value.length < 8) {
                showError(input, errorElement, null, null, 'å¯†ç é•¿åº¦è‡³å°‘8ä½');
                updatePasswordStrength('weak', 'å¼±');
                return false;
            }

            const hasLetter = /[a-zA-Z]/.test(value);
            const hasNumber = /\d/.test(value);
            const hasSpecial = /[!@#$%^&*(),.?":{}|<>]/.test(value);

            let strength = 'weak';
            let strengthLabel = 'å¼±';

            if (value.length >= 12 && hasLetter && hasNumber && hasSpecial) {
                strength = 'very-strong';
                strengthLabel = 'éå¸¸å¼º';
            } else if (value.length >= 10 && hasLetter && hasNumber) {
                strength = 'strong';
                strengthLabel = 'å¼º';
            } else if (value.length >= 8 && (hasLetter || hasNumber)) {
                strength = 'medium';
                strengthLabel = 'ä¸­ç­‰';
            }

            updatePasswordStrength(strength, strengthLabel);
            showSuccess(input, errorElement, null, null, 'å¯†ç æ ¼å¼æ­£ç¡®');
            return true;
        }

        // æ›´æ–°å¯†ç å¼ºåº¦æ˜¾ç¤º
        function updatePasswordStrength(strength, label) {
            const strengthFill = document.getElementById('strength-fill');
            const strengthText = document.getElementById('strength-text');

            strengthFill.className = 'strength-fill';
            if (strength) {
                strengthFill.classList.add(`strength-${strength}`);
            }
            strengthText.textContent = `å¯†ç å¼ºåº¦ï¼š${label}`;
        }

        // ç¡®è®¤å¯†ç éªŒè¯
        function validateConfirmPassword() {
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const input = document.getElementById('confirmPassword');
            const errorElement = document.getElementById('confirmPassword-error');

            if (!confirmPassword) {
                showError(input, errorElement, null, null, 'è¯·ç¡®è®¤å¯†ç ');
                return false;
            }

            if (password !== confirmPassword) {
                showError(input, errorElement, null, null, 'ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´');
                return false;
            }

            showSuccess(input, errorElement, null, null, 'å¯†ç ç¡®è®¤æ­£ç¡®');
            return true;
        }

        // çœŸå®å§“åéªŒè¯
        function validateFullName() {
            const input = document.getElementById('fullName');
            const value = input.value.trim();
            const errorElement = document.getElementById('fullName-error');

            if (!value) {
                showError(input, errorElement, null, null, 'è¯·è¾“å…¥çœŸå®å§“å');
                return false;
            }

            if (value.length < 2) {
                showError(input, errorElement, null, null, 'å§“åé•¿åº¦è‡³å°‘2ä¸ªå­—ç¬¦');
                return false;
            }

            showSuccess(input, errorElement, null, null, 'å§“åæ ¼å¼æ­£ç¡®');
            return true;
        }

        // æ‰‹æœºå·éªŒè¯
        function validatePhone() {
            const input = document.getElementById('phone');
            const value = input.value.trim();
            const errorElement = document.getElementById('phone-error');

            if (!value) {
                showSuccess(input, errorElement, null, null, 'æ‰‹æœºå·å¯é€‰');
                return true;
            }

            const phoneRegex = /^1[3-9]\d{9}$/;
            if (!phoneRegex.test(value)) {
                showError(input, errorElement, null, null, 'è¯·è¾“å…¥æœ‰æ•ˆçš„æ‰‹æœºå·ç ');
                return false;
            }

            showSuccess(input, errorElement, null, null, 'æ‰‹æœºå·æ ¼å¼æ­£ç¡®');
            return true;
        }

        // æ˜¾ç¤ºé”™è¯¯çŠ¶æ€
        function showError(input, errorElement, statusElement, statusText, message) {
            input.classList.remove('success');
            input.classList.add('error');
            if (errorElement) {
                errorElement.classList.add('show');
                errorElement.textContent = message;
            }
            if (statusElement) {
                statusElement.className = 'status-icon status-invalid';
                statusElement.textContent = 'âœ•';
            }
            if (statusText) {
                statusText.textContent = message;
            }
        }

        // æ˜¾ç¤ºæˆåŠŸçŠ¶æ€
        function showSuccess(input, errorElement, statusElement, statusText, message) {
            input.classList.remove('error');
            input.classList.add('success');
            if (errorElement) {
                errorElement.classList.remove('show');
            }
            if (statusElement) {
                statusElement.className = 'status-icon status-valid';
                statusElement.textContent = 'âœ“';
            }
            if (statusText) {
                statusText.textContent = message;
            }
        }

        // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // éªŒè¯æ–‡ä»¶ç±»å‹
            if (!file.type.startsWith('image/')) {
                notification.error('è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶');
                return;
            }

            // éªŒè¯æ–‡ä»¶å¤§å°ï¼ˆæœ€å¤§5MBï¼‰
            if (file.size > 5 * 1024 * 1024) {
                notification.error('æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡5MB');
                return;
            }

            avatarFile = file;

            // æ˜¾ç¤ºé¢„è§ˆ
            const reader = new FileReader();
            reader.onload = function(e) {
                const previewImage = document.getElementById('previewImage');
                const filePreview = document.getElementById('filePreview');
                previewImage.src = e.target.result;
                filePreview.classList.add('show');
            };
            reader.readAsDataURL(file);

            notification.success('æ–‡ä»¶é€‰æ‹©æˆåŠŸ');
        }

        // æ”¶é›†è¡¨å•æ•°æ®
        function collectFormData() {
            const formData = {
                username: document.getElementById('username').value.trim(),
                email: document.getElementById('email').value.trim(),
                password: document.getElementById('password').value,
                fullName: document.getElementById('fullName').value.trim(),
                gender: genderSelect.getValue(),
                                 birthDate: formatDateOnlyFromPicker(birthDatePicker.getValue()),
                phone: document.getElementById('phone').value.trim(),
                userType: userTypeSelect.getValue(),
                quantity: quantityInput.getValue(),
                interests: interestsCheckbox.checkboxes.map((cb, index) => cb.isChecked() ? interestsCheckbox.checkboxes[index].options.label : null).filter(Boolean),
                notifications: notificationCheckbox.checkboxes.map((cb, index) => cb.isChecked() ? notificationCheckbox.checkboxes[index].options.label : null).filter(Boolean),
                                 agreement: agreementCheckbox.isChecked(),
                referralCode: document.getElementById('referralCode').value.trim(),
                avatar: avatarFile ? avatarFile.name : null,
                                 registrationTime: formatDateTime(new Date())
            };

            return formData;
        }

        // éªŒè¯å¹¶æäº¤è¡¨å•
        function validateAndSubmit() {
            // éªŒè¯å¿…å¡«å­—æ®µ
            const validations = [
                validateUsername(),
                validateEmail(),
                validatePassword(),
                validateConfirmPassword(),
                validateFullName(),
                validatePhone()
            ];

            if (validations.some(v => !v)) {
                notification.error('è¯·æ£€æŸ¥è¡¨å•ä¸­çš„é”™è¯¯ä¿¡æ¯');
                return;
            }

                         // æ£€æŸ¥åè®®åŒæ„
             if (!agreementCheckbox.isChecked()) {
                 notification.error('è¯·å…ˆåŒæ„ç”¨æˆ·åè®®å’Œéšç§æ”¿ç­–');
                 return;
             }

            // æ”¶é›†è¡¨å•æ•°æ®
            const data = collectFormData();

            // æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
            modal.confirm('ç¡®è®¤æäº¤æ³¨å†Œä¿¡æ¯å—ï¼Ÿ').then(confirmed => {
                if (confirmed) {
                    submitForm(data);
                }
            });
        }

        // æäº¤è¡¨å•
        function submitForm(data) {
            // æ˜¾ç¤ºä¸Šä¼ è¿›åº¦
            const progressBar = document.getElementById('uploadProgress');
            const progressFill = document.getElementById('progressFill');
            progressBar.classList.add('show');

            // æ¨¡æ‹Ÿä¸Šä¼ è¿›åº¦
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += Math.random() * 20;
                if (progress > 90) progress = 90;
                progressFill.style.width = progress + '%';
            }, 200);

            // å‘é€POSTè¯·æ±‚
            const jsonData = JSON.stringify(data);
        httpPost(
            'https://jsonplaceholder.typicode.com/posts/',
                jsonData,
                (responseText) => {
                    clearInterval(progressInterval);
                    progressFill.style.width = '100%';

                    setTimeout(() => {
                        progressBar.classList.remove('show');
                        showResult(data, responseText);
                        notification.success('æ³¨å†ŒæˆåŠŸï¼');
                    }, 500);
                },
                (error) => {
                    clearInterval(progressInterval);
                    progressBar.classList.remove('show');
                    notification.error('æ³¨å†Œå¤±è´¥ï¼Œè¯·é‡è¯•');
                    console.error('Submit error:', error);
                }
            );
        }

        // æ˜¾ç¤ºç»“æœ
        function showResult(formData, responseText) {
            const resultContainer = document.getElementById('resultContainer');
            const resultData = document.getElementById('resultData');

            let template = '';
            for (const [key, value] of Object.entries(formData)) {
                if (value !== null && value !== undefined && value !== '') {
                                         let displayValue = value;
                     if (Array.isArray(value)) {
                         displayValue = value.join(', ');
                     } else if (typeof value === 'boolean') {
                         displayValue = value ? 'æ˜¯' : 'å¦';
                     } else if (key === 'birthDate') {
                         // æ ¼å¼åŒ–å‡ºç”Ÿæ—¥æœŸï¼ˆä»…æ˜¾ç¤ºæ—¥æœŸéƒ¨åˆ†ï¼‰
                         try {
                             if (typeof value === 'string' && value.includes('T')) {
                                 const date = new Date(value);
                                 if (!isNaN(date.getTime())) {
                                     displayValue = formatDateOnly(date);
                                 }
                             } else if (typeof value === 'string' && value.match(/^\d{4}-\d{2}-\d{2}/)) {
                                 displayValue = value;
                             } else {
                                 displayValue = value;
                             }
                         } catch (e) {
                             displayValue = value;
                         }
                     } else if (key === 'registrationTime') {
                         // æ ¼å¼åŒ–æ³¨å†Œæ—¶é—´ï¼ˆæ˜¾ç¤ºå®Œæ•´çš„æ—¥æœŸæ—¶é—´ï¼‰
                         try {
                             if (typeof value === 'string' && value.includes('T')) {
                                 const date = new Date(value);
                                 if (!isNaN(date.getTime())) {
                                     displayValue = formatDateTime(date);
                                 }
                             } else if (typeof value === 'string' && value.match(/^\d{4}-\d{2}-\d{2}/)) {
                                 displayValue = value;
                             } else {
                                 displayValue = value;
                             }
                         } catch (e) {
                             displayValue = value;
                         }
                     }
                    
                        template += `
                        <div class="result-row">
                            <div class="result-label">${getFieldLabel(key)}:</div>
                            <div class="result-value">${displayValue}</div>
                            </div>
                    `;
                }
            }

            resultData.innerHTML = template;
            resultContainer.classList.add('show');
            resultContainer.scrollIntoView({ behavior: 'smooth' });
        }

                 // æ ¼å¼åŒ–æ—¥æœŸæ—¶é—´
         function formatDateTime(date) {
             const year = date.getFullYear();
             const month = String(date.getMonth() + 1).padStart(2, '0');
             const day = String(date.getDate()).padStart(2, '0');
             const hours = String(date.getHours()).padStart(2, '0');
             const minutes = String(date.getMinutes()).padStart(2, '0');
             const seconds = String(date.getSeconds()).padStart(2, '0');
             return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
         }

         // æ ¼å¼åŒ–æ—¥æœŸé€‰æ‹©å™¨çš„å€¼
         function formatDateTimeFromPicker(pickerValue) {
             if (!pickerValue) return '';
             // å°† YYYY-MM-DDTHH:mm æ ¼å¼è½¬æ¢ä¸º YYYY-MM-DD HH:mm:ss
             const date = new Date(pickerValue);
             if (isNaN(date.getTime())) return pickerValue;
             return formatDateTime(date);
         }

         // æ ¼å¼åŒ–æ—¥æœŸï¼ˆä»…æ—¥æœŸéƒ¨åˆ†ï¼‰
         function formatDateOnly(date) {
             const year = date.getFullYear();
             const month = String(date.getMonth() + 1).padStart(2, '0');
             const day = String(date.getDate()).padStart(2, '0');
             return `${year}-${month}-${day}`;
         }

         // æ ¼å¼åŒ–æ—¥æœŸé€‰æ‹©å™¨çš„å€¼ä¸ºä»…æ—¥æœŸæ ¼å¼
         function formatDateOnlyFromPicker(pickerValue) {
             if (!pickerValue) return '';
             const date = new Date(pickerValue);
             if (isNaN(date.getTime())) return pickerValue;
             return formatDateOnly(date);
         }

         // è·å–å­—æ®µæ ‡ç­¾
         function getFieldLabel(key) {
            const labels = {
                username: 'ç”¨æˆ·å',
                email: 'é‚®ç®±åœ°å€',
                password: 'å¯†ç ',
                fullName: 'çœŸå®å§“å',
                gender: 'æ€§åˆ«',
                birthDate: 'å‡ºç”Ÿæ—¥æœŸ',
                phone: 'æ‰‹æœºå·ç ',
                userType: 'ç”¨æˆ·ç±»å‹',
                quantity: 'æ³¨å†Œæ•°é‡',
                interests: 'å…´è¶£çˆ±å¥½',
                notifications: 'é€šçŸ¥è®¾ç½®',
                agreement: 'åè®®åŒæ„',
                referralCode: 'æ¨èç ',
                avatar: 'å¤´åƒæ–‡ä»¶',
                registrationTime: 'æ³¨å†Œæ—¶é—´'
            };
            return labels[key] || key;
        }

        // é‡ç½®è¡¨å•
        function resetForm() {
            modal.confirm('ç¡®å®šè¦é‡ç½®è¡¨å•å—ï¼Ÿæ‰€æœ‰æ•°æ®å°†ä¸¢å¤±ã€‚').then(confirmed => {
                if (confirmed) {
                    document.getElementById('registrationForm').reset();
                    
                    // é‡ç½®æ’ä»¶
                    genderSelect.setValue('');
                    userTypeSelect.setValue('');
                    birthDatePicker.setValue('');
                    quantityInput.setValue(1);
                    
                    // é‡ç½®å¤é€‰æ¡†
                    interestsCheckbox.checkboxes.forEach(cb => cb.setChecked(false));
                    notificationCheckbox.checkboxes.forEach(cb => cb.setChecked(false));
                                         agreementCheckbox.setChecked(false);

                    // æ¸…é™¤æ–‡ä»¶é¢„è§ˆ
                    document.getElementById('filePreview').classList.remove('show');
                    avatarFile = null;

                    // éšè—ç»“æœ
                    document.getElementById('resultContainer').classList.remove('show');

                    // æ¸…é™¤éªŒè¯çŠ¶æ€
                    document.querySelectorAll('.form-control').forEach(input => {
                        input.classList.remove('error', 'success');
                    });
                    document.querySelectorAll('.error-message').forEach(error => {
                        error.classList.remove('show');
                    });

                    notification.info('è¡¨å•å·²é‡ç½®');
                }
            });
        }

        // ç”Ÿæˆæ¼”ç¤ºæ•°æ®
        function generateDemoData() {
            const demoData = {
                username: 'demo_user_' + Math.floor(Math.random() * 1000),
                email: `demo${Math.floor(Math.random() * 1000)}@example.com`,
                password: 'DemoPass123!',
                fullName: 'æ¼”ç¤ºç”¨æˆ·',
                phone: '13800138000'
            };

            // å¡«å……è¡¨å•
            document.getElementById('username').value = demoData.username;
            document.getElementById('email').value = demoData.email;
            document.getElementById('password').value = demoData.password;
            document.getElementById('confirmPassword').value = demoData.password;
            document.getElementById('fullName').value = demoData.fullName;
            document.getElementById('phone').value = demoData.phone;

            // è®¾ç½®æ’ä»¶å€¼
            genderSelect.setValue('male');
            userTypeSelect.setValue('personal');
                         birthDatePicker.setValue('1990-01-01T00:00:00');
            quantityInput.setValue(1);

            // è®¾ç½®å¤é€‰æ¡†
            interestsCheckbox.checkboxes[0].setChecked(true);
            interestsCheckbox.checkboxes[2].setChecked(true);
            notificationCheckbox.checkboxes[0].setChecked(true);
            notificationCheckbox.checkboxes[2].setChecked(true);
                         agreementCheckbox.setChecked(true);

            // è§¦å‘éªŒè¯
            validateUsername();
            validateEmail();
            validatePassword();
            validateConfirmPassword();
            validateFullName();
            validatePhone();

            notification.success('æ¼”ç¤ºæ•°æ®å·²ç”Ÿæˆ');
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>

</html>