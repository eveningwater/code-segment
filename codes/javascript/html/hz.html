<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ€§èƒ½æµ‹è¯•ä¸åŸºå‡†æµ‹è¯•ç³»ç»Ÿ - hzå‡½æ•°å®æˆ˜ç¤ºä¾‹</title>
    <link rel="stylesheet" href="../../demo/plugins/modal/style.css">
    <link rel="stylesheet" href="../../demo/plugins/notification/style.css">
    <link rel="stylesheet" href="../../demo/plugins/select/style.css">
    <link rel="stylesheet" href="../../demo/plugins/checkbox/style.css">
    <link rel="stylesheet" href="../../demo/plugins/datetime-picker/style.css">
    <link rel="stylesheet" href="../../demo/plugins/input-number/style.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .control-panel {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #e9ecef;
            margin-bottom: 30px;
        }

        .control-section {
            margin-bottom: 25px;
        }

        .control-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.1em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 0.9em;
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 14px;
            margin: 5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(40, 167, 69, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
            color: #212529;
        }

        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 193, 7, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #e74c3c 100%);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(220, 53, 69, 0.4);
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 25px;
            transition: all 0.3s ease;
        }

        .card:hover {
            border-color: #667eea;
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .card-icon {
            font-size: 1.5em;
        }

        .card-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #333;
        }

        .performance-chart {
            height: 200px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            position: relative;
            overflow: hidden;
        }

        .chart-bar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 4px;
            transition: all 0.3s ease;
            position: relative;
            margin-bottom: 5px;
        }

        .chart-bar:hover {
            transform: scaleY(1.05);
        }

        .chart-label {
            font-size: 0.8em;
            color: #666;
            margin-bottom: 5px;
        }

        .chart-value {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            color: white;
            font-weight: bold;
            font-size: 0.9em;
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .results-table th,
        .results-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        .results-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }

        .results-table tr:hover {
            background: #f8f9fa;
        }

        .performance-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .badge-excellent {
            background: #d4edda;
            color: #155724;
        }

        .badge-good {
            background: #d1ecf1;
            color: #0c5460;
        }

        .badge-average {
            background: #fff3cd;
            color: #856404;
        }

        .badge-poor {
            background: #f8d7da;
            color: #721c24;
        }

        .real-time-monitor {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 300px;
            overflow-y: auto;
        }

        .monitor-entry {
            margin-bottom: 8px;
            padding: 5px 0;
            border-bottom: 1px solid #4a5568;
        }

        .monitor-time {
            color: #a0aec0;
            margin-right: 10px;
        }

        .monitor-level-info {
            color: #63b3ed;
        }

        .monitor-level-success {
            color: #68d391;
        }

        .monitor-level-warning {
            color: #f6ad55;
        }

        .monitor-level-error {
            color: #fc8181;
        }

        .algorithm-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .algorithm-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            transition: all 0.3s ease;
        }

        .algorithm-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .algorithm-card.selected {
            border-color: #667eea;
            background: #f0f2ff;
        }

        .algorithm-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .algorithm-checkbox-container {
            min-width: 20px;
        }

        .algorithm-name {
            font-weight: 600;
            color: #333;
        }

        .algorithm-description {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 10px;
        }

        .algorithm-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.8em;
            color: #999;
        }

        .progress-container {
            background: #e9ecef;
            border-radius: 10px;
            height: 8px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s ease;
        }

        .comparison-chart {
            height: 300px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
        }

        .chart-container {
            height: 100%;
            display: flex;
            align-items: end;
            gap: 10px;
            padding: 20px 0;
        }

        .chart-column {
            flex: 1;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 4px 4px 0 0;
            position: relative;
            transition: all 0.3s ease;
        }

        .chart-column:hover {
            transform: scaleY(1.05);
        }

        .chart-column-label {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8em;
            color: #666;
            white-space: nowrap;
        }

        .chart-column-value {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.9em;
            font-weight: bold;
            color: #333;
        }

        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .controls-grid {
                grid-template-columns: 1fr;
            }
            
            .algorithm-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>âš¡ æ€§èƒ½æµ‹è¯•ä¸åŸºå‡†æµ‹è¯•ç³»ç»Ÿ</h1>
            <p>åŸºäº hz å‡½æ•°çš„å®æˆ˜ç¤ºä¾‹ - ç®—æ³•æ€§èƒ½å¯¹æ¯”ä¸å®æ—¶ç›‘æ§</p>
        </div>

        <div class="content">
            <!-- æ§åˆ¶é¢æ¿ -->
            <div class="control-panel">
                <div class="control-section">
                    <h3>âš™ï¸ æµ‹è¯•é…ç½®</h3>
                    <div class="controls-grid">
                        <div class="form-group">
                            <label>æµ‹è¯•è¿­ä»£æ¬¡æ•°</label>
                            <div id="iterationsInput"></div>
                        </div>
                        <div class="form-group">
                            <label>æ•°æ®è§„æ¨¡</label>
                            <div id="dataSizeInput"></div>
                        </div>
                        <div class="form-group">
                            <label>æµ‹è¯•ç±»å‹</label>
                            <div id="testTypeSelect"></div>
                        </div>
                        <div class="form-group">
                            <label>è¿è¡Œæ¨¡å¼</label>
                            <div id="runModeSelect"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>ç®—æ³•é€‰æ‹©</label>
                        <div class="algorithm-grid" id="algorithmGrid">
                            <!-- ç®—æ³•é€‰æ‹©å¡ç‰‡å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="runPerformanceTest()">å¼€å§‹æ€§èƒ½æµ‹è¯•</button>
                    <button class="btn btn-success" onclick="runComparisonTest()">å¯¹æ¯”æµ‹è¯•</button>
                    <button class="btn btn-warning" onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
                    <button class="btn btn-danger" onclick="exportResults()">å¯¼å‡ºç»“æœ</button>
                </div>
            </div>

            <!-- ä»ªè¡¨æ¿ -->
            <div class="dashboard">
                <!-- æ€§èƒ½æ¦‚è§ˆ -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-icon">ğŸ“Š</span>
                        <span class="card-title">æ€§èƒ½æ¦‚è§ˆ</span>
                    </div>
                    <div class="performance-chart" id="performanceChart">
                        <!-- æ€§èƒ½å›¾è¡¨å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                    </div>
                    <div id="performanceStats">
                        <p><strong>æœ€é«˜æ€§èƒ½ï¼š</strong><span id="maxPerformance">--</span> Hz</p>
                        <p><strong>å¹³å‡æ€§èƒ½ï¼š</strong><span id="avgPerformance">--</span> Hz</p>
                        <p><strong>æœ€ä½æ€§èƒ½ï¼š</strong><span id="minPerformance">--</span> Hz</p>
                    </div>
                </div>

                <!-- å®æ—¶ç›‘æ§ -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-icon">ğŸ“ˆ</span>
                        <span class="card-title">å®æ—¶ç›‘æ§</span>
                    </div>
                    <div class="real-time-monitor" id="realTimeMonitor">
                        <!-- å®æ—¶ç›‘æ§æ—¥å¿—å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                    </div>
                </div>

                <!-- æµ‹è¯•ç»“æœ -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-icon">ğŸ“‹</span>
                        <span class="card-title">æµ‹è¯•ç»“æœ</span>
                    </div>
                    <div id="testResults">
                        <table class="results-table" id="resultsTable">
                            <thead>
                                <tr>
                                    <th>ç®—æ³•</th>
                                    <th>æ€§èƒ½ (Hz)</th>
                                    <th>æ—¶é—´ (ms)</th>
                                    <th>è¯„çº§</th>
                                </tr>
                            </thead>
                            <tbody id="resultsTableBody">
                                <!-- ç»“æœè¡Œå°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- å¯¹æ¯”å›¾è¡¨ -->
            <div class="card">
                <div class="card-header">
                    <span class="card-icon">ğŸ“Š</span>
                    <span class="card-title">æ€§èƒ½å¯¹æ¯”</span>
                </div>
                <div class="comparison-chart" id="comparisonChart">
                    <div class="chart-container" id="chartContainer">
                        <!-- å¯¹æ¯”å›¾è¡¨å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- å¼•å…¥æ’ä»¶ -->
    <script src="../../demo/plugins/modal/index.js"></script>
    <script src="../../demo/plugins/notification/index.js"></script>
    <script src="../../demo/plugins/select/index.js"></script>
    <script src="../../demo/plugins/checkbox/index.js"></script>
    <script src="../../demo/plugins/datetime-picker/index.js"></script>
    <script src="../../demo/plugins/input-number/index.js"></script>

    <script>
        // å…¨å±€å˜é‡
        let modal, notification;
        let iterationsInput, dataSizeInput, testTypeSelect, runModeSelect;
        let selectedAlgorithms = [];
        let testResults = [];
        let performanceLog = [];

        // å…¼å®¹æ€§å¤„ç†ï¼šç¡®ä¿ performance.now å¯ç”¨
        const getPerformanceTime = () => {
            if (typeof performance !== 'undefined' && performance.now) {
                return performance.now();
            } else if (typeof Date !== 'undefined' && Date.now) {
                return Date.now();
            } else {
                return new Date().getTime();
            }
        };

        // hz å‡½æ•°
        const hz = (handler, iterations = 100) => {
            const before = getPerformanceTime();
            for (let i = 0; i < iterations; i++) {
                handler();
            }
            const after = getPerformanceTime();
            return 1000 * iterations / (after - before);
        };

        // ç®—æ³•å®šä¹‰
        const algorithms = {
            sumReduce: {
                name: 'Array.reduce()',
                description: 'ä½¿ç”¨ Array.reduce() æ–¹æ³•æ±‚å’Œ',
                handler: (data) => data.reduce((acc, n) => acc + n, 0),
                category: 'functional'
            },
            sumForLoop: {
                name: 'For å¾ªç¯',
                description: 'ä½¿ç”¨ä¼ ç»Ÿ for å¾ªç¯æ±‚å’Œ',
                handler: (data) => {
                    let sum = 0;
                    for (let i = 0; i < data.length; i++) sum += data[i];
                    return sum;
                },
                category: 'imperative'
            },
            sumForEach: {
                name: 'Array.forEach()',
                description: 'ä½¿ç”¨ Array.forEach() æ–¹æ³•æ±‚å’Œ',
                handler: (data) => {
                    let sum = 0;
                    data.forEach(n => sum += n);
                    return sum;
                },
                category: 'functional'
            },
            sumForOf: {
                name: 'For...of å¾ªç¯',
                description: 'ä½¿ç”¨ for...of å¾ªç¯æ±‚å’Œ',
                handler: (data) => {
                    let sum = 0;
                    for (const n of data) sum += n;
                    return sum;
                },
                category: 'modern'
            },
            sumWhile: {
                name: 'While å¾ªç¯',
                description: 'ä½¿ç”¨ while å¾ªç¯æ±‚å’Œ',
                handler: (data) => {
                    let sum = 0;
                    let i = 0;
                    while (i < data.length) {
                        sum += data[i];
                        i++;
                    }
                    return sum;
                },
                category: 'imperative'
            },
            sumRecursive: {
                name: 'é€’å½’æ±‚å’Œ',
                description: 'ä½¿ç”¨é€’å½’æ–¹æ³•æ±‚å’Œ',
                handler: (data) => {
                    const sumRec = (arr, index = 0) => {
                        if (index >= arr.length) return 0;
                        return arr[index] + sumRec(arr, index + 1);
                    };
                    return sumRec(data);
                },
                category: 'functional'
            },
            sortBubble: {
                name: 'å†’æ³¡æ’åº',
                description: 'ä½¿ç”¨å†’æ³¡æ’åºç®—æ³•',
                handler: (data) => [...data].sort((a, b) => a - b),
                category: 'sorting'
            },
            sortQuick: {
                name: 'å¿«é€Ÿæ’åº',
                description: 'ä½¿ç”¨å¿«é€Ÿæ’åºç®—æ³•',
                handler: (data) => {
                    const quickSort = (arr) => {
                        if (arr.length <= 1) return arr;
                        const pivot = arr[Math.floor(arr.length / 2)];
                        const left = arr.filter(x => x < pivot);
                        const middle = arr.filter(x => x === pivot);
                        const right = arr.filter(x => x > pivot);
                        return [...quickSort(left), ...middle, ...quickSort(right)];
                    };
                    return quickSort([...data]);
                },
                category: 'sorting'
            },
            filterEven: {
                name: 'è¿‡æ»¤å¶æ•°',
                description: 'è¿‡æ»¤æ•°ç»„ä¸­çš„å¶æ•°',
                handler: (data) => data.filter(n => n % 2 === 0),
                category: 'filtering'
            },
            mapSquare: {
                name: 'å¹³æ–¹æ˜ å°„',
                description: 'å°†æ•°ç»„å…ƒç´ å¹³æ–¹',
                handler: (data) => data.map(n => n * n),
                category: 'transformation'
            }
        };

        // åˆå§‹åŒ–åº”ç”¨
        function initApp() {
            // åˆå§‹åŒ–æ’ä»¶
            modal = new Modal();
            notification = new Notification({ position: 'top-right' });

            // åˆå§‹åŒ–è¾“å…¥æ§ä»¶
            iterationsInput = new InputNumber({
                container: document.getElementById('iterationsInput'),
                min: 10,
                max: 10000,
                value: 100,
                step: 10
            });

            dataSizeInput = new InputNumber({
                container: document.getElementById('dataSizeInput'),
                min: 100,
                max: 100000,
                value: 10000,
                step: 1000
            });

            testTypeSelect = new Select({
                container: document.getElementById('testTypeSelect'),
                options: [
                    { value: 'single', label: 'å•æ¬¡æµ‹è¯•' },
                    { value: 'multiple', label: 'å¤šæ¬¡æµ‹è¯•' },
                    { value: 'stress', label: 'å‹åŠ›æµ‹è¯•' }
                ],
                placeholder: 'é€‰æ‹©æµ‹è¯•ç±»å‹'
            });

            runModeSelect = new Select({
                container: document.getElementById('runModeSelect'),
                options: [
                    { value: 'sync', label: 'åŒæ­¥æ¨¡å¼' },
                    { value: 'async', label: 'å¼‚æ­¥æ¨¡å¼' },
                    { value: 'webworker', label: 'Web Worker' }
                ],
                placeholder: 'é€‰æ‹©è¿è¡Œæ¨¡å¼'
            });

            // ç”Ÿæˆç®—æ³•é€‰æ‹©ç½‘æ ¼
            generateAlgorithmGrid();

            // åˆå§‹åŒ–ç•Œé¢
            addMonitorLog('info', 'ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
        }

        // ç”Ÿæˆç®—æ³•é€‰æ‹©ç½‘æ ¼
        function generateAlgorithmGrid() {
            const container = document.getElementById('algorithmGrid');
            
            Object.entries(algorithms).forEach(([key, algorithm]) => {
                const card = document.createElement('div');
                card.className = 'algorithm-card';
                card.id = `card-${key}`;
                
                card.innerHTML = `
                    <div class="algorithm-header">
                        <div class="algorithm-checkbox-container" id="checkbox-container-${key}"></div>
                        <span class="algorithm-name">${algorithm.name}</span>
                    </div>
                    <div class="algorithm-description">${algorithm.description}</div>
                    <div class="algorithm-stats">
                        <span>ç±»åˆ«: ${algorithm.category}</span>
                        <span>æ€§èƒ½: -- Hz</span>
                    </div>
                `;
                
                container.appendChild(card);
                
                // åˆ›å»ºè‡ªå®šä¹‰ checkbox
                const checkbox = new Checkbox({
                    label: '',
                    checked: false,
                    onChange: (checked) => {
                        if (checked) {
                            selectedAlgorithms.push(key);
                            card.classList.add('selected');
                        } else {
                            selectedAlgorithms = selectedAlgorithms.filter(k => k !== key);
                            card.classList.remove('selected');
                        }
                    }
                });
                checkbox.mount(document.getElementById(`checkbox-container-${key}`));
            });
        }

        // åˆ‡æ¢ç®—æ³•é€‰æ‹© - å·²åºŸå¼ƒï¼Œç°åœ¨é€šè¿‡ checkbox onChange å¤„ç†
        function toggleAlgorithm(key, card) {
            // è¿™ä¸ªæ–¹æ³•ç°åœ¨ç”± checkbox onChange å¤„ç†
        }

        // è¿è¡Œæ€§èƒ½æµ‹è¯•
        function runPerformanceTest() {
            if (selectedAlgorithms.length === 0) {
                notification.error('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªç®—æ³•è¿›è¡Œæµ‹è¯•');
                return;
            }

            const iterations = iterationsInput.getValue();
            const dataSize = dataSizeInput.getValue();
            const testType = testTypeSelect.getValue();
            const runMode = runModeSelect.getValue();

            addMonitorLog('info', `å¼€å§‹æ€§èƒ½æµ‹è¯• - è¿­ä»£æ¬¡æ•°: ${iterations}, æ•°æ®è§„æ¨¡: ${dataSize}`);

            // ç”Ÿæˆæµ‹è¯•æ•°æ®
            const testData = Array(dataSize).fill().map((_, i) => i);
            testResults = [];

            // æ‰§è¡Œæµ‹è¯•
            let completedTests = 0;
            selectedAlgorithms.forEach((algorithmKey, index) => {
                setTimeout(() => {
                    const algorithm = algorithms[algorithmKey];
                    const startTime = getPerformanceTime();
                    
                    try {
                        // ä¿®å¤ï¼šåˆ›å»ºæ­£ç¡®çš„æµ‹è¯•å‡½æ•°ï¼Œå°† testData ä¼ é€’ç»™ç®—æ³•
                        const testFunction = () => {
                            const result = algorithm.handler(testData);
                            // ç¡®ä¿ç®—æ³•è¿”å›äº†æœ‰æ•ˆç»“æœ
                            if (result === undefined || result === null) {
                                throw new Error('ç®—æ³•è¿”å›äº†æ— æ•ˆç»“æœ');
                            }
                            return result;
                        };
                        
                        const performance = hz(testFunction, iterations);
                        const endTime = getPerformanceTime();
                        const executionTime = endTime - startTime;

                        const result = {
                            name: algorithm.name,
                            key: algorithmKey,
                            performance: Math.round(performance),
                            executionTime: Math.round(executionTime),
                            rating: getPerformanceRating(performance),
                            category: algorithm.category
                        };

                        testResults.push(result);
                        addMonitorLog('success', `${algorithm.name}: ${performance.toFixed(0)} Hz`);

                        // æ›´æ–°ç®—æ³•å¡ç‰‡
                        updateAlgorithmCard(algorithmKey, performance);

                        completedTests++;
                        
                        // è°ƒè¯•ä¿¡æ¯
                        console.log(`æµ‹è¯•å®Œæˆ: ${algorithm.name}, æ€§èƒ½: ${performance}, å·²å®Œæˆ: ${completedTests}/${selectedAlgorithms.length}`);
                        
                        // å¦‚æœæ˜¯æœ€åä¸€ä¸ªç®—æ³•ï¼Œæ›´æ–°ç•Œé¢
                        if (completedTests === selectedAlgorithms.length) {
                            updateResults();
                            updatePerformanceChart();
                            updateComparisonChart();
                            addMonitorLog('info', `æ€§èƒ½æµ‹è¯•å®Œæˆï¼Œå…±æµ‹è¯• ${testResults.length} ä¸ªç®—æ³•`);
                            notification.success(`æ€§èƒ½æµ‹è¯•å®Œæˆï¼Œå…±æµ‹è¯• ${testResults.length} ä¸ªç®—æ³•`);
                            
                            // è°ƒè¯•ä¿¡æ¯
                            console.log('æµ‹è¯•ç»“æœæ•°ç»„:', testResults);
                            console.log('æµ‹è¯•ç»“æœæ•°é‡:', testResults.length);
                        }
                    } catch (error) {
                        addMonitorLog('error', `${algorithm.name}: æµ‹è¯•å¤±è´¥ - ${error.message}`);
                        console.error(`æµ‹è¯•å¤±è´¥: ${algorithm.name}`, error);
                        completedTests++;
                        
                        // å³ä½¿æœ‰é”™è¯¯ä¹Ÿè¦æ£€æŸ¥æ˜¯å¦æ‰€æœ‰æµ‹è¯•éƒ½å®Œæˆäº†
                        if (completedTests === selectedAlgorithms.length) {
                            updateResults();
                            updatePerformanceChart();
                            updateComparisonChart();
                            addMonitorLog('info', `æ€§èƒ½æµ‹è¯•å®Œæˆï¼Œå…±æµ‹è¯• ${testResults.length} ä¸ªç®—æ³•`);
                            notification.success(`æ€§èƒ½æµ‹è¯•å®Œæˆï¼Œå…±æµ‹è¯• ${testResults.length} ä¸ªç®—æ³•`);
                        }
                    }
                }, index * 500);
            });
        }

        // è¿è¡Œå¯¹æ¯”æµ‹è¯•
        function runComparisonTest() {
            console.log('å¯¹æ¯”æµ‹è¯• - testResults æ•°ç»„:', testResults);
            console.log('å¯¹æ¯”æµ‹è¯• - testResults é•¿åº¦:', testResults.length);
            
            if (testResults.length === 0) {
                notification.error('è¯·å…ˆè¿è¡Œæ€§èƒ½æµ‹è¯•');
                addMonitorLog('error', 'testResults æ•°ç»„ä¸ºç©ºï¼Œè¯·å…ˆè¿è¡Œæ€§èƒ½æµ‹è¯•');
                return;
            }

            addMonitorLog('info', 'å¼€å§‹æ·±åº¦å¯¹æ¯”æµ‹è¯•...');

            // 1. æŒ‰ç±»åˆ«åˆ†ç»„å¯¹æ¯”
            const categories = {};
            testResults.forEach(result => {
                if (!categories[result.category]) {
                    categories[result.category] = [];
                }
                categories[result.category].push(result);
            });

            // 2. æ‰¾å‡ºæ¯ä¸ªç±»åˆ«çš„æœ€ä½³ç®—æ³•
            const categoryBests = {};
            Object.entries(categories).forEach(([category, results]) => {
                const best = results.reduce((max, current) => 
                    current.performance > max.performance ? current : max
                );
                categoryBests[category] = best;
                addMonitorLog('success', `${category} ç±»åˆ«æœ€ä½³: ${best.name} (${best.performance.toLocaleString()} Hz)`);
            });

            // 3. æ‰¾å‡ºå…¨å±€æœ€ä½³ç®—æ³•
            const globalBest = testResults.reduce((max, current) => 
                current.performance > max.performance ? current : max
            );
            addMonitorLog('success', `ğŸ† å…¨å±€æœ€ä½³: ${globalBest.name} (${globalBest.performance.toLocaleString()} Hz)`);

            // 4. æ€§èƒ½å·®å¼‚åˆ†æ
            const sortedResults = [...testResults].sort((a, b) => b.performance - a.performance);
            const bestPerformance = sortedResults[0].performance;
            
            sortedResults.forEach((result, index) => {
                const performanceDiff = ((bestPerformance - result.performance) / bestPerformance * 100).toFixed(1);
                const rank = index + 1;
                const rankEmoji = rank === 1 ? 'ğŸ¥‡' : rank === 2 ? 'ğŸ¥ˆ' : rank === 3 ? 'ğŸ¥‰' : `${rank}.`;
                
                addMonitorLog('info', `${rankEmoji} ${result.name}: ${result.performance.toLocaleString()} Hz (æ¯”æœ€ä½³æ…¢ ${performanceDiff}%)`);
            });

            // 5. ç±»åˆ«æ€§èƒ½å¯¹æ¯”
            const categoryAverages = {};
            Object.entries(categories).forEach(([category, results]) => {
                const avgPerformance = results.reduce((sum, r) => sum + r.performance, 0) / results.length;
                categoryAverages[category] = avgPerformance;
                addMonitorLog('info', `ğŸ“Š ${category} ç±»åˆ«å¹³å‡æ€§èƒ½: ${avgPerformance.toFixed(0)} Hz`);
            });

            // 6. æ€§èƒ½åˆ†å¸ƒåˆ†æ
            const performances = testResults.map(r => r.performance);
            const avgPerformance = performances.reduce((a, b) => a + b, 0) / performances.length;
            const aboveAverage = testResults.filter(r => r.performance > avgPerformance).length;
            const belowAverage = testResults.length - aboveAverage;
            
            addMonitorLog('info', `ğŸ“ˆ æ€§èƒ½åˆ†å¸ƒ: ${aboveAverage} ä¸ªç®—æ³•é«˜äºå¹³å‡æ°´å¹³, ${belowAverage} ä¸ªç®—æ³•ä½äºå¹³å‡æ°´å¹³`);

            // 7. æ˜¾ç¤ºå¯¹æ¯”ç»“æœå¼¹çª—
            showComparisonResults({
                globalBest,
                categoryBests,
                categoryAverages,
                sortedResults,
                performanceStats: {
                    total: testResults.length,
                    aboveAverage,
                    belowAverage,
                    bestPerformance,
                    avgPerformance
                }
            });

            notification.success('æ·±åº¦å¯¹æ¯”æµ‹è¯•å®Œæˆ');
        }

        // æ˜¾ç¤ºå¯¹æ¯”ç»“æœå¼¹çª—
        function showComparisonResults(data) {
            const { globalBest, categoryBests, categoryAverages, sortedResults, performanceStats } = data;
            
            const content = `
                <div style="max-width: 600px; max-height: 500px; overflow-y: auto;">
                    <h3 style="color: #667eea; margin-bottom: 20px;">ğŸ† æ€§èƒ½å¯¹æ¯”åˆ†ææŠ¥å‘Š</h3>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #333; margin-bottom: 10px;">ğŸ¥‡ å…¨å±€æœ€ä½³ç®—æ³•</h4>
                        <div style="background: #f0f8ff; padding: 15px; border-radius: 8px; border-left: 4px solid #667eea;">
                            <strong>${globalBest.name}</strong><br>
                            æ€§èƒ½: <span style="color: #667eea; font-weight: bold;">${globalBest.performance.toLocaleString()} Hz</span><br>
                            ç±»åˆ«: ${globalBest.category}<br>
                            è¯„çº§: <span class="performance-badge ${globalBest.rating.class}">${globalBest.rating.text}</span>
                        </div>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #333; margin-bottom: 10px;">ğŸ“Š ç±»åˆ«æœ€ä½³ç®—æ³•</h4>
                        ${Object.entries(categoryBests).map(([category, best]) => `
                            <div style="background: #f8f9fa; padding: 10px; margin-bottom: 8px; border-radius: 6px;">
                                <strong>${category}</strong>: ${best.name} (${best.performance.toLocaleString()} Hz)
                            </div>
                        `).join('')}
                    </div>

                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #333; margin-bottom: 10px;">ğŸ“ˆ æ€§èƒ½æ’å</h4>
                        ${sortedResults.slice(0, 5).map((result, index) => {
                            const rankEmoji = index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : `${index + 1}.`;
                            const performanceDiff = ((performanceStats.bestPerformance - result.performance) / performanceStats.bestPerformance * 100).toFixed(1);
                            return `
                                <div style="background: #f8f9fa; padding: 8px; margin-bottom: 5px; border-radius: 4px;">
                                    ${rankEmoji} ${result.name}: ${result.performance.toLocaleString()} Hz 
                                    ${index > 0 ? `<span style="color: #666;">(æ…¢ ${performanceDiff}%)</span>` : ''}
                                </div>
                            `;
                        }).join('')}
                    </div>

                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #333; margin-bottom: 10px;">ğŸ“Š ç»Ÿè®¡æ‘˜è¦</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <div style="background: #e8f5e8; padding: 10px; border-radius: 6px; text-align: center;">
                                <div style="font-size: 1.2em; font-weight: bold; color: #28a745;">${performanceStats.aboveAverage}</div>
                                <div style="font-size: 0.9em; color: #666;">é«˜äºå¹³å‡</div>
                            </div>
                            <div style="background: #fff3cd; padding: 10px; border-radius: 6px; text-align: center;">
                                <div style="font-size: 1.2em; font-weight: bold; color: #ffc107;">${performanceStats.belowAverage}</div>
                                <div style="font-size: 0.9em; color: #666;">ä½äºå¹³å‡</div>
                            </div>
                        </div>
                    </div>

                    <div style="text-align: center; margin-top: 20px;">
                        <button onclick="exportComparisonReport(${JSON.stringify(data).replace(/"/g, '&quot;')})" 
                                style="background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">
                            å¯¼å‡ºå¯¹æ¯”æŠ¥å‘Š
                        </button>
                    </div>
                </div>
            `;

            modal.alert(content, 'æ€§èƒ½å¯¹æ¯”åˆ†æ');
        }

        // å¯¼å‡ºå¯¹æ¯”æŠ¥å‘Š
        function exportComparisonReport(data) {
            const report = {
                timestamp: new Date().toISOString(),
                summary: {
                    globalBest: data.globalBest,
                    categoryBests: data.categoryBests,
                    performanceStats: data.performanceStats
                },
                detailedResults: data.sortedResults,
                categoryAverages: data.categoryAverages
            };

            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `comparison-report-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);

            addMonitorLog('info', 'å¯¹æ¯”æŠ¥å‘Šå·²å¯¼å‡º');
            notification.success('å¯¹æ¯”æŠ¥å‘Šå·²å¯¼å‡º');
        }

        // è·å–æ€§èƒ½è¯„çº§
        function getPerformanceRating(performance) {
            if (performance >= 10000) return { text: 'ä¼˜ç§€', class: 'badge-excellent' };
            if (performance >= 5000) return { text: 'è‰¯å¥½', class: 'badge-good' };
            if (performance >= 1000) return { text: 'ä¸€èˆ¬', class: 'badge-average' };
            return { text: 'è¾ƒå·®', class: 'badge-poor' };
        }

        // æ›´æ–°ç®—æ³•å¡ç‰‡
        function updateAlgorithmCard(key, performance) {
            const card = document.getElementById(`card-${key}`);
            const stats = card.querySelector('.algorithm-stats');
            stats.innerHTML = `
                <span>ç±»åˆ«: ${algorithms[key].category}</span>
                <span>æ€§èƒ½: ${performance.toFixed(0)} Hz</span>
            `;
        }

        // æ›´æ–°ç»“æœè¡¨æ ¼
        function updateResults() {
            const tbody = document.getElementById('resultsTableBody');
            tbody.innerHTML = '';

            testResults.forEach(result => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${result.name}</td>
                    <td>${result.performance.toLocaleString()}</td>
                    <td>${result.executionTime}</td>
                    <td><span class="performance-badge ${result.rating.class}">${result.rating.text}</span></td>
                `;
                tbody.appendChild(row);
            });

            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            const performances = testResults.map(r => r.performance);
            document.getElementById('maxPerformance').textContent = Math.max(...performances).toLocaleString();
            document.getElementById('avgPerformance').textContent = Math.round(performances.reduce((a, b) => a + b, 0) / performances.length).toLocaleString();
            document.getElementById('minPerformance').textContent = Math.min(...performances).toLocaleString();
        }

        // æ›´æ–°æ€§èƒ½å›¾è¡¨
        function updatePerformanceChart() {
            const container = document.getElementById('performanceChart');
            container.innerHTML = '';

            const maxPerformance = Math.max(...testResults.map(r => r.performance));

            testResults.forEach(result => {
                const percentage = (result.performance / maxPerformance) * 100;
                
                const bar = document.createElement('div');
                bar.className = 'chart-bar';
                bar.style.height = `${percentage}%`;
                bar.style.width = '100%';
                
                const label = document.createElement('div');
                label.className = 'chart-label';
                label.textContent = result.name;
                
                const value = document.createElement('div');
                value.className = 'chart-value';
                value.textContent = result.performance.toLocaleString();
                
                bar.appendChild(value);
                container.appendChild(label);
                container.appendChild(bar);
            });
        }

        // æ›´æ–°å¯¹æ¯”å›¾è¡¨
        function updateComparisonChart() {
            const container = document.getElementById('chartContainer');
            container.innerHTML = '';

            const maxPerformance = Math.max(...testResults.map(r => r.performance));

            testResults.forEach(result => {
                const percentage = (result.performance / maxPerformance) * 100;
                
                const column = document.createElement('div');
                column.className = 'chart-column';
                column.style.height = `${percentage}%`;
                
                const label = document.createElement('div');
                label.className = 'chart-column-label';
                label.textContent = result.name;
                
                const value = document.createElement('div');
                value.className = 'chart-column-value';
                value.textContent = result.performance.toLocaleString();
                
                column.appendChild(label);
                column.appendChild(value);
                container.appendChild(column);
            });
        }

        // æ·»åŠ ç›‘æ§æ—¥å¿—
        function addMonitorLog(level, message) {
            const timestamp = new Date();
            const logEntry = {
                time: timestamp,
                level: level,
                message: message
            };
            
            performanceLog.unshift(logEntry);
            if (performanceLog.length > 50) {
                performanceLog.pop();
            }
            
            updateMonitorDisplay();
        }

        // æ›´æ–°ç›‘æ§æ˜¾ç¤º
        function updateMonitorDisplay() {
            const container = document.getElementById('realTimeMonitor');
            
            container.innerHTML = performanceLog.map(entry => `
                <div class="monitor-entry">
                    <span class="monitor-time">${formatDateTime(entry.time)}</span>
                    <span class="monitor-level-${entry.level}">[${entry.level.toUpperCase()}]</span>
                    <span>${entry.message}</span>
                </div>
            `).join('');
        }

        // æ¸…é™¤ç»“æœ
        function clearResults() {
            modal.confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æµ‹è¯•ç»“æœå—ï¼Ÿ').then(confirmed => {
                if (confirmed) {
                    testResults = [];
                    performanceLog = [];
                    selectedAlgorithms = [];
                    
                    // æ¸…é™¤é€‰æ‹©
                    selectedAlgorithms = [];
                    document.querySelectorAll('.algorithm-card').forEach(card => {
                        card.classList.remove('selected');
                    });
                    // é‡æ–°ç”Ÿæˆç®—æ³•ç½‘æ ¼ä»¥é‡ç½® checkbox çŠ¶æ€
                    document.getElementById('algorithmGrid').innerHTML = '';
                    generateAlgorithmGrid();
                    
                    // æ¸…é™¤æ˜¾ç¤º
                    document.getElementById('resultsTableBody').innerHTML = '';
                    document.getElementById('performanceChart').innerHTML = '';
                    document.getElementById('chartContainer').innerHTML = '';
                    document.getElementById('realTimeMonitor').innerHTML = '';
                    
                    // é‡ç½®ç»Ÿè®¡
                    document.getElementById('maxPerformance').textContent = '--';
                    document.getElementById('avgPerformance').textContent = '--';
                    document.getElementById('minPerformance').textContent = '--';
                    
                    addMonitorLog('info', 'æ‰€æœ‰ç»“æœå·²æ¸…é™¤');
                    notification.success('æ‰€æœ‰ç»“æœå·²æ¸…é™¤');
                }
            });
        }

        // å¯¼å‡ºç»“æœ
        function exportResults() {
            if (testResults.length === 0) {
                notification.error('æ²¡æœ‰å¯å¯¼å‡ºçš„ç»“æœ');
                return;
            }

            const exportData = {
                timestamp: new Date().toISOString(),
                testConfig: {
                    iterations: iterationsInput.getValue(),
                    dataSize: dataSizeInput.getValue(),
                    testType: testTypeSelect.getValue(),
                    runMode: runModeSelect.getValue()
                },
                results: testResults,
                log: performanceLog
            };

            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `performance-test-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);

            addMonitorLog('info', 'ç»“æœå·²å¯¼å‡º');
            notification.success('ç»“æœå·²å¯¼å‡º');
        }

        // æ ¼å¼åŒ–æ—¥æœŸæ—¶é—´
        function formatDateTime(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            const seconds = String(date.getSeconds()).padStart(2, '0');
            return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', initApp);

        // å…¨å±€è°ƒè¯•å‡½æ•°
        window.debugPerformanceTest = function() {
            console.log('=== æ€§èƒ½æµ‹è¯•è°ƒè¯•ä¿¡æ¯ ===');
            console.log('é€‰ä¸­çš„ç®—æ³•:', selectedAlgorithms);
            console.log('æµ‹è¯•ç»“æœ:', testResults);
            console.log('æµ‹è¯•ç»“æœæ•°é‡:', testResults.length);
            console.log('æ€§èƒ½æ—¥å¿—æ•°é‡:', performanceLog.length);
            console.log('=======================');
        };

        // æµ‹è¯• hz å‡½æ•°æ˜¯å¦æ­£å¸¸å·¥ä½œ
        window.testHzFunction = function() {
            console.log('=== æµ‹è¯• hz å‡½æ•° ===');
            console.log('æ€§èƒ½APIå¯ç”¨æ€§æ£€æŸ¥:');
            console.log('- performance:', typeof performance);
            console.log('- performance.now:', typeof performance?.now);
            console.log('- Date.now:', typeof Date?.now);
            
            const testData = [1, 2, 3, 4, 5];
            const testFunction = () => testData.reduce((a, b) => a + b, 0);
            const performance = hz(testFunction, 100);
            console.log('hz å‡½æ•°æµ‹è¯•ç»“æœ:', performance);
            console.log('==================');
            return performance;
        };
    </script>
</body>

</html>