<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ€å°æ—¥æœŸæŸ¥æ‰¾å¹³å° - minDate</title>
    <link rel="stylesheet" href="../../demo/plugins/modal/style.css">
    <link rel="stylesheet" href="../../demo/plugins/checkbox/style.css">
    <link rel="stylesheet" href="../../demo/plugins/notification/style.css">
    <link rel="stylesheet" href="../../demo/plugins/datetime-picker/style.css">
    <link rel="stylesheet" href="../../demo/plugins/input-number/style.css">
    <!-- Highlight.js ä»£ç é«˜äº® -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            min-height: 100vh;
            color: #1f2937;
            line-height: 1.6;
            padding-bottom: 40px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 36px;
            color: white;
        }

        .header h1 {
            font-size: 2.7rem;
            margin-bottom: 12px;
            font-weight: 800;
            text-shadow: 0 3px 8px rgba(15, 23, 42, 0.35);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.95;
            max-width: 900px;
            margin: 0 auto;
        }

        .main-content {
            display: grid;
            grid-template-columns: 480px 1fr;
            gap: 26px;
            margin-bottom: 28px;
        }

        .card {
            background: rgba(255, 255, 255, 0.97);
            border-radius: 20px;
            padding: 26px;
            box-shadow: 0 14px 32px rgba(15, 23, 42, 0.15);
            margin-bottom: 10px;
        }

        .card h2 {
            font-size: 1.55rem;
            margin-bottom: 20px;
            color: #1f2937;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .input-section {
            margin-bottom: 22px;
        }

        .input-group {
            margin-bottom: 18px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
            font-size: 0.98rem;
        }

        .input-field,
        .textarea-field {
            width: 100%;
            padding: 14px;
            border: 2px solid #e5e7eb;
            border-radius: 14px;
            font-size: 1.05rem;
            font-family: 'Monaco', 'Menlo', monospace;
            transition: all 0.25s ease;
        }

        .textarea-field {
            min-height: 100px;
            resize: vertical;
        }

        .input-field:focus,
        .textarea-field:focus {
            outline: none;
            border-color: #a8edea;
            box-shadow: 0 0 0 3px rgba(168, 237, 234, 0.25);
        }

        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 16px;
        }

        .btn {
            padding: 12px 22px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #a8edea, #fed6e3);
            color: #1f2937;
        }

        .btn-success {
            background: linear-gradient(135deg, #22c55e, #15803d);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #fbbf24, #d97706);
            color: white;
        }

        .btn-info {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #b91c1c);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(168, 237, 234, 0.3);
        }

        .btn:active {
            transform: scale(0.97);
        }

        .btn-block {
            width: 100%;
            justify-content: center;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        .date-list {
            background: #f8fafc;
            border-radius: 18px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .date-item {
            background: white;
            border-radius: 14px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 4px 12px rgba(15, 23, 42, 0.1);
            border-left: 4px solid #a8edea;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .date-item.min {
            border-left-color: #3b82f6;
            background: linear-gradient(135deg, #dbeafe, #eff6ff);
            transform: scale(1.02);
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3);
        }

        .date-info {
            flex: 1;
        }

        .date-label {
            font-size: 0.75rem;
            color: #64748b;
            margin-bottom: 6px;
            font-weight: 600;
        }

        .date-value {
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 1rem;
            color: #1f2937;
            margin-bottom: 4px;
        }

        .date-formats {
            font-size: 0.85rem;
            color: #64748b;
        }

        .date-actions {
            display: flex;
            gap: 8px;
        }

        .min-badge {
            display: inline-block;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 700;
            margin-left: 8px;
        }

        .result-display {
            background: #f8fafc;
            border-radius: 18px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .result-card {
            background: linear-gradient(135deg, #e0f2fe, #bae6fd);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            box-shadow: 0 8px 24px rgba(168, 237, 234, 0.2);
        }

        .result-label {
            font-size: 0.9rem;
            color: #0369a1;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .result-value {
            font-size: 2rem;
            font-weight: 800;
            color: #0c4a6e;
            font-family: 'Monaco', 'Menlo', monospace;
            margin-bottom: 8px;
        }

        .result-formats {
            font-size: 0.85rem;
            color: #64748b;
            margin-top: 12px;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        .comparison-card {
            background: white;
            border-radius: 14px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(15, 23, 42, 0.1);
        }

        .comparison-card h4 {
            font-size: 0.95rem;
            color: #a8edea;
            margin-bottom: 10px;
        }

        .comparison-card p {
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9rem;
            color: #475569;
            margin: 4px 0;
        }

        .timeline {
            background: #f8fafc;
            border-radius: 14px;
            padding: 20px;
            margin-top: 16px;
        }

        .timeline-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            margin-bottom: 8px;
            background: white;
            border-radius: 10px;
            border-left: 3px solid #a8edea;
        }

        .timeline-item.min {
            border-left-color: #3b82f6;
            background: linear-gradient(135deg, #dbeafe, #eff6ff);
        }

        .timeline-date {
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9rem;
            color: #1f2937;
            min-width: 150px;
        }

        .timeline-bar {
            flex: 1;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            position: relative;
        }

        .timeline-fill {
            height: 100%;
            background: linear-gradient(90deg, #a8edea, #fed6e3);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .timeline-fill.min {
            background: linear-gradient(90deg, #3b82f6, #2563eb);
        }

        .history-list {
            max-height: 320px;
            overflow-y: auto;
            background: #f1f5f9;
            border-radius: 12px;
            padding: 12px;
        }

        .history-item {
            background: white;
            padding: 14px;
            margin-bottom: 10px;
            border-radius: 12px;
            border-left: 4px solid #a8edea;
            transition: transform 0.2s ease;
        }

        .history-item:hover {
            transform: translateX(4px);
        }

        .history-time {
            font-size: 0.75rem;
            color: #64748b;
            margin-bottom: 6px;
        }

        .history-summary {
            font-family: 'Monaco', monospace;
            font-size: 0.9rem;
            color: #1f2937;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        .stat-card {
            background: white;
            border-radius: 14px;
            padding: 18px;
            text-align: center;
            box-shadow: 0 3px 12px rgba(15, 23, 42, 0.1);
        }

        .stat-number {
            font-size: 1.8rem;
            font-weight: 800;
            color: #a8edea;
        }

        .stat-label {
            font-size: 0.85rem;
            color: #64748b;
            margin-top: 4px;
        }

        .code-block {
            margin-top: 16px;
            border-radius: 12px;
            overflow: hidden;
        }

        .code-block pre {
            margin: 0;
            padding: 20px;
            background: #1e293b;
            overflow-x: auto;
        }

        .empty-state {
            text-align: center;
            padding: 36px 20px;
            color: #64748b;
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 12px;
            opacity: 0.5;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            border-radius: 999px;
            background: linear-gradient(135deg, #a8edea, #fed6e3);
            color: #1f2937;
            font-size: 0.8rem;
            font-weight: 600;
            margin: 4px;
        }

        .date-picker-container {
            margin-bottom: 12px;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 2.2rem;
            }
        }

        .modal-content {
            max-height: 420px;
            overflow-y: auto;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“… æœ€å°æ—¥æœŸæŸ¥æ‰¾å¹³å°</h1>
            <p>åŸºäº minDate å‡½æ•°çš„æ—¥æœŸæœ€å°å€¼æŸ¥æ‰¾å·¥å…·ï¼Œæ”¯æŒå¤šæ—¥æœŸè¾“å…¥ã€å¯è§†åŒ–å±•ç¤ºã€æ—¶é—´çº¿å¯¹æ¯”å’Œå†å²è®°å½•</p>
        </div>

        <div class="main-content">
            <div class="sidebar">
                <div class="card">
                    <h2>ğŸ“ æ—¥æœŸè¾“å…¥</h2>
                    <div class="input-section">
                        <div class="input-group">
                            <label>é€‰æ‹©æ—¥æœŸ</label>
                            <div class="date-picker-container" id="datePickerContainer"></div>
                        </div>
                        <div class="button-group">
                            <button class="btn btn-primary btn-block" onclick="window.minDateTool?.addDate()">â• æ·»åŠ æ—¥æœŸ</button>
                        </div>
                        <div class="button-group">
                            <button class="btn btn-success" onclick="window.minDateTool?.findMin()">âš¡ æŸ¥æ‰¾æœ€å°æ—¥æœŸ</button>
                            <button class="btn btn-info" onclick="window.minDateTool?.loadSample()">ğŸ“„ ç¤ºä¾‹æ•°æ®</button>
                            <button class="btn btn-warning" onclick="window.minDateTool?.generateRandom()">ğŸ² éšæœºç”Ÿæˆ</button>
                            <button class="btn btn-danger" onclick="window.minDateTool?.clearAll()">ğŸ§¹ æ¸…ç©º</button>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2>âš™ï¸ é«˜çº§é€‰é¡¹</h2>
                    <div class="input-section">
                        <div id="checkboxGroup"></div>
                    </div>
                </div>

                <div class="card">
                    <h2>ğŸ—‚ï¸ å†å²è®°å½• (<span id="historyCount">0</span>)</h2>
                    <div class="history-list" id="historyList">
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ“œ</div>
                            <p>æš‚æ— æŸ¥æ‰¾å†å²</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="visualization">
                <div class="card">
                    <h2>ğŸ“… æ—¥æœŸåˆ—è¡¨</h2>
                    <div class="date-list" id="dateList">
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ“‹</div>
                            <p>æ·»åŠ æ—¥æœŸåå°†åœ¨æ­¤å±•ç¤º</p>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2>âœ¨ æœ€å°æ—¥æœŸç»“æœ</h2>
                    <div class="result-display" id="resultDisplay">
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ¯</div>
                            <p>æ‰§è¡ŒæŸ¥æ‰¾åå°†åœ¨æ­¤å±•ç¤ºæœ€å°æ—¥æœŸ</p>
                        </div>
                    </div>
                </div>

                <div class="card" id="timelineCard" style="display:none;">
                    <h2>ğŸ“Š æ—¶é—´çº¿å¯¹æ¯”</h2>
                    <div class="timeline" id="timeline"></div>
                </div>

                <div class="card" id="analysisCard" style="display:none;">
                    <h2>ğŸ“ˆ æ—¥æœŸåˆ†æ</h2>
                    <div class="comparison-grid" id="comparisonGrid"></div>
                </div>

                <div class="card" id="codeSection" style="display:none;">
                    <h2>ğŸ’» æ‰§è¡Œä»£ç </h2>
                    <div class="code-block">
                        <pre><code class="language-javascript" id="codePreview">// ä»£ç å°†åœ¨è¿™é‡Œæ˜¾ç¤º</code></pre>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>ğŸ“Š ç»Ÿè®¡ä¿¡æ¯</h2>
            <div class="stats-grid" id="statsGrid"></div>
        </div>

        <div class="card">
            <h2>ğŸ“– å‡½æ•°è¯´æ˜</h2>
            <div style="background:#f8fafc;padding:20px;border-radius:14px;">
                <h3 style="color:#a8edea;margin-bottom:12px;">minDate å‡½æ•°ï¼ˆæŸ¥æ‰¾æœ€å°æ—¥æœŸï¼‰</h3>
                <div class="code-block">
                    <pre><code class="language-javascript">const minDate = (...dates) => new Date(Math.min(...dates));</code></pre>
                </div>

                <h3 style="color:#a8edea;margin:20px 0 12px;">å‡½æ•°è¯´æ˜</h3>
                <p style="color:#374151;line-height:1.8;">
                    <strong>minDate</strong> å‡½æ•°è¿”å›ç»™å®šæ—¥æœŸçš„æœ€å°å€¼ã€‚
                    ä½¿ç”¨å¸¦æœ‰ Math.min() çš„ ES6 æ‰©å±•è¯­æ³•æ¥æŸ¥æ‰¾æœ€å°æ—¥æœŸå€¼ï¼Œç„¶åä½¿ç”¨ Date æ„é€ å‡½æ•°å°†å…¶è½¬æ¢ä¸º Date å¯¹è±¡ã€‚
                    é€‚ç”¨äºæŸ¥æ‰¾å¤šä¸ªæ—¥æœŸä¸­çš„æœ€æ—©æ—¥æœŸï¼Œå¸¸ç”¨äºäº‹ä»¶æ’åºã€æˆªæ­¢æ—¥æœŸæŸ¥æ‰¾ç­‰åœºæ™¯ã€‚
                </p>

                <h3 style="color:#a8edea;margin:20px 0 12px;">ä½¿ç”¨æ–¹å¼</h3>
                <div class="code-block">
                    <pre><code class="language-javascript">const dates = [
  new Date(2017, 4, 13),
  new Date(2018, 2, 12),
  new Date(2016, 0, 10),
  new Date(2016, 0, 9)
];
minDate(...dates);
// 2016-01-08T22:00:00.000Z

// ä¹Ÿå¯ä»¥ç›´æ¥ä¼ å…¥æ—¥æœŸå­—ç¬¦ä¸²
minDate('2023-01-01', '2023-12-31', '2023-06-15');
// 2023-01-01T00:00:00.000Z</code></pre>
                </div>

                <h3 style="color:#a8edea;margin:20px 0 12px;">å…¸å‹åœºæ™¯</h3>
                <div>
                    <span class="badge">äº‹ä»¶æ’åº</span>
                    <span class="badge">æˆªæ­¢æ—¥æœŸæŸ¥æ‰¾</span>
                    <span class="badge">æœ€æ—©è®°å½•</span>
                    <span class="badge">æ—¶é—´èŒƒå›´åˆ†æ</span>
                    <span class="badge">æ—¥æœŸç­›é€‰</span>
                    <span class="badge">æ•°æ®ç»Ÿè®¡</span>
                </div>
            </div>
        </div>
    </div>

    <script src="../../demo/plugins/modal/index.js"></script>
    <script src="../../demo/plugins/checkbox/index.js"></script>
    <script src="../../demo/plugins/notification/index.js"></script>
    <script src="../../demo/plugins/input-number/index.js"></script>
    <script src="../../demo/plugins/datetime-picker/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
        const minDate = (...dates) => new Date(Math.min(...dates));

        class MinDateTool {
            constructor() {
                this.plugins = {};
                this.dates = [];
                this.minDateValue = null;
                this.minDateIndex = null;
                this.history = [];
                this.stats = {
                    totalFinds: 0,
                    totalDates: 0,
                    averageDatesPerFind: 0
                };
                this.dateId = 1;
                this.checkboxOptions = [
                    { id: 'showDateList', label: 'æ˜¾ç¤ºæ—¥æœŸåˆ—è¡¨', checked: true },
                    { id: 'showResult', label: 'æ˜¾ç¤ºæœ€å°æ—¥æœŸç»“æœ', checked: true },
                    { id: 'showTimeline', label: 'æ˜¾ç¤ºæ—¶é—´çº¿å¯¹æ¯”', checked: true },
                    { id: 'showAnalysis', label: 'æ˜¾ç¤ºæ—¥æœŸåˆ†æ', checked: true },
                    { id: 'showCode', label: 'æ˜¾ç¤ºä»£ç é¢„è§ˆ', checked: true },
                    { id: 'showNotifications', label: 'æ˜¾ç¤ºé€šçŸ¥æé†’', checked: true }
                ];
                this.init();
            }

            async init() {
                try {
                    await this.loadPlugins();
                    this.setupDatePicker();
                    this.setupCheckboxes();
                    this.initHighlight();
                    this.updateStats();
                    this.showWelcomeMessage();
                } catch (error) {
                    console.error('åˆå§‹åŒ–å¤±è´¥:', error);
                    this.showError('åˆå§‹åŒ–å¤±è´¥: ' + error.message);
                }
            }

            initHighlight() {
                if (window.hljs) {
                    document.querySelectorAll('pre code').forEach((block) => hljs.highlightElement(block));
                }
            }

            async loadPlugins() {
                try {
                    this.plugins.modal = new Modal();
                    this.plugins.notification = new Notification();
                } catch (error) {
                    console.warn('éƒ¨åˆ†æ’ä»¶åŠ è½½å¤±è´¥:', error);
                }
            }

            setupDatePicker() {
                const container = document.getElementById('datePickerContainer');
                if (!container) {
                    console.warn('datePickerContainer å…ƒç´ ä¸å­˜åœ¨');
                    return;
                }

                // æ£€æŸ¥ DateTimePicker æ˜¯å¦å¯ç”¨
                if (typeof DateTimePicker === 'undefined') {
                    console.warn('DateTimePicker ç±»æœªå®šä¹‰ï¼Œä½¿ç”¨åŸç”Ÿè¾“å…¥æ¡†');
                    const input = document.createElement('input');
                    input.type = 'datetime-local';
                    input.id = 'dateNative';
                    input.value = new Date().toISOString().slice(0, 16);
                    input.className = 'input-field';
                    container.appendChild(input);
                    return;
                }

                try {
                    // ç›´æ¥ä½¿ç”¨ DateTimePickerï¼ˆé€šè¿‡ script æ ‡ç­¾åŠ è½½ï¼Œåœ¨å…¨å±€ä½œç”¨åŸŸå¯ç”¨ï¼‰
                    this.plugins.datePicker = new DateTimePicker({
                        container,
                        value: new Date(),
                        format: 'YYYY-MM-DD HH:mm',
                        placeholder: 'é€‰æ‹©æ—¥æœŸæ—¶é—´',
                        onChange: () => {}
                    });
                    console.log('DateTimePicker åˆå§‹åŒ–æˆåŠŸ');
                } catch (error) {
                    console.error('DateTimePicker åˆå§‹åŒ–å¤±è´¥:', error);
                    // å¦‚æœ DateTimePicker ä¸å¯ç”¨ï¼Œä½¿ç”¨åŸç”Ÿæ—¥æœŸæ—¶é—´é€‰æ‹©å™¨
                    const input = document.createElement('input');
                    input.type = 'datetime-local';
                    input.id = 'dateNative';
                    input.value = new Date().toISOString().slice(0, 16);
                    input.className = 'input-field';
                    container.appendChild(input);
                }
            }

            setupCheckboxes() {
                const container = document.getElementById('checkboxGroup');
                if (!container) return;
                try {
                    const group = Checkbox.createCheckboxGroup({
                        items: this.checkboxOptions.map(option => ({
                            id: option.id,
                            label: option.label,
                            checked: option.checked
                        })),
                        onChange: () => {}
                    });
                    container.appendChild(group.container);
                    this.plugins.checkboxGroup = group;
                } catch (error) {
                    console.warn('å¤é€‰æ¡†æ’ä»¶åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨åŸç”Ÿå¤é€‰æ¡†:', error);
                    this.checkboxOptions.forEach(option => {
                        const div = document.createElement('div');
                        div.style.marginBottom = '10px';
                        div.innerHTML = `<input type="checkbox" id="${option.id}" ${option.checked ? 'checked' : ''}>` +
                            `<label for="${option.id}" style="margin-left:6px;">${option.label}</label>`;
                        container.appendChild(div);
                    });
                }
            }

            getCheckboxValue(id) {
                if (this.plugins.checkboxGroup) {
                    try {
                        const states = this.plugins.checkboxGroup.getAllChecked();
                        const index = this.checkboxOptions.findIndex(option => option.id === id);
                        if (index !== -1) {
                            return states[index] || false;
                        }
                    } catch (error) {
                        console.warn('è¯»å–å¤é€‰æ¡†çŠ¶æ€å¤±è´¥ï¼Œä½¿ç”¨åŸç”Ÿæ–¹æ³•:', error);
                    }
                }
                const checkbox = document.getElementById(id);
                return checkbox ? checkbox.checked : false;
            }

            getSelectedDate() {
                if (this.plugins.datePicker?.getValue) {
                    try {
                        const dateValue = this.plugins.datePicker.getValue();
                        // DateTimePicker è¿”å› Date å¯¹è±¡ï¼Œéœ€è¦è½¬æ¢ä¸ºå­—ç¬¦ä¸²æ ¼å¼
                        if (dateValue instanceof Date) {
                            return dateValue.toISOString().slice(0, 16);
                        }
                        return dateValue;
                    } catch (error) {
                        console.warn('è·å–æ—¥æœŸå¤±è´¥ï¼Œä½¿ç”¨åŸç”Ÿæ–¹æ³•:', error);
                    }
                }
                const native = document.getElementById('dateNative');
                return native ? native.value : null;
            }

            formatDate(date, format = 'full') {
                if (!date) return '';
                const d = new Date(date);
                if (isNaN(d.getTime())) return 'æ— æ•ˆæ—¥æœŸ';

                const year = d.getFullYear();
                const month = String(d.getMonth() + 1).padStart(2, '0');
                const day = String(d.getDate()).padStart(2, '0');
                const hours = String(d.getHours()).padStart(2, '0');
                const minutes = String(d.getMinutes()).padStart(2, '0');
                const seconds = String(d.getSeconds()).padStart(2, '0');

                switch (format) {
                    case 'iso':
                        return d.toISOString();
                    case 'date':
                        return `${year}-${month}-${day}`;
                    case 'datetime':
                        return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
                    case 'local':
                        return d.toLocaleString('zh-CN');
                    default:
                        return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
                }
            }

            addDate() {
                const dateStr = this.getSelectedDate();
                if (!dateStr) {
                    this.showError('è¯·é€‰æ‹©æ—¥æœŸ');
                    return;
                }

                try {
                    const date = new Date(dateStr);
                    if (isNaN(date.getTime())) {
                        throw new Error('æ— æ•ˆçš„æ—¥æœŸæ ¼å¼');
                    }

                    this.dates.push({
                        id: this.dateId++,
                        date: date,
                        timestamp: new Date().toLocaleString('zh-CN')
                    });

                    this.stats.totalDates++;
                    this.displayDateList();
                    this.showNotification(`å·²æ·»åŠ æ—¥æœŸ: ${this.formatDate(date, 'date')}`, 'success');
                } catch (error) {
                    this.showError('æ·»åŠ æ—¥æœŸå¤±è´¥: ' + error.message);
                }
            }

            removeDate(id) {
                this.dates = this.dates.filter(d => d.id !== id);
                this.displayDateList();
                this.showNotification('å·²ç§»é™¤æ—¥æœŸ', 'info');
            }

            findMin() {
                if (this.dates.length === 0) {
                    this.showError('è¯·å…ˆæ·»åŠ è‡³å°‘ä¸€ä¸ªæ—¥æœŸ');
                    return;
                }

                try {
                    const dateObjects = this.dates.map(d => d.date);
                    const start = performance.now();
                    this.minDateValue = minDate(...dateObjects);
                    const end = performance.now();
                    const time = Math.round((end - start) * 1000) / 1000;

                    // æ‰¾åˆ°æœ€å°æ—¥æœŸå¯¹åº”çš„ç´¢å¼•
                    this.minDateIndex = this.dates.findIndex(d => 
                        d.date.getTime() === this.minDateValue.getTime()
                    );

                    this.stats.totalFinds++;
                    this.stats.averageDatesPerFind = Math.round(
                        (this.stats.totalDates / this.stats.totalFinds) * 100
                    ) / 100;

                    this.displayDateList();
                    this.displayResult();
                    this.updateStats();
                    this.addToHistory(time);

                    if (this.getCheckboxValue('showTimeline')) {
                        this.displayTimeline();
                    }

                    if (this.getCheckboxValue('showAnalysis')) {
                        this.displayAnalysis(time);
                    }

                    if (this.getCheckboxValue('showCode')) {
                        this.showCode();
                    }

                    this.showNotification(`æœ€å°æ—¥æœŸæŸ¥æ‰¾å®Œæˆï¼æœ€å°æ—¥æœŸ: ${this.formatDate(this.minDateValue, 'date')}`, 'success');
                } catch (error) {
                    this.showError('æŸ¥æ‰¾å¤±è´¥: ' + error.message);
                }
            }

            displayDateList() {
                const container = document.getElementById('dateList');
                if (!container) return;

                if (!this.getCheckboxValue('showDateList')) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ™ˆ</div>
                            <p>å·²å…³é—­æ—¥æœŸåˆ—è¡¨å±•ç¤º</p>
                        </div>`;
                    return;
                }

                if (this.dates.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ“‹</div>
                            <p>æ·»åŠ æ—¥æœŸåå°†åœ¨æ­¤å±•ç¤º</p>
                        </div>`;
                    return;
                }

                const html = this.dates.map((item, index) => {
                    const isMin = this.minDateValue && 
                        item.date.getTime() === this.minDateValue.getTime();
                    return `
                        <div class="date-item ${isMin ? 'min' : ''}">
                            <div class="date-info">
                                <div class="date-label">æ—¥æœŸ #${item.id} ${isMin ? '<span class="min-badge">æœ€å°</span>' : ''}</div>
                                <div class="date-value">${this.formatDate(item.date, 'datetime')}</div>
                                <div class="date-formats">
                                    ISO: ${this.formatDate(item.date, 'iso')} | 
                                    æœ¬åœ°: ${this.formatDate(item.date, 'local')}
                                </div>
                            </div>
                            <div class="date-actions">
                                <button class="btn btn-sm btn-danger" onclick="window.minDateTool?.removeDate(${item.id})">ç§»é™¤</button>
                            </div>
                        </div>
                    `;
                }).join('');

                container.innerHTML = html;
            }

            displayResult() {
                const container = document.getElementById('resultDisplay');
                if (!container) return;

                if (!this.getCheckboxValue('showResult')) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ™ˆ</div>
                            <p>å·²å…³é—­æœ€å°æ—¥æœŸç»“æœå±•ç¤º</p>
                        </div>`;
                    return;
                }

                if (!this.minDateValue) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ¯</div>
                            <p>æ‰§è¡ŒæŸ¥æ‰¾åå°†åœ¨æ­¤å±•ç¤ºæœ€å°æ—¥æœŸ</p>
                        </div>`;
                    return;
                }

                container.innerHTML = `
                    <div class="result-card">
                        <div class="result-label">æœ€å°æ—¥æœŸ</div>
                        <div class="result-value">${this.formatDate(this.minDateValue, 'datetime')}</div>
                        ${this.minDateIndex !== null ? `<div style="margin-top:12px;color:#64748b;font-size:0.9rem;">ä½äºç´¢å¼• ${this.minDateIndex}</div>` : ''}
                        <div class="result-formats">
                            <div>ISO æ ¼å¼: ${this.formatDate(this.minDateValue, 'iso')}</div>
                            <div>æœ¬åœ°æ ¼å¼: ${this.formatDate(this.minDateValue, 'local')}</div>
                            <div>æ—¥æœŸæ ¼å¼: ${this.formatDate(this.minDateValue, 'date')}</div>
                        </div>
                    </div>
                `;
            }

            displayTimeline() {
                const card = document.getElementById('timelineCard');
                const container = document.getElementById('timeline');
                if (!card || !container) return;

                if (!this.minDateValue || this.dates.length === 0) {
                    card.style.display = 'none';
                    return;
                }

                const sortedDates = [...this.dates].sort((a, b) => a.date.getTime() - b.date.getTime());
                const minTime = sortedDates[0].date.getTime();
                const maxTime = sortedDates[sortedDates.length - 1].date.getTime();
                const range = maxTime - minTime || 1;

                const html = sortedDates.map(item => {
                    const isMin = item.date.getTime() === this.minDateValue.getTime();
                    const position = ((item.date.getTime() - minTime) / range) * 100;
                    return `
                        <div class="timeline-item ${isMin ? 'min' : ''}">
                            <div class="timeline-date">${this.formatDate(item.date, 'datetime')}</div>
                            <div class="timeline-bar">
                                <div class="timeline-fill ${isMin ? 'min' : ''}" style="width: ${position}%"></div>
                            </div>
                        </div>
                    `;
                }).join('');

                container.innerHTML = html;
                card.style.display = 'block';
            }

            displayAnalysis(time) {
                const card = document.getElementById('analysisCard');
                const grid = document.getElementById('comparisonGrid');
                if (!card || !grid) return;

                if (!this.minDateValue || this.dates.length === 0) {
                    card.style.display = 'none';
                    return;
                }

                const sortedDates = [...this.dates].sort((a, b) => a.date.getTime() - b.date.getTime());
                const maxDate = sortedDates[sortedDates.length - 1].date;
                const diffMs = maxDate.getTime() - this.minDateValue.getTime();
                const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
                const diffMonths = Math.floor(diffDays / 30);
                const diffYears = Math.floor(diffDays / 365);

                grid.innerHTML = `
                    <div class="comparison-card">
                        <h4>ğŸ“Š æŸ¥æ‰¾ä¿¡æ¯</h4>
                        <p>æ—¥æœŸæ€»æ•°: ${this.dates.length}</p>
                        <p>æœ€å°æ—¥æœŸ: ${this.formatDate(this.minDateValue, 'date')}</p>
                        <p>æœ€å¤§æ—¥æœŸ: ${this.formatDate(maxDate, 'date')}</p>
                        <p>è®¡ç®—æ—¶é—´: ${time}Î¼s</p>
                    </div>
                    <div class="comparison-card">
                        <h4>ğŸ“ˆ æ—¶é—´è·¨åº¦</h4>
                        <p>ç›¸å·®å¤©æ•°: ${diffDays} å¤©</p>
                        <p>ç›¸å·®æœˆæ•°: ${diffMonths} æœˆ</p>
                        <p>ç›¸å·®å¹´æ•°: ${diffYears} å¹´</p>
                        <p>æ—¶é—´æˆ³å·®: ${diffMs} æ¯«ç§’</p>
                    </div>
                    <div class="comparison-card">
                        <h4>ğŸ” æ—¥æœŸè¯¦æƒ…</h4>
                        <p>æœ€å°æ—¥æœŸç´¢å¼•: ${this.minDateIndex}</p>
                        <p>æœ€å°æ—¥æœŸ ID: ${this.dates[this.minDateIndex]?.id || '-'}</p>
                        <p>æ·»åŠ æ—¶é—´: ${this.dates[this.minDateIndex]?.timestamp || '-'}</p>
                    </div>
                `;

                card.style.display = 'block';
            }

            addToHistory(time) {
                this.history.unshift({
                    time: new Date().toLocaleString('zh-CN'),
                    dateCount: this.dates.length,
                    minDate: this.formatDate(this.minDateValue, 'date'),
                    execTime: time
                });
                if (this.history.length > 40) this.history.pop();
                this.updateHistoryDisplay();
            }

            updateHistoryDisplay() {
                const container = document.getElementById('historyList');
                const count = document.getElementById('historyCount');
                if (!container) return;
                if (count) count.textContent = this.history.length;

                if (this.history.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ“œ</div>
                            <p>æš‚æ— æŸ¥æ‰¾å†å²</p>
                        </div>`;
                    return;
                }

                container.innerHTML = this.history.slice(0, 20).map(item => `
                    <div class="history-item">
                        <div class="history-time">${item.time} â€¢ ${item.execTime}Î¼s</div>
                        <div class="history-summary">
                            æ—¥æœŸæ•°: ${item.dateCount} | æœ€å°æ—¥æœŸ: ${item.minDate}
                        </div>
                    </div>
                `).join('');
            }

            updateStats() {
                const grid = document.getElementById('statsGrid');
                if (!grid) return;
                grid.innerHTML = `
                    <div class="stat-card">
                        <div class="stat-number">${this.stats.totalFinds}</div>
                        <div class="stat-label">æŸ¥æ‰¾æ¬¡æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${this.stats.totalDates}</div>
                        <div class="stat-label">ç´¯è®¡æ—¥æœŸ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${this.dates.length}</div>
                        <div class="stat-label">å½“å‰æ—¥æœŸæ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${this.stats.averageDatesPerFind.toFixed(1)}</div>
                        <div class="stat-label">å¹³å‡æ—¥æœŸæ•°</div>
                    </div>
                `;
            }

            showCode() {
                const section = document.getElementById('codeSection');
                const preview = document.getElementById('codePreview');
                if (!preview) return;

                if (!this.minDateValue || this.dates.length === 0) {
                    if (section) section.style.display = 'none';
                    return;
                }

                const dateStrings = this.dates.map(d => 
                    `new Date('${d.date.toISOString()}')`
                ).join(',\n  ');

                const code = `const minDate = (...dates) => new Date(Math.min(...dates));

// è¾“å…¥æ—¥æœŸæ•°ç»„
const dates = [
  ${dateStrings}
];

// æ‰§è¡ŒæŸ¥æ‰¾
const minDateValue = minDate(...dates);

console.log(minDateValue);
// ${this.minDateValue.toISOString()}

// è¯´æ˜ï¼š
// - minDate ä½¿ç”¨ Math.min() æŸ¥æ‰¾æœ€å°æ—¥æœŸå€¼
// - ä½¿ç”¨ Date æ„é€ å‡½æ•°è½¬æ¢ä¸º Date å¯¹è±¡
// - æ—¶é—´å¤æ‚åº¦: O(n)
// - ç©ºé—´å¤æ‚åº¦: O(1)
// - é€‚ç”¨äºæŸ¥æ‰¾å¤šä¸ªæ—¥æœŸä¸­çš„æœ€æ—©æ—¥æœŸ`;

                preview.textContent = code;
                if (window.hljs) {
                    delete preview.dataset.highlighted;
                    preview.className = 'language-javascript';
                    hljs.highlightElement(preview);
                }
                if (section) section.style.display = 'block';
            }

            clearAll() {
                this.dates = [];
                this.minDateValue = null;
                this.minDateIndex = null;
                this.displayDateList();
                this.displayResult();
                const timelineCard = document.getElementById('timelineCard');
                if (timelineCard) timelineCard.style.display = 'none';
                const analysisCard = document.getElementById('analysisCard');
                if (analysisCard) analysisCard.style.display = 'none';
                const codeSection = document.getElementById('codeSection');
                if (codeSection) codeSection.style.display = 'none';
                this.showNotification('å·²æ¸…ç©ºå…¨éƒ¨æ•°æ®', 'info');
            }

            loadSample() {
                const today = new Date();
                const sampleDates = [
                    new Date(today.getFullYear(), today.getMonth(), today.getDate() - 30),
                    new Date(today.getFullYear(), today.getMonth(), today.getDate() - 10),
                    new Date(today.getFullYear(), today.getMonth(), today.getDate() - 5),
                    new Date(today.getFullYear(), today.getMonth(), today.getDate())
                ];

                this.dates = sampleDates.map((date, index) => ({
                    id: this.dateId++,
                    date: date,
                    timestamp: new Date().toLocaleString('zh-CN')
                }));

                this.stats.totalDates += this.dates.length;
                this.displayDateList();
                this.showNotification('ç¤ºä¾‹æ•°æ®å·²åŠ è½½', 'info');
            }

            generateRandom() {
                const count = Math.floor(Math.random() * 5) + 3;
                const today = new Date();
                const randomDates = Array.from({ length: count }, () => {
                    const daysAgo = Math.floor(Math.random() * 365);
                    return new Date(today.getFullYear(), today.getMonth(), today.getDate() - daysAgo);
                });

                this.dates = randomDates.map((date, index) => ({
                    id: this.dateId++,
                    date: date,
                    timestamp: new Date().toLocaleString('zh-CN')
                }));

                this.stats.totalDates += this.dates.length;
                this.displayDateList();
                this.showNotification(`å·²ç”Ÿæˆ ${count} ä¸ªéšæœºæ—¥æœŸ`, 'info');
            }

            showNotification(message, type) {
                if (this.plugins.notification && this.getCheckboxValue('showNotifications')) {
                    this.plugins.notification.show(message, type);
                } else {
                    console.log(`${type.toUpperCase()}: ${message}`);
                }
            }

            showError(message) {
                this.showNotification(message, 'error');
            }

            showWelcomeMessage() {
                if (this.plugins.modal) {
                    this.plugins.modal.show({
                        title: 'ğŸ‰ æ¬¢è¿ä½¿ç”¨æœ€å°æ—¥æœŸæŸ¥æ‰¾å¹³å°',
                        content: `
                            <div style="padding:18px;">
                                <div style="font-size:46px;text-align:center;margin-bottom:12px;">ğŸ“…</div>
                                <p style="color:#1f2937;line-height:1.8;">
                                    ä½¿ç”¨ <strong>minDate</strong> å‡½æ•°æŸ¥æ‰¾å¤šä¸ªæ—¥æœŸä¸­çš„æœ€å°å€¼ã€‚
                                    æ”¯æŒæ—¥æœŸè¾“å…¥ã€å¯è§†åŒ–å±•ç¤ºã€æ—¶é—´çº¿å¯¹æ¯”å’Œè¯¦ç»†åˆ†æã€‚
                                </p>
                                <div style="background:#e0f2fe;border-left:4px solid #a8edea;padding:12px;border-radius:12px;color:#0369a1;margin-top:12px;">
                                    <strong>äº®ç‚¹ï¼š</strong> æ—¥æœŸé€‰æ‹©å™¨ã€å¤šæ—¥æœŸç®¡ç†ã€æ—¶é—´çº¿å¯è§†åŒ–ã€æ—¥æœŸåˆ†æã€ä»£ç é¢„è§ˆã€å†å²è®°å½•ã€‚
                                </div>
                                <ul style="color:#1f2937;margin-left:18px;margin-top:12px;line-height:1.8;">
                                    <li>æ”¯æŒæ·»åŠ å¤šä¸ªæ—¥æœŸå¹¶æŸ¥æ‰¾æœ€å°æ—¥æœŸ</li>
                                    <li>æ—¶é—´çº¿å¯è§†åŒ–å±•ç¤ºæ—¥æœŸé¡ºåºå’Œæœ€å°æ—¥æœŸä½ç½®</li>
                                    <li>æä¾›è¯¦ç»†çš„æ—¥æœŸåˆ†æå’Œæ—¶é—´è·¨åº¦è®¡ç®—</li>
                                    <li>è®°å½•æŸ¥æ‰¾å†å²å¹¶ç»Ÿè®¡ä½¿ç”¨æƒ…å†µ</li>
                                </ul>
                            </div>
                        `,
                        type: 'alert'
                    });
                }
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            window.minDateTool = new MinDateTool();
        });

        if (document.readyState !== 'loading' && !window.minDateTool) {
            window.minDateTool = new MinDateTool();
        }
    </script>
</body>

</html>
