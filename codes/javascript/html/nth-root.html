<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Næ¬¡æ–¹æ ¹è®¡ç®—å™¨ - nthRoot å‡½æ•°å®æˆ˜å¹³å°</title>
    <!-- å¼•å…¥æ’ä»¶æ ·å¼ -->
    <link rel="stylesheet" href="../../demo/plugins/modal/style.css">
    <link rel="stylesheet" href="../../demo/plugins/checkbox/style.css">
    <link rel="stylesheet" href="../../demo/plugins/notification/style.css">
    <link rel="stylesheet" href="../../demo/plugins/select/style.css">
    <link rel="stylesheet" href="../../demo/plugins/input-number/style.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #1f2937;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 800;
            text-shadow: 0 3px 8px rgba(15, 23, 42, 0.35);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.95;
        }

        .main-content {
            display: grid;
            grid-template-columns: 420px 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }

        .card {
            background: rgba(255, 255, 255, 0.97);
            border-radius: 20px;
            padding: 24px;
            box-shadow: 0 14px 32px rgba(15, 23, 42, 0.15);
            margin-bottom: 20px;
        }

        .card h2 {
            font-size: 1.4rem;
            margin-bottom: 18px;
            color: #1f2937;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .input-group {
            margin-bottom: 16px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
            font-size: 0.95rem;
        }

        .input-field {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 0.95rem;
            transition: all 0.25s ease;
            font-family: 'Monaco', 'Menlo', monospace;
        }

        .input-field:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.25);
        }

        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 16px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #22c55e, #15803d);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #fbbf24, #d97706);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #b91c1c);
            color: white;
        }

        .btn-info {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .btn:active {
            transform: scale(0.97);
        }

        .btn-block {
            width: 100%;
            justify-content: center;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 0.85rem;
        }

        .result-panel {
            background: #f8fafc;
            border-radius: 16px;
            padding: 20px;
            margin-top: 20px;
        }

        .result-display {
            background: linear-gradient(135deg, #1e293b, #334155);
            color: #e2e8f0;
            padding: 30px;
            border-radius: 12px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 1.2rem;
            margin-top: 12px;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .result-formula {
            font-size: 1rem;
            color: #94a3b8;
            margin-bottom: 12px;
        }

        .result-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #82aaff;
            margin: 8px 0;
        }

        .result-error {
            color: #f87171;
            font-style: italic;
        }

        .quick-roots {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 16px;
        }

        .quick-root-btn {
            padding: 10px;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: 600;
            color: #374151;
        }

        .quick-root-btn:hover {
            border-color: #667eea;
            background: #f0f4ff;
            transform: translateY(-2px);
        }

        .quick-root-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-color: #667eea;
        }

        .calculation-info {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-top: 16px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e5e7eb;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            font-weight: 600;
            color: #374151;
        }

        .info-value {
            font-family: 'Monaco', 'Menlo', monospace;
            color: #667eea;
            font-weight: 700;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }

        .stat-card {
            background: white;
            border-radius: 14px;
            padding: 16px;
            text-align: center;
            box-shadow: 0 3px 12px rgba(15, 23, 42, 0.1);
        }

        .stat-number {
            font-size: 1.8rem;
            font-weight: 800;
            color: #667eea;
            font-family: 'Monaco', 'Menlo', monospace;
        }

        .stat-label {
            font-size: 0.85rem;
            color: #64748b;
            margin-top: 4px;
        }

        .batch-test-container {
            background: #f8fafc;
            border-radius: 16px;
            padding: 20px;
            margin-top: 20px;
        }

        .test-item {
            background: white;
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 12px;
            border-left: 4px solid #667eea;
        }

        .test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .test-title {
            font-weight: 700;
            color: #1f2937;
        }

        .test-result {
            font-family: 'Monaco', 'Menlo', monospace;
            font-weight: 600;
            color: #667eea;
        }

        .test-args {
            font-size: 0.9rem;
            color: #64748b;
            font-family: 'Monaco', 'Menlo', monospace;
        }

        .history-list {
            max-height: 300px;
            overflow-y: auto;
            background: #f8fafc;
            border-radius: 12px;
            padding: 12px;
        }

        .history-item {
            background: white;
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 10px;
            border-left: 3px solid #667eea;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .history-item:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .history-time {
            font-size: 0.75rem;
            color: #64748b;
            margin-bottom: 4px;
        }

        .history-info {
            font-size: 0.85rem;
            color: #1f2937;
            font-family: 'Monaco', 'Menlo', monospace;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #64748b;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .select-container,
        .input-number-container {
            margin-bottom: 16px;
        }

        .checkbox-container {
            margin-top: 12px;
        }

        .code-preview {
            background: #1e293b;
            color: #e2e8f0;
            padding: 16px;
            border-radius: 10px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.85rem;
            overflow-x: auto;
            margin-top: 12px;
        }

        .code-preview .keyword {
            color: #c792ea;
        }

        .code-preview .function {
            color: #82aaff;
        }

        .code-preview .string {
            color: #c3e88d;
        }

        .code-preview .comment {
            color: #697098;
        }

        .code-preview .number {
            color: #f78c6c;
        }

        .visualization {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-top: 16px;
        }

        .visual-title {
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 12px;
        }

        .visual-bar {
            height: 40px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            margin-top: 8px;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”¢ Næ¬¡æ–¹æ ¹è®¡ç®—å™¨ - nthRoot å‡½æ•°å®æˆ˜å¹³å°</h1>
            <p>åŸºäº nthRoot å‡½æ•°çš„æ™ºèƒ½æ•°å­¦è®¡ç®—å·¥å…·ï¼Œæ”¯æŒä»»æ„æ¬¡æ–¹æ ¹è®¡ç®—ã€æ‰¹é‡æµ‹è¯•ã€å¯è§†åŒ–å±•ç¤ºå’Œå®æ—¶é¢„è§ˆ</p>
        </div>

        <div class="main-content">
            <!-- å·¦ä¾§æ§åˆ¶é¢æ¿ -->
            <div class="sidebar">
                <div class="card">
                    <h2>âš™ï¸ æ ¹è®¡ç®—å™¨</h2>
                    <div class="input-group">
                        <label>è¢«å¼€æ–¹æ•° (x)</label>
                        <div id="xInputContainer" class="input-number-container"></div>
                    </div>
                    <div class="input-group">
                        <label>æ ¹æŒ‡æ•° (n)</label>
                        <div id="nInputContainer" class="input-number-container"></div>
                    </div>
                    <div class="input-group">
                        <label>å¿«é€Ÿé€‰æ‹©å¸¸ç”¨æ ¹</label>
                        <div class="quick-roots" id="quickRoots">
                            <div class="quick-root-btn" data-n="2">âˆš å¹³æ–¹æ ¹</div>
                            <div class="quick-root-btn" data-n="3">âˆ› ç«‹æ–¹æ ¹</div>
                            <div class="quick-root-btn" data-n="4">âˆœ å››æ¬¡æ–¹æ ¹</div>
                            <div class="quick-root-btn" data-n="5">5æ¬¡æ–¹æ ¹</div>
                        </div>
                    </div>
                    <div class="button-group">
                        <button class="btn btn-primary btn-block" onclick="window.rootCalculator?.calculate()">
                            ğŸ¯ è®¡ç®—æ ¹
                        </button>
                    </div>
                </div>

                <div class="card">
                    <h2>ğŸ”§ å·¥å…·é€‰é¡¹</h2>
                    <div id="checkboxGroup" class="checkbox-container"></div>
                    <div class="button-group">
                        <button class="btn btn-info btn-sm" onclick="window.rootCalculator?.loadSample()">
                            ğŸ“ åŠ è½½ç¤ºä¾‹
                        </button>
                        <button class="btn btn-success btn-sm" onclick="window.rootCalculator?.runBatchTest()">
                            ğŸ§ª æ‰¹é‡æµ‹è¯•
                        </button>
                        <button class="btn btn-warning btn-sm" onclick="window.rootCalculator?.generateRandom()">
                            ğŸ² éšæœºç”Ÿæˆ
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="window.rootCalculator?.clearAll()">
                            ğŸ§¹ æ¸…ç©ºå…¨éƒ¨
                        </button>
                    </div>
                </div>

                <div class="card">
                    <h2>ğŸ“Š ç»Ÿè®¡ä¿¡æ¯</h2>
                    <div class="stats-grid" id="statsGrid">
                        <div class="stat-card">
                            <div class="stat-number" id="totalCalculations">0</div>
                            <div class="stat-label">è®¡ç®—æ¬¡æ•°</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="averageRoot">-</div>
                            <div class="stat-label">å¹³å‡æ ¹å€¼</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="maxRoot">-</div>
                            <div class="stat-label">æœ€å¤§æ ¹å€¼</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2>ğŸ“œ è®¡ç®—å†å²</h2>
                    <div class="history-list" id="historyList">
                        <div class="empty-state" style="padding: 40px 20px;">
                            <div class="empty-state-icon">ğŸ“</div>
                            <p style="font-size: 0.9rem;">è®¡ç®—å†å²å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å³ä¾§ç»“æœå±•ç¤ºåŒºåŸŸ -->
            <div class="visualization">
                <div class="card">
                    <h2>ğŸ“Š è®¡ç®—ç»“æœ</h2>
                    <div class="result-panel">
                        <div class="result-display" id="resultDisplay">
                            <div style="color: #94a3b8; font-size: 0.9rem;">è®¡ç®—ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</div>
                        </div>
                        <div class="calculation-info" id="calculationInfo" style="display: none;">
                            <div class="info-row">
                                <span class="info-label">è¢«å¼€æ–¹æ•° (x)</span>
                                <span class="info-value" id="infoX">-</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">æ ¹æŒ‡æ•° (n)</span>
                                <span class="info-value" id="infoN">-</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">è®¡ç®—ç»“æœ</span>
                                <span class="info-value" id="infoResult">-</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">éªŒè¯ (ç»“æœ^n)</span>
                                <span class="info-value" id="infoVerify">-</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">ç²¾åº¦è¯¯å·®</span>
                                <span class="info-value" id="infoError">-</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card" id="visualizationCard" style="display: none;">
                    <h2>ğŸ“ˆ å¯è§†åŒ–å±•ç¤º</h2>
                    <div class="visualization">
                        <div class="visual-title">æ ¹å€¼å¯¹æ¯”</div>
                        <div id="visualBars">
                            <!-- å¯è§†åŒ–æ¡å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                        </div>
                    </div>
                </div>

                <div class="card" id="batchTestCard" style="display: none;">
                    <h2>ğŸ§ª æ‰¹é‡æµ‹è¯•ç»“æœ</h2>
                    <div class="batch-test-container" id="batchTestContainer">
                        <!-- æ‰¹é‡æµ‹è¯•ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                    </div>
                </div>

                <div class="card">
                    <h2>ğŸ“– å‡½æ•°è¯´æ˜</h2>
                    <div style="background:#f8fafc;padding:20px;border-radius:14px;">
                        <h3 style="color:#667eea;margin-bottom:12px;">nthRoot å‡½æ•°ï¼ˆè®¡ç®— n æ¬¡æ–¹æ ¹ï¼‰</h3>
                        <div class="code-preview">
<span class="keyword">const</span> <span class="function">nthRoot</span> = (<span class="function">x</span>, <span class="function">n</span>) => <span class="function">Math</span>.<span class="function">pow</span>(<span class="function">x</span>, <span class="number">1</span> / <span class="function">n</span>);
                        </div>
                        <p style="color:#374151;line-height:1.8;margin-top:16px;">
                            <strong>nthRoot</strong> å‡½æ•°ç”¨äºè®¡ç®—ç»™å®šæ•°å­— <strong>x</strong> çš„ <strong>n</strong> æ¬¡æ–¹æ ¹ã€‚
                            ä½¿ç”¨ <code>Math.pow(x, 1/n)</code> æ¥è®¡ç®— x çš„ 1/n æ¬¡æ–¹ï¼Œç­‰äº x çš„ç¬¬ n æ¬¡æ–¹æ ¹ã€‚
                        </p>
                        <h3 style="color:#667eea;margin:20px 0 12px;">ä½¿ç”¨ç¤ºä¾‹</h3>
                        <div class="code-preview">
<span class="comment">// è®¡ç®— 32 çš„ 5 æ¬¡æ–¹æ ¹</span>
<span class="function">nthRoot</span>(<span class="number">32</span>, <span class="number">5</span>); <span class="comment">// => 2</span>

<span class="comment">// è®¡ç®— 16 çš„å¹³æ–¹æ ¹ï¼ˆ2æ¬¡æ–¹æ ¹ï¼‰</span>
<span class="function">nthRoot</span>(<span class="number">16</span>, <span class="number">2</span>); <span class="comment">// => 4</span>

<span class="comment">// è®¡ç®— 27 çš„ç«‹æ–¹æ ¹ï¼ˆ3æ¬¡æ–¹æ ¹ï¼‰</span>
<span class="function">nthRoot</span>(<span class="number">27</span>, <span class="number">3</span>); <span class="comment">// => 3</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- å¼•å…¥æ’ä»¶è„šæœ¬ -->
    <script src="../../demo/plugins/modal/index.js"></script>
    <script src="../../demo/plugins/checkbox/index.js"></script>
    <script src="../../demo/plugins/notification/index.js"></script>
    <script src="../../demo/plugins/select/index.js"></script>
    <script src="../../demo/plugins/input-number/index.js"></script>

    <script>
        // nthRoot å‡½æ•°ï¼šè®¡ç®—ç»™å®šæ•°å­—çš„ n æ¬¡æ–¹æ ¹
        const nthRoot = (x, n) => Math.pow(x, 1 / n);

        // Næ¬¡æ–¹æ ¹è®¡ç®—å™¨ç±»
        class RootCalculator {
            constructor() {
                this.plugins = {};
                this.history = [];
                this.recentResults = [];
                this.stats = {
                    totalCalculations: 0,
                    results: []
                };
                
                this.init();
            }

            async init() {
                await this.loadPlugins();
                this.setupInputs();
                this.setupCheckboxes();
                this.setupQuickRoots();
                this.setupEventListeners();
                this.loadHistoryFromStorage();
                this.updateStats();
            }

            async loadPlugins() {
                try {
                    this.plugins.modal = new Modal();
                    this.plugins.notification = new Notification();
                } catch (error) {
                    console.warn('æ’ä»¶åŠ è½½å¤±è´¥:', error);
                }
            }

            setupInputs() {
                try {
                    const xContainer = document.getElementById('xInputContainer');
                    const nContainer = document.getElementById('nInputContainer');
                    
                    if (xContainer) {
                        this.plugins.xInput = new InputNumber({
                            container: xContainer,
                            min: 0,
                            max: 1000000,
                            value: 16,
                            placeholder: 'è¾“å…¥è¢«å¼€æ–¹æ•°',
                            onChange: (value) => {
                                if (this.getCheckboxValue('autoCalculate')) {
                                    this.calculate();
                                }
                            }
                        });
                    }

                    if (nContainer) {
                        this.plugins.nInput = new InputNumber({
                            container: nContainer,
                            min: 1,
                            max: 100,
                            value: 2,
                            placeholder: 'è¾“å…¥æ ¹æŒ‡æ•°',
                            onChange: (value) => {
                                if (this.getCheckboxValue('autoCalculate')) {
                                    this.calculate();
                                }
                            }
                        });
                    }
                } catch (error) {
                    console.warn('æ•°å­—è¾“å…¥æ’ä»¶åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨åŸç”Ÿè¾“å…¥:', error);
                    this.setupNativeInputs();
                }
            }

            setupNativeInputs() {
                const xContainer = document.getElementById('xInputContainer');
                const nContainer = document.getElementById('nInputContainer');
                
                if (xContainer) {
                    xContainer.innerHTML = '<input type="number" id="xInput" class="input-field" value="16" min="0" max="1000000" placeholder="è¾“å…¥è¢«å¼€æ–¹æ•°">';
                }
                if (nContainer) {
                    nContainer.innerHTML = '<input type="number" id="nInput" class="input-field" value="2" min="1" max="100" placeholder="è¾“å…¥æ ¹æŒ‡æ•°">';
                }
            }

            setupCheckboxes() {
                const container = document.getElementById('checkboxGroup');
                if (!container) return;

                const options = [
                    { id: 'autoCalculate', label: 'è‡ªåŠ¨è®¡ç®—', checked: false },
                    { id: 'showDetails', label: 'æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯', checked: true },
                    { id: 'showVisualization', label: 'æ˜¾ç¤ºå¯è§†åŒ–', checked: true },
                    { id: 'enableNotifications', label: 'å¯ç”¨é€šçŸ¥æé†’', checked: true },
                    { id: 'saveHistory', label: 'ä¿å­˜è®¡ç®—å†å²', checked: true }
                ];

                try {
                    const group = Checkbox.createCheckboxGroup({
                        items: options,
                        onChange: () => {
                            this.updateDisplay();
                        }
                    });
                    container.appendChild(group.container);
                    this.plugins.checkboxGroup = group;
                } catch (error) {
                    console.warn('å¤é€‰æ¡†æ’ä»¶åŠ è½½å¤±è´¥:', error);
                }
            }

            setupQuickRoots() {
                const quickRoots = document.getElementById('quickRoots');
                if (!quickRoots) return;

                const buttons = quickRoots.querySelectorAll('.quick-root-btn');
                buttons.forEach(btn => {
                    btn.addEventListener('click', () => {
                        const n = parseInt(btn.dataset.n);
                        if (this.plugins.nInput) {
                            this.plugins.nInput.setValue(n);
                        } else {
                            const nInput = document.getElementById('nInput');
                            if (nInput) nInput.value = n;
                        }

                        // æ›´æ–°æŒ‰é’®çŠ¶æ€
                        buttons.forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');

                        if (this.getCheckboxValue('autoCalculate')) {
                            this.calculate();
                        }
                    });
                });
            }

            setupEventListeners() {
                // åŸç”Ÿè¾“å…¥æ¡†çš„äº‹ä»¶ç›‘å¬
                const xInput = document.getElementById('xInput');
                const nInput = document.getElementById('nInput');
                
                if (xInput) {
                    xInput.addEventListener('input', () => {
                        if (this.getCheckboxValue('autoCalculate')) {
                            this.calculate();
                        }
                    });
                }

                if (nInput) {
                    nInput.addEventListener('input', () => {
                        if (this.getCheckboxValue('autoCalculate')) {
                            this.calculate();
                        }
                    });
                }
            }

            getCheckboxValue(id) {
                if (this.plugins.checkboxGroup) {
                    try {
                        const states = this.plugins.checkboxGroup.getAllChecked();
                        const index = ['autoCalculate', 'showDetails', 'showVisualization', 'enableNotifications', 'saveHistory'].indexOf(id);
                        return index !== -1 ? states[index] : false;
                    } catch (error) {
                        console.warn('è¯»å–å¤é€‰æ¡†çŠ¶æ€å¤±è´¥:', error);
                    }
                }
                return false;
            }

            getXValue() {
                if (this.plugins.xInput) {
                    return this.plugins.xInput.getValue() || 0;
                }
                const input = document.getElementById('xInput');
                return input ? parseFloat(input.value) || 0 : 0;
            }

            getNValue() {
                if (this.plugins.nInput) {
                    return this.plugins.nInput.getValue() || 2;
                }
                const input = document.getElementById('nInput');
                return input ? parseFloat(input.value) || 2 : 2;
            }

            calculate() {
                const x = this.getXValue();
                const n = this.getNValue();

                // éªŒè¯è¾“å…¥
                if (x <= 0) {
                    this.showNotification('è¢«å¼€æ–¹æ•°å¿…é¡»å¤§äº 0', 'error');
                    return;
                }

                if (n <= 0) {
                    this.showNotification('æ ¹æŒ‡æ•°å¿…é¡»å¤§äº 0', 'error');
                    return;
                }

                // è®¡ç®— n æ¬¡æ–¹æ ¹
                let result;
                let error = null;
                
                try {
                    result = nthRoot(x, n);
                    
                    // æ£€æŸ¥ç»“æœæ˜¯å¦æœ‰æ•ˆ
                    if (!isFinite(result) || isNaN(result)) {
                        throw new Error('è®¡ç®—ç»“æœæ— æ•ˆ');
                    }
                } catch (e) {
                    error = e.message;
                    result = null;
                }

                // æ˜¾ç¤ºç»“æœ
                this.displayResult(x, n, result, error);

                // æ›´æ–°ç»Ÿè®¡
                if (result !== null && !error) {
                    this.stats.totalCalculations++;
                    this.stats.results.push(result);
                    if (this.stats.results.length > 100) {
                        this.stats.results.shift();
                    }
                    this.updateStats();
                }

                // ä¿å­˜å†å²
                if (this.getCheckboxValue('saveHistory') && result !== null && !error) {
                    this.addToHistory(x, n, result);
                }

                if (!error) {
                    this.showNotification('è®¡ç®—å®Œæˆ', 'success');
                }
            }

            displayResult(x, n, result, error) {
                const resultDisplay = document.getElementById('resultDisplay');
                if (!resultDisplay) return;

                if (error || result === null) {
                    resultDisplay.innerHTML = `
                        <div class="result-formula">${this.getRootSymbol(n)}${x}</div>
                        <div class="result-value result-error">è®¡ç®—é”™è¯¯: ${error || 'æ— æ•ˆç»“æœ'}</div>
                    `;
                    return;
                }

                const formattedResult = this.formatNumber(result);
                const formula = this.getRootSymbol(n) + x;

                resultDisplay.innerHTML = `
                    <div class="result-formula">${formula}</div>
                    <div class="result-value">${formattedResult}</div>
                    <div style="font-size: 0.9rem; color: #94a3b8; margin-top: 8px;">
                        â‰ˆ ${result.toFixed(10)}
                    </div>
                `;

                // æ›´æ–°è¯¦ç»†ä¿¡æ¯
                this.updateCalculationInfo(x, n, result);

                // æ›´æ–°å¯è§†åŒ–
                if (this.getCheckboxValue('showVisualization')) {
                    this.updateVisualization(x, n, result);
                }
            }

            getRootSymbol(n) {
                const symbols = {
                    2: 'âˆš',
                    3: 'âˆ›',
                    4: 'âˆœ'
                };
                return symbols[n] || `^${n}âˆš`;
            }

            formatNumber(num) {
                if (num >= 1000000) {
                    return num.toExponential(6);
                }
                if (num < 0.0001 && num > 0) {
                    return num.toExponential(6);
                }
                // ä¿ç•™æœ€å¤š 10 ä½æœ‰æ•ˆæ•°å­—
                const magnitude = Math.floor(Math.log10(Math.abs(num)));
                const precision = Math.max(0, 10 - magnitude - 1);
                return parseFloat(num.toPrecision(10)).toString();
            }

            updateCalculationInfo(x, n, result) {
                const calculationInfo = document.getElementById('calculationInfo');
                if (!calculationInfo) return;

                if (!this.getCheckboxValue('showDetails')) {
                    calculationInfo.style.display = 'none';
                    return;
                }

                calculationInfo.style.display = 'block';
                document.getElementById('infoX').textContent = this.formatNumber(x);
                document.getElementById('infoN').textContent = n;
                document.getElementById('infoResult').textContent = this.formatNumber(result);

                // éªŒè¯ï¼šè®¡ç®— result^n åº”è¯¥çº¦ç­‰äº x
                const verify = Math.pow(result, n);
                document.getElementById('infoVerify').textContent = this.formatNumber(verify);

                // è®¡ç®—ç²¾åº¦è¯¯å·®
                const error = Math.abs(verify - x);
                document.getElementById('infoError').textContent = error < 0.0000001 ? 'æå°' : this.formatNumber(error);
            }

            updateVisualization(x, n, result) {
                const visualizationCard = document.getElementById('visualizationCard');
                const visualBars = document.getElementById('visualBars');
                
                if (!visualizationCard || !visualBars) return;

                visualizationCard.style.display = 'block';

                // æ·»åŠ å½“å‰ç»“æœåˆ°æœ€è¿‘ç»“æœåˆ—è¡¨
                this.recentResults.push({ x, n, result });
                if (this.recentResults.length > 5) {
                    this.recentResults.shift();
                }

                // æ˜¾ç¤ºæœ€è¿‘ 5 ä¸ªç»“æœ
                visualBars.innerHTML = this.recentResults.map((item, idx) => {
                    const percentage = (item.result / Math.max(...this.recentResults.map(r => r.result))) * 100;
                    return `
                        <div style="margin-bottom: 12px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                <span style="font-size: 0.9rem; color: #64748b;">${this.getRootSymbol(item.n)}${item.x}</span>
                                <span style="font-size: 0.9rem; color: #667eea; font-weight: 600;">${this.formatNumber(item.result)}</span>
                            </div>
                            <div class="visual-bar" style="width: ${percentage}%;">
                                ${this.formatNumber(item.result)}
                            </div>
                        </div>
                    `;
                }).join('');
            }

            runBatchTest() {
                const testCases = [
                    { x: 32, n: 5, description: '32 çš„ 5 æ¬¡æ–¹æ ¹' },
                    { x: 16, n: 2, description: '16 çš„å¹³æ–¹æ ¹' },
                    { x: 27, n: 3, description: '27 çš„ç«‹æ–¹æ ¹' },
                    { x: 81, n: 4, description: '81 çš„ 4 æ¬¡æ–¹æ ¹' },
                    { x: 64, n: 6, description: '64 çš„ 6 æ¬¡æ–¹æ ¹' },
                    { x: 100, n: 2, description: '100 çš„å¹³æ–¹æ ¹' },
                    { x: 8, n: 3, description: '8 çš„ç«‹æ–¹æ ¹' },
                    { x: 256, n: 4, description: '256 çš„ 4 æ¬¡æ–¹æ ¹' }
                ];

                const batchTestContainer = document.getElementById('batchTestContainer');
                const batchTestCard = document.getElementById('batchTestCard');
                
                if (!batchTestContainer || !batchTestCard) return;

                batchTestCard.style.display = 'block';
                batchTestContainer.innerHTML = '';

                testCases.forEach((testCase, idx) => {
                    let result;
                    let error = null;
                    
                    try {
                        result = nthRoot(testCase.x, testCase.n);
                        if (!isFinite(result) || isNaN(result)) {
                            throw new Error('è®¡ç®—ç»“æœæ— æ•ˆ');
                        }
                    } catch (e) {
                        error = e.message;
                    }

                    const testItem = document.createElement('div');
                    testItem.className = 'test-item';
                    testItem.innerHTML = `
                        <div class="test-header">
                            <span class="test-title">æµ‹è¯• ${idx + 1}: ${testCase.description}</span>
                            <span class="test-result">${error ? 'âŒ é”™è¯¯' : 'âœ… ' + this.formatNumber(result)}</span>
                        </div>
                        <div class="test-args">
                            x = ${testCase.x}, n = ${testCase.n} | 
                            ç»“æœ: ${error ? error : this.formatNumber(result)}
                            ${!error ? `| éªŒè¯: ${this.formatNumber(Math.pow(result, testCase.n))}` : ''}
                        </div>
                    `;
                    batchTestContainer.appendChild(testItem);
                });

                this.showNotification('æ‰¹é‡æµ‹è¯•å®Œæˆ', 'success');
            }

            generateRandom() {
                const x = Math.floor(Math.random() * 1000) + 1;
                const n = Math.floor(Math.random() * 10) + 2;

                if (this.plugins.xInput) {
                    this.plugins.xInput.setValue(x);
                } else {
                    const xInput = document.getElementById('xInput');
                    if (xInput) xInput.value = x;
                }

                if (this.plugins.nInput) {
                    this.plugins.nInput.setValue(n);
                } else {
                    const nInput = document.getElementById('nInput');
                    if (nInput) nInput.value = n;
                }

                // æ›´æ–°å¿«é€Ÿé€‰æ‹©æŒ‰é’®
                const quickRoots = document.getElementById('quickRoots');
                if (quickRoots) {
                    const buttons = quickRoots.querySelectorAll('.quick-root-btn');
                    buttons.forEach(btn => {
                        if (parseInt(btn.dataset.n) === n) {
                            buttons.forEach(b => b.classList.remove('active'));
                            btn.classList.add('active');
                        }
                    });
                }

                if (this.getCheckboxValue('autoCalculate')) {
                    this.calculate();
                }

                this.showNotification('éšæœºå€¼å·²ç”Ÿæˆ', 'success');
            }

            loadSample() {
                const samples = [
                    { x: 32, n: 5 },
                    { x: 16, n: 2 },
                    { x: 27, n: 3 },
                    { x: 81, n: 4 },
                    { x: 64, n: 6 }
                ];

                const randomSample = samples[Math.floor(Math.random() * samples.length)];

                if (this.plugins.xInput) {
                    this.plugins.xInput.setValue(randomSample.x);
                } else {
                    const xInput = document.getElementById('xInput');
                    if (xInput) xInput.value = randomSample.x;
                }

                if (this.plugins.nInput) {
                    this.plugins.nInput.setValue(randomSample.n);
                } else {
                    const nInput = document.getElementById('nInput');
                    if (nInput) nInput.value = randomSample.n;
                }

                // æ›´æ–°å¿«é€Ÿé€‰æ‹©æŒ‰é’®
                const quickRoots = document.getElementById('quickRoots');
                if (quickRoots) {
                    const buttons = quickRoots.querySelectorAll('.quick-root-btn');
                    buttons.forEach(btn => {
                        if (parseInt(btn.dataset.n) === randomSample.n) {
                            buttons.forEach(b => b.classList.remove('active'));
                            btn.classList.add('active');
                        }
                    });
                }

                if (this.getCheckboxValue('autoCalculate')) {
                    this.calculate();
                }

                this.showNotification('ç¤ºä¾‹æ•°æ®å·²åŠ è½½', 'success');
            }

            clearAll() {
                this.plugins.modal?.confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†…å®¹å—ï¼Ÿ').then(confirmed => {
                    if (confirmed) {
                        if (this.plugins.xInput) {
                            this.plugins.xInput.setValue(16);
                        } else {
                            const xInput = document.getElementById('xInput');
                            if (xInput) xInput.value = '16';
                        }

                        if (this.plugins.nInput) {
                            this.plugins.nInput.setValue(2);
                        } else {
                            const nInput = document.getElementById('nInput');
                            if (nInput) nInput.value = '2';
                        }

                        const resultDisplay = document.getElementById('resultDisplay');
                        if (resultDisplay) {
                            resultDisplay.innerHTML = '<div style="color: #94a3b8; font-size: 0.9rem;">è®¡ç®—ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</div>';
                        }

                        const calculationInfo = document.getElementById('calculationInfo');
                        if (calculationInfo) calculationInfo.style.display = 'none';

                        const visualizationCard = document.getElementById('visualizationCard');
                        if (visualizationCard) visualizationCard.style.display = 'none';

                        const batchTestCard = document.getElementById('batchTestCard');
                        if (batchTestCard) batchTestCard.style.display = 'none';

                        this.recentResults = [];

                        // æ¸…é™¤å¿«é€Ÿé€‰æ‹©æŒ‰é’®çŠ¶æ€
                        const quickRoots = document.getElementById('quickRoots');
                        if (quickRoots) {
                            const buttons = quickRoots.querySelectorAll('.quick-root-btn');
                            buttons.forEach(btn => btn.classList.remove('active'));
                        }

                        this.showNotification('å·²æ¸…ç©ºæ‰€æœ‰å†…å®¹', 'info');
                    }
                });
            }

            updateStats() {
                document.getElementById('totalCalculations').textContent = this.stats.totalCalculations;
                
                if (this.stats.results.length > 0) {
                    const avg = this.stats.results.reduce((a, b) => a + b, 0) / this.stats.results.length;
                    const max = Math.max(...this.stats.results);
                    document.getElementById('averageRoot').textContent = this.formatNumber(avg);
                    document.getElementById('maxRoot').textContent = this.formatNumber(max);
                } else {
                    document.getElementById('averageRoot').textContent = '-';
                    document.getElementById('maxRoot').textContent = '-';
                }
            }

            updateDisplay() {
                // æ ¹æ®é€‰é¡¹æ›´æ–°æ˜¾ç¤º
                const x = this.getXValue();
                const n = this.getNValue();
                
                if (x > 0 && n > 0) {
                    try {
                        const result = nthRoot(x, n);
                        if (isFinite(result) && !isNaN(result)) {
                            this.updateCalculationInfo(x, n, result);
                            if (this.getCheckboxValue('showVisualization')) {
                                this.updateVisualization(x, n, result);
                            }
                        }
                    } catch (e) {
                        // å¿½ç•¥é”™è¯¯
                    }
                }
            }

            addToHistory(x, n, result) {
                this.history.unshift({
                    time: new Date().toLocaleString('zh-CN'),
                    x: x,
                    n: n,
                    result: result
                });

                if (this.history.length > 50) {
                    this.history.pop();
                }

                this.renderHistory();
                this.saveHistory();
            }

            renderHistory() {
                const container = document.getElementById('historyList');
                if (!container) return;

                if (this.history.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state" style="padding: 40px 20px;">
                            <div class="empty-state-icon">ğŸ“</div>
                            <p style="font-size: 0.9rem;">è®¡ç®—å†å²å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = this.history.slice(0, 20).map((item, idx) => `
                    <div class="history-item" onclick="window.rootCalculator?.loadHistory(${idx})">
                        <div class="history-time">${item.time}</div>
                        <div class="history-info">
                            ${this.getRootSymbol(item.n)}${item.x} = ${this.formatNumber(item.result)}
                        </div>
                    </div>
                `).join('');
            }

            loadHistory(index) {
                const item = this.history[index];
                if (!item) return;

                if (this.plugins.xInput) {
                    this.plugins.xInput.setValue(item.x);
                } else {
                    const xInput = document.getElementById('xInput');
                    if (xInput) xInput.value = item.x;
                }

                if (this.plugins.nInput) {
                    this.plugins.nInput.setValue(item.n);
                } else {
                    const nInput = document.getElementById('nInput');
                    if (nInput) nInput.value = item.n;
                }

                this.calculate();
                this.showNotification('å·²ä»å†å²è®°å½•åŠ è½½', 'success');
            }

            showNotification(message, type = 'info') {
                if (this.plugins.notification && this.getCheckboxValue('enableNotifications')) {
                    this.plugins.notification.show(message, type);
                } else {
                    console.log(`${type.toUpperCase()}: ${message}`);
                }
            }

            saveHistory() {
                try {
                    localStorage.setItem('rootCalculator_history', JSON.stringify(this.history));
                    localStorage.setItem('rootCalculator_stats', JSON.stringify(this.stats));
                } catch (error) {
                    console.warn('ä¿å­˜å†å²è®°å½•å¤±è´¥:', error);
                }
            }

            loadHistoryFromStorage() {
                try {
                    const savedHistory = localStorage.getItem('rootCalculator_history');
                    if (savedHistory) {
                        this.history = JSON.parse(savedHistory);
                        this.renderHistory();
                    }

                    const savedStats = localStorage.getItem('rootCalculator_stats');
                    if (savedStats) {
                        this.stats = { ...this.stats, ...JSON.parse(savedStats) };
                        this.updateStats();
                    }
                } catch (error) {
                    console.warn('åŠ è½½å†å²è®°å½•å¤±è´¥:', error);
                }
            }
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            window.rootCalculator = new RootCalculator();
        });

        if (document.readyState !== 'loading' && !window.rootCalculator) {
            window.rootCalculator = new RootCalculator();
        }
    </script>
</body>
</html>