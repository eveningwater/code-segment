<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ¬åœ°å­˜å‚¨æ£€æµ‹å’Œç®¡ç†å·¥å…·</title>
    <link rel="stylesheet" href="../../demo/plugins/modal/style.css">
    <link rel="stylesheet" href="../../demo/plugins/checkbox/style.css">
    <link rel="stylesheet" href="../../demo/plugins/notification/style.css">
    <link rel="stylesheet" href="../../demo/plugins/select/style.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .card h2 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-section {
            text-align: center;
        }

        .status-indicator {
            display: inline-block;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            margin: 20px auto;
            transition: all 0.3s ease;
        }

        .status-enabled {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            box-shadow: 0 0 30px rgba(16, 185, 129, 0.3);
        }

        .status-disabled {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            box-shadow: 0 0 30px rgba(239, 68, 68, 0.3);
        }

        .status-text {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .status-details {
            color: #666;
            font-size: 0.9rem;
        }

        .test-section {
            margin-top: 20px;
        }

        .test-button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .test-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .storage-info {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .info-item:last-child {
            border-bottom: none;
        }

        .info-label {
            font-weight: 600;
            color: #495057;
        }

        .info-value {
            color: #6c757d;
            font-family: 'Monaco', 'Menlo', monospace;
        }

        .storage-manager {
            margin-top: 20px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #495057;
        }

        .input-group input,
        .input-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd8;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-warning {
            background: #f59e0b;
            color: white;
        }

        .btn-warning:hover {
            background: #d97706;
        }

        .storage-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            margin-top: 15px;
        }

        .storage-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid #f1f3f4;
            transition: background-color 0.3s ease;
        }

        .storage-item:hover {
            background-color: #f8f9fa;
        }

        .storage-item:last-child {
            border-bottom: none;
        }

        .storage-key {
            font-weight: 600;
            color: #495057;
            font-family: 'Monaco', 'Menlo', monospace;
        }

        .storage-value {
            color: #6c757d;
            font-size: 0.9rem;
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .storage-actions {
            display: flex;
            gap: 5px;
        }

        .btn-small {
            padding: 4px 8px;
            font-size: 0.8rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: #667eea;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #6c757d;
            margin-top: 5px;
        }

        .advanced-options {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .options-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: #495057;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checkbox-item label {
            font-size: 0.9rem;
            color: #495057;
            cursor: pointer;
        }


        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 2rem;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes bounce {

            0%,
            20%,
            53%,
            80%,
            100% {
                transform: translate3d(0, 0, 0);
            }

            40%,
            43% {
                transform: translate3d(0, -8px, 0);
            }

            70% {
                transform: translate3d(0, -4px, 0);
            }

            90% {
                transform: translate3d(0, -2px, 0);
            }
        }

        .btn:active {
            transform: scale(0.95);
        }

        .storage-item {
            transition: all 0.3s ease;
        }

        .storage-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .modal-content {
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” æœ¬åœ°å­˜å‚¨æ£€æµ‹å’Œç®¡ç†å·¥å…·</h1>
            <p>æ£€æµ‹æµè§ˆå™¨æœ¬åœ°å­˜å‚¨æ”¯æŒçŠ¶æ€ï¼Œå¹¶æä¾›å®Œæ•´çš„å­˜å‚¨ç®¡ç†åŠŸèƒ½</p>
        </div>

        <div class="main-content">
            <div class="card">
                <h2>ğŸ“Š å­˜å‚¨çŠ¶æ€æ£€æµ‹</h2>
                <div class="status-section">
                    <div class="status-indicator" id="statusIndicator">
                        <span id="statusIcon">â³</span>
                    </div>
                    <div class="status-text" id="statusText">æ£€æµ‹ä¸­...</div>
                    <div class="status-details" id="statusDetails">æ­£åœ¨æ£€æµ‹æµè§ˆå™¨æœ¬åœ°å­˜å‚¨æ”¯æŒçŠ¶æ€</div>
                </div>

                <div class="test-section">
                    <button class="test-button" id="testButton" onclick="window.storageManager?.testStorage()">
                        é‡æ–°æ£€æµ‹
                    </button>
                    <button class="test-button" id="clearButton" onclick="window.storageManager?.clearAllStorage()">
                        æ¸…ç©ºå­˜å‚¨
                    </button>
                    <button class="test-button" id="addTestDataBtn" onclick="testAddData()">
                        æ·»åŠ æµ‹è¯•æ•°æ®
                    </button>
                </div>

                <div class="storage-info" id="storageInfo" style="display: none;">
                    <div class="info-item">
                        <span class="info-label">å­˜å‚¨ç±»å‹</span>
                        <span class="info-value" id="storageType">localStorage</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">æ”¯æŒçŠ¶æ€</span>
                        <span class="info-value" id="supportStatus">æœªçŸ¥</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">å¯ç”¨ç©ºé—´</span>
                        <span class="info-value" id="availableSpace">æ£€æµ‹ä¸­...</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">å·²ç”¨é¡¹ç›®</span>
                        <span class="info-value" id="usedItems">0</span>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>ğŸ› ï¸ å­˜å‚¨ç®¡ç†</h2>
                <div class="storage-manager">
                    <div class="input-group">
                        <label for="keyInput">é”®å</label>
                        <input type="text" id="keyInput" placeholder="è¾“å…¥å­˜å‚¨é”®å">
                    </div>
                    <div class="input-group">
                        <label for="valueInput">å€¼</label>
                        <textarea id="valueInput" rows="3" placeholder="è¾“å…¥å­˜å‚¨å€¼"></textarea>
                    </div>
                    <div class="button-group">
                        <button class="btn btn-primary"
                            onclick="if(window.storageManager) window.storageManager.setItem(); else console.error('storageManageræœªåˆå§‹åŒ–')">å­˜å‚¨</button>
                        <button class="btn btn-success"
                            onclick="if(window.storageManager) window.storageManager.getItem(); else console.error('storageManageræœªåˆå§‹åŒ–')">è¯»å–</button>
                        <button class="btn btn-danger"
                            onclick="if(window.storageManager) window.storageManager.removeItem(); else console.error('storageManageræœªåˆå§‹åŒ–')">åˆ é™¤</button>
                        <button class="btn btn-warning"
                            onclick="if(window.storageManager) window.storageManager.refreshList(); else console.error('storageManageræœªåˆå§‹åŒ–')">åˆ·æ–°</button>
                    </div>
                </div>

                <div class="storage-list" id="storageList">
                    <!-- å­˜å‚¨é¡¹ç›®åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>

        <div class="card">
            <h2>ğŸ“ˆ å­˜å‚¨ç»Ÿè®¡</h2>
            <div class="stats-grid" id="statsGrid">
                <!-- ç»Ÿè®¡ä¿¡æ¯å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

        <div class="card">
            <h2>âš™ï¸ é«˜çº§é€‰é¡¹</h2>
            <div class="advanced-options">
                <div class="options-title">æ£€æµ‹é€‰é¡¹</div>
                <div class="checkbox-group" id="checkboxGroup">
                    <!-- å¤é€‰æ¡†å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>

    <script src="../../demo/plugins/modal/index.js"></script>
    <script src="../../demo/plugins/checkbox/index.js"></script>
    <script src="../../demo/plugins/notification/index.js"></script>
    <script src="../../demo/plugins/select/index.js"></script>
    <script>
        // æœ¬åœ°å­˜å‚¨æ£€æµ‹å’Œç®¡ç†å·¥å…·ç±»
        class LocalStorageManager {
            constructor() {
                this.isEnabled = false;
                this.storageData = {};
                this.plugins = {};
                this.stats = {
                    totalItems: 0,
                    totalSize: 0,
                    lastTest: null,
                    testCount: 0
                };
                this.init();
            }

            // åˆå§‹åŒ–
            async init() {
                try {
                    await this.loadPlugins();
                    this.setupCheckboxes();
                    this.testStorage();

                    // æ·»åŠ ä¸€äº›æµ‹è¯•æ•°æ®
                    this.addTestData();

                    this.refreshList();
                    this.updateStats();
                    this.setupEventListeners();
                } catch (error) {
                    console.error('åˆå§‹åŒ–å¤±è´¥:', error);
                    this.showError('åˆå§‹åŒ–å¤±è´¥: ' + error.message);
                }
            }

            // æ·»åŠ æµ‹è¯•æ•°æ®
            addTestData() {
                if (!this.isEnabled) {
                    this.showError('æœ¬åœ°å­˜å‚¨ä¸å¯ç”¨ï¼Œæ— æ³•æ·»åŠ æµ‹è¯•æ•°æ®');
                    return;
                }

                try {
                    let addedCount = 0;
                    const testData = [
                        { key: 'test_key_1', value: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•å€¼' },
                        {
                            key: 'user_preferences', value: JSON.stringify({
                                theme: 'dark',
                                language: 'zh-CN',
                                notifications: true
                            })
                        },
                        { key: 'sample_data', value: 'Hello World! è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹æ•°æ®ã€‚' },
                        { key: 'current_time', value: new Date().toLocaleString() },
                        { key: 'random_number', value: Math.floor(Math.random() * 1000).toString() },
                        {
                            key: 'json_data', value: JSON.stringify({
                                name: 'æµ‹è¯•ç”¨æˆ·',
                                age: 25,
                                hobbies: ['ç¼–ç¨‹', 'é˜…è¯»', 'éŸ³ä¹']
                            })
                        }
                    ];

                    testData.forEach(({ key, value }) => {
                        if (!localStorage.getItem(key)) {
                            localStorage.setItem(key, value);
                            addedCount++;
                        }
                    });

                    if (addedCount > 0) {
                        this.showSuccess(`æˆåŠŸæ·»åŠ  ${addedCount} ä¸ªæµ‹è¯•æ•°æ®`);
                        this.refreshAndUpdate();
                        this.showAddTestDataModal(addedCount, testData);
                    } else {
                        this.showError('æ‰€æœ‰æµ‹è¯•æ•°æ®å·²å­˜åœ¨ï¼Œæ— éœ€é‡å¤æ·»åŠ ');
                    }
                } catch (error) {
                    this.showError('æ·»åŠ æµ‹è¯•æ•°æ®å¤±è´¥: ' + error.message);
                }
            }

            // åŠ è½½æ’ä»¶
            async loadPlugins() {
                try {
                    this.plugins.modal = new Modal();
                    this.plugins.notification = new Notification();
                } catch (error) {
                    console.warn('éƒ¨åˆ†æ’ä»¶åŠ è½½å¤±è´¥:', error);
                }
            }

            // è®¾ç½®å¤é€‰æ¡†
            setupCheckboxes() {
                const checkboxGroup = document.getElementById('checkboxGroup');
                if (!checkboxGroup) return;

                const options = [
                    { id: 'autoRefresh', label: 'è‡ªåŠ¨åˆ·æ–°åˆ—è¡¨', checked: true },
                    { id: 'showDetails', label: 'æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯', checked: true },
                    { id: 'enableNotifications', label: 'å¯ç”¨é€šçŸ¥æé†’', checked: true },
                    { id: 'saveHistory', label: 'ä¿å­˜æ£€æµ‹å†å²', checked: false }
                ];

                // ä½¿ç”¨è‡ªå®šä¹‰checkboxæ’ä»¶
                try {
                    const checkboxGroupInstance = Checkbox.createCheckboxGroup({
                        items: options.map(option => ({
                            id: option.id,
                            label: option.label,
                            checked: option.checked
                        })),
                        onChange: (checkedStates) => {
                            console.log('å¤é€‰æ¡†çŠ¶æ€å˜åŒ–:', checkedStates);
                        }
                    });

                    checkboxGroup.appendChild(checkboxGroupInstance.container);
                    this.plugins.checkboxGroup = checkboxGroupInstance;
                    this.checkboxOptions = options; // ä¿å­˜é€‰é¡¹æ˜ å°„
                } catch (error) {
                    console.warn('è‡ªå®šä¹‰å¤é€‰æ¡†åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨åŸç”Ÿå¤é€‰æ¡†:', error);
                    // é™çº§åˆ°åŸç”Ÿå¤é€‰æ¡†
                    options.forEach(option => {
                        const checkboxItem = document.createElement('div');
                        checkboxItem.className = 'checkbox-item';
                        checkboxItem.innerHTML = `
                            <input type="checkbox" id="${option.id}" ${option.checked ? 'checked' : ''}>
                            <label for="${option.id}">${option.label}</label>
                        `;
                        checkboxGroup.appendChild(checkboxItem);
                    });
                }
            }

            // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
            setupEventListeners() {
                // è¾“å…¥æ¡†å›è½¦äº‹ä»¶
                document.getElementById('keyInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.setItem();
                    }
                });

                // è‡ªåŠ¨åˆ·æ–°
                setInterval(() => {
                    if (this.getCheckboxValue('autoRefresh')) {
                        this.refreshList();
                        this.updateStats();
                    }
                }, 5000);
            }

            // æ£€æµ‹æœ¬åœ°å­˜å‚¨æ˜¯å¦å¯ç”¨
            isLocalStorageEnabled() {
                try {
                    const key = `__storage__test`;
                    window.localStorage.setItem(key, 'test');
                    window.localStorage.removeItem(key);
                    return true;
                } catch (e) {
                    return false;
                }
            }

            // æµ‹è¯•å­˜å‚¨åŠŸèƒ½
            testStorage() {
                const startTime = performance.now();
                this.isEnabled = this.isLocalStorageEnabled();
                const endTime = performance.now();

                this.updateStatus();
                this.updateStorageInfo();
                this.stats.lastTest = new Date();
                this.stats.testCount++;

                // æ˜¾ç¤ºæ£€æµ‹ç»“æœé€šçŸ¥
                this.showNotification(
                    this.isEnabled ? 'æœ¬åœ°å­˜å‚¨å¯ç”¨' : 'æœ¬åœ°å­˜å‚¨ä¸å¯ç”¨',
                    this.isEnabled ? 'success' : 'error'
                );

                if (this.getCheckboxValue('saveHistory')) {
                    this.saveTestHistory({
                        enabled: this.isEnabled,
                        testTime: endTime - startTime,
                        timestamp: this.stats.lastTest
                    });
                }
            }

            // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
            updateStatus() {
                const statusIndicator = document.getElementById('statusIndicator');
                const statusIcon = document.getElementById('statusIcon');
                const statusText = document.getElementById('statusText');
                const statusDetails = document.getElementById('statusDetails');

                if (this.isEnabled) {
                    statusIndicator.className = 'status-indicator status-enabled';
                    statusIcon.textContent = 'âœ…';
                    statusText.textContent = 'æœ¬åœ°å­˜å‚¨å¯ç”¨';
                    statusDetails.textContent = 'æµè§ˆå™¨æ”¯æŒlocalStorageï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨';
                } else {
                    statusIndicator.className = 'status-indicator status-disabled';
                    statusIcon.textContent = 'âŒ';
                    statusText.textContent = 'æœ¬åœ°å­˜å‚¨ä¸å¯ç”¨';
                    statusDetails.textContent = 'æµè§ˆå™¨ä¸æ”¯æŒlocalStorageæˆ–å·²è¢«ç¦ç”¨';
                }
            }

            // æ›´æ–°å­˜å‚¨ä¿¡æ¯
            updateStorageInfo() {
                const storageInfo = document.getElementById('storageInfo');
                const supportStatus = document.getElementById('supportStatus');
                const availableSpace = document.getElementById('availableSpace');
                const usedItems = document.getElementById('usedItems');

                storageInfo.style.display = 'block';
                supportStatus.textContent = this.isEnabled ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ';

                if (this.isEnabled) {
                    try {
                        const used = this.getStorageSize();
                        availableSpace.textContent = `${used} bytes`;
                        usedItems.textContent = Object.keys(this.storageData).length;
                    } catch (error) {
                        availableSpace.textContent = 'æ— æ³•è®¡ç®—';
                        usedItems.textContent = '0';
                    }
                } else {
                    availableSpace.textContent = 'ä¸å¯ç”¨';
                    usedItems.textContent = '0';
                }
            }

            // è·å–å­˜å‚¨å¤§å°
            getStorageSize() {
                let total = 0;
                for (let key in localStorage) {
                    if (localStorage.hasOwnProperty(key)) {
                        total += localStorage[key].length + key.length;
                    }
                }
                return total;
            }

            // å­˜å‚¨é¡¹ç›®
            setItem() {
                if (!this.validateStorage()) return;

                const { key, value } = this.getInputValues();
                if (!this.validateKey(key)) return;

                try {
                    localStorage.setItem(key, value);
                    this.showSuccess(`æˆåŠŸå­˜å‚¨: ${key}`);
                    this.refreshAndUpdate();
                } catch (error) {
                    this.showError('å­˜å‚¨å¤±è´¥: ' + error.message);
                }
            }

            // è¯»å–é¡¹ç›®
            getItem() {
                if (!this.validateStorage()) return;

                const { key } = this.getInputValues();
                if (!this.validateKey(key)) return;

                try {
                    const value = localStorage.getItem(key);
                    if (value !== null) {
                        // æ·»åŠ è¯»å–åŠ¨ç”»æ•ˆæœ
                        this.showReadAnimation(key, value);
                        this.setInputValues(key, value);
                        this.showSuccess(`æˆåŠŸè¯»å–: ${key}`);

                        // æ˜¾ç¤ºè¯¦ç»†è¯»å–ä¿¡æ¯å¼¹çª—
                        this.showReadDetailsModal(key, value);
                    } else {
                        this.showError(`é”® "${key}" ä¸å­˜åœ¨`);
                        this.showNotFoundModal(key);
                    }
                } catch (error) {
                    this.showError('è¯»å–å¤±è´¥: ' + error.message);
                }
            }

            // åˆ é™¤é¡¹ç›®
            removeItem() {
                if (!this.validateStorage()) return;

                const { key } = this.getInputValues();
                if (!this.validateKey(key)) return;

                try {
                    localStorage.removeItem(key);
                    this.showSuccess(`æˆåŠŸåˆ é™¤: ${key}`);
                    this.refreshAndUpdate();
                } catch (error) {
                    this.showError('åˆ é™¤å¤±è´¥: ' + error.message);
                }
            }

            // æ¸…ç©ºæ‰€æœ‰å­˜å‚¨
            clearAllStorage() {
                if (!this.validateStorage()) return;

                // ä½¿ç”¨è‡ªå®šä¹‰æ¨¡æ€æ¡†æ›¿ä»£confirm
                this.showConfirmModal(
                    'ç¡®è®¤æ¸…ç©ºå­˜å‚¨',
                    'ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æœ¬åœ°å­˜å‚¨æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼',
                    () => {
                        try {
                            localStorage.clear();
                            this.showSuccess('å·²æ¸…ç©ºæ‰€æœ‰å­˜å‚¨æ•°æ®');
                            this.refreshAndUpdate();
                        } catch (error) {
                            this.showError('æ¸…ç©ºå¤±è´¥: ' + error.message);
                        }
                    }
                );
            }

            // åˆ·æ–°å­˜å‚¨åˆ—è¡¨
            refreshList() {
                if (!this.isEnabled) {
                    document.getElementById('storageList').innerHTML = '<div style="padding: 20px; text-align: center; color: #6c757d;">æœ¬åœ°å­˜å‚¨ä¸å¯ç”¨</div>';
                    return;
                }

                const storageList = document.getElementById('storageList');

                // æ·»åŠ åˆ·æ–°åŠ¨ç”»
                this.showRefreshAnimation();

                this.storageData = {};

                try {
                    for (let i = 0; i < localStorage.length; i++) {
                        const key = localStorage.key(i);
                        const value = localStorage.getItem(key);
                        this.storageData[key] = value;
                    }

                    if (Object.keys(this.storageData).length === 0) {
                        storageList.innerHTML = '<div style="padding: 20px; text-align: center; color: #6c757d;">æš‚æ— å­˜å‚¨æ•°æ®</div>';
                        this.showEmptyListModal();
                        return;
                    }

                    const itemsHTML = Object.entries(this.storageData).map(([key, value], index) => `
                        <div class="storage-item" style="animation: slideInUp 0.3s ease-out ${index * 0.1}s both;">
                            <div>
                                <div class="storage-key">${key}</div>
                                <div class="storage-value">${this.truncateValue(value)}</div>
                            </div>
                            <div class="storage-actions">
                                <button class="btn btn-primary btn-small" onclick="window.storageManager?.loadItem('${key}')">åŠ è½½</button>
                                <button class="btn btn-danger btn-small" onclick="window.storageManager?.deleteItem('${key}')">åˆ é™¤</button>
                            </div>
                        </div>
                    `).join('');

                    storageList.innerHTML = itemsHTML;

                    // æ˜¾ç¤ºåˆ·æ–°æˆåŠŸæç¤º
                    this.showRefreshSuccessModal(Object.keys(this.storageData).length);
                } catch (error) {
                    storageList.innerHTML = '<div style="padding: 20px; text-align: center; color: #dc2626;">è¯»å–å­˜å‚¨æ•°æ®å¤±è´¥</div>';
                    this.showError('åˆ·æ–°å­˜å‚¨åˆ—è¡¨å¤±è´¥: ' + error.message);
                }
            }

            // åŠ è½½é¡¹ç›®åˆ°è¾“å…¥æ¡†
            loadItem(key) {
                // å…ˆä»localStorageé‡æ–°è·å–æœ€æ–°æ•°æ®
                const value = localStorage.getItem(key);
                if (value !== null) {
                    // æ·»åŠ åŠ è½½åŠ¨ç”»æ•ˆæœ
                    this.showLoadAnimation(key, value);

                    this.setInputValues(key, value);
                    this.showSuccess(`å·²åŠ è½½: ${key}`);

                    // æ˜¾ç¤ºåŠ è½½è¯¦æƒ…å¼¹çª—
                    this.showLoadDetailsModal(key, value);
                } else {
                    this.showError(`é”® "${key}" ä¸å­˜åœ¨`);
                    this.showNotFoundModal(key);
                }
            }

            // åˆ é™¤æŒ‡å®šé¡¹ç›®
            deleteItem(key) {
                this.showConfirmModal(
                    'ç¡®è®¤åˆ é™¤',
                    `ç¡®å®šè¦åˆ é™¤ "${key}" å—ï¼Ÿ`,
                    () => {
                        try {
                            localStorage.removeItem(key);
                            this.showSuccess(`å·²åˆ é™¤: ${key}`);
                            this.refreshAndUpdate();
                        } catch (error) {
                            this.showError('åˆ é™¤å¤±è´¥: ' + error.message);
                        }
                    }
                );
            }

            // æˆªæ–­æ˜¾ç¤ºå€¼
            truncateValue(value, maxLength = 50) {
                if (value.length <= maxLength) return value;
                return value.substring(0, maxLength) + '...';
            }

            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            updateStats() {
                this.stats.totalItems = Object.keys(this.storageData).length;
                this.stats.totalSize = this.getStorageSize();

                const statsGrid = document.getElementById('statsGrid');
                statsGrid.innerHTML = `
                    <div class="stat-card">
                        <div class="stat-number">${this.stats.totalItems}</div>
                        <div class="stat-label">å­˜å‚¨é¡¹ç›®</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${this.stats.totalSize}</div>
                        <div class="stat-label">æ€»å¤§å°(bytes)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${this.stats.testCount}</div>
                        <div class="stat-label">æ£€æµ‹æ¬¡æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${this.isEnabled ? 'æ˜¯' : 'å¦'}</div>
                        <div class="stat-label">å­˜å‚¨å¯ç”¨</div>
                    </div>
                `;
            }

            // ä¿å­˜æ£€æµ‹å†å²
            saveTestHistory(testData) {
                try {
                    const history = JSON.parse(localStorage.getItem('storageTestHistory') || '[]');
                    history.push(testData);
                    if (history.length > 50) {
                        history.shift(); // åªä¿ç•™æœ€è¿‘50æ¡è®°å½•
                    }
                    localStorage.setItem('storageTestHistory', JSON.stringify(history));
                } catch (error) {
                    console.warn('ä¿å­˜æ£€æµ‹å†å²å¤±è´¥:', error);
                }
            }

            // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯ï¼ˆä½¿ç”¨Notificationæ’ä»¶ï¼‰
            showSuccess(message) {
                this.showNotification(message, 'success');
            }

            // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯ï¼ˆä½¿ç”¨Notificationæ’ä»¶ï¼‰
            showError(message) {
                this.showNotification(message, 'error');
            }

            // æ˜¾ç¤ºé€šçŸ¥ï¼ˆç»Ÿä¸€ä½¿ç”¨Notificationæ’ä»¶ï¼‰
            showNotification(message, type) {
                if (this.plugins.notification) {
                    this.plugins.notification.show(message, type);
                } else {
                    // é™çº§åˆ°ç®€å•çš„alertï¼ˆä»…åœ¨æ’ä»¶æœªåŠ è½½æ—¶ä½¿ç”¨ï¼‰
                    alert(message);
                }
            }

            // è·å–è¾“å…¥æ¡†å€¼çš„é€šç”¨æ–¹æ³•
            getInputValues() {
                return {
                    key: document.getElementById('keyInput').value.trim(),
                    value: document.getElementById('valueInput').value.trim()
                };
            }

            // è®¾ç½®è¾“å…¥æ¡†å€¼çš„é€šç”¨æ–¹æ³•
            setInputValues(key, value) {
                document.getElementById('keyInput').value = key || '';
                document.getElementById('valueInput').value = value || '';
            }

            // éªŒè¯é”®åçš„é€šç”¨æ–¹æ³•
            validateKey(key) {
                if (!key) {
                    this.showError('è¯·è¾“å…¥é”®å');
                    return false;
                }
                return true;
            }

            // éªŒè¯æœ¬åœ°å­˜å‚¨å¯ç”¨æ€§çš„é€šç”¨æ–¹æ³•
            validateStorage() {
                if (!this.isEnabled) {
                    this.showError('æœ¬åœ°å­˜å‚¨ä¸å¯ç”¨ï¼Œæ— æ³•æ‰§è¡Œæ“ä½œ');
                    return false;
                }
                return true;
            }

            // åˆ·æ–°åˆ—è¡¨å’Œç»Ÿè®¡çš„é€šç”¨æ–¹æ³•
            refreshAndUpdate() {
                this.refreshList();
                this.updateStats();
            }

            // è·å–å¤é€‰æ¡†å€¼
            getCheckboxValue(checkboxId) {
                if (this.plugins.checkboxGroup && this.checkboxOptions) {
                    try {
                        // æ‰¾åˆ°å¯¹åº”é€‰é¡¹çš„ç´¢å¼•
                        const optionIndex = this.checkboxOptions.findIndex(option => option.id === checkboxId);
                        if (optionIndex !== -1) {
                            const checkedStates = this.plugins.checkboxGroup.getAllChecked();
                            return checkedStates[optionIndex] || false;
                        }
                    } catch (error) {
                        console.warn('è·å–å¤é€‰æ¡†å€¼å¤±è´¥ï¼Œä½¿ç”¨åŸç”Ÿæ–¹æ³•:', error);
                    }
                }
                // é™çº§åˆ°åŸç”Ÿå¤é€‰æ¡†
                const checkbox = document.getElementById(checkboxId);
                return checkbox ? checkbox.checked : false;
            }

            // æ˜¾ç¤ºç¡®è®¤æ¨¡æ€æ¡†
            showConfirmModal(title, message, onConfirm) {
                if (this.plugins.modal) {
                    this.plugins.modal.show({
                        title: title,
                        content: `<p style="margin: 0; font-size: 16px;">${message}</p>`,
                        type: "confirm",
                        onConfirm: onConfirm,
                        onCancel: () => {
                            // å–æ¶ˆæ“ä½œï¼Œä¸éœ€è¦åšä»»ä½•äº‹æƒ…
                        }
                    });
                } else {
                    // é™çº§åˆ°åŸç”Ÿconfirm
                    if (confirm(message)) {
                        onConfirm();
                    }
                }
            }

            // æ˜¾ç¤ºè¯»å–åŠ¨ç”»
            showReadAnimation(key, value) {
                const keyInput = document.getElementById('keyInput');
                const valueInput = document.getElementById('valueInput');

                // æ·»åŠ é«˜äº®æ•ˆæœ
                keyInput.style.borderColor = '#10b981';
                valueInput.style.borderColor = '#10b981';

                // æ·»åŠ è„‰å†²æ•ˆæœ
                keyInput.style.animation = 'pulse 0.6s ease-in-out';
                valueInput.style.animation = 'pulse 0.6s ease-in-out';

                setTimeout(() => {
                    keyInput.style.borderColor = '';
                    valueInput.style.borderColor = '';
                    keyInput.style.animation = '';
                    valueInput.style.animation = '';
                }, 600);
            }

            // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
            showLoadAnimation(key, value) {
                const keyInput = document.getElementById('keyInput');
                const valueInput = document.getElementById('valueInput');

                // æ·»åŠ åŠ è½½æ•ˆæœ
                keyInput.style.transform = 'scale(1.05)';
                valueInput.style.transform = 'scale(1.05)';
                keyInput.style.boxShadow = '0 0 20px rgba(16, 185, 129, 0.3)';
                valueInput.style.boxShadow = '0 0 20px rgba(16, 185, 129, 0.3)';

                setTimeout(() => {
                    keyInput.style.transform = '';
                    valueInput.style.transform = '';
                    keyInput.style.boxShadow = '';
                    valueInput.style.boxShadow = '';
                }, 500);
            }

            // æ˜¾ç¤ºåˆ·æ–°åŠ¨ç”»
            showRefreshAnimation() {
                const storageList = document.getElementById('storageList');
                storageList.style.opacity = '0.5';
                storageList.style.transform = 'scale(0.98)';

                setTimeout(() => {
                    storageList.style.opacity = '';
                    storageList.style.transform = '';
                }, 300);
            }

            // æ˜¾ç¤ºè¯»å–è¯¦æƒ…å¼¹çª—
            showReadDetailsModal(key, value) {
                if (this.plugins.modal) {
                    this.plugins.modal.show({
                        title: 'ğŸ“– è¯»å–è¯¦æƒ…',
                        content: `
                            <div style="padding: 20px;">
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                    <h4 style="margin: 0 0 10px 0; color: #495057;">é”®å</h4>
                                    <code style="background: #e9ecef; padding: 5px 10px; border-radius: 4px; font-size: 14px;">${key}</code>
                                </div>
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                    <h4 style="margin: 0 0 10px 0; color: #495057;">å€¼</h4>
                                    <div style="background: #e9ecef; padding: 10px; border-radius: 4px; font-family: monospace; white-space: pre-wrap; max-height: 200px; overflow-y: auto;">${value}</div>
                                </div>
                                <div style="background: #e8f5e8; padding: 10px; border-radius: 6px; border-left: 4px solid #10b981;">
                                    <strong>âœ… è¯»å–æˆåŠŸï¼</strong> æ•°æ®å·²åŠ è½½åˆ°è¾“å…¥æ¡†ä¸­ã€‚
                                </div>
                            </div>
                        `,
                        type: "alert"
                    });
                }
            }

            // æ˜¾ç¤ºåŠ è½½è¯¦æƒ…å¼¹çª—
            showLoadDetailsModal(key, value) {
                if (this.plugins.modal) {
                    this.plugins.modal.show({
                        title: 'ğŸ”„ åŠ è½½è¯¦æƒ…',
                        content: `
                            <div style="padding: 20px;">
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                    <h4 style="margin: 0 0 10px 0; color: #495057;">å·²åŠ è½½çš„é”®</h4>
                                    <code style="background: #e9ecef; padding: 5px 10px; border-radius: 4px; font-size: 14px;">${key}</code>
                                </div>
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                    <h4 style="margin: 0 0 10px 0; color: #495057;">å€¼å†…å®¹</h4>
                                    <div style="background: #e9ecef; padding: 10px; border-radius: 4px; font-family: monospace; white-space: pre-wrap; max-height: 200px; overflow-y: auto;">${value}</div>
                                </div>
                                <div style="background: #e8f5e8; padding: 10px; border-radius: 6px; border-left: 4px solid #10b981;">
                                    <strong>âœ… åŠ è½½å®Œæˆï¼</strong> æ•°æ®å·²å¡«å…¥è¾“å…¥æ¡†ï¼Œå¯ä»¥ç»§ç»­ç¼–è¾‘ã€‚
                                </div>
                            </div>
                        `,
                        type: "alert"
                    });
                }
            }

            // æ˜¾ç¤ºåˆ·æ–°æˆåŠŸå¼¹çª—
            showRefreshSuccessModal(itemCount) {
                if (this.plugins.modal) {
                    this.plugins.modal.show({
                        title: 'ğŸ”„ åˆ·æ–°å®Œæˆ',
                        content: `
                            <div style="padding: 20px; text-align: center;">
                                <div style="font-size: 48px; margin-bottom: 15px;">âœ…</div>
                                <h3 style="margin: 0 0 10px 0; color: #10b981;">åˆ·æ–°æˆåŠŸï¼</h3>
                                <p style="margin: 0 0 15px 0; color: #6c757d;">å…±æ‰¾åˆ° <strong>${itemCount}</strong> ä¸ªå­˜å‚¨é¡¹ç›®</p>
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                                    <p style="margin: 0; font-size: 14px; color: #495057;">åˆ—è¡¨å·²æ›´æ–°ï¼Œæ‰€æœ‰é¡¹ç›®éƒ½æ˜¾ç¤ºåœ¨ä¸‹æ–¹</p>
                                </div>
                            </div>
                        `,
                        type: "alert"
                    });
                }
            }

            // æ˜¾ç¤ºç©ºåˆ—è¡¨å¼¹çª—
            showEmptyListModal() {
                if (this.plugins.modal) {
                    this.plugins.modal.show({
                        title: 'ğŸ“­ å­˜å‚¨åˆ—è¡¨ä¸ºç©º',
                        content: `
                            <div style="padding: 20px; text-align: center;">
                                <div style="font-size: 48px; margin-bottom: 15px;">ğŸ“­</div>
                                <h3 style="margin: 0 0 10px 0; color: #6c757d;">æš‚æ— å­˜å‚¨æ•°æ®</h3>
                                <p style="margin: 0 0 15px 0; color: #6c757d;">å½“å‰æœ¬åœ°å­˜å‚¨ä¸­æ²¡æœ‰æ•°æ®</p>
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                                    <p style="margin: 0; font-size: 14px; color: #495057;">ğŸ’¡ æç¤ºï¼šå¯ä»¥æ·»åŠ ä¸€äº›æµ‹è¯•æ•°æ®æ¥ä½“éªŒåŠŸèƒ½</p>
                                </div>
                            </div>
                        `,
                        type: "alert"
                    });
                }
            }

            // æ˜¾ç¤ºæœªæ‰¾åˆ°å¼¹çª—
            showNotFoundModal(key) {
                if (this.plugins.modal) {
                    this.plugins.modal.show({
                        title: 'âŒ æœªæ‰¾åˆ°æ•°æ®',
                        content: `
                            <div style="padding: 20px; text-align: center;">
                                <div style="font-size: 48px; margin-bottom: 15px;">ğŸ”</div>
                                <h3 style="margin: 0 0 10px 0; color: #dc2626;">é”®ä¸å­˜åœ¨</h3>
                                <p style="margin: 0 0 15px 0; color: #6c757d;">æœªæ‰¾åˆ°é”®: <code style="background: #f3f4f6; padding: 2px 6px; border-radius: 3px;">${key}</code></p>
                                <div style="background: #fef2f2; padding: 15px; border-radius: 8px; border-left: 4px solid #dc2626;">
                                    <p style="margin: 0; font-size: 14px; color: #dc2626;">è¯·æ£€æŸ¥é”®åæ˜¯å¦æ­£ç¡®ï¼Œæˆ–å…ˆå­˜å‚¨ä¸€äº›æ•°æ®</p>
                                </div>
                            </div>
                        `,
                        type: "alert"
                    });
                }
            }

            // æ˜¾ç¤ºæ·»åŠ æµ‹è¯•æ•°æ®æˆåŠŸå¼¹çª—
            showAddTestDataModal(addedCount, testData) {
                if (this.plugins.modal) {
                    const addedItemsHTML = testData.map(({ key, value }) => `
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 6px; margin-bottom: 8px; border-left: 3px solid #10b981;">
                            <div style="font-weight: 600; color: #495057; margin-bottom: 4px;">
                                <code style="background: #e9ecef; padding: 2px 6px; border-radius: 3px; font-size: 12px;">${key}</code>
                            </div>
                            <div style="font-size: 12px; color: #6c757d; font-family: monospace; white-space: pre-wrap; max-height: 60px; overflow: hidden;">${value.length > 50 ? value.substring(0, 50) + '...' : value}</div>
                        </div>
                    `).join('');

                    this.plugins.modal.show({
                        title: 'ğŸ‰ æµ‹è¯•æ•°æ®æ·»åŠ æˆåŠŸ',
                        content: `
                            <div style="padding: 20px;">
                                <div style="text-align: center; margin-bottom: 20px;">
                                    <div style="font-size: 48px; margin-bottom: 10px;">âœ…</div>
                                    <h3 style="margin: 0 0 10px 0; color: #10b981;">æˆåŠŸæ·»åŠ  ${addedCount} ä¸ªæµ‹è¯•æ•°æ®</h3>
                                    <p style="margin: 0; color: #6c757d;">ç°åœ¨å¯ä»¥æµ‹è¯•å„ç§å­˜å‚¨åŠŸèƒ½äº†</p>
                                </div>
                                
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                    <h4 style="margin: 0 0 10px 0; color: #495057;">å·²æ·»åŠ çš„æ•°æ®ï¼š</h4>
                                    <div style="max-height: 200px; overflow-y: auto;">
                                        ${addedItemsHTML}
                                    </div>
                                </div>
                                
                                <div style="background: #e8f5e8; padding: 12px; border-radius: 6px; border-left: 4px solid #10b981;">
                                    <p style="margin: 0; font-size: 14px; color: #16a34a;">
                                        <strong>ğŸ’¡ æç¤ºï¼š</strong> ç°åœ¨å¯ä»¥å°è¯•è¯»å–ã€åŠ è½½ã€åˆ é™¤è¿™äº›æµ‹è¯•æ•°æ®æ¥ä½“éªŒåŠŸèƒ½
                                    </p>
                                </div>
                            </div>
                        `,
                        type: "alert"
                    });
                }
            }
        }

        // å…¨å±€æµ‹è¯•å‡½æ•°
        function testAddData() {
            // æ·»åŠ æŒ‰é’®ç‚¹å‡»æ•ˆæœ
            const btn = document.getElementById('addTestDataBtn');
            btn.style.transform = 'scale(0.95)';
            btn.style.backgroundColor = '#5a6fd8';

            setTimeout(() => {
                btn.style.transform = '';
                btn.style.backgroundColor = '';
            }, 150);

            if (window.storageManager) {
                window.storageManager.addTestData();
            } else {
                // ä½¿ç”¨å…¨å±€æ¶ˆæ¯æ˜¾ç¤ºå‡½æ•°
                showGlobalMessage('å­˜å‚¨ç®¡ç†å™¨æœªåˆå§‹åŒ–ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•', 'error');
            }
        }

        // å…¨å±€æ¶ˆæ¯æ˜¾ç¤ºå‡½æ•°ï¼ˆå¤ç”¨ç±»å†…éƒ¨çš„æ–¹æ³•ï¼‰
        function showGlobalMessage(message, type = 'error') {
            if (window.storageManager) {
                if (type === 'error') {
                    window.storageManager.showError(message);
                } else {
                    window.storageManager.showSuccess(message);
                }
            } else {
                // é™çº§åˆ°ç®€å•çš„alertï¼ˆä»…åœ¨storageManageræœªåˆå§‹åŒ–æ—¶ä½¿ç”¨ï¼‰
                alert(message);
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–å­˜å‚¨ç®¡ç†å™¨
        document.addEventListener('DOMContentLoaded', () => {
            window.storageManager = new LocalStorageManager();
        });
    </script>
</body>

</html>