<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能文本搜索与内容管理系统 - includesCaseInsensitive函数实战示例</title>
    <link rel="stylesheet" href="../../demo/plugins/modal/style.css">
    <link rel="stylesheet" href="../../demo/plugins/notification/style.css">
    <link rel="stylesheet" href="../../demo/plugins/select/style.css">
    <link rel="stylesheet" href="../../demo/plugins/checkbox/style.css">
    <link rel="stylesheet" href="../../demo/plugins/datetime-picker/style.css">
    <link rel="stylesheet" href="../../demo/plugins/input-number/style.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .control-panel {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #e9ecef;
            margin-bottom: 30px;
        }

        .control-section {
            margin-bottom: 25px;
        }

        .control-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.1em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 0.9em;
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 14px;
            margin: 5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(40, 167, 69, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
            color: #212529;
        }

        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 193, 7, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #e74c3c 100%);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(220, 53, 69, 0.4);
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 25px;
            transition: all 0.3s ease;
        }

        .card:hover {
            border-color: #667eea;
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .card-icon {
            font-size: 1.5em;
        }

        .card-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #333;
        }

        .search-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .search-results {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .result-item {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .result-item:hover {
            border-color: #667eea;
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .result-item.matched {
            border-color: #28a745;
            background: #f8fff9;
        }

        .result-item.partial {
            border-color: #ffc107;
            background: #fffef8;
        }

        .result-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .result-icon {
            font-size: 1.2em;
        }

        .result-title {
            font-weight: 600;
            color: #333;
            flex: 1;
        }

        .result-category {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .category-document {
            background: #e3f2fd;
            color: #1976d2;
        }

        .category-email {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .category-note {
            background: #e8f5e8;
            color: #388e3c;
        }

        .category-code {
            background: #fff3e0;
            color: #f57c00;
        }

        .result-content {
            color: #666;
            line-height: 1.5;
            margin-bottom: 10px;
        }

        .result-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9em;
            color: #999;
        }

        .highlight {
            background: #fff3cd;
            padding: 2px 4px;
            border-radius: 4px;
            font-weight: 600;
        }

        .highlight.exact {
            background: #d4edda;
            color: #155724;
        }

        .highlight.partial {
            background: #fff3cd;
            color: #856404;
        }

        .search-stats {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .stat-item {
            text-align: center;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: 600;
            color: #667eea;
        }

        .stat-label {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }

        .filter-panel {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .filter-group {
            margin-bottom: 15px;
        }

        .filter-label {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            display: block;
        }

        .filter-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .filter-option {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        .filter-option:hover {
            border-color: #667eea;
        }

        .filter-option.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .document-editor {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .editor-toolbar {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .editor-textarea {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            resize: vertical;
        }

        .editor-textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .search-history {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 300px;
            overflow-y: auto;
        }

        .history-entry {
            margin-bottom: 8px;
            padding: 5px 0;
            border-bottom: 1px solid #4a5568;
        }

        .history-time {
            color: #a0aec0;
            margin-right: 10px;
        }

        .history-query {
            color: #63b3ed;
        }

        .history-results {
            margin-left: 10px;
        }

        .history-results.success {
            color: #68d391;
        }

        .history-results.warning {
            color: #f6ad55;
        }

        .history-results.error {
            color: #fc8181;
        }

        .realtime-search {
            position: relative;
        }

        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            max-height: 200px;
            overflow-y: auto;
        }

        .suggestion-item {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid #f1f3f4;
            transition: background-color 0.2s ease;
        }

        .suggestion-item:hover {
            background: #f8f9fa;
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .suggestion-highlight {
            font-weight: 600;
            color: #667eea;
        }

        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .controls-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>🔍 智能文本搜索与内容管理系统</h1>
            <p>基于 includesCaseInsensitive 函数的实战示例 - 不区分大小写的智能搜索</p>
        </div>

        <div class="content">
            <!-- 控制面板 -->
            <div class="control-panel">
                <div class="control-section">
                    <h3>⚙️ 搜索配置</h3>
                    <div class="controls-grid">
                        <div class="form-group">
                            <label>搜索模式</label>
                            <div id="searchModeSelect"></div>
                        </div>
                        <div class="form-group">
                            <label>内容类型</label>
                            <div id="contentTypeSelect"></div>
                        </div>
                        <div class="form-group">
                            <label>最大结果数</label>
                            <div id="maxResultsInput"></div>
                        </div>
                        <div class="form-group">
                            <label>实时搜索</label>
                            <div id="realtimeSearchCheckbox"></div>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="performSearch()">执行搜索</button>
                    <button class="btn btn-success" onclick="addDocument()">添加文档</button>
                    <button class="btn btn-warning" onclick="analyzeContent()">内容分析</button>
                    <button class="btn btn-danger" onclick="clearResults()">清除结果</button>
                </div>
            </div>

            <!-- 仪表板 -->
            <div class="dashboard">
                <!-- 搜索面板 -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-icon">🔍</span>
                        <span class="card-title">智能搜索</span>
                    </div>
                    <div class="realtime-search">
                        <input type="text" id="searchInput" class="search-input" placeholder="输入搜索关键词..." oninput="handleSearchInput()">
                        <div id="searchSuggestions" class="search-suggestions" style="display: none;"></div>
                    </div>
                    <div class="search-stats">
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-value" id="totalResults">0</div>
                                <div class="stat-label">总结果</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="exactMatches">0</div>
                                <div class="stat-label">精确匹配</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="partialMatches">0</div>
                                <div class="stat-label">部分匹配</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="searchTime">0ms</div>
                                <div class="stat-label">搜索时间</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 过滤面板 -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-icon">🔧</span>
                        <span class="card-title">搜索过滤</span>
                    </div>
                    <div class="filter-panel">
                        <div class="filter-group">
                            <label class="filter-label">文档类型</label>
                            <div class="filter-options" id="documentTypeFilters">
                                <!-- 文档类型过滤器将在这里生成 -->
                            </div>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">匹配类型</label>
                            <div class="filter-options" id="matchTypeFilters">
                                <!-- 匹配类型过滤器将在这里生成 -->
                            </div>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">时间范围</label>
                            <div class="filter-options" id="timeRangeFilters">
                                <!-- 时间范围过滤器将在这里生成 -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 文档编辑器 -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-icon">✏️</span>
                        <span class="card-title">文档编辑器</span>
                    </div>
                    <div class="document-editor">
                        <div class="editor-toolbar">
                            <button class="btn btn-primary" onclick="saveDocument()">保存文档</button>
                            <button class="btn btn-success" onclick="previewDocument()">预览</button>
                            <button class="btn btn-warning" onclick="clearEditor()">清空</button>
                        </div>
                        <textarea id="documentEditor" class="editor-textarea" placeholder="在这里输入文档内容..."></textarea>
                    </div>
                </div>
            </div>

            <!-- 搜索结果 -->
            <div class="card">
                <div class="card-header">
                    <span class="card-icon">📋</span>
                    <span class="card-title">搜索结果</span>
                </div>
                <div class="search-results" id="searchResults">
                    <!-- 搜索结果将在这里显示 -->
                </div>
            </div>

            <!-- 搜索历史 -->
            <div class="card">
                <div class="card-header">
                    <span class="card-icon">📈</span>
                    <span class="card-title">搜索历史</span>
                </div>
                <div class="search-history" id="searchHistory">
                    <!-- 搜索历史将在这里显示 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 引入插件 -->
    <script src="../../demo/plugins/modal/index.js"></script>
    <script src="../../demo/plugins/notification/index.js"></script>
    <script src="../../demo/plugins/select/index.js"></script>
    <script src="../../demo/plugins/checkbox/index.js"></script>
    <script src="../../demo/plugins/datetime-picker/index.js"></script>
    <script src="../../demo/plugins/input-number/index.js"></script>

    <script>
        // 全局变量
        let modal, notification;
        let searchModeSelect, contentTypeSelect, maxResultsInput, realtimeSearchCheckbox;
        let documents = [];
        let searchHistory = [];
        let currentSearchQuery = '';
        let searchTimeout = null;

        // includesCaseInsensitive 函数
        const includesCaseInsensitive = (str, searchString) =>
            new RegExp(searchString, 'i').test(str);

        // 初始化应用
        function initApp() {
            // 初始化插件
            modal = new Modal();
            notification = new Notification({ position: 'top-right' });

            // 初始化选择控件
            searchModeSelect = new Select({
                container: document.getElementById('searchModeSelect'),
                options: [
                    { value: 'exact', label: '精确匹配' },
                    { value: 'partial', label: '部分匹配' },
                    { value: 'fuzzy', label: '模糊匹配' },
                    { value: 'smart', label: '智能匹配' }
                ],
                placeholder: '选择搜索模式'
            });

            contentTypeSelect = new Select({
                container: document.getElementById('contentTypeSelect'),
                options: [
                    { value: 'all', label: '所有类型' },
                    { value: 'document', label: '文档' },
                    { value: 'email', label: '邮件' },
                    { value: 'note', label: '笔记' },
                    { value: 'code', label: '代码' }
                ],
                placeholder: '选择内容类型'
            });

            maxResultsInput = new InputNumber({
                container: document.getElementById('maxResultsInput'),
                min: 1,
                max: 100,
                value: 20,
                step: 1
            });

            realtimeSearchCheckbox = new Checkbox({
                label: '启用实时搜索',
                checked: true,
                onChange: (checked) => {
                    console.log('实时搜索状态:', checked);
                }
            });
            realtimeSearchCheckbox.mount(document.getElementById('realtimeSearchCheckbox'));

            // 初始化数据
            initializeData();

            // 初始化界面
            updateDocumentTypeFilters();
            updateMatchTypeFilters();
            updateTimeRangeFilters();
            addSearchHistory('系统初始化完成', 'info');
        }

        // 初始化数据
        function initializeData() {
            documents = [
                {
                    id: 1,
                    title: 'JavaScript 高级编程指南',
                    content: 'JavaScript is a powerful programming language that enables interactive web pages. This guide covers advanced concepts including closures, prototypes, and asynchronous programming.',
                    category: 'document',
                    tags: ['javascript', 'programming', 'web development'],
                    createdAt: new Date('2024-01-15'),
                    author: '张三',
                    views: 1250
                },
                {
                    id: 2,
                    title: 'React 组件设计模式',
                    content: 'React is a popular JavaScript library for building user interfaces. This document explores various component design patterns and best practices for creating maintainable React applications.',
                    category: 'document',
                    tags: ['react', 'javascript', 'frontend'],
                    createdAt: new Date('2024-02-20'),
                    author: '李四',
                    views: 2100
                },
                {
                    id: 3,
                    title: '项目进度报告 - Q1 2024',
                    content: 'This is the quarterly progress report for Q1 2024. The project has achieved significant milestones including the completion of the core features and successful user testing.',
                    category: 'document',
                    tags: ['report', 'project', 'progress'],
                    createdAt: new Date('2024-03-31'),
                    author: '王五',
                    views: 890
                },
                {
                    id: 4,
                    title: '客户反馈邮件',
                    content: 'Dear Team, I would like to express my satisfaction with the recent updates to your product. The new features are exactly what we needed. Thank you for your excellent work!',
                    category: 'email',
                    tags: ['feedback', 'customer', 'satisfaction'],
                    createdAt: new Date('2024-04-10'),
                    author: '客户',
                    views: 150
                },
                {
                    id: 5,
                    title: '会议笔记 - 产品规划',
                    content: 'Meeting notes from the product planning session. Key decisions: 1) Launch new feature in June, 2) Increase marketing budget by 20%, 3) Hire two new developers.',
                    category: 'note',
                    tags: ['meeting', 'planning', 'product'],
                    createdAt: new Date('2024-04-15'),
                    author: '赵六',
                    views: 320
                },
                {
                    id: 6,
                    title: 'Python 数据分析脚本',
                    content: 'import pandas as pd\nimport numpy as np\n\n# Load data\ndf = pd.read_csv("data.csv")\n\n# Perform analysis\nresult = df.groupby("category").agg({\n    "value": ["mean", "std", "count"]\n})\n\nprint(result)',
                    category: 'code',
                    tags: ['python', 'data analysis', 'pandas'],
                    createdAt: new Date('2024-04-20'),
                    author: '钱七',
                    views: 450
                },
                {
                    id: 7,
                    title: 'CSS 样式优化指南',
                    content: 'CSS optimization techniques for better performance. This guide covers: 1) Minimizing CSS files, 2) Using efficient selectors, 3) Leveraging CSS Grid and Flexbox, 4) Implementing responsive design patterns.',
                    category: 'document',
                    tags: ['css', 'optimization', 'performance'],
                    createdAt: new Date('2024-04-25'),
                    author: '孙八',
                    views: 780
                },
                {
                    id: 8,
                    title: '数据库查询优化',
                    content: 'Database query optimization strategies for MySQL and PostgreSQL. Topics include: indexing strategies, query analysis, performance monitoring, and best practices for complex queries.',
                    category: 'document',
                    tags: ['database', 'sql', 'optimization'],
                    createdAt: new Date('2024-05-01'),
                    author: '周九',
                    views: 650
                }
            ];
        }

        // 更新文档类型过滤器
        function updateDocumentTypeFilters() {
            const container = document.getElementById('documentTypeFilters');
            container.innerHTML = '';

            const types = [
                { id: 'all', name: '全部', icon: '📄' },
                { id: 'document', name: '文档', icon: '📝' },
                { id: 'email', name: '邮件', icon: '📧' },
                { id: 'note', name: '笔记', icon: '📋' },
                { id: 'code', name: '代码', icon: '💻' }
            ];

            types.forEach(type => {
                const option = document.createElement('div');
                option.className = 'filter-option active';
                option.textContent = `${type.icon} ${type.name}`;
                option.onclick = () => toggleFilter(option, 'type', type.id);
                container.appendChild(option);
            });
        }

        // 更新匹配类型过滤器
        function updateMatchTypeFilters() {
            const container = document.getElementById('matchTypeFilters');
            container.innerHTML = '';

            const matchTypes = [
                { label: '精确匹配', value: 'exact' },
                { label: '部分匹配', value: 'partial' },
                { label: '模糊匹配', value: 'fuzzy' }
            ];

            matchTypes.forEach(type => {
                const option = document.createElement('div');
                option.className = 'filter-option active';
                option.textContent = type.label;
                option.onclick = () => toggleFilter(option, 'match', type.value);
                container.appendChild(option);
            });
        }

        // 更新时间范围过滤器
        function updateTimeRangeFilters() {
            const container = document.getElementById('timeRangeFilters');
            container.innerHTML = '';

            const timeRanges = [
                { label: '全部时间', value: 'all' },
                { label: '最近一周', value: 'week' },
                { label: '最近一月', value: 'month' },
                { label: '最近三月', value: 'quarter' }
            ];

            timeRanges.forEach(range => {
                const option = document.createElement('div');
                option.className = 'filter-option active';
                option.textContent = range.label;
                option.onclick = () => toggleFilter(option, 'time', range.value);
                container.appendChild(option);
            });
        }

        // 切换过滤器
        function toggleFilter(element, type, value) {
            element.classList.toggle('active');
            // 这里可以添加过滤逻辑
        }

        // 处理搜索输入
        function handleSearchInput() {
            const query = document.getElementById('searchInput').value.trim();
            currentSearchQuery = query;

            if (searchTimeout) {
                clearTimeout(searchTimeout);
            }

            if (realtimeSearchCheckbox.isChecked() && query.length > 0) {
                searchTimeout = setTimeout(() => {
                    performSearch();
                }, 300);
            } else if (query.length === 0) {
                clearSearchResults();
            }
        }

        // 执行搜索
        function performSearch() {
            const query = currentSearchQuery;
            const searchMode = searchModeSelect.getValue();
            const contentType = contentTypeSelect.getValue();
            const maxResults = maxResultsInput.getValue();

            if (!query) {
                notification.error('请输入搜索关键词');
                return;
            }

            const startTime = performance.now();
            const results = searchDocuments(query, searchMode, contentType, maxResults);
            const endTime = performance.now();
            const searchTime = Math.round(endTime - startTime);

            updateSearchResults(results, query, searchTime);
            addSearchHistory(`搜索: "${query}"`, results.length > 0 ? 'success' : 'warning');
        }

        // 搜索文档
        function searchDocuments(query, searchMode, contentType, maxResults) {
            let results = documents.filter(doc => {
                // 内容类型过滤
                if (contentType !== 'all' && doc.category !== contentType) {
                    return false;
                }

                // 使用 includesCaseInsensitive 进行搜索
                const titleMatch = includesCaseInsensitive(doc.title, query);
                const contentMatch = includesCaseInsensitive(doc.content, query);
                const tagsMatch = doc.tags.some(tag => includesCaseInsensitive(tag, query));

                switch (searchMode) {
                    case 'exact':
                        return titleMatch || contentMatch || tagsMatch;
                    case 'partial':
                        return titleMatch || contentMatch || tagsMatch;
                    case 'fuzzy':
                        return titleMatch || contentMatch || tagsMatch;
                    case 'smart':
                        return titleMatch || contentMatch || tagsMatch;
                    default:
                        return titleMatch || contentMatch || tagsMatch;
                }
            });

            // 计算匹配度并排序
            results = results.map(doc => {
                const titleMatch = includesCaseInsensitive(doc.title, query);
                const contentMatch = includesCaseInsensitive(doc.content, query);
                const tagsMatch = doc.tags.some(tag => includesCaseInsensitive(tag, query));

                let score = 0;
                if (titleMatch) score += 3;
                if (contentMatch) score += 1;
                if (tagsMatch) score += 2;

                return { ...doc, score, titleMatch, contentMatch, tagsMatch };
            }).sort((a, b) => b.score - a.score);

            return results.slice(0, maxResults);
        }

        // 更新搜索结果
        function updateSearchResults(results, query, searchTime) {
            const container = document.getElementById('searchResults');
            container.innerHTML = '';

            // 更新统计信息
            document.getElementById('totalResults').textContent = results.length;
            document.getElementById('exactMatches').textContent = results.filter(r => r.score >= 3).length;
            document.getElementById('partialMatches').textContent = results.filter(r => r.score < 3 && r.score > 0).length;
            document.getElementById('searchTime').textContent = `${searchTime}ms`;

            if (results.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">未找到匹配的结果</p>';
                return;
            }

            results.forEach(result => {
                const item = document.createElement('div');
                item.className = `result-item ${result.score >= 3 ? 'matched' : 'partial'}`;

                const category = getCategoryInfo(result.category);
                const highlightedTitle = highlightText(result.title, query);
                const highlightedContent = highlightText(result.content.substring(0, 200) + '...', query);

                item.innerHTML = `
                    <div class="result-header">
                        <span class="result-icon">${category.icon}</span>
                        <span class="result-title">${highlightedTitle}</span>
                        <span class="result-category ${category.class}">${category.name}</span>
                    </div>
                    <div class="result-content">${highlightedContent}</div>
                    <div class="result-meta">
                        <span>👤 ${result.author}</span>
                        <span>📅 ${formatDate(result.createdAt)}</span>
                        <span>👁️ ${result.views}</span>
                        <span>🎯 匹配度: ${result.score}</span>
                    </div>
                `;

                item.onclick = () => viewDocument(result);
                container.appendChild(item);
            });
        }

        // 高亮文本
        function highlightText(text, query) {
            if (!query) return text;
            
            const regex = new RegExp(`(${query})`, 'gi');
            return text.replace(regex, '<span class="highlight">$1</span>');
        }

        // 获取分类信息
        function getCategoryInfo(category) {
            const categories = {
                document: { name: '文档', icon: '📝', class: 'category-document' },
                email: { name: '邮件', icon: '📧', class: 'category-email' },
                note: { name: '笔记', icon: '📋', class: 'category-note' },
                code: { name: '代码', icon: '💻', class: 'category-code' }
            };
            return categories[category] || categories.document;
        }

        // 格式化日期
        function formatDate(date) {
            return date.toLocaleDateString('zh-CN');
        }

        // 清除搜索结果
        function clearSearchResults() {
            document.getElementById('searchResults').innerHTML = '';
            document.getElementById('totalResults').textContent = '0';
            document.getElementById('exactMatches').textContent = '0';
            document.getElementById('partialMatches').textContent = '0';
            document.getElementById('searchTime').textContent = '0ms';
        }

        // 添加文档
        function addDocument() {
            const title = document.getElementById('documentEditor').value.trim();
            if (!title) {
                notification.error('请输入文档内容');
                return;
            }

            const newDoc = {
                id: documents.length + 1,
                title: `新文档 ${documents.length + 1}`,
                content: title,
                category: 'document',
                tags: ['new'],
                createdAt: new Date(),
                author: '当前用户',
                views: 0
            };

            documents.unshift(newDoc);
            notification.success('文档添加成功');
            addSearchHistory('添加新文档', 'success');
        }

        // 内容分析
        function analyzeContent() {
            const totalDocs = documents.length;
            const categoryStats = {};
            const tagStats = {};

            documents.forEach(doc => {
                categoryStats[doc.category] = (categoryStats[doc.category] || 0) + 1;
                doc.tags.forEach(tag => {
                    tagStats[tag] = (tagStats[tag] || 0) + 1;
                });
            });

            const content = `
                <div style="max-width: 600px;">
                    <h4>内容分析报告</h4>
                    <div style="margin-top: 15px;">
                        <div style="background: #f8f9fa; padding: 15px; margin-bottom: 15px; border-radius: 6px;">
                            <strong>总文档数:</strong> ${totalDocs}
                        </div>
                        <div style="background: #f8f9fa; padding: 15px; margin-bottom: 15px; border-radius: 6px;">
                            <strong>分类统计:</strong>
                            ${Object.entries(categoryStats).map(([cat, count]) => 
                                `<div style="margin-top: 5px;">${cat}: ${count} 个</div>`
                            ).join('')}
                        </div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 6px;">
                            <strong>热门标签 (前5):</strong>
                            ${Object.entries(tagStats)
                                .sort(([,a], [,b]) => b - a)
                                .slice(0, 5)
                                .map(([tag, count]) => 
                                    `<div style="margin-top: 5px;">${tag}: ${count} 次</div>`
                                ).join('')}
                        </div>
                    </div>
                </div>
            `;

            modal.alert(content, '内容分析报告');
            addSearchHistory('执行内容分析', 'info');
        }

        // 清除结果
        function clearResults() {
            modal.confirm('确定要清除所有搜索结果吗？').then(confirmed => {
                if (confirmed) {
                    clearSearchResults();
                    document.getElementById('searchInput').value = '';
                    currentSearchQuery = '';
                    addSearchHistory('清除搜索结果', 'info');
                    notification.success('结果已清除');
                }
            });
        }

        // 保存文档
        function saveDocument() {
            const content = document.getElementById('documentEditor').value.trim();
            if (!content) {
                notification.error('请输入文档内容');
                return;
            }

            notification.success('文档保存成功');
            addSearchHistory('保存文档', 'success');
        }

        // 预览文档
        function previewDocument() {
            const content = document.getElementById('documentEditor').value.trim();
            if (!content) {
                notification.error('请输入文档内容');
                return;
            }

            modal.alert(`<pre style="white-space: pre-wrap;">${content}</pre>`, '文档预览');
        }

        // 清空编辑器
        function clearEditor() {
            modal.confirm('确定要清空编辑器吗？').then(confirmed => {
                if (confirmed) {
                    document.getElementById('documentEditor').value = '';
                    notification.success('编辑器已清空');
                }
            });
        }

        // 查看文档
        function viewDocument(doc) {
            const content = `
                <div style="max-width: 600px;">
                    <h4>${doc.title}</h4>
                    <div style="color: #666; margin: 10px 0;">
                        <strong>作者:</strong> ${doc.author} | 
                        <strong>分类:</strong> ${getCategoryInfo(doc.category).name} | 
                        <strong>创建时间:</strong> ${formatDate(doc.createdAt)}
                    </div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 6px; margin: 10px 0;">
                        <strong>标签:</strong> ${doc.tags.join(', ')}
                    </div>
                    <div style="background: white; padding: 15px; border: 1px solid #e9ecef; border-radius: 6px; max-height: 300px; overflow-y: auto;">
                        <pre style="white-space: pre-wrap; margin: 0;">${doc.content}</pre>
                    </div>
                </div>
            `;
            modal.alert(content, '文档详情');
        }

        // 添加搜索历史
        function addSearchHistory(action, status) {
            const timestamp = new Date();
            const logEntry = {
                time: timestamp,
                action: action,
                status: status
            };

            searchHistory.unshift(logEntry);
            if (searchHistory.length > 50) {
                searchHistory.pop();
            }

            updateSearchHistory();
        }

        // 更新搜索历史
        function updateSearchHistory() {
            const container = document.getElementById('searchHistory');
            
            container.innerHTML = searchHistory.map(entry => `
                <div class="history-entry">
                    <span class="history-time">${formatDateTime(entry.time)}</span>
                    <span class="history-query">${entry.action}</span>
                    <span class="history-results ${entry.status}">${entry.status}</span>
                </div>
            `).join('');
        }

        // 格式化日期时间
        function formatDateTime(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            const seconds = String(date.getSeconds()).padStart(2, '0');
            return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>

</html>