<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‚¹å‡»å¤–éƒ¨æ£€æµ‹å™¨ - onClickOutside å‡½æ•°å®æˆ˜å¹³å°</title>
    <!-- å¼•å…¥æ’ä»¶æ ·å¼ -->
    <link rel="stylesheet" href="../../demo/plugins/modal/style.css">
    <link rel="stylesheet" href="../../demo/plugins/checkbox/style.css">
    <link rel="stylesheet" href="../../demo/plugins/notification/style.css">
    <link rel="stylesheet" href="../../demo/plugins/select/style.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #1f2937;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 800;
            text-shadow: 0 3px 8px rgba(15, 23, 42, 0.35);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.95;
        }

        .main-content {
            display: grid;
            grid-template-columns: 420px 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }

        .card {
            background: rgba(255, 255, 255, 0.97);
            border-radius: 20px;
            padding: 24px;
            box-shadow: 0 14px 32px rgba(15, 23, 42, 0.15);
            margin-bottom: 20px;
        }

        .card h2 {
            font-size: 1.4rem;
            margin-bottom: 18px;
            color: #1f2937;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .input-group {
            margin-bottom: 16px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
            font-size: 0.95rem;
        }

        .input-field,
        .textarea-field {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 0.95rem;
            transition: all 0.25s ease;
            font-family: 'Monaco', 'Menlo', monospace;
        }

        .textarea-field {
            min-height: 100px;
            resize: vertical;
            line-height: 1.6;
        }

        .input-field:focus,
        .textarea-field:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.25);
        }

        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 16px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #22c55e, #15803d);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #fbbf24, #d97706);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #b91c1c);
            color: white;
        }

        .btn-info {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .btn:active {
            transform: scale(0.97);
        }

        .btn-block {
            width: 100%;
            justify-content: center;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 0.85rem;
        }

        .select-container {
            margin-bottom: 16px;
        }

        .checkbox-container {
            margin-top: 12px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }

        .stat-card {
            background: white;
            border-radius: 14px;
            padding: 16px;
            text-align: center;
            box-shadow: 0 3px 12px rgba(15, 23, 42, 0.1);
        }

        .stat-number {
            font-size: 1.8rem;
            font-weight: 800;
            color: #667eea;
            font-family: 'Monaco', 'Menlo', monospace;
        }

        .stat-label {
            font-size: 0.85rem;
            color: #64748b;
            margin-top: 4px;
        }

        .watchers-list {
            max-height: 400px;
            overflow-y: auto;
            background: #f8fafc;
            border-radius: 12px;
            padding: 12px;
        }

        .watcher-item {
            background: white;
            padding: 16px;
            margin-bottom: 12px;
            border-radius: 12px;
            border-left: 4px solid #667eea;
            transition: all 0.2s ease;
        }

        .watcher-item:hover {
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }

        .watcher-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .watcher-title {
            font-weight: 700;
            color: #1f2937;
            font-size: 1rem;
        }

        .watcher-badge {
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-active {
            background: #dcfce7;
            color: #15803d;
        }

        .badge-inactive {
            background: #fee2e2;
            color: #991b1b;
        }

        .watcher-info {
            font-size: 0.85rem;
            color: #64748b;
            margin-bottom: 8px;
            font-family: 'Monaco', 'Menlo', monospace;
        }

        .watcher-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .demo-area {
            background: #f8fafc;
            border-radius: 16px;
            padding: 24px;
            margin-top: 20px;
            min-height: 500px;
            position: relative;
        }

        .demo-area-title {
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 20px;
            font-size: 1.1rem;
        }

        .demo-box {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            transition: all 0.3s ease;
            position: relative;
        }

        .demo-box.active {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .demo-box-title {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 12px;
        }

        .demo-button {
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .demo-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.3);
        }

        .modal-demo {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            max-width: 500px;
            width: 90%;
            display: none;
        }

        .modal-demo.show {
            display: block;
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none;
        }

        .modal-overlay.show {
            display: block;
        }

        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            padding: 8px 0;
            min-width: 200px;
            margin-top: 8px;
            display: none;
            z-index: 100;
        }

        .dropdown-menu.show {
            display: block;
            animation: dropdownFadeIn 0.2s ease;
        }

        @keyframes dropdownFadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .dropdown-item {
            padding: 12px 16px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .dropdown-item:hover {
            background: #f3f4f6;
        }

        .tooltip {
            position: absolute;
            background: #1f2937;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            white-space: nowrap;
            z-index: 1000;
            display: none;
            pointer-events: none;
        }

        .tooltip.show {
            display: block;
            animation: tooltipFadeIn 0.2s ease;
        }

        @keyframes tooltipFadeIn {
            from {
                opacity: 0;
                transform: translateY(-5px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .event-log {
            background: #1e293b;
            color: #e2e8f0;
            padding: 16px;
            border-radius: 12px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.85rem;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 16px;
        }

        .event-log-item {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .event-log-item:last-child {
            border-bottom: none;
        }

        .event-log-time {
            color: #94a3b8;
            font-size: 0.75rem;
            margin-right: 8px;
        }

        .event-log-type {
            color: #82aaff;
            font-weight: 600;
        }

        .event-log-info {
            color: #c3e88d;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #64748b;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .code-preview {
            background: #1e293b;
            color: #e2e8f0;
            padding: 16px;
            border-radius: 10px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.85rem;
            overflow-x: auto;
            margin-top: 12px;
        }

        .code-preview .keyword {
            color: #c792ea;
        }

        .code-preview .function {
            color: #82aaff;
        }

        .code-preview .string {
            color: #c3e88d;
        }

        .code-preview .comment {
            color: #697098;
        }

        .error-message {
            background: #fee2e2;
            color: #dc2626;
            padding: 12px;
            border-radius: 8px;
            margin-top: 8px;
            font-size: 0.9rem;
            border-left: 3px solid #dc2626;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¯ ç‚¹å‡»å¤–éƒ¨æ£€æµ‹å™¨ - onClickOutside å‡½æ•°å®æˆ˜å¹³å°</h1>
            <p>åŸºäº onClickOutside å‡½æ•°çš„ç‚¹å‡»å¤–éƒ¨æ£€æµ‹å·¥å…·ï¼Œæ”¯æŒæ¨¡æ€æ¡†ã€ä¸‹æ‹‰èœå•ã€å·¥å…·æç¤ºç­‰åœºæ™¯</p>
        </div>

        <div class="main-content">
            <!-- å·¦ä¾§æ§åˆ¶é¢æ¿ -->
            <div class="sidebar">
                <div class="card">
                    <h2>âš™ï¸ æ·»åŠ ç›‘å¬å™¨</h2>
                    <div class="input-group">
                        <label>é€‰æ‹©ç›®æ ‡å…ƒç´ </label>
                        <div id="targetSelect" class="select-container"></div>
                    </div>
                    <div class="input-group">
                        <label>å›è°ƒå‡½æ•°åç§°</label>
                        <input type="text" id="callbackName" class="input-field" placeholder="ä¾‹å¦‚: closeModal">
                    </div>
                    <div id="errorMessage" class="error-message" style="display: none;"></div>
                    <div class="button-group">
                        <button class="btn btn-primary btn-block" onclick="window.clickOutsideManager?.addWatcher()">
                            â• æ·»åŠ ç›‘å¬å™¨
                        </button>
                    </div>
                </div>

                <div class="card">
                    <h2>ğŸ”§ å·¥å…·é€‰é¡¹</h2>
                    <div id="checkboxGroup" class="checkbox-container"></div>
                    <div class="button-group">
                        <button class="btn btn-info btn-sm" onclick="window.clickOutsideManager?.loadSample()">
                            ğŸ“ åŠ è½½ç¤ºä¾‹
                        </button>
                        <button class="btn btn-warning btn-sm" onclick="window.clickOutsideManager?.clearLog()">
                            ğŸ§¹ æ¸…ç©ºæ—¥å¿—
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="window.clickOutsideManager?.removeAllWatchers()">
                            ğŸ—‘ï¸ ç§»é™¤å…¨éƒ¨
                        </button>
                    </div>
                </div>

                <div class="card">
                    <h2>ğŸ“Š ç»Ÿè®¡ä¿¡æ¯</h2>
                    <div class="stats-grid" id="statsGrid">
                        <div class="stat-card">
                            <div class="stat-number" id="totalWatchers">0</div>
                            <div class="stat-label">ç›‘å¬å™¨æ€»æ•°</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="activeWatchers">0</div>
                            <div class="stat-label">æ´»è·ƒç›‘å¬å™¨</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="totalTriggers">0</div>
                            <div class="stat-label">è§¦å‘æ¬¡æ•°</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2>ğŸ“‹ ç›‘å¬å™¨åˆ—è¡¨</h2>
                    <div class="watchers-list" id="watchersList">
                        <div class="empty-state" style="padding: 40px 20px;">
                            <div class="empty-state-icon">ğŸ“</div>
                            <p style="font-size: 0.9rem;">ç›‘å¬å™¨åˆ—è¡¨å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å³ä¾§æ¼”ç¤ºåŒºåŸŸ -->
            <div class="visualization">
                <div class="card">
                    <h2>ğŸ§ª å®æ—¶æ¼”ç¤ºåŒºåŸŸ</h2>
                    <div class="demo-area">
                        <div class="demo-area-title">äº¤äº’æ¼”ç¤º</div>
                        
                        <!-- æ¨¡æ€æ¡†æ¼”ç¤º -->
                        <div class="demo-box" id="modalDemoBox">
                            <div class="demo-box-title">ğŸ“¦ æ¨¡æ€æ¡†æ¼”ç¤º</div>
                            <button class="demo-button" id="openModalBtn">æ‰“å¼€æ¨¡æ€æ¡†</button>
                            <div class="modal-overlay" id="modalOverlay"></div>
                            <div class="modal-demo" id="modalDemo">
                                <h3 style="margin-bottom: 16px;">è¿™æ˜¯ä¸€ä¸ªæ¨¡æ€æ¡†</h3>
                                <p style="margin-bottom: 20px; color: #64748b;">ç‚¹å‡»å¤–éƒ¨åŒºåŸŸå¯ä»¥å…³é—­æ­¤æ¨¡æ€æ¡†</p>
                                <button class="btn btn-primary" onclick="window.clickOutsideManager?.closeModal()">å…³é—­</button>
                            </div>
                        </div>

                        <!-- ä¸‹æ‹‰èœå•æ¼”ç¤º -->
                        <div class="demo-box" id="dropdownDemoBox">
                            <div class="demo-box-title">ğŸ“‹ ä¸‹æ‹‰èœå•æ¼”ç¤º</div>
                            <div class="dropdown">
                                <button class="demo-button" id="dropdownToggle">æ‰“å¼€ä¸‹æ‹‰èœå•</button>
                                <div class="dropdown-menu" id="dropdownMenu">
                                    <div class="dropdown-item">é€‰é¡¹ 1</div>
                                    <div class="dropdown-item">é€‰é¡¹ 2</div>
                                    <div class="dropdown-item">é€‰é¡¹ 3</div>
                                    <div class="dropdown-item">é€‰é¡¹ 4</div>
                                </div>
                            </div>
                        </div>

                        <!-- å·¥å…·æç¤ºæ¼”ç¤º -->
                        <div class="demo-box" id="tooltipDemoBox">
                            <div class="demo-box-title">ğŸ’¡ å·¥å…·æç¤ºæ¼”ç¤º</div>
                            <button class="demo-button" id="tooltipTrigger">æ‚¬åœæˆ–ç‚¹å‡»æ˜¾ç¤ºæç¤º</button>
                            <div class="tooltip" id="tooltipDemo">è¿™æ˜¯ä¸€ä¸ªå·¥å…·æç¤ºï¼Œç‚¹å‡»å¤–éƒ¨å…³é—­</div>
                        </div>

                        <!-- è‡ªå®šä¹‰å…ƒç´ æ¼”ç¤º -->
                        <div class="demo-box" id="customDemoBox">
                            <div class="demo-box-title">ğŸ¨ è‡ªå®šä¹‰å…ƒç´ æ¼”ç¤º</div>
                            <p style="margin-bottom: 12px; color: #64748b;">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®åˆ›å»ºä¸€ä¸ªå—ä¿æŠ¤çš„å…ƒç´ </p>
                            <button class="demo-button" id="createCustomBtn">åˆ›å»ºå—ä¿æŠ¤å…ƒç´ </button>
                            <div id="customElementsContainer" style="margin-top: 16px;"></div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2>ğŸ“œ äº‹ä»¶è§¦å‘æ—¥å¿—</h2>
                    <div class="event-log" id="eventLog">
                        <div class="empty-state" style="padding: 40px 20px; color: #94a3b8;">
                            <div class="empty-state-icon">ğŸ“</div>
                            <p style="font-size: 0.9rem;">äº‹ä»¶æ—¥å¿—å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</p>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2>ğŸ“– å‡½æ•°è¯´æ˜</h2>
                    <div style="background:#f8fafc;padding:20px;border-radius:14px;">
                        <h3 style="color:#667eea;margin-bottom:12px;">onClickOutside å‡½æ•°ï¼ˆç‚¹å‡»å¤–éƒ¨æ£€æµ‹ï¼‰</h3>
                        <div class="code-preview">
<span class="keyword">const</span> <span class="function">onClickOutside</span> = (<span class="function">element</span>, <span class="function">callback</span>) => {
  <span class="function">document</span>.<span class="function">addEventListener</span>(<span class="string">'click'</span>, <span class="function">e</span> => {
    <span class="keyword">if</span> (!<span class="function">element</span>.<span class="function">contains</span>(<span class="function">e</span>.<span class="function">target</span>)) {
      <span class="function">callback</span>();
    }
  });
};
                        </div>
                        <p style="color:#374151;line-height:1.8;margin-top:16px;">
                            <strong>onClickOutside</strong> å‡½æ•°ç”¨äºæ£€æµ‹ç”¨æˆ·æ˜¯å¦ç‚¹å‡»äº†æŒ‡å®šå…ƒç´ çš„å¤–éƒ¨åŒºåŸŸã€‚
                            å½“ç‚¹å‡»å‘ç”Ÿåœ¨å…ƒç´ å¤–éƒ¨æ—¶ï¼Œä¼šè§¦å‘å›è°ƒå‡½æ•°ã€‚å¸¸ç”¨äºå…³é—­æ¨¡æ€æ¡†ã€ä¸‹æ‹‰èœå•ã€å·¥å…·æç¤ºç­‰åœºæ™¯ã€‚
                        </p>
                        <h3 style="color:#667eea;margin:20px 0 12px;">ä½¿ç”¨ç¤ºä¾‹</h3>
                        <div class="code-preview">
<span class="comment">// ç‚¹å‡»å¤–éƒ¨å…³é—­æ¨¡æ€æ¡†</span>
<span class="function">onClickOutside</span>(<span class="function">document</span>.<span class="function">querySelector</span>(<span class="string">'#modal'</span>), () => {
  <span class="function">modal</span>.<span class="function">style</span>.<span class="function">display</span> = <span class="string">'none'</span>;
});

<span class="comment">// ç‚¹å‡»å¤–éƒ¨å…³é—­ä¸‹æ‹‰èœå•</span>
<span class="function">onClickOutside</span>(<span class="function">document</span>.<span class="function">querySelector</span>(<span class="string">'.dropdown'</span>), () => {
  <span class="function">dropdownMenu</span>.<span class="function">classList</span>.<span class="function">remove</span>(<span class="string">'show'</span>);
});
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- å¼•å…¥æ’ä»¶è„šæœ¬ -->
    <script src="../../demo/plugins/modal/index.js"></script>
    <script src="../../demo/plugins/checkbox/index.js"></script>
    <script src="../../demo/plugins/notification/index.js"></script>
    <script src="../../demo/plugins/select/index.js"></script>

    <script>
        // onClickOutside å‡½æ•°ï¼šæ£€æµ‹ç‚¹å‡»å¤–éƒ¨åŒºåŸŸ
        const onClickOutside = (element, callback) => {
            document.addEventListener('click', e => {
                if (!element.contains(e.target)) {
                    callback();
                }
            });
        };

        // ç‚¹å‡»å¤–éƒ¨ç®¡ç†å™¨ç±»
        class ClickOutsideManager {
            constructor() {
                this.plugins = {};
                this.watchers = [];
                this.eventLog = [];
                this.stats = {
                    totalTriggers: 0
                };
                this.customElementCounter = 0;
                
                this.init();
            }

            async init() {
                await this.loadPlugins();
                this.setupSelects();
                this.setupCheckboxes();
                this.setupDemoInteractions();
                this.updateStats();
                this.renderWatchers();
            }

            async loadPlugins() {
                try {
                    this.plugins.modal = new Modal();
                    this.plugins.notification = new Notification();
                } catch (error) {
                    console.warn('æ’ä»¶åŠ è½½å¤±è´¥:', error);
                }
            }

            setupSelects() {
                // ç›®æ ‡å…ƒç´ é€‰æ‹©å™¨
                try {
                    this.plugins.targetSelect = new Select({
                        container: '#targetSelect',
                        options: [
                            { value: '#modalDemo', label: 'æ¨¡æ€æ¡† (#modalDemo)' },
                            { value: '#dropdownMenu', label: 'ä¸‹æ‹‰èœå• (#dropdownMenu)' },
                            { value: '#tooltipDemo', label: 'å·¥å…·æç¤º (#tooltipDemo)' },
                            { value: '#customDemoBox', label: 'è‡ªå®šä¹‰æ¼”ç¤ºæ¡† (#customDemoBox)' },
                            { value: '.demo-box', label: 'æ‰€æœ‰æ¼”ç¤ºæ¡† (.demo-box)' }
                        ],
                        placeholder: 'é€‰æ‹©ç›®æ ‡å…ƒç´ ',
                        onChange: () => {}
                    });
                    this.plugins.targetSelect.setValue('#modalDemo');
                } catch (error) {
                    console.warn('ç›®æ ‡é€‰æ‹©å™¨åŠ è½½å¤±è´¥:', error);
                }
            }

            setupCheckboxes() {
                const container = document.getElementById('checkboxGroup');
                if (!container) return;

                const options = [
                    { id: 'autoLog', label: 'è‡ªåŠ¨è®°å½•æ—¥å¿—', checked: true },
                    { id: 'showDetails', label: 'æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯', checked: true },
                    { id: 'enableNotifications', label: 'å¯ç”¨é€šçŸ¥æé†’', checked: true }
                ];

                try {
                    const group = Checkbox.createCheckboxGroup({
                        items: options,
                        onChange: () => {}
                    });
                    container.appendChild(group.container);
                    this.plugins.checkboxGroup = group;
                } catch (error) {
                    console.warn('å¤é€‰æ¡†æ’ä»¶åŠ è½½å¤±è´¥:', error);
                }
            }

            setupDemoInteractions() {
                // æ¨¡æ€æ¡†
                const openModalBtn = document.getElementById('openModalBtn');
                const modalDemo = document.getElementById('modalDemo');
                const modalOverlay = document.getElementById('modalOverlay');
                
                if (openModalBtn && modalDemo) {
                    openModalBtn.addEventListener('click', () => {
                        this.openModal();
                    });
                }

                // ä¸‹æ‹‰èœå•
                const dropdownToggle = document.getElementById('dropdownToggle');
                const dropdownMenu = document.getElementById('dropdownMenu');
                
                if (dropdownToggle && dropdownMenu) {
                    dropdownToggle.addEventListener('click', (e) => {
                        e.stopPropagation();
                        dropdownMenu.classList.toggle('show');
                    });
                }

                // å·¥å…·æç¤º
                const tooltipTrigger = document.getElementById('tooltipTrigger');
                const tooltipDemo = document.getElementById('tooltipDemo');
                
                if (tooltipTrigger && tooltipDemo) {
                    tooltipTrigger.addEventListener('click', (e) => {
                        e.stopPropagation();
                        tooltipDemo.classList.toggle('show');
                        if (tooltipDemo.classList.contains('show')) {
                            const rect = tooltipTrigger.getBoundingClientRect();
                            tooltipDemo.style.top = (rect.bottom + 10) + 'px';
                            tooltipDemo.style.left = rect.left + 'px';
                        }
                    });
                }

                // åˆ›å»ºè‡ªå®šä¹‰å…ƒç´ 
                const createCustomBtn = document.getElementById('createCustomBtn');
                if (createCustomBtn) {
                    createCustomBtn.addEventListener('click', () => {
                        this.createCustomElement();
                    });
                }
            }

            getCheckboxValue(id) {
                if (this.plugins.checkboxGroup) {
                    try {
                        const states = this.plugins.checkboxGroup.getAllChecked();
                        const index = ['autoLog', 'showDetails', 'enableNotifications'].indexOf(id);
                        return index !== -1 ? states[index] : false;
                    } catch (error) {
                        console.warn('è¯»å–å¤é€‰æ¡†çŠ¶æ€å¤±è´¥:', error);
                    }
                }
                return false;
            }

            getElement(selector) {
                return document.querySelector(selector);
            }

            addWatcher() {
                const errorMessage = document.getElementById('errorMessage');
                if (errorMessage) {
                    errorMessage.style.display = 'none';
                }

                try {
                    const targetValue = this.plugins.targetSelect?.getValue() || '#modalDemo';
                    const callbackName = document.getElementById('callbackName')?.value.trim() || `callback_${Date.now()}`;
                    
                    const targetElement = this.getElement(targetValue);
                    if (!targetElement) {
                        throw new Error(`æ— æ³•æ‰¾åˆ°ç›®æ ‡å…ƒç´ : ${targetValue}`);
                    }

                    // åˆ›å»ºå›è°ƒå‡½æ•°
                    const callback = () => {
                        this.stats.totalTriggers++;
                        this.updateStats();
                        
                        if (this.getCheckboxValue('autoLog')) {
                            this.addToLog(targetValue, {
                                callbackName: callbackName,
                                timestamp: new Date().toLocaleTimeString()
                            });
                        }

                        if (this.getCheckboxValue('enableNotifications')) {
                            this.showNotification(`ç‚¹å‡»å¤–éƒ¨æ£€æµ‹è§¦å‘: ${callbackName}`, 'info');
                        }
                    };

                    // æ·»åŠ ç‚¹å‡»å¤–éƒ¨ç›‘å¬å™¨
                    onClickOutside(targetElement, callback);

                    // ä¿å­˜ç›‘å¬å™¨ä¿¡æ¯
                    const watcher = {
                        id: Date.now(),
                        target: targetValue,
                        callbackName: callbackName,
                        callback: callback,
                        active: true,
                        createdAt: new Date().toLocaleString('zh-CN')
                    };

                    this.watchers.push(watcher);
                    this.renderWatchers();
                    this.updateStats();
                    this.showNotification(`ç›‘å¬å™¨ "${callbackName}" å·²æ·»åŠ `, 'success');

                    // æ¸…ç©ºè¾“å…¥
                    document.getElementById('callbackName').value = '';

                } catch (error) {
                    this.showError(error.message);
                    console.error('æ·»åŠ ç›‘å¬å™¨å¤±è´¥:', error);
                }
            }

            removeWatcher(id) {
                const watcher = this.watchers.find(w => w.id === id);
                if (!watcher) return;

                // æ³¨æ„ï¼šonClickOutside å‡½æ•°æ²¡æœ‰æä¾›ç§»é™¤æ–¹æ³•
                // è¿™é‡Œåªæ˜¯æ ‡è®°ä¸ºä¸æ´»è·ƒ
                watcher.active = false;
                this.renderWatchers();
                this.updateStats();
                this.showNotification(`ç›‘å¬å™¨ "${watcher.callbackName}" å·²ç§»é™¤`, 'success');
            }

            removeAllWatchers() {
                this.plugins.modal?.confirm('ç¡®å®šè¦ç§»é™¤æ‰€æœ‰ç›‘å¬å™¨å—ï¼Ÿ').then(confirmed => {
                    if (confirmed) {
                        this.watchers.forEach(watcher => {
                            watcher.active = false;
                        });
                        this.watchers = [];
                        this.renderWatchers();
                        this.updateStats();
                        this.showNotification('æ‰€æœ‰ç›‘å¬å™¨å·²ç§»é™¤', 'info');
                    }
                });
            }

            renderWatchers() {
                const container = document.getElementById('watchersList');
                if (!container) return;

                if (this.watchers.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state" style="padding: 40px 20px;">
                            <div class="empty-state-icon">ğŸ“</div>
                            <p style="font-size: 0.9rem;">ç›‘å¬å™¨åˆ—è¡¨å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = this.watchers.map(watcher => {
                    const badgeClass = watcher.active ? 'badge-active' : 'badge-inactive';
                    const badgeText = watcher.active ? 'æ´»è·ƒ' : 'å·²ç§»é™¤';

                    return `
                        <div class="watcher-item">
                            <div class="watcher-header">
                                <span class="watcher-title">${watcher.callbackName}</span>
                                <span class="watcher-badge ${badgeClass}">${badgeText}</span>
                            </div>
                            <div class="watcher-info">
                                ç›®æ ‡: ${watcher.target} | åˆ›å»º: ${watcher.createdAt}
                            </div>
                            ${watcher.active ? `
                                <div class="watcher-actions">
                                    <button class="btn btn-danger btn-sm" onclick="window.clickOutsideManager?.removeWatcher(${watcher.id})">
                                        ğŸ—‘ï¸ ç§»é™¤
                                    </button>
                                </div>
                            ` : ''}
                        </div>
                    `;
                }).join('');
            }

            updateStats() {
                const totalWatchers = this.watchers.length;
                const activeWatchers = this.watchers.filter(w => w.active).length;
                const totalTriggers = this.stats.totalTriggers;

                document.getElementById('totalWatchers').textContent = totalWatchers;
                document.getElementById('activeWatchers').textContent = activeWatchers;
                document.getElementById('totalTriggers').textContent = totalTriggers;
            }

            addToLog(target, info) {
                this.eventLog.unshift({
                    target: target,
                    info: info,
                    timestamp: new Date().toLocaleTimeString()
                });

                if (this.eventLog.length > 100) {
                    this.eventLog.pop();
                }

                this.renderLog();
            }

            renderLog() {
                const container = document.getElementById('eventLog');
                if (!container) return;

                if (this.eventLog.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state" style="padding: 40px 20px; color: #94a3b8;">
                            <div class="empty-state-icon">ğŸ“</div>
                            <p style="font-size: 0.9rem;">äº‹ä»¶æ—¥å¿—å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = this.eventLog.slice(0, 50).map(item => {
                    const details = this.getCheckboxValue('showDetails') 
                        ? ` | å›è°ƒ: ${item.info.callbackName}`
                        : '';

                    return `
                        <div class="event-log-item">
                            <span class="event-log-time">[${item.timestamp}]</span>
                            <span class="event-log-type">ç‚¹å‡»å¤–éƒ¨</span>
                            <span class="event-log-info">ç›®æ ‡: ${item.target}${details}</span>
                        </div>
                    `;
                }).join('');
            }

            clearLog() {
                this.plugins.modal?.confirm('ç¡®å®šè¦æ¸…ç©ºäº‹ä»¶æ—¥å¿—å—ï¼Ÿ').then(confirmed => {
                    if (confirmed) {
                        this.eventLog = [];
                        this.renderLog();
                        this.showNotification('äº‹ä»¶æ—¥å¿—å·²æ¸…ç©º', 'info');
                    }
                });
            }

            openModal() {
                const modalDemo = document.getElementById('modalDemo');
                const modalOverlay = document.getElementById('modalOverlay');
                
                if (modalDemo && modalOverlay) {
                    modalDemo.classList.add('show');
                    modalOverlay.classList.add('show');
                    
                    // æ·»åŠ ç‚¹å‡»å¤–éƒ¨å…³é—­
                    onClickOutside(modalDemo, () => {
                        this.closeModal();
                    });
                }
            }

            closeModal() {
                const modalDemo = document.getElementById('modalDemo');
                const modalOverlay = document.getElementById('modalOverlay');
                
                if (modalDemo && modalOverlay) {
                    modalDemo.classList.remove('show');
                    modalOverlay.classList.remove('show');
                }
            }

            createCustomElement() {
                this.customElementCounter++;
                const container = document.getElementById('customElementsContainer');
                if (!container) return;

                const element = document.createElement('div');
                element.className = 'demo-box';
                element.id = `customElement_${this.customElementCounter}`;
                element.style.position = 'relative';
                element.innerHTML = `
                    <div class="demo-box-title">è‡ªå®šä¹‰å…ƒç´  #${this.customElementCounter}</div>
                    <p style="color: #64748b; margin-bottom: 12px;">ç‚¹å‡»æ­¤å…ƒç´ å¤–éƒ¨åŒºåŸŸä¼šè§¦å‘å›è°ƒ</p>
                    <button class="btn btn-danger btn-sm" onclick="this.parentElement.remove()">åˆ é™¤</button>
                `;

                container.appendChild(element);

                // æ·»åŠ ç‚¹å‡»å¤–éƒ¨ç›‘å¬
                onClickOutside(element, () => {
                    element.classList.add('active');
                    setTimeout(() => {
                        element.classList.remove('active');
                    }, 500);
                    
                    this.stats.totalTriggers++;
                    this.updateStats();
                    
                    if (this.getCheckboxValue('autoLog')) {
                        this.addToLog(`#customElement_${this.customElementCounter}`, {
                            callbackName: 'custom_callback',
                            timestamp: new Date().toLocaleTimeString()
                        });
                    }

                    if (this.getCheckboxValue('enableNotifications')) {
                        this.showNotification(`ç‚¹å‡»äº†è‡ªå®šä¹‰å…ƒç´  #${this.customElementCounter} çš„å¤–éƒ¨`, 'info');
                    }
                });

                this.showNotification(`è‡ªå®šä¹‰å…ƒç´  #${this.customElementCounter} å·²åˆ›å»º`, 'success');
            }

            loadSample() {
                // åŠ è½½ç¤ºä¾‹ç›‘å¬å™¨
                const samples = [
                    {
                        target: '#modalDemo',
                        callbackName: 'closeModal'
                    },
                    {
                        target: '#dropdownMenu',
                        callbackName: 'closeDropdown'
                    },
                    {
                        target: '#tooltipDemo',
                        callbackName: 'closeTooltip'
                    }
                ];

                samples.forEach(sample => {
                    this.plugins.targetSelect?.setValue(sample.target);
                    document.getElementById('callbackName').value = sample.callbackName;
                    this.addWatcher();
                });

                // è®¾ç½®ä¸‹æ‹‰èœå•å’Œå·¥å…·æç¤ºçš„ç‚¹å‡»å¤–éƒ¨å…³é—­
                const dropdownMenu = document.getElementById('dropdownMenu');
                const tooltipDemo = document.getElementById('tooltipDemo');
                
                if (dropdownMenu) {
                    onClickOutside(dropdownMenu, () => {
                        dropdownMenu.classList.remove('show');
                        this.stats.totalTriggers++;
                        this.updateStats();
                        if (this.getCheckboxValue('autoLog')) {
                            this.addToLog('#dropdownMenu', {
                                callbackName: 'closeDropdown',
                                timestamp: new Date().toLocaleTimeString()
                            });
                        }
                    });
                }

                if (tooltipDemo) {
                    onClickOutside(tooltipDemo, () => {
                        tooltipDemo.classList.remove('show');
                        this.stats.totalTriggers++;
                        this.updateStats();
                        if (this.getCheckboxValue('autoLog')) {
                            this.addToLog('#tooltipDemo', {
                                callbackName: 'closeTooltip',
                                timestamp: new Date().toLocaleTimeString()
                            });
                        }
                    });
                }

                this.showNotification('ç¤ºä¾‹ç›‘å¬å™¨å·²åŠ è½½', 'success');
            }

            showError(message) {
                const errorMessage = document.getElementById('errorMessage');
                if (errorMessage) {
                    errorMessage.textContent = 'âŒ ' + message;
                    errorMessage.style.display = 'block';
                }
                this.showNotification(message, 'error');
            }

            showNotification(message, type = 'info') {
                if (this.plugins.notification && this.getCheckboxValue('enableNotifications')) {
                    this.plugins.notification.show(message, type);
                } else {
                    console.log(`${type.toUpperCase()}: ${message}`);
                }
            }
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            window.clickOutsideManager = new ClickOutsideManager();
        });

        if (document.readyState !== 'loading' && !window.clickOutsideManager) {
            window.clickOutsideManager = new ClickOutsideManager();
        }
    </script>
</body>
</html>
