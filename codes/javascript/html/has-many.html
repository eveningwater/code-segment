<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®åˆ†æç³»ç»Ÿ - é‡å¤æ¨¡å¼æ£€æµ‹</title>
    <link rel="stylesheet" href="../../demo/plugins/input-number/style.css">
    <link rel="stylesheet" href="../../demo/plugins/select/style.css">
    <link rel="stylesheet" href="../../demo/plugins/modal/style.css">
    <link rel="stylesheet" href="../../demo/plugins/notification/style.css">
    <link rel="stylesheet" href="../../demo/plugins/checkbox/style.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .panel h2 {
            color: #4a5568;
            margin-bottom: 20px;
            font-size: 1.5rem;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2d3748;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            align-items: end;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            box-shadow: 0 4px 15px rgba(240, 147, 251, 0.4);
        }

        .btn-secondary:hover {
            box-shadow: 0 6px 20px rgba(240, 147, 251, 0.6);
        }

        .btn-success {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            box-shadow: 0 4px 15px rgba(79, 172, 254, 0.4);
        }

        .btn-success:hover {
            box-shadow: 0 6px 20px rgba(79, 172, 254, 0.6);
        }

        .results-panel {
            grid-column: 1 / -1;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .result-card {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 15px;
            padding: 20px;
            border-left: 4px solid #667eea;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .result-card h3 {
            color: #4a5568;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-label {
            font-weight: 600;
            color: #2d3748;
        }

        .result-value {
            color: #667eea;
            font-weight: 600;
        }

        .result-value.success {
            color: #38a169;
        }

        .result-value.warning {
            color: #d69e2e;
        }

        .result-value.error {
            color: #e53e3e;
        }

        .data-preview {
            background: #f7fafc;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #e2e8f0;
        }

        .data-preview pre {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            color: #4a5568;
            white-space: pre-wrap;
        }

        .chart-container {
            height: 300px;
            margin-top: 20px;
            background: #f8fafc;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px dashed #cbd5e0;
        }

        .chart-placeholder {
            text-align: center;
            color: #718096;
        }

        .chart-placeholder i {
            font-size: 3rem;
            margin-bottom: 10px;
            display: block;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-group .ew-checkbox {
            margin-right: 15px;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” æ•°æ®åˆ†æç³»ç»Ÿ</h1>
            <p>åŸºäº hasMany æ–¹æ³•çš„é‡å¤æ¨¡å¼æ£€æµ‹ä¸æ•°æ®åˆ†æå¹³å°</p>
        </div>

        <div class="main-content">
            <!-- æ•°æ®è¾“å…¥é¢æ¿ -->
            <div class="panel">
                <h2>ğŸ“Š æ•°æ®è¾“å…¥</h2>
                <div class="form-group">
                    <label>æ•°æ®ç±»å‹</label>
                    <div id="dataTypeSelect"></div>
                </div>
                <div class="form-group">
                    <label>æ•°æ®å†…å®¹</label>
                    <textarea id="dataInput" rows="8" placeholder="è¯·è¾“å…¥æ•°æ®ï¼Œæ¯è¡Œä¸€ä¸ªå…ƒç´ æˆ–ä½¿ç”¨é€—å·åˆ†éš”" style="width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 8px; font-family: monospace; resize: vertical;"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>æ£€æµ‹é˜ˆå€¼</label>
                        <div id="thresholdInput"></div>
                    </div>
                    <div class="form-group">
                        <label>åˆ†ææ·±åº¦</label>
                        <div id="depthInput"></div>
                    </div>
                </div>
                <button class="btn" onclick="analyzeData()">ğŸš€ å¼€å§‹åˆ†æ</button>
            </div>

            <!-- æ£€æµ‹æ¡ä»¶é¢æ¿ -->
            <div class="panel">
                <h2>ğŸ¯ æ£€æµ‹æ¡ä»¶</h2>
                <div class="form-group">
                    <label>æ£€æµ‹æ¨¡å¼</label>
                    <div id="patternSelect"></div>
                </div>
                <div class="form-group">
                    <label>æ£€æµ‹é€‰é¡¹</label>
                    <div id="detectionOptions"></div>
                </div>
                <div class="form-group">
                    <label>è¿‡æ»¤æ¡ä»¶</label>
                    <div id="filterSelect"></div>
                </div>
                <div class="form-row">
                    <button class="btn btn-secondary" onclick="loadSampleData()">ğŸ“‹ åŠ è½½ç¤ºä¾‹æ•°æ®</button>
                    <button class="btn btn-success" onclick="exportResults()">ğŸ“¤ å¯¼å‡ºç»“æœ</button>
                </div>
            </div>
        </div>

        <!-- åŠ è½½çŠ¶æ€ -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>æ­£åœ¨åˆ†ææ•°æ®ï¼Œè¯·ç¨å€™...</p>
        </div>

        <!-- ç»“æœå±•ç¤ºé¢æ¿ -->
        <div class="results-panel" id="resultsPanel" style="display: none;">
            <h2>ğŸ“ˆ åˆ†æç»“æœ</h2>
            
            <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
            <div class="stats-grid" id="statsGrid"></div>
            
            <!-- è¯¦ç»†ç»“æœ -->
            <div class="results-grid" id="resultsGrid"></div>
            
            <!-- æ•°æ®é¢„è§ˆ -->
            <div class="data-preview" id="dataPreview"></div>
            
            <!-- å›¾è¡¨å®¹å™¨ -->
            <div class="chart-container" id="chartContainer">
                <div class="chart-placeholder">
                    <i>ğŸ“Š</i>
                    <p>åˆ†æå®Œæˆåå°†æ˜¾ç¤ºå¯è§†åŒ–å›¾è¡¨</p>
                </div>
            </div>
        </div>
    </div>

    <!-- å¯¼å…¥æ’ä»¶è„šæœ¬ -->
    <script src="../../demo/plugins/input-number/index.js"></script>
    <script src="../../demo/plugins/select/index.js"></script>
    <script src="../../demo/plugins/modal/index.js"></script>
    <script src="../../demo/plugins/notification/index.js"></script>
    <script src="../../demo/plugins/checkbox/index.js"></script>

    <script>
        // åˆå§‹åŒ–æ’ä»¶
        let notification, modal;
        let dataTypeSelect, patternSelect, filterSelect;
        let thresholdInput, depthInput;
        let detectionOptions;

        // hasMany æ–¹æ³•å®ç°
        const hasMany = (arr, handler) => arr.filter(handler).length > 1;

        // åˆå§‹åŒ–ç³»ç»Ÿ
        function initSystem() {
            // åˆå§‹åŒ–é€šçŸ¥ç³»ç»Ÿ
            notification = new Notification({
                position: 'top-right',
                duration: 4000
            });

            // åˆå§‹åŒ–æ¨¡æ€æ¡†
            modal = new Modal();

            // åˆå§‹åŒ–æ•°æ®ç±»å‹é€‰æ‹©å™¨
            dataTypeSelect = new Select({
                container: '#dataTypeSelect',
                options: [
                    { value: 'numbers', label: 'æ•°å­—æ•°ç»„' },
                    { value: 'strings', label: 'å­—ç¬¦ä¸²æ•°ç»„' },
                    { value: 'objects', label: 'å¯¹è±¡æ•°ç»„' },
                    { value: 'mixed', label: 'æ··åˆæ•°æ®' }
                ],
                onChange: (value) => {
                    updateDataInputPlaceholder(value);
                }
            });

            // åˆå§‹åŒ–æ£€æµ‹æ¨¡å¼é€‰æ‹©å™¨
            patternSelect = new Select({
                container: '#patternSelect',
                options: [
                    { value: 'duplicates', label: 'é‡å¤å€¼æ£€æµ‹' },
                    { value: 'patterns', label: 'æ¨¡å¼åŒ¹é…' },
                    { value: 'outliers', label: 'å¼‚å¸¸å€¼æ£€æµ‹' },
                    { value: 'clusters', label: 'èšç±»åˆ†æ' },
                    { value: 'trends', label: 'è¶‹åŠ¿åˆ†æ' }
                ]
            });

            // åˆå§‹åŒ–è¿‡æ»¤æ¡ä»¶é€‰æ‹©å™¨
            filterSelect = new Select({
                container: '#filterSelect',
                options: [
                    { value: 'none', label: 'æ— è¿‡æ»¤' },
                    { value: 'min', label: 'æœ€å°å€¼è¿‡æ»¤' },
                    { value: 'max', label: 'æœ€å¤§å€¼è¿‡æ»¤' },
                    { value: 'range', label: 'èŒƒå›´è¿‡æ»¤' },
                    { value: 'custom', label: 'è‡ªå®šä¹‰è¿‡æ»¤' }
                ]
            });

            // åˆå§‹åŒ–æ•°å€¼è¾“å…¥
            thresholdInput = new InputNumber({
                container: '#thresholdInput',
                min: 1,
                max: 100,
                value: 2,
                onChange: (value) => {
                    console.log('é˜ˆå€¼è®¾ç½®ä¸º:', value);
                }
            });

            depthInput = new InputNumber({
                container: '#depthInput',
                min: 1,
                max: 10,
                value: 3,
                onChange: (value) => {
                    console.log('åˆ†ææ·±åº¦è®¾ç½®ä¸º:', value);
                }
            });

            // åˆå§‹åŒ–æ£€æµ‹é€‰é¡¹å¤é€‰æ¡†ç»„
            detectionOptions = Checkbox.createCheckboxGroup({
                container: '#detectionOptions',
                items: [
                    { label: 'ä¸¥æ ¼æ¨¡å¼', checked: false },
                    { label: 'å¿½ç•¥å¤§å°å†™', checked: true },
                    { label: 'åŒ…å«ç©ºå€¼', checked: false },
                    { label: 'é€’å½’æ£€æµ‹', checked: true },
                    { label: 'å®æ—¶åˆ†æ', checked: false }
                ],
                onChange: (values) => {
                    console.log('æ£€æµ‹é€‰é¡¹:', values);
                }
            });

            // è®¾ç½®é»˜è®¤æ•°æ®ç±»å‹
            dataTypeSelect.setValue('numbers');
            
            notification.success('æ•°æ®åˆ†æç³»ç»Ÿåˆå§‹åŒ–å®Œæˆï¼');
        }

        // æ›´æ–°æ•°æ®è¾“å…¥å ä½ç¬¦
        function updateDataInputPlaceholder(dataType) {
            const dataInput = document.getElementById('dataInput');
            const placeholders = {
                numbers: 'è¯·è¾“å…¥æ•°å­—ï¼Œæ¯è¡Œä¸€ä¸ªæˆ–ä½¿ç”¨é€—å·åˆ†éš”\nä¾‹å¦‚ï¼š\n1\n2\n3\n4\n5',
                strings: 'è¯·è¾“å…¥å­—ç¬¦ä¸²ï¼Œæ¯è¡Œä¸€ä¸ªæˆ–ä½¿ç”¨é€—å·åˆ†éš”\nä¾‹å¦‚ï¼š\napple\nbanana\napple\norange',
                objects: 'è¯·è¾“å…¥JSONæ ¼å¼çš„å¯¹è±¡æ•°ç»„\nä¾‹å¦‚ï¼š\n[{"id": 1, "name": "Alice"},\n{"id": 2, "name": "Bob"},\n{"id": 1, "name": "Alice"}]',
                mixed: 'è¯·è¾“å…¥æ··åˆæ•°æ®ï¼Œæ¯è¡Œä¸€ä¸ªå…ƒç´ \nä¾‹å¦‚ï¼š\n123\n"hello"\n456\n"hello"\n789'
            };
            dataInput.placeholder = placeholders[dataType] || placeholders.numbers;
        }

        // è§£æè¾“å…¥æ•°æ®
        function parseInputData(input, dataType) {
            try {
                if (dataType === 'objects') {
                    return JSON.parse(input);
                }
                
                const lines = input.trim().split('\n');
                const data = [];
                
                for (let line of lines) {
                    line = line.trim();
                    if (!line) continue;
                    
                    if (line.includes(',')) {
                        const items = line.split(',').map(item => item.trim());
                        data.push(...items);
                    } else {
                        data.push(line);
                    }
                }
                
                if (dataType === 'numbers') {
                    return data.map(item => {
                        const num = parseFloat(item);
                        return isNaN(num) ? item : num;
                    });
                }
                
                return data;
            } catch (error) {
                throw new Error('æ•°æ®è§£æå¤±è´¥: ' + error.message);
            }
        }

        // åˆ†ææ•°æ®
        async function analyzeData() {
            const dataInput = document.getElementById('dataInput').value.trim();
            if (!dataInput) {
                notification.error('è¯·è¾“å…¥æ•°æ®å†…å®¹');
                return;
            }

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            document.getElementById('loading').classList.add('show');
            document.getElementById('resultsPanel').style.display = 'none';

            try {
                // æ¨¡æ‹Ÿå¼‚æ­¥åˆ†æ
                await new Promise(resolve => setTimeout(resolve, 1500));

                const dataType = dataTypeSelect.getValue();
                const pattern = patternSelect.getValue();
                const threshold = thresholdInput.getValue();
                const depth = depthInput.getValue();
                const filterType = filterSelect.getValue();
                const options = detectionOptions.checkboxes.map(cb => cb.isChecked());

                // è§£ææ•°æ®
                const data = parseInputData(dataInput, dataType);
                
                // æ‰§è¡Œåˆ†æ
                const results = performAnalysis(data, pattern, threshold, depth, filterType, options);
                
                // æ˜¾ç¤ºç»“æœ
                displayResults(results, data);
                
                notification.success('æ•°æ®åˆ†æå®Œæˆï¼');
                
            } catch (error) {
                notification.error('åˆ†æå¤±è´¥: ' + error.message);
            } finally {
                document.getElementById('loading').classList.remove('show');
            }
        }

        // æ‰§è¡Œæ•°æ®åˆ†æ
        function performAnalysis(data, pattern, threshold, depth, filterType, options) {
            const results = {
                totalItems: data.length,
                uniqueItems: new Set(data).size,
                duplicates: [],
                patterns: [],
                outliers: [],
                clusters: [],
                trends: [],
                statistics: {}
            };

            // é‡å¤å€¼æ£€æµ‹
            if (pattern === 'duplicates' || pattern === 'patterns') {
                const valueCounts = {};
                data.forEach(item => {
                    const key = options[1] ? String(item).toLowerCase() : String(item);
                    valueCounts[key] = (valueCounts[key] || 0) + 1;
                });

                Object.entries(valueCounts).forEach(([value, count]) => {
                    if (count >= threshold) {
                        results.duplicates.push({
                            value: value,
                            count: count,
                            percentage: (count / data.length * 100).toFixed(2)
                        });
                    }
                });
            }

            // ä½¿ç”¨ hasMany æ–¹æ³•æ£€æµ‹æ¨¡å¼
            if (pattern === 'patterns') {
                // æ£€æµ‹æ•°å€¼æ¨¡å¼
                if (dataTypeSelect.getValue() === 'numbers') {
                    const numbers = data.filter(item => typeof item === 'number');
                    
                    // æ£€æµ‹å¶æ•°
                    if (hasMany(numbers, x => x % 2 === 0)) {
                        results.patterns.push({
                            type: 'å¶æ•°æ¨¡å¼',
                            description: 'å­˜åœ¨å¤šä¸ªå¶æ•°',
                            count: numbers.filter(x => x % 2 === 0).length
                        });
                    }
                    
                    // æ£€æµ‹å¥‡æ•°
                    if (hasMany(numbers, x => x % 2 === 1)) {
                        results.patterns.push({
                            type: 'å¥‡æ•°æ¨¡å¼',
                            description: 'å­˜åœ¨å¤šä¸ªå¥‡æ•°',
                            count: numbers.filter(x => x % 2 === 1).length
                        });
                    }
                    
                    // æ£€æµ‹å¤§äºå¹³å‡å€¼çš„æ•°
                    const avg = numbers.reduce((sum, x) => sum + x, 0) / numbers.length;
                    if (hasMany(numbers, x => x > avg)) {
                        results.patterns.push({
                            type: 'é«˜äºå¹³å‡å€¼',
                            description: 'å­˜åœ¨å¤šä¸ªé«˜äºå¹³å‡å€¼çš„æ•°',
                            count: numbers.filter(x => x > avg).length,
                            average: avg.toFixed(2)
                        });
                    }
                }
                
                // æ£€æµ‹å­—ç¬¦ä¸²æ¨¡å¼
                if (dataTypeSelect.getValue() === 'strings') {
                    const strings = data.filter(item => typeof item === 'string');
                    
                    // æ£€æµ‹ç›¸åŒé•¿åº¦çš„å­—ç¬¦ä¸²
                    const lengthGroups = {};
                    strings.forEach(str => {
                        const len = str.length;
                        lengthGroups[len] = (lengthGroups[len] || 0) + 1;
                    });
                    
                    Object.entries(lengthGroups).forEach(([length, count]) => {
                        if (count >= threshold) {
                            results.patterns.push({
                                type: 'é•¿åº¦æ¨¡å¼',
                                description: `å­˜åœ¨${count}ä¸ªé•¿åº¦ä¸º${length}çš„å­—ç¬¦ä¸²`,
                                length: parseInt(length),
                                count: count
                            });
                        }
                    });
                }
            }

            // å¼‚å¸¸å€¼æ£€æµ‹
            if (pattern === 'outliers') {
                const numbers = data.filter(item => typeof item === 'number');
                if (numbers.length > 0) {
                    const sorted = numbers.sort((a, b) => a - b);
                    const q1 = sorted[Math.floor(sorted.length * 0.25)];
                    const q3 = sorted[Math.floor(sorted.length * 0.75)];
                    const iqr = q3 - q1;
                    const lowerBound = q1 - 1.5 * iqr;
                    const upperBound = q3 + 1.5 * iqr;
                    
                    const outliers = numbers.filter(x => x < lowerBound || x > upperBound);
                    if (hasMany(outliers, x => true)) {
                        results.outliers = outliers.map(x => ({
                            value: x,
                            type: x < lowerBound ? 'ä¸‹å¼‚å¸¸å€¼' : 'ä¸Šå¼‚å¸¸å€¼'
                        }));
                    }
                }
            }

            // è®¡ç®—ç»Ÿè®¡ä¿¡æ¯
            if (dataTypeSelect.getValue() === 'numbers') {
                const numbers = data.filter(item => typeof item === 'number');
                if (numbers.length > 0) {
                    results.statistics = {
                        min: Math.min(...numbers),
                        max: Math.max(...numbers),
                        average: (numbers.reduce((sum, x) => sum + x, 0) / numbers.length).toFixed(2),
                        median: calculateMedian(numbers),
                        standardDeviation: calculateStandardDeviation(numbers)
                    };
                }
            }

            return results;
        }

        // è®¡ç®—ä¸­ä½æ•°
        function calculateMedian(numbers) {
            const sorted = numbers.sort((a, b) => a - b);
            const mid = Math.floor(sorted.length / 2);
            return sorted.length % 2 === 0 
                ? ((sorted[mid - 1] + sorted[mid]) / 2).toFixed(2)
                : sorted[mid].toFixed(2);
        }

        // è®¡ç®—æ ‡å‡†å·®
        function calculateStandardDeviation(numbers) {
            const avg = numbers.reduce((sum, x) => sum + x, 0) / numbers.length;
            const variance = numbers.reduce((sum, x) => sum + Math.pow(x - avg, 2), 0) / numbers.length;
            return Math.sqrt(variance).toFixed(2);
        }

        // æ˜¾ç¤ºåˆ†æç»“æœ
        function displayResults(results, originalData) {
            const resultsPanel = document.getElementById('resultsPanel');
            const statsGrid = document.getElementById('statsGrid');
            const resultsGrid = document.getElementById('resultsGrid');
            const dataPreview = document.getElementById('dataPreview');

            // æ˜¾ç¤ºç»Ÿè®¡æ¦‚è§ˆ
            statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${results.totalItems}</div>
                    <div class="stat-label">æ€»æ•°æ®é‡</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${results.uniqueItems}</div>
                    <div class="stat-label">å”¯ä¸€å€¼</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${results.duplicates.length}</div>
                    <div class="stat-label">é‡å¤æ¨¡å¼</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${results.patterns.length}</div>
                    <div class="stat-label">æ£€æµ‹æ¨¡å¼</div>
                </div>
            `;

            // æ˜¾ç¤ºè¯¦ç»†ç»“æœ
            resultsGrid.innerHTML = '';

            // é‡å¤å€¼ç»“æœ
            if (results.duplicates.length > 0) {
                const duplicateCard = createResultCard('é‡å¤å€¼æ£€æµ‹', results.duplicates.map(item => ({
                    label: `å€¼: ${item.value}`,
                    value: `${item.count}æ¬¡ (${item.percentage}%)`,
                    className: item.count >= 3 ? 'warning' : 'success'
                })));
                resultsGrid.appendChild(duplicateCard);
            }

            // æ¨¡å¼æ£€æµ‹ç»“æœ
            if (results.patterns.length > 0) {
                const patternCard = createResultCard('æ¨¡å¼æ£€æµ‹', results.patterns.map(item => ({
                    label: item.type,
                    value: item.description,
                    className: 'success'
                })));
                resultsGrid.appendChild(patternCard);
            }

            // å¼‚å¸¸å€¼ç»“æœ
            if (results.outliers.length > 0) {
                const outlierCard = createResultCard('å¼‚å¸¸å€¼æ£€æµ‹', results.outliers.map(item => ({
                    label: `å¼‚å¸¸å€¼: ${item.value}`,
                    value: item.type,
                    className: 'error'
                })));
                resultsGrid.appendChild(outlierCard);
            }

            // ç»Ÿè®¡ä¿¡æ¯
            if (Object.keys(results.statistics).length > 0) {
                const statsCard = createResultCard('ç»Ÿè®¡ä¿¡æ¯', [
                    { label: 'æœ€å°å€¼', value: results.statistics.min, className: 'success' },
                    { label: 'æœ€å¤§å€¼', value: results.statistics.max, className: 'success' },
                    { label: 'å¹³å‡å€¼', value: results.statistics.average, className: 'success' },
                    { label: 'ä¸­ä½æ•°', value: results.statistics.median, className: 'success' },
                    { label: 'æ ‡å‡†å·®', value: results.statistics.standardDeviation, className: 'success' }
                ]);
                resultsGrid.appendChild(statsCard);
            }

            // æ˜¾ç¤ºæ•°æ®é¢„è§ˆ
            dataPreview.innerHTML = `
                <h4>åŸå§‹æ•°æ®é¢„è§ˆ (å‰20é¡¹):</h4>
                <pre>${JSON.stringify(originalData.slice(0, 20), null, 2)}</pre>
            `;

            resultsPanel.style.display = 'block';
        }

        // åˆ›å»ºç»“æœå¡ç‰‡
        function createResultCard(title, items) {
            const card = document.createElement('div');
            card.className = 'result-card';
            
            const titleElement = document.createElement('h3');
            titleElement.textContent = title;
            card.appendChild(titleElement);
            
            items.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = 'result-item';
                itemElement.innerHTML = `
                    <span class="result-label">${item.label}</span>
                    <span class="result-value ${item.className || ''}">${item.value}</span>
                `;
                card.appendChild(itemElement);
            });
            
            return card;
        }

        // åŠ è½½ç¤ºä¾‹æ•°æ®
        function loadSampleData() {
            const dataType = dataTypeSelect.getValue();
            const sampleData = {
                numbers: '1\n2\n3\n4\n5\n2\n3\n6\n7\n8\n9\n10\n2\n3\n4',
                strings: 'apple\nbanana\napple\norange\nbanana\napple\ngrape\norange\nkiwi\napple',
                objects: '[{"id": 1, "name": "Alice", "age": 25},\n{"id": 2, "name": "Bob", "age": 30},\n{"id": 1, "name": "Alice", "age": 25},\n{"id": 3, "name": "Charlie", "age": 35},\n{"id": 2, "name": "Bob", "age": 30}]',
                mixed: '123\n"hello"\n456\n"hello"\n789\n"world"\n123\n"hello"\n999'
            };
            
            document.getElementById('dataInput').value = sampleData[dataType];
            notification.info('ç¤ºä¾‹æ•°æ®å·²åŠ è½½');
        }

        // å¯¼å‡ºç»“æœ
        function exportResults() {
            const resultsPanel = document.getElementById('resultsPanel');
            if (resultsPanel.style.display === 'none') {
                notification.warning('è¯·å…ˆè¿›è¡Œæ•°æ®åˆ†æ');
                return;
            }

            modal.confirm('ç¡®å®šè¦å¯¼å‡ºåˆ†æç»“æœå—ï¼Ÿ').then(confirmed => {
                if (confirmed) {
                    // æ¨¡æ‹Ÿå¯¼å‡º
                    setTimeout(() => {
                        notification.success('åˆ†æç»“æœå·²å¯¼å‡ºåˆ° downloads/analysis-report.json');
                    }, 1000);
                }
            });
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', initSystem);
    </script>
</body>

</html>