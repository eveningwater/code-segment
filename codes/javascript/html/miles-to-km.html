<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‹±é‡Œè½¬å…¬é‡Œè½¬æ¢å¹³å° - milesToKm</title>
    <link rel="stylesheet" href="../../demo/plugins/modal/style.css">
    <link rel="stylesheet" href="../../demo/plugins/checkbox/style.css">
    <link rel="stylesheet" href="../../demo/plugins/notification/style.css">
    <link rel="stylesheet" href="../../demo/plugins/input-number/style.css">
    <!-- Highlight.js ä»£ç é«˜äº® -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            min-height: 100vh;
            color: #1f2937;
            line-height: 1.6;
            padding-bottom: 40px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 36px;
            color: white;
        }

        .header h1 {
            font-size: 2.7rem;
            margin-bottom: 12px;
            font-weight: 800;
            text-shadow: 0 3px 8px rgba(15, 23, 42, 0.35);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.95;
            max-width: 900px;
            margin: 0 auto;
        }

        .main-content {
            display: grid;
            grid-template-columns: 480px 1fr;
            gap: 26px;
            margin-bottom: 28px;
        }

        .card {
            background: rgba(255, 255, 255, 0.97);
            border-radius: 20px;
            padding: 26px;
            box-shadow: 0 14px 32px rgba(15, 23, 42, 0.15);
            margin-bottom: 10px;
        }

        .card h2 {
            font-size: 1.55rem;
            margin-bottom: 20px;
            color: #1f2937;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .input-section {
            margin-bottom: 22px;
        }

        .input-group {
            margin-bottom: 18px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
            font-size: 0.98rem;
        }

        .input-field,
        .textarea-field {
            width: 100%;
            padding: 14px;
            border: 2px solid #e5e7eb;
            border-radius: 14px;
            font-size: 1.05rem;
            font-family: 'Monaco', 'Menlo', monospace;
            transition: all 0.25s ease;
        }

        .textarea-field {
            min-height: 100px;
            resize: vertical;
        }

        .input-field:focus,
        .textarea-field:focus {
            outline: none;
            border-color: #fcb69f;
            box-shadow: 0 0 0 3px rgba(252, 182, 159, 0.25);
        }

        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 16px;
        }

        .btn {
            padding: 12px 22px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #fcb69f, #ffecd2);
            color: #1f2937;
        }

        .btn-success {
            background: linear-gradient(135deg, #22c55e, #15803d);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #fbbf24, #d97706);
            color: white;
        }

        .btn-info {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #b91c1c);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(252, 182, 159, 0.3);
        }

        .btn:active {
            transform: scale(0.97);
        }

        .btn-block {
            width: 100%;
            justify-content: center;
        }

        .conversion-display {
            background: #f8fafc;
            border-radius: 18px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .conversion-card {
            background: linear-gradient(135deg, #fff5e6, #ffe4cc);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            box-shadow: 0 8px 24px rgba(252, 182, 159, 0.2);
            margin-bottom: 16px;
        }

        .conversion-formula {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .value-box {
            background: white;
            border-radius: 14px;
            padding: 20px 30px;
            box-shadow: 0 4px 12px rgba(15, 23, 42, 0.1);
            min-width: 150px;
        }

        .value-number {
            font-size: 2.5rem;
            font-weight: 800;
            color: #1f2937;
            font-family: 'Monaco', 'Menlo', monospace;
        }

        .value-unit {
            font-size: 1rem;
            color: #64748b;
            margin-top: 8px;
            font-weight: 600;
        }

        .conversion-arrow {
            font-size: 2rem;
            color: #fcb69f;
            font-weight: 800;
        }

        .conversion-multiplier {
            background: #fef3c7;
            border-radius: 10px;
            padding: 12px 20px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 1.1rem;
            color: #92400e;
            font-weight: 700;
        }

        .visualization-bar {
            background: white;
            border-radius: 14px;
            padding: 20px;
            margin-top: 16px;
        }

        .bar-container {
            display: flex;
            align-items: flex-end;
            gap: 20px;
            height: 200px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 10px;
        }

        .bar-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .bar {
            width: 100%;
            background: linear-gradient(180deg, #fcb69f, #ffecd2);
            border-radius: 8px 8px 0 0;
            position: relative;
            transition: height 0.5s ease;
            box-shadow: 0 4px 12px rgba(252, 182, 159, 0.3);
        }

        .bar.miles {
            background: linear-gradient(180deg, #3b82f6, #60a5fa);
        }

        .bar.km {
            background: linear-gradient(180deg, #22c55e, #4ade80);
        }

        .bar-label {
            font-weight: 700;
            color: #1f2937;
            font-size: 0.9rem;
        }

        .bar-value {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Monaco', 'Menlo', monospace;
            font-weight: 700;
            color: #1f2937;
            font-size: 0.85rem;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        .comparison-card {
            background: white;
            border-radius: 14px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(15, 23, 42, 0.1);
        }

        .comparison-card h4 {
            font-size: 0.95rem;
            color: #fcb69f;
            margin-bottom: 10px;
        }

        .comparison-card p {
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9rem;
            color: #475569;
            margin: 4px 0;
        }

        .history-list {
            max-height: 320px;
            overflow-y: auto;
            background: #f1f5f9;
            border-radius: 12px;
            padding: 12px;
        }

        .history-item {
            background: white;
            padding: 14px;
            margin-bottom: 10px;
            border-radius: 12px;
            border-left: 4px solid #fcb69f;
            transition: transform 0.2s ease;
        }

        .history-item:hover {
            transform: translateX(4px);
        }

        .history-time {
            font-size: 0.75rem;
            color: #64748b;
            margin-bottom: 6px;
        }

        .history-summary {
            font-family: 'Monaco', monospace;
            font-size: 0.9rem;
            color: #1f2937;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        .stat-card {
            background: white;
            border-radius: 14px;
            padding: 18px;
            text-align: center;
            box-shadow: 0 3px 12px rgba(15, 23, 42, 0.1);
        }

        .stat-number {
            font-size: 1.8rem;
            font-weight: 800;
            color: #fcb69f;
        }

        .stat-label {
            font-size: 0.85rem;
            color: #64748b;
            margin-top: 4px;
        }

        .code-block {
            margin-top: 16px;
            border-radius: 12px;
            overflow: hidden;
        }

        .code-block pre {
            margin: 0;
            padding: 20px;
            background: #1e293b;
            overflow-x: auto;
        }

        .empty-state {
            text-align: center;
            padding: 36px 20px;
            color: #64748b;
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 12px;
            opacity: 0.5;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            border-radius: 999px;
            background: linear-gradient(135deg, #fcb69f, #ffecd2);
            color: #1f2937;
            font-size: 0.8rem;
            font-weight: 600;
            margin: 4px;
        }

        .batch-input {
            background: #f8fafc;
            border-radius: 14px;
            padding: 16px;
            margin-top: 16px;
        }

        .batch-result {
            background: white;
            border-radius: 10px;
            padding: 12px;
            margin-top: 12px;
            max-height: 200px;
            overflow-y: auto;
        }

        .batch-item {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            border-bottom: 1px solid #e5e7eb;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9rem;
        }

        .batch-item:last-child {
            border-bottom: none;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 2.2rem;
            }

            .conversion-formula {
                flex-direction: column;
            }

            .conversion-arrow {
                transform: rotate(90deg);
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ›£ï¸ è‹±é‡Œè½¬å…¬é‡Œè½¬æ¢å¹³å°</h1>
            <p>åŸºäº milesToKm å‡½æ•°çš„å•ä½è½¬æ¢å·¥å…·ï¼Œæ”¯æŒå•æ¬¡è½¬æ¢ã€æ‰¹é‡è½¬æ¢ã€å¯è§†åŒ–å¯¹æ¯”å’Œå†å²è®°å½•</p>
        </div>

        <div class="main-content">
            <div class="sidebar">
                <div class="card">
                    <h2>ğŸ“ è½¬æ¢è¾“å…¥</h2>
                    <div class="input-section">
                        <div class="input-group">
                            <label>è‹±é‡Œæ•° (Miles)</label>
                            <div id="milesInput"></div>
                        </div>
                        <div class="button-group">
                            <button class="btn btn-primary btn-block" onclick="window.convertTool?.convert()">âš¡ æ‰§è¡Œè½¬æ¢</button>
                        </div>
                        <div class="button-group">
                            <button class="btn btn-success" onclick="window.convertTool?.loadSample()">ğŸ“„ ç¤ºä¾‹æ•°æ®</button>
                            <button class="btn btn-info" onclick="window.convertTool?.generateRandom()">ğŸ² éšæœºç”Ÿæˆ</button>
                            <button class="btn btn-warning" onclick="window.convertTool?.clearAll()">ğŸ§¹ æ¸…ç©º</button>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2>ğŸ“¦ æ‰¹é‡è½¬æ¢</h2>
                    <div class="input-section">
                        <div class="input-group">
                            <label>æ‰¹é‡è‹±é‡Œæ•° (æ¯è¡Œä¸€ä¸ªæˆ–é€—å·åˆ†éš”)</label>
                            <textarea id="batchInput" class="textarea-field" placeholder="5, 10, 15 æˆ–æ¯è¡Œä¸€ä¸ªæ•°å­—"></textarea>
                        </div>
                        <div class="button-group">
                            <button class="btn btn-success btn-block" onclick="window.convertTool?.batchConvert()">âš¡ æ‰¹é‡è½¬æ¢</button>
                        </div>
                        <div id="batchResult" class="batch-result" style="display:none;"></div>
                    </div>
                </div>

                <div class="card">
                    <h2>âš™ï¸ é«˜çº§é€‰é¡¹</h2>
                    <div class="input-section">
                        <div id="checkboxGroup"></div>
                    </div>
                </div>

                <div class="card">
                    <h2>ğŸ—‚ï¸ è½¬æ¢å†å² (<span id="historyCount">0</span>)</h2>
                    <div class="history-list" id="historyList">
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ“œ</div>
                            <p>æš‚æ— è½¬æ¢å†å²</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="visualization">
                <div class="card" id="resultCard" style="display:none;">
                    <h2>âœ¨ è½¬æ¢ç»“æœ</h2>
                    <div class="conversion-display" id="resultDisplay"></div>
                </div>

                <div class="card" id="visualizationCard" style="display:none;">
                    <h2>ğŸ“Š å¯è§†åŒ–å¯¹æ¯”</h2>
                    <div class="visualization-bar" id="visualizationBar"></div>
                </div>

                <div class="card" id="analysisCard" style="display:none;">
                    <h2>ğŸ“ˆ è½¬æ¢åˆ†æ</h2>
                    <div class="comparison-grid" id="comparisonGrid"></div>
                </div>

                <div class="card" id="codeSection" style="display:none;">
                    <h2>ğŸ’» æ‰§è¡Œä»£ç </h2>
                    <div class="code-block">
                        <pre><code class="language-javascript" id="codePreview">// ä»£ç å°†åœ¨è¿™é‡Œæ˜¾ç¤º</code></pre>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>ğŸ“Š ç»Ÿè®¡ä¿¡æ¯</h2>
            <div class="stats-grid" id="statsGrid"></div>
        </div>

        <div class="card">
            <h2>ğŸ“– å‡½æ•°è¯´æ˜</h2>
            <div style="background:#f8fafc;padding:20px;border-radius:14px;">
                <h3 style="color:#fcb69f;margin-bottom:12px;">milesToKm å‡½æ•°ï¼ˆè‹±é‡Œè½¬æ¢æˆå…¬é‡Œï¼‰</h3>
                <div class="code-block">
                    <pre><code class="language-javascript">const milesToKm = miles => miles * 1.609344;</code></pre>
                </div>

                <h3 style="color:#fcb69f;margin:20px 0 12px;">å‡½æ•°è¯´æ˜</h3>
                <p style="color:#374151;line-height:1.8;">
                    <strong>milesToKm</strong> å°†è‹±é‡Œè½¬æ¢ä¸ºå…¬é‡Œã€‚
                    æŒ‰ç…§æ¢ç®—å…¬å¼ <code>km = miles Ã— 1.609344</code> è¿›è¡Œè®¡ç®—ã€‚
                    1 è‹±é‡Œçº¦ç­‰äº 1.609344 å…¬é‡Œã€‚
                </p>

                <h3 style="color:#fcb69f;margin:20px 0 12px;">ä½¿ç”¨æ–¹å¼</h3>
                <div class="code-block">
                    <pre><code class="language-javascript">milesToKm(5);
// ~8.04672

milesToKm(10);
// ~16.09344

milesToKm(1);
// 1.609344</code></pre>
                </div>

                <h3 style="color:#fcb69f;margin:20px 0 12px;">å…¸å‹åœºæ™¯</h3>
                <div>
                    <span class="badge">å•ä½è½¬æ¢</span>
                    <span class="badge">è·ç¦»è®¡ç®—</span>
                    <span class="badge">åœ°å›¾åº”ç”¨</span>
                    <span class="badge">è¿åŠ¨è¿½è¸ª</span>
                    <span class="badge">å¯¼èˆªç³»ç»Ÿ</span>
                    <span class="badge">æ•°æ®å¯è§†åŒ–</span>
                </div>
            </div>
        </div>
    </div>

    <script src="../../demo/plugins/modal/index.js"></script>
    <script src="../../demo/plugins/checkbox/index.js"></script>
    <script src="../../demo/plugins/notification/index.js"></script>
    <script src="../../demo/plugins/input-number/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
        const milesToKm = miles => miles * 1.609344;

        class MilesToKmTool {
            constructor() {
                this.plugins = {};
                this.currentMiles = 0;
                this.currentKm = null;
                this.history = [];
                this.stats = {
                    totalConversions: 0,
                    totalMiles: 0,
                    totalKm: 0,
                    averageMiles: 0,
                    maxMiles: 0
                };
                this.checkboxOptions = [
                    { id: 'showResult', label: 'æ˜¾ç¤ºè½¬æ¢ç»“æœ', checked: true },
                    { id: 'showVisualization', label: 'æ˜¾ç¤ºå¯è§†åŒ–å¯¹æ¯”', checked: true },
                    { id: 'showAnalysis', label: 'æ˜¾ç¤ºè½¬æ¢åˆ†æ', checked: true },
                    { id: 'showCode', label: 'æ˜¾ç¤ºä»£ç é¢„è§ˆ', checked: true },
                    { id: 'showNotifications', label: 'æ˜¾ç¤ºé€šçŸ¥æé†’', checked: true }
                ];
                this.init();
            }

            async init() {
                try {
                    await this.loadPlugins();
                    this.setupInputNumber();
                    this.setupCheckboxes();
                    this.initHighlight();
                    this.updateStats();
                    this.showWelcomeMessage();
                } catch (error) {
                    console.error('åˆå§‹åŒ–å¤±è´¥:', error);
                    this.showError('åˆå§‹åŒ–å¤±è´¥: ' + error.message);
                }
            }

            initHighlight() {
                if (window.hljs) {
                    document.querySelectorAll('pre code').forEach((block) => hljs.highlightElement(block));
                }
            }

            async loadPlugins() {
                try {
                    this.plugins.modal = new Modal();
                    this.plugins.notification = new Notification();
                } catch (error) {
                    console.warn('éƒ¨åˆ†æ’ä»¶åŠ è½½å¤±è´¥:', error);
                }
            }

            setupInputNumber() {
                const container = document.getElementById('milesInput');
                if (!container) return;
                try {
                    this.plugins.milesInput = new InputNumber({
                        container,
                        value: 5,
                        min: 0,
                        max: 10000,
                        step: 0.1,
                        onChange: () => {}
                    });
                } catch (error) {
                    console.warn('è‡ªå®šä¹‰æ•°å­—è¾“å…¥åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨åŸç”Ÿè¾“å…¥æ¡†:', error);
                    const input = document.createElement('input');
                    input.type = 'number';
                    input.value = '5';
                    input.min = '0';
                    input.max = '10000';
                    input.step = '0.1';
                    input.id = 'milesNative';
                    input.className = 'input-field';
                    input.addEventListener('input', () => {});
                    container.appendChild(input);
                }
            }

            setupCheckboxes() {
                const container = document.getElementById('checkboxGroup');
                if (!container) return;
                try {
                    const group = Checkbox.createCheckboxGroup({
                        items: this.checkboxOptions.map(option => ({
                            id: option.id,
                            label: option.label,
                            checked: option.checked
                        })),
                        onChange: () => {}
                    });
                    container.appendChild(group.container);
                    this.plugins.checkboxGroup = group;
                } catch (error) {
                    console.warn('å¤é€‰æ¡†æ’ä»¶åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨åŸç”Ÿå¤é€‰æ¡†:', error);
                    this.checkboxOptions.forEach(option => {
                        const div = document.createElement('div');
                        div.style.marginBottom = '10px';
                        div.innerHTML = `<input type="checkbox" id="${option.id}" ${option.checked ? 'checked' : ''}>` +
                            `<label for="${option.id}" style="margin-left:6px;">${option.label}</label>`;
                        container.appendChild(div);
                    });
                }
            }

            getCheckboxValue(id) {
                if (this.plugins.checkboxGroup) {
                    try {
                        const states = this.plugins.checkboxGroup.getAllChecked();
                        const index = this.checkboxOptions.findIndex(option => option.id === id);
                        if (index !== -1) {
                            return states[index] || false;
                        }
                    } catch (error) {
                        console.warn('è¯»å–å¤é€‰æ¡†çŠ¶æ€å¤±è´¥ï¼Œä½¿ç”¨åŸç”Ÿæ–¹æ³•:', error);
                    }
                }
                const checkbox = document.getElementById(id);
                return checkbox ? checkbox.checked : false;
            }

            getMiles() {
                if (this.plugins.milesInput?.getValue) {
                    return Number(this.plugins.milesInput.getValue() || 0);
                }
                const native = document.getElementById('milesNative');
                return native ? Number(native.value || 0) : 0;
            }

            convert() {
                const miles = this.getMiles();
                if (miles < 0) {
                    this.showError('è‹±é‡Œæ•°ä¸èƒ½ä¸ºè´Ÿæ•°');
                    return;
                }

                const start = performance.now();
                this.currentMiles = miles;
                this.currentKm = milesToKm(miles);
                const end = performance.now();
                const time = Math.round((end - start) * 1000) / 1000;

                this.stats.totalConversions++;
                this.stats.totalMiles += miles;
                this.stats.totalKm += this.currentKm;
                this.stats.averageMiles = Math.round((this.stats.totalMiles / this.stats.totalConversions) * 100) / 100;
                this.stats.maxMiles = Math.max(this.stats.maxMiles, miles);

                this.displayResult();
                this.updateStats();
                this.addToHistory(time);

                if (this.getCheckboxValue('showVisualization')) {
                    this.displayVisualization();
                }

                if (this.getCheckboxValue('showAnalysis')) {
                    this.displayAnalysis(time);
                }

                if (this.getCheckboxValue('showCode')) {
                    this.showCode();
                }

                this.showNotification(`è½¬æ¢å®Œæˆï¼${miles} è‹±é‡Œ = ${this.currentKm.toFixed(4)} å…¬é‡Œ`, 'success');
            }

            displayResult() {
                const card = document.getElementById('resultCard');
                const container = document.getElementById('resultDisplay');
                if (!card || !container) return;

                if (!this.getCheckboxValue('showResult')) {
                    card.style.display = 'none';
                    return;
                }

                if (this.currentKm === null) {
                    card.style.display = 'none';
                    return;
                }

                container.innerHTML = `
                    <div class="conversion-card">
                        <div class="conversion-formula">
                            <div class="value-box">
                                <div class="value-number">${this.currentMiles.toFixed(2)}</div>
                                <div class="value-unit">è‹±é‡Œ (Miles)</div>
                            </div>
                            <div class="conversion-arrow">Ã—</div>
                            <div class="conversion-multiplier">1.609344</div>
                            <div class="conversion-arrow">=</div>
                            <div class="value-box">
                                <div class="value-number">${this.currentKm.toFixed(4)}</div>
                                <div class="value-unit">å…¬é‡Œ (Kilometers)</div>
                            </div>
                        </div>
                    </div>
                `;

                card.style.display = 'block';
            }

            displayVisualization() {
                const card = document.getElementById('visualizationCard');
                const container = document.getElementById('visualizationBar');
                if (!card || !container) return;

                if (!this.currentKm || this.currentMiles === 0) {
                    card.style.display = 'none';
                    return;
                }

                const maxValue = Math.max(this.currentMiles, this.currentKm);
                const milesHeight = (this.currentMiles / maxValue) * 100;
                const kmHeight = (this.currentKm / maxValue) * 100;

                container.innerHTML = `
                    <div class="bar-container">
                        <div class="bar-item">
                            <div class="bar miles" style="height: ${milesHeight}%">
                                <div class="bar-value">${this.currentMiles.toFixed(2)}</div>
                            </div>
                            <div class="bar-label">è‹±é‡Œ</div>
                        </div>
                        <div class="bar-item">
                            <div class="bar km" style="height: ${kmHeight}%">
                                <div class="bar-value">${this.currentKm.toFixed(2)}</div>
                            </div>
                            <div class="bar-label">å…¬é‡Œ</div>
                        </div>
                    </div>
                `;

                card.style.display = 'block';
            }

            displayAnalysis(time) {
                const card = document.getElementById('analysisCard');
                const grid = document.getElementById('comparisonGrid');
                if (!card || !grid) return;

                if (!this.currentKm || this.currentMiles === 0) {
                    card.style.display = 'none';
                    return;
                }

                const ratio = this.currentKm / this.currentMiles;
                const difference = this.currentKm - this.currentMiles;
                const percentage = ((this.currentKm - this.currentMiles) / this.currentMiles * 100).toFixed(2);

                grid.innerHTML = `
                    <div class="comparison-card">
                        <h4>ğŸ“Š è½¬æ¢ä¿¡æ¯</h4>
                        <p>è¾“å…¥: ${this.currentMiles.toFixed(2)} è‹±é‡Œ</p>
                        <p>è¾“å‡º: ${this.currentKm.toFixed(4)} å…¬é‡Œ</p>
                        <p>è½¬æ¢ç³»æ•°: 1.609344</p>
                        <p>è®¡ç®—æ—¶é—´: ${time}Î¼s</p>
                    </div>
                    <div class="comparison-card">
                        <h4>ğŸ“ˆ å¯¹æ¯”åˆ†æ</h4>
                        <p>æ¯”å€¼: ${ratio.toFixed(4)}</p>
                        <p>å·®å€¼: +${difference.toFixed(4)} å…¬é‡Œ</p>
                        <p>å¢åŠ æ¯”ä¾‹: +${percentage}%</p>
                        <p>1 è‹±é‡Œ â‰ˆ ${this.currentKm.toFixed(4)} å…¬é‡Œ</p>
                    </div>
                    <div class="comparison-card">
                        <h4>ğŸŒ å®é™…å‚è€ƒ</h4>
                        <p>${this.currentMiles.toFixed(1)} è‹±é‡Œ â‰ˆ ${(this.currentKm / 1.609).toFixed(1)} å…¬é‡Œï¼ˆè¿‘ä¼¼ï¼‰</p>
                        <p>ç›¸å½“äº: ${(this.currentKm / 1000).toFixed(2)} åƒç±³</p>
                        <p>é©¬æ‹‰æ¾: ${(this.currentMiles / 26.2).toFixed(2)} å€</p>
                        <p>åŸå¸‚é—´è·ç¦»: ${this.currentMiles < 100 ? 'çŸ­é€”' : this.currentMiles < 500 ? 'ä¸­é€”' : 'é•¿é€”'}</p>
                    </div>
                `;

                card.style.display = 'block';
            }

            batchConvert() {
                const batchInput = document.getElementById('batchInput');
                if (!batchInput) return;

                const inputStr = batchInput.value.trim();
                if (!inputStr) {
                    this.showError('è¯·è¾“å…¥æ‰¹é‡æ•°æ®');
                    return;
                }

                try {
                    let milesArray = [];
                    // å°è¯•è§£æä¸ºé€—å·åˆ†éš”
                    if (inputStr.includes(',')) {
                        milesArray = inputStr.split(',').map(item => {
                            const num = Number(item.trim());
                            if (Number.isNaN(num) || num < 0) {
                                throw new Error(`æ— æ•ˆçš„æ•°å€¼: ${item.trim()}`);
                            }
                            return num;
                        });
                    } else {
                        // æŒ‰è¡Œåˆ†éš”
                        const lines = inputStr.split('\n').filter(line => line.trim());
                        milesArray = lines.map(line => {
                            const num = Number(line.trim());
                            if (Number.isNaN(num) || num < 0) {
                                throw new Error(`æ— æ•ˆçš„æ•°å€¼: ${line.trim()}`);
                            }
                            return num;
                        });
                    }

                    if (milesArray.length === 0) {
                        this.showError('æœªæ‰¾åˆ°æœ‰æ•ˆæ•°æ®');
                        return;
                    }

                    const results = milesArray.map(miles => ({
                        miles,
                        km: milesToKm(miles)
                    }));

                    const resultContainer = document.getElementById('batchResult');
                    if (resultContainer) {
                        resultContainer.innerHTML = `
                            <div style="font-weight:700;color:#1f2937;margin-bottom:12px;">è½¬æ¢ç»“æœ (${results.length} æ¡)</div>
                            ${results.map((item, index) => `
                                <div class="batch-item">
                                    <span>${index + 1}. ${item.miles.toFixed(2)} è‹±é‡Œ</span>
                                    <span style="color:#22c55e;font-weight:700;">= ${item.km.toFixed(4)} å…¬é‡Œ</span>
                                </div>
                            `).join('')}
                        `;
                        resultContainer.style.display = 'block';
                    }

                    // æ›´æ–°ç»Ÿè®¡
                    results.forEach(item => {
                        this.stats.totalConversions++;
                        this.stats.totalMiles += item.miles;
                        this.stats.totalKm += item.km;
                    });
                    this.stats.averageMiles = Math.round((this.stats.totalMiles / this.stats.totalConversions) * 100) / 100;
                    this.stats.maxMiles = Math.max(this.stats.maxMiles, ...results.map(r => r.miles));

                    this.updateStats();
                    this.showNotification(`æ‰¹é‡è½¬æ¢å®Œæˆï¼å…±è½¬æ¢ ${results.length} æ¡æ•°æ®`, 'success');
                } catch (error) {
                    this.showError(error.message);
                }
            }

            addToHistory(time) {
                this.history.unshift({
                    time: new Date().toLocaleString('zh-CN'),
                    miles: this.currentMiles,
                    km: this.currentKm,
                    execTime: time
                });
                if (this.history.length > 40) this.history.pop();
                this.updateHistoryDisplay();
            }

            updateHistoryDisplay() {
                const container = document.getElementById('historyList');
                const count = document.getElementById('historyCount');
                if (!container) return;
                if (count) count.textContent = this.history.length;

                if (this.history.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ“œ</div>
                            <p>æš‚æ— è½¬æ¢å†å²</p>
                        </div>`;
                    return;
                }

                container.innerHTML = this.history.slice(0, 20).map(item => `
                    <div class="history-item">
                        <div class="history-time">${item.time} â€¢ ${item.execTime}Î¼s</div>
                        <div class="history-summary">
                            ${item.miles.toFixed(2)} è‹±é‡Œ = ${item.km.toFixed(4)} å…¬é‡Œ
                        </div>
                    </div>
                `).join('');
            }

            updateStats() {
                const grid = document.getElementById('statsGrid');
                if (!grid) return;
                grid.innerHTML = `
                    <div class="stat-card">
                        <div class="stat-number">${this.stats.totalConversions}</div>
                        <div class="stat-label">è½¬æ¢æ¬¡æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${this.stats.totalMiles.toFixed(1)}</div>
                        <div class="stat-label">ç´¯è®¡è‹±é‡Œ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${this.stats.totalKm.toFixed(1)}</div>
                        <div class="stat-label">ç´¯è®¡å…¬é‡Œ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${this.stats.averageMiles.toFixed(1)}</div>
                        <div class="stat-label">å¹³å‡è‹±é‡Œ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${this.stats.maxMiles.toFixed(1)}</div>
                        <div class="stat-label">æœ€å¤§è‹±é‡Œ</div>
                    </div>
                `;
            }

            showCode() {
                const section = document.getElementById('codeSection');
                const preview = document.getElementById('codePreview');
                if (!preview) return;

                if (!this.currentKm || this.currentMiles === 0) {
                    if (section) section.style.display = 'none';
                    return;
                }

                const code = `const milesToKm = miles => miles * 1.609344;

// è¾“å…¥è‹±é‡Œæ•°
const miles = ${this.currentMiles};

// æ‰§è¡Œè½¬æ¢
const km = milesToKm(miles);

console.log(km);
// ${this.currentKm.toFixed(4)}

// è¯´æ˜ï¼š
// - milesToKm å°†è‹±é‡Œè½¬æ¢ä¸ºå…¬é‡Œ
// - è½¬æ¢å…¬å¼: km = miles Ã— 1.609344
// - 1 è‹±é‡Œ = 1.609344 å…¬é‡Œ
// - æ—¶é—´å¤æ‚åº¦: O(1)
// - ç©ºé—´å¤æ‚åº¦: O(1)
// - é€‚ç”¨äºè·ç¦»å•ä½è½¬æ¢ã€åœ°å›¾åº”ç”¨ç­‰åœºæ™¯`;

                preview.textContent = code;
                if (window.hljs) {
                    delete preview.dataset.highlighted;
                    preview.className = 'language-javascript';
                    hljs.highlightElement(preview);
                }
                if (section) section.style.display = 'block';
            }

            clearAll() {
                this.currentMiles = 0;
                this.currentKm = null;
                if (this.plugins.milesInput?.setValue) {
                    this.plugins.milesInput.setValue(0);
                } else {
                    const native = document.getElementById('milesNative');
                    if (native) native.value = '0';
                }
                const batchInput = document.getElementById('batchInput');
                if (batchInput) batchInput.value = '';
                const batchResult = document.getElementById('batchResult');
                if (batchResult) {
                    batchResult.style.display = 'none';
                    batchResult.innerHTML = '';
                }
                this.displayResult();
                const visualizationCard = document.getElementById('visualizationCard');
                if (visualizationCard) visualizationCard.style.display = 'none';
                const analysisCard = document.getElementById('analysisCard');
                if (analysisCard) analysisCard.style.display = 'none';
                const codeSection = document.getElementById('codeSection');
                if (codeSection) codeSection.style.display = 'none';
                this.showNotification('å·²æ¸…ç©ºå…¨éƒ¨æ•°æ®', 'info');
            }

            loadSample() {
                const samples = [5, 10, 26.2, 100, 500];
                const sample = samples[Math.floor(Math.random() * samples.length)];
                if (this.plugins.milesInput?.setValue) {
                    this.plugins.milesInput.setValue(sample);
                } else {
                    const native = document.getElementById('milesNative');
                    if (native) native.value = String(sample);
                }
                this.showNotification('ç¤ºä¾‹æ•°æ®å·²åŠ è½½', 'info');
            }

            generateRandom() {
                const random = Math.floor(Math.random() * 1000) + 1;
                if (this.plugins.milesInput?.setValue) {
                    this.plugins.milesInput.setValue(random);
                } else {
                    const native = document.getElementById('milesNative');
                    if (native) native.value = String(random);
                }
                this.showNotification(`å·²ç”Ÿæˆéšæœºå€¼: ${random} è‹±é‡Œ`, 'info');
            }

            showNotification(message, type) {
                if (this.plugins.notification && this.getCheckboxValue('showNotifications')) {
                    this.plugins.notification.show(message, type);
                } else {
                    console.log(`${type.toUpperCase()}: ${message}`);
                }
            }

            showError(message) {
                this.showNotification(message, 'error');
            }

            showWelcomeMessage() {
                if (this.plugins.modal) {
                    this.plugins.modal.show({
                        title: 'ğŸ‰ æ¬¢è¿ä½¿ç”¨è‹±é‡Œè½¬å…¬é‡Œè½¬æ¢å¹³å°',
                        content: `
                            <div style="padding:18px;">
                                <div style="font-size:46px;text-align:center;margin-bottom:12px;">ğŸ›£ï¸</div>
                                <p style="color:#1f2937;line-height:1.8;">
                                    ä½¿ç”¨ <strong>milesToKm</strong> å‡½æ•°å°†è‹±é‡Œè½¬æ¢ä¸ºå…¬é‡Œã€‚
                                    æ”¯æŒå•æ¬¡è½¬æ¢ã€æ‰¹é‡è½¬æ¢ã€å¯è§†åŒ–å¯¹æ¯”å’Œè¯¦ç»†åˆ†æã€‚
                                </p>
                                <div style="background:#fff5e6;border-left:4px solid #fcb69f;padding:12px;border-radius:12px;color:#92400e;margin-top:12px;">
                                    <strong>äº®ç‚¹ï¼š</strong> å®æ—¶è½¬æ¢ã€æ‰¹é‡å¤„ç†ã€å¯è§†åŒ–å¯¹æ¯”ã€è½¬æ¢åˆ†æã€ä»£ç é¢„è§ˆã€å†å²è®°å½•ã€‚
                                </div>
                                <ul style="color:#1f2937;margin-left:18px;margin-top:12px;line-height:1.8;">
                                    <li>æ”¯æŒå•æ¬¡è½¬æ¢å’Œæ‰¹é‡è½¬æ¢ï¼ˆé€—å·æˆ–æ¢è¡Œåˆ†éš”ï¼‰</li>
                                    <li>å¯è§†åŒ–å±•ç¤ºè‹±é‡Œå’Œå…¬é‡Œçš„å¯¹æ¯”</li>
                                    <li>æä¾›è¯¦ç»†çš„è½¬æ¢åˆ†æå’Œå®é™…å‚è€ƒ</li>
                                    <li>è®°å½•è½¬æ¢å†å²å¹¶ç»Ÿè®¡ç´¯è®¡æ•°æ®</li>
                                </ul>
                            </div>
                        `,
                        type: 'alert'
                    });
                }
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            window.convertTool = new MilesToKmTool();
        });

        if (document.readyState !== 'loading' && !window.convertTool) {
            window.convertTool = new MilesToKmTool();
        }
    </script>
</body>

</html>
