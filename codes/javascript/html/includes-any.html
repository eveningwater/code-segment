<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能内容推荐与标签匹配系统 - includesAny函数实战示例</title>
    <link rel="stylesheet" href="../../demo/plugins/modal/style.css">
    <link rel="stylesheet" href="../../demo/plugins/notification/style.css">
    <link rel="stylesheet" href="../../demo/plugins/select/style.css">
    <link rel="stylesheet" href="../../demo/plugins/checkbox/style.css">
    <link rel="stylesheet" href="../../demo/plugins/datetime-picker/style.css">
    <link rel="stylesheet" href="../../demo/plugins/input-number/style.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .control-panel {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #e9ecef;
            margin-bottom: 30px;
        }

        .control-section {
            margin-bottom: 25px;
        }

        .control-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.1em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 0.9em;
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 14px;
            margin: 5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(40, 167, 69, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
            color: #212529;
        }

        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 193, 7, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #e74c3c 100%);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(220, 53, 69, 0.4);
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 25px;
            transition: all 0.3s ease;
        }

        .card:hover {
            border-color: #667eea;
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .card-icon {
            font-size: 1.5em;
        }

        .card-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #333;
        }

        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .content-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .content-card:hover {
            border-color: #667eea;
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .content-card.matched {
            border-color: #28a745;
            background: #f8fff9;
        }

        .content-card.partial {
            border-color: #ffc107;
            background: #fffef8;
        }

        .content-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .content-icon {
            font-size: 1.5em;
        }

        .content-title {
            font-weight: 600;
            color: #333;
            font-size: 1.1em;
        }

        .content-category {
            margin-left: auto;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .category-tech {
            background: #e3f2fd;
            color: #1976d2;
        }

        .category-design {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .category-business {
            background: #e8f5e8;
            color: #388e3c;
        }

        .category-lifestyle {
            background: #fff3e0;
            color: #f57c00;
        }

        .content-description {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .content-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 15px;
        }

        .content-tag {
            background: #e9ecef;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            color: #666;
        }

        .content-tag.matched {
            background: #d4edda;
            color: #155724;
        }

        .content-tag.partial {
            background: #fff3cd;
            color: #856404;
        }

        .content-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9em;
            color: #999;
        }

        .search-panel {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .search-result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            font-weight: 600;
        }

        .search-result.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .search-result.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .search-result.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .tag-cloud {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .tag-item {
            display: inline-block;
            background: #e9ecef;
            padding: 8px 12px;
            border-radius: 20px;
            margin: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        .tag-item:hover {
            background: #667eea;
            color: white;
            transform: scale(1.05);
        }

        .tag-item.selected {
            background: #28a745;
            color: white;
        }

        .tag-item.matched {
            background: #d4edda;
            color: #155724;
            border: 2px solid #28a745;
        }

        .recommendation-panel {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .recommendation-item {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .recommendation-item:hover {
            border-color: #667eea;
            transform: translateX(5px);
        }

        .recommendation-score {
            float: right;
            background: #667eea;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .filter-panel {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .filter-group {
            margin-bottom: 15px;
        }

        .filter-label {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            display: block;
        }

        .filter-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .filter-option {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        .filter-option:hover {
            border-color: #667eea;
        }

        .filter-option.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .stats-panel {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 300px;
            overflow-y: auto;
        }

        .stats-entry {
            margin-bottom: 8px;
            padding: 5px 0;
            border-bottom: 1px solid #4a5568;
        }

        .stats-time {
            color: #a0aec0;
            margin-right: 10px;
        }

        .stats-action {
            color: #63b3ed;
        }

        .stats-result {
            margin-left: 10px;
        }

        .stats-result.success {
            color: #68d391;
        }

        .stats-result.warning {
            color: #f6ad55;
        }

        .stats-result.error {
            color: #fc8181;
        }

        .matching-visualizer {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .matching-chart {
            height: 200px;
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            position: relative;
        }

        .matching-bar {
            background: #e9ecef;
            height: 20px;
            border-radius: 10px;
            margin: 10px 0;
            position: relative;
            overflow: hidden;
        }

        .matching-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745 0%, #20c997 100%);
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .matching-fill.partial {
            background: linear-gradient(90deg, #ffc107 0%, #fd7e14 100%);
        }

        .matching-fill.low {
            background: linear-gradient(90deg, #dc3545 0%, #e74c3c 100%);
        }

        .matching-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .matching-value {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: white;
            font-weight: bold;
            font-size: 0.8em;
        }

        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .controls-grid {
                grid-template-columns: 1fr;
            }
            
            .content-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>🎯 智能内容推荐与标签匹配系统</h1>
            <p>基于 includesAny 函数的实战示例 - 内容分类、标签匹配、智能推荐</p>
        </div>

        <div class="content">
            <!-- 控制面板 -->
            <div class="control-panel">
                <div class="control-section">
                    <h3>⚙️ 系统配置</h3>
                    <div class="controls-grid">
                        <div class="form-group">
                            <label>内容类型</label>
                            <div id="contentTypeSelect"></div>
                        </div>
                        <div class="form-group">
                            <label>匹配模式</label>
                            <div id="matchingModeSelect"></div>
                        </div>
                        <div class="form-group">
                            <label>推荐数量</label>
                            <div id="recommendationCountInput"></div>
                        </div>
                        <div class="form-group">
                            <label>智能推荐</label>
                            <div id="smartRecommendationCheckbox"></div>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="searchContent()">搜索内容</button>
                    <button class="btn btn-success" onclick="generateRecommendations()">生成推荐</button>
                    <button class="btn btn-warning" onclick="analyzeTags()">标签分析</button>
                    <button class="btn btn-danger" onclick="clearResults()">清除结果</button>
                </div>
            </div>

            <!-- 仪表板 -->
            <div class="dashboard">
                <!-- 搜索面板 -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-icon">🔍</span>
                        <span class="card-title">内容搜索</span>
                    </div>
                    <div class="search-panel">
                        <div class="controls-grid">
                            <div class="form-group">
                                <label>搜索标签</label>
                                <div id="searchTagsSelect"></div>
                            </div>
                            <div class="form-group">
                                <label>内容分类</label>
                                <div id="contentCategorySelect"></div>
                            </div>
                            <div class="form-group">
                                <label>匹配阈值</label>
                                <div id="matchingThresholdInput"></div>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="performSearch()">执行搜索</button>
                        <button class="btn btn-success" onclick="advancedSearch()">高级搜索</button>
                        <div id="searchResult" class="search-result" style="display: none;"></div>
                    </div>
                </div>

                <!-- 标签云 -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-icon">🏷️</span>
                        <span class="card-title">标签云</span>
                    </div>
                    <div class="tag-cloud" id="tagCloud">
                        <!-- 标签将在这里动态生成 -->
                    </div>
                </div>

                <!-- 匹配可视化 -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-icon">📊</span>
                        <span class="card-title">匹配可视化</span>
                    </div>
                    <div class="matching-visualizer">
                        <div id="matchingChart">
                            <!-- 匹配图表将在这里显示 -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- 过滤面板 -->
            <div class="card">
                <div class="card-header">
                    <span class="card-icon">🔧</span>
                    <span class="card-title">内容过滤</span>
                </div>
                <div class="filter-panel">
                    <div class="filter-group">
                        <label class="filter-label">内容分类</label>
                        <div class="filter-options" id="categoryFilters">
                            <!-- 分类过滤器将在这里生成 -->
                        </div>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">标签过滤</label>
                        <div class="filter-options" id="tagFilters">
                            <!-- 标签过滤器将在这里生成 -->
                        </div>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">匹配度</label>
                        <div class="filter-options" id="matchingFilters">
                            <!-- 匹配度过滤器将在这里生成 -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- 推荐面板 -->
            <div class="card">
                <div class="card-header">
                    <span class="card-icon">💡</span>
                    <span class="card-title">智能推荐</span>
                </div>
                <div class="recommendation-panel" id="recommendationPanel">
                    <!-- 推荐内容将在这里显示 -->
                </div>
            </div>

            <!-- 内容网格 -->
            <div class="card">
                <div class="card-header">
                    <span class="card-icon">📚</span>
                    <span class="card-title">内容库</span>
                </div>
                <div class="content-grid" id="contentGrid">
                    <!-- 内容卡片将在这里动态生成 -->
                </div>
            </div>

            <!-- 统计面板 -->
            <div class="card">
                <div class="card-header">
                    <span class="card-icon">📈</span>
                    <span class="card-title">系统统计</span>
                </div>
                <div class="stats-panel" id="statsPanel">
                    <!-- 统计信息将在这里显示 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 引入插件 -->
    <script src="../../demo/plugins/modal/index.js"></script>
    <script src="../../demo/plugins/notification/index.js"></script>
    <script src="../../demo/plugins/select/index.js"></script>
    <script src="../../demo/plugins/checkbox/index.js"></script>
    <script src="../../demo/plugins/datetime-picker/index.js"></script>
    <script src="../../demo/plugins/input-number/index.js"></script>

    <script>
        // 全局变量
        let modal, notification;
        let contentTypeSelect, matchingModeSelect, recommendationCountInput, smartRecommendationCheckbox;
        let searchTagsSelect, contentCategorySelect, matchingThresholdInput;
        let contents = [];
        let tags = [];
        let categories = [];
        let selectedTags = [];
        let searchHistory = [];
        let recommendations = [];

        // includesAny 函数
        const includesAny = (arr, values) => values.some(v => arr.includes(v));

        // 初始化应用
        function initApp() {
            // 初始化插件
            modal = new Modal();
            notification = new Notification({ position: 'top-right' });

            // 初始化选择控件
            contentTypeSelect = new Select({
                container: document.getElementById('contentTypeSelect'),
                options: [
                    { value: 'article', label: '文章' },
                    { value: 'video', label: '视频' },
                    { value: 'image', label: '图片' },
                    { value: 'audio', label: '音频' },
                    { value: 'document', label: '文档' }
                ],
                placeholder: '选择内容类型'
            });

            matchingModeSelect = new Select({
                container: document.getElementById('matchingModeSelect'),
                options: [
                    { value: 'exact', label: '精确匹配' },
                    { value: 'partial', label: '部分匹配' },
                    { value: 'fuzzy', label: '模糊匹配' },
                    { value: 'smart', label: '智能匹配' }
                ],
                placeholder: '选择匹配模式'
            });

            recommendationCountInput = new InputNumber({
                container: document.getElementById('recommendationCountInput'),
                min: 1,
                max: 50,
                value: 10,
                step: 1
            });

            smartRecommendationCheckbox = new Checkbox({
                label: '启用智能推荐算法',
                checked: true,
                onChange: (checked) => {
                    console.log('智能推荐状态:', checked);
                }
            });
            smartRecommendationCheckbox.mount(document.getElementById('smartRecommendationCheckbox'));

            // 初始化搜索控件
            searchTagsSelect = new Select({
                container: document.getElementById('searchTagsSelect'),
                options: [
                    { value: 'javascript', label: 'JavaScript' },
                    { value: 'python', label: 'Python' },
                    { value: 'react', label: 'React' },
                    { value: 'vue', label: 'Vue' },
                    { value: 'nodejs', label: 'Node.js' },
                    { value: 'design', label: '设计' },
                    { value: 'ui', label: 'UI/UX' },
                    { value: 'business', label: '商业' },
                    { value: 'marketing', label: '营销' },
                    { value: 'lifestyle', label: '生活方式' }
                ],
                placeholder: '选择搜索标签',
                multiple: true
            });

            contentCategorySelect = new Select({
                container: document.getElementById('contentCategorySelect'),
                options: [
                    { value: 'tech', label: '技术' },
                    { value: 'design', label: '设计' },
                    { value: 'business', label: '商业' },
                    { value: 'lifestyle', label: '生活方式' }
                ],
                placeholder: '选择内容分类'
            });

            matchingThresholdInput = new InputNumber({
                container: document.getElementById('matchingThresholdInput'),
                min: 0,
                max: 100,
                value: 50,
                step: 5
            });

            // 初始化数据
            initializeData();

            // 初始化界面
            updateTagCloud();
            updateContentGrid();
            updateCategoryFilters();
            updateTagFilters();
            updateMatchingFilters();
            addStatsLog('系统初始化完成', 'info');
        }

        // 初始化数据
        function initializeData() {
            // 初始化标签
            tags = [
                'javascript', 'python', 'react', 'vue', 'nodejs', 'typescript', 'angular', 'php',
                'design', 'ui', 'ux', 'figma', 'sketch', 'photoshop', 'illustrator',
                'business', 'marketing', 'strategy', 'startup', 'entrepreneurship',
                'lifestyle', 'health', 'fitness', 'travel', 'food', 'fashion'
            ];

            // 初始化分类
            categories = [
                { id: 'tech', name: '技术', icon: '💻', color: 'category-tech' },
                { id: 'design', name: '设计', icon: '🎨', color: 'category-design' },
                { id: 'business', name: '商业', icon: '💼', color: 'category-business' },
                { id: 'lifestyle', name: '生活方式', icon: '🌟', color: 'category-lifestyle' }
            ];

            // 初始化内容
            contents = [
                {
                    id: 1,
                    title: 'JavaScript 高级技巧',
                    description: '深入探讨 JavaScript 的高级特性和最佳实践',
                    category: 'tech',
                    tags: ['javascript', 'programming', 'web'],
                    icon: '📝',
                    type: 'article',
                    rating: 4.8,
                    views: 1250
                },
                {
                    id: 2,
                    title: 'React 组件设计模式',
                    description: '学习 React 中的各种组件设计模式和最佳实践',
                    category: 'tech',
                    tags: ['react', 'javascript', 'frontend'],
                    icon: '⚛️',
                    type: 'video',
                    rating: 4.9,
                    views: 2100
                },
                {
                    id: 3,
                    title: 'UI/UX 设计原则',
                    description: '掌握现代 UI/UX 设计的核心原则和方法论',
                    category: 'design',
                    tags: ['design', 'ui', 'ux', 'figma'],
                    icon: '🎨',
                    type: 'article',
                    rating: 4.7,
                    views: 890
                },
                {
                    id: 4,
                    title: '创业公司营销策略',
                    description: '为创业公司制定有效的营销策略和推广方案',
                    category: 'business',
                    tags: ['business', 'marketing', 'startup'],
                    icon: '📈',
                    type: 'document',
                    rating: 4.6,
                    views: 650
                },
                {
                    id: 5,
                    title: '健康生活方式指南',
                    description: '如何建立和维持健康的生活方式习惯',
                    category: 'lifestyle',
                    tags: ['lifestyle', 'health', 'fitness'],
                    icon: '💪',
                    type: 'article',
                    rating: 4.5,
                    views: 1200
                },
                {
                    id: 6,
                    title: 'Vue.js 3.0 新特性',
                    description: '探索 Vue.js 3.0 的新特性和性能优化',
                    category: 'tech',
                    tags: ['vue', 'javascript', 'frontend'],
                    icon: '🟢',
                    type: 'video',
                    rating: 4.8,
                    views: 1800
                },
                {
                    id: 7,
                    title: '品牌设计案例分析',
                    description: '分析成功品牌的视觉设计策略和实现方法',
                    category: 'design',
                    tags: ['design', 'branding', 'marketing'],
                    icon: '🏷️',
                    type: 'article',
                    rating: 4.7,
                    views: 950
                },
                {
                    id: 8,
                    title: '数字营销趋势',
                    description: '2024年数字营销的最新趋势和策略',
                    category: 'business',
                    tags: ['marketing', 'digital', 'trends'],
                    icon: '📱',
                    type: 'document',
                    rating: 4.4,
                    views: 780
                }
            ];
        }

        // 更新标签云
        function updateTagCloud() {
            const container = document.getElementById('tagCloud');
            container.innerHTML = '';

            tags.forEach(tag => {
                const tagElement = document.createElement('div');
                tagElement.className = 'tag-item';
                tagElement.textContent = tag;
                tagElement.onclick = () => toggleTag(tag, tagElement);
                container.appendChild(tagElement);
            });
        }

        // 切换标签选择
        function toggleTag(tag, element) {
            if (selectedTags.includes(tag)) {
                selectedTags = selectedTags.filter(t => t !== tag);
                element.classList.remove('selected');
            } else {
                selectedTags.push(tag);
                element.classList.add('selected');
            }
            updateContentGrid();
        }

        // 更新内容网格
        function updateContentGrid() {
            const container = document.getElementById('contentGrid');
            container.innerHTML = '';

            contents.forEach(content => {
                const card = document.createElement('div');
                card.className = 'content-card';

                // 检查标签匹配
                let matchType = 'none';
                let matchScore = 0;
                
                if (selectedTags.length > 0) {
                    const matchedTags = content.tags.filter(tag => selectedTags.includes(tag));
                    matchScore = (matchedTags.length / selectedTags.length) * 100;
                    
                    if (matchScore === 100) {
                        matchType = 'matched';
                        card.classList.add('matched');
                    } else if (matchScore > 0) {
                        matchType = 'partial';
                        card.classList.add('partial');
                    }
                }

                const category = categories.find(c => c.id === content.category);
                const tagsHtml = content.tags.map(tag => {
                    const isMatched = selectedTags.includes(tag);
                    const isPartial = selectedTags.length > 0 && includesAny(selectedTags, [tag]);
                    return `<span class="content-tag ${isMatched ? 'matched' : isPartial ? 'partial' : ''}">${tag}</span>`;
                }).join('');

                card.innerHTML = `
                    <div class="content-header">
                        <span class="content-icon">${content.icon}</span>
                        <span class="content-title">${content.title}</span>
                        <span class="content-category ${category.color}">${category.name}</span>
                    </div>
                    <div class="content-description">${content.description}</div>
                    <div class="content-tags">${tagsHtml}</div>
                    <div class="content-meta">
                        <span>⭐ ${content.rating}</span>
                        <span>👁️ ${content.views}</span>
                        <span>📅 ${content.type}</span>
                        ${matchScore > 0 ? `<span style="color: ${matchScore >= 80 ? '#28a745' : matchScore >= 50 ? '#ffc107' : '#dc3545'};">🎯 ${matchScore.toFixed(0)}%</span>` : ''}
                    </div>
                `;

                container.appendChild(card);
            });
        }

        // 更新分类过滤器
        function updateCategoryFilters() {
            const container = document.getElementById('categoryFilters');
            container.innerHTML = '';

            categories.forEach(category => {
                const option = document.createElement('div');
                option.className = 'filter-option';
                option.textContent = `${category.icon} ${category.name}`;
                option.onclick = () => toggleFilter(option, 'category', category.id);
                container.appendChild(option);
            });
        }

        // 更新标签过滤器
        function updateTagFilters() {
            const container = document.getElementById('tagFilters');
            container.innerHTML = '';

            tags.slice(0, 12).forEach(tag => {
                const option = document.createElement('div');
                option.className = 'filter-option';
                option.textContent = tag;
                option.onclick = () => toggleFilter(option, 'tag', tag);
                container.appendChild(option);
            });
        }

        // 更新匹配度过滤器
        function updateMatchingFilters() {
            const container = document.getElementById('matchingFilters');
            container.innerHTML = '';

            const matchingOptions = [
                { label: '高匹配 (80%+)', value: 'high' },
                { label: '中匹配 (50-80%)', value: 'medium' },
                { label: '低匹配 (<50%)', value: 'low' }
            ];

            matchingOptions.forEach(option => {
                const element = document.createElement('div');
                element.className = 'filter-option';
                element.textContent = option.label;
                element.onclick = () => toggleFilter(element, 'matching', option.value);
                container.appendChild(element);
            });
        }

        // 切换过滤器
        function toggleFilter(element, type, value) {
            element.classList.toggle('active');
            // 这里可以添加过滤逻辑
        }

        // 搜索内容
        function searchContent() {
            const contentType = contentTypeSelect.getValue();
            const matchingMode = matchingModeSelect.getValue();

            if (!contentType || !matchingMode) {
                notification.error('请选择内容类型和匹配模式');
                return;
            }

            addStatsLog(`搜索内容: ${contentType} (${matchingMode}模式)`, 'info');
            notification.success('搜索配置已更新');
        }

        // 生成推荐
        function generateRecommendations() {
            const count = recommendationCountInput.getValue();
            const smartMode = smartRecommendationCheckbox.isChecked();

            if (!count) {
                notification.error('请设置推荐数量');
                return;
            }

            // 基于当前选择的标签生成推荐
            recommendations = contents
                .filter(content => {
                    if (selectedTags.length === 0) return true;
                    return includesAny(content.tags, selectedTags);
                })
                .map(content => {
                    const matchedTags = content.tags.filter(tag => selectedTags.includes(tag));
                    const score = selectedTags.length > 0 ? (matchedTags.length / selectedTags.length) * 100 : 50;
                    return { ...content, score };
                })
                .sort((a, b) => b.score - a.score)
                .slice(0, count);

            updateRecommendationPanel();
            addStatsLog(`生成推荐: ${recommendations.length} 个内容`, 'success');
            notification.success(`已生成 ${recommendations.length} 个推荐`);
        }

        // 更新推荐面板
        function updateRecommendationPanel() {
            const container = document.getElementById('recommendationPanel');
            container.innerHTML = '';

            if (recommendations.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">暂无推荐内容</p>';
                return;
            }

            recommendations.forEach(item => {
                const recElement = document.createElement('div');
                recElement.className = 'recommendation-item';
                
                const category = categories.find(c => c.id === item.category);
                recElement.innerHTML = `
                    <div class="recommendation-score">${item.score.toFixed(0)}%</div>
                    <div style="font-weight: 600; margin-bottom: 5px;">${item.title}</div>
                    <div style="color: #666; font-size: 0.9em; margin-bottom: 5px;">${item.description}</div>
                    <div style="font-size: 0.8em; color: #999;">
                        ${category.icon} ${category.name} | ⭐ ${item.rating} | 👁️ ${item.views}
                    </div>
                `;
                container.appendChild(recElement);
            });
        }

        // 标签分析
        function analyzeTags() {
            const tagStats = {};
            
            // 统计标签使用频率
            contents.forEach(content => {
                content.tags.forEach(tag => {
                    tagStats[tag] = (tagStats[tag] || 0) + 1;
                });
            });

            const sortedTags = Object.entries(tagStats)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 10);

            const content = `
                <div style="max-width: 600px;">
                    <h4>标签使用频率分析</h4>
                    <div style="margin-top: 15px;">
                        ${sortedTags.map(([tag, count]) => `
                            <div style="background: #f8f9fa; padding: 10px; margin-bottom: 8px; border-radius: 6px;">
                                <strong>${tag}</strong>: 使用 ${count} 次
                                <div style="background: #e9ecef; height: 8px; border-radius: 4px; margin-top: 5px;">
                                    <div style="background: #667eea; height: 100%; width: ${(count / Math.max(...sortedTags.map(([,c]) => c))) * 100}%; border-radius: 4px;"></div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;

            modal.alert(content, '标签分析结果');
            addStatsLog('执行标签分析', 'info');
        }

        // 执行搜索
        function performSearch() {
            const searchTags = searchTagsSelect.getValue();
            const category = contentCategorySelect.getValue();
            const threshold = matchingThresholdInput.getValue();

            if (!searchTags || searchTags.length === 0) {
                notification.error('请选择搜索标签');
                return;
            }

            const results = contents.filter(content => {
                // 检查标签匹配
                const hasMatchingTags = includesAny(content.tags, searchTags);
                
                // 检查分类匹配
                const categoryMatch = !category || content.category === category;
                
                return hasMatchingTags && categoryMatch;
            });

            const resultDiv = document.getElementById('searchResult');
            resultDiv.style.display = 'block';
            resultDiv.className = `search-result ${results.length > 0 ? 'success' : 'warning'}`;
            resultDiv.innerHTML = `
                <div>搜索标签: [${searchTags.join(', ')}]</div>
                <div style="margin-top: 5px; font-size: 0.9em;">
                    找到 <strong>${results.length}</strong> 个匹配内容
                </div>
            `;

            addStatsLog(`搜索完成: ${results.length} 个结果`, results.length > 0 ? 'success' : 'warning');
        }

        // 高级搜索
        function advancedSearch() {
            const searchTags = searchTagsSelect.getValue();
            const category = contentCategorySelect.getValue();
            const threshold = matchingThresholdInput.getValue();

            if (!searchTags || searchTags.length === 0) {
                notification.error('请选择搜索标签');
                return;
            }

            const results = contents.map(content => {
                const matchedTags = content.tags.filter(tag => searchTags.includes(tag));
                const matchPercentage = (matchedTags.length / searchTags.length) * 100;
                return { ...content, matchPercentage, matchedTags };
            }).filter(result => result.matchPercentage >= threshold);

            const content = `
                <div style="max-width: 600px;">
                    <h4>高级搜索结果</h4>
                    <p>匹配阈值: ${threshold}%</p>
                    <div style="margin-top: 15px;">
                        ${results.map(result => `
                            <div style="background: #f8f9fa; padding: 10px; margin-bottom: 8px; border-radius: 6px;">
                                <div style="font-weight: 600;">${result.title}</div>
                                <div style="color: #666; font-size: 0.9em; margin: 5px 0;">${result.description}</div>
                                <div style="font-size: 0.8em; color: #999;">
                                    匹配度: <span style="color: ${result.matchPercentage >= 80 ? '#28a745' : result.matchPercentage >= 50 ? '#ffc107' : '#dc3545'}; font-weight: bold;">
                                        ${result.matchPercentage.toFixed(1)}%
                                    </span>
                                    | 匹配标签: [${result.matchedTags.join(', ')}]
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;

            modal.alert(content, '高级搜索结果');
            addStatsLog(`高级搜索: ${results.length} 个结果`, 'info');
        }

        // 清除结果
        function clearResults() {
            modal.confirm('确定要清除所有搜索结果和推荐吗？').then(confirmed => {
                if (confirmed) {
                    selectedTags = [];
                    recommendations = [];
                    updateTagCloud();
                    updateContentGrid();
                    updateRecommendationPanel();
                    document.getElementById('searchResult').style.display = 'none';
                    addStatsLog('清除所有结果', 'info');
                    notification.success('结果已清除');
                }
            });
        }

        // 添加统计日志
        function addStatsLog(action, status) {
            const timestamp = new Date();
            const logEntry = {
                time: timestamp,
                action: action,
                status: status
            };

            searchHistory.unshift(logEntry);
            if (searchHistory.length > 50) {
                searchHistory.pop();
            }

            updateStatsPanel();
        }

        // 更新统计面板
        function updateStatsPanel() {
            const container = document.getElementById('statsPanel');
            
            container.innerHTML = searchHistory.map(entry => `
                <div class="stats-entry">
                    <span class="stats-time">${formatDateTime(entry.time)}</span>
                    <span class="stats-action">${entry.action}</span>
                    <span class="stats-result ${entry.status}">${entry.status}</span>
                </div>
            `).join('');
        }

        // 格式化日期时间
        function formatDateTime(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            const seconds = String(date.getSeconds()).padStart(2, '0');
            return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>

</html>