<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>深度冻结检测与分析工具 - isDeepFrozen实战</title>
    
    <!-- 引入自定义插件样式 -->
    <link rel="stylesheet" href="../../demo/plugins/modal/style.css">
    <link rel="stylesheet" href="../../demo/plugins/checkbox/style.css">
    <link rel="stylesheet" href="../../demo/plugins/input-number/style.css">
    <link rel="stylesheet" href="../../demo/plugins/notification/style.css">
    <link rel="stylesheet" href="../../demo/plugins/select/style.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }

        .panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
            border: 1px solid #e1e8ed;
        }

        .panel h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.4rem;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #34495e;
        }

        .input-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            resize: vertical;
            min-height: 120px;
            transition: border-color 0.3s ease;
        }

        .input-group textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(149, 165, 166, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60, #229954);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
        }

        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(243, 156, 18, 0.4);
        }

        .result-display {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 5px solid #3498db;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #e1e8ed;
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-label {
            font-weight: 600;
            color: #2c3e50;
        }

        .result-value {
            font-family: 'Courier New', monospace;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .result-true {
            background: #d4edda;
            color: #155724;
        }

        .result-false {
            background: #f8d7da;
            color: #721c24;
        }

        .object-tree {
            background: #2c3e50;
            color: #ecf0f1;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
        }

        .tree-node {
            margin-left: 20px;
            position: relative;
        }

        .tree-node::before {
            content: '├─';
            position: absolute;
            left: -15px;
            color: #7f8c8d;
        }

        .tree-node:last-child::before {
            content: '└─';
        }

        .tree-key {
            color: #3498db;
            font-weight: bold;
        }

        .tree-value {
            color: #e74c3c;
        }

        .tree-type {
            color: #f39c12;
            font-style: italic;
        }

        .stats-panel {
            grid-column: 1 / -1;
            margin-top: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .templates-panel {
            grid-column: 1 / -1;
            margin-top: 20px;
        }

        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .template-card {
            background: #f8f9fa;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .template-card:hover {
            border-color: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.2);
        }

        .template-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .template-desc {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-bottom: 10px;
        }

        .template-code {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 10px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            overflow-x: auto;
        }

        .history-panel {
            grid-column: 1 / -1;
            margin-top: 20px;
        }

        .history-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .history-item {
            background: #f8f9fa;
            border: 1px solid #e1e8ed;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-info {
            flex: 1;
        }

        .history-time {
            font-size: 0.8rem;
            color: #7f8c8d;
            margin-bottom: 5px;
        }

        .history-object {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .history-result {
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .history-actions {
            display: flex;
            gap: 5px;
        }

        .btn-small {
            padding: 5px 10px;
            font-size: 12px;
        }

        .advanced-options {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid #e1e8ed;
        }

        .advanced-options h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .checkbox-group .ew-checkbox {
            margin-bottom: 10px;
        }

        .option-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .option-item label {
            font-size: 14px;
            color: #34495e;
            cursor: pointer;
            margin-left: 5px;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            border: 1px solid #f5c6cb;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            border: 1px solid #c3e6cb;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
                padding: 20px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .button-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .template-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>深度冻结检测与分析工具</h1>
            <p>基于 isDeepFrozen 函数的对象深度冻结状态检测和详细分析</p>
        </div>

        <div class="main-content">
            <!-- 输入面板 -->
            <div class="panel">
                <h2>对象输入与检测</h2>
                
                <div class="input-group">
                    <label for="objectInput">输入要检测的对象 (JSON格式):</label>
                    <textarea id="objectInput" placeholder='例如: {"a": 1, "b": {"c": 2}, "d": [1, 2, 3]}'></textarea>
                </div>

                <div class="button-group">
                    <button class="btn btn-primary" id="detectBtn">检测深度冻结</button>
                    <button class="btn btn-secondary" id="clearBtn">清空输入</button>
                    <button class="btn btn-success" id="freezeBtn">深度冻结对象</button>
                    <button class="btn btn-warning" id="analyzeBtn">详细分析</button>
                </div>

                <div class="advanced-options">
                    <h3>高级选项</h3>
                    <div id="checkboxGroupContainer"></div>
                </div>
            </div>

            <!-- 结果面板 -->
            <div class="panel">
                <h2>检测结果</h2>
                
                <div class="result-display" id="resultDisplay" style="display: none;">
                    <div class="result-item">
                        <span class="result-label">深度冻结状态:</span>
                        <span class="result-value" id="deepFrozenResult">-</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">表面冻结状态:</span>
                        <span class="result-value" id="surfaceFrozenResult">-</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">对象类型:</span>
                        <span class="result-value" id="objectTypeResult">-</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">检测时间:</span>
                        <span class="result-value" id="detectionTimeResult">-</span>
                    </div>
                </div>

                <div class="object-tree" id="objectTree" style="display: none;">
                    <div>对象结构树:</div>
                    <div id="treeContent"></div>
                </div>

                <div id="messageArea"></div>
            </div>
        </div>

        <!-- 统计面板 -->
        <div class="panel stats-panel">
            <h2>检测统计</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalDetections">0</div>
                    <div class="stat-label">总检测次数</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="deepFrozenCount">0</div>
                    <div class="stat-label">深度冻结对象</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="surfaceFrozenCount">0</div>
                    <div class="stat-label">表面冻结对象</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="unfrozenCount">0</div>
                    <div class="stat-label">未冻结对象</div>
                </div>
            </div>
        </div>

        <!-- 模板面板 -->
        <div class="panel templates-panel">
            <h2>常用对象模板</h2>
            <div class="template-grid" id="templateGrid">
                <!-- 模板将通过JavaScript动态生成 -->
            </div>
        </div>

        <!-- 历史面板 -->
        <div class="panel history-panel">
            <h2>检测历史</h2>
            <div class="history-list" id="historyList">
                <div style="text-align: center; color: #7f8c8d; padding: 20px;">
                    暂无检测历史
                </div>
            </div>
        </div>
    </div>

    <!-- 引入自定义插件脚本 -->
    <script src="../../demo/plugins/modal/index.js"></script>
    <script src="../../demo/plugins/checkbox/index.js"></script>
    <script src="../../demo/plugins/input-number/index.js"></script>
    <script src="../../demo/plugins/notification/index.js"></script>
    <script src="../../demo/plugins/select/index.js"></script>

    <script>
        // 深度冻结检测核心函数
        const isDeepFrozen = obj => {
            if (obj === null || typeof obj !== 'object') {
                return true;
            }
            
            if (!Object.isFrozen(obj)) {
                return false;
            }
            
            return Object.keys(obj).every(
                key => typeof obj[key] !== 'object' || obj[key] === null || isDeepFrozen(obj[key])
            );
        };

        // 深度冻结对象函数
        const deepFreeze = obj => {
            if (obj === null || typeof obj !== 'object') {
                return obj;
            }
            
            Object.freeze(obj);
            Object.keys(obj).forEach(key => {
                if (typeof obj[key] === 'object' && obj[key] !== null) {
                    deepFreeze(obj[key]);
                }
            });
            
            return obj;
        };

        // 深度冻结检测器类
        class DeepFrozenDetector {
            constructor() {
                this.stats = {
                    totalDetections: 0,
                    deepFrozenCount: 0,
                    surfaceFrozenCount: 0,
                    unfrozenCount: 0
                };
                this.history = [];
                this.currentObject = null;
                this.checkboxes = {};
                this.templates = [];
                this.init();
            }

            init() {
                this.setupCheckboxes();
                this.setupEventListeners();
                this.loadTemplates();
                this.loadStats();
                this.loadHistory();
                this.updateStatsDisplay();
            }

            setupCheckboxes() {
                // 使用checkbox插件创建复选框组
                const checkboxGroup = Checkbox.createCheckboxGroup({
                    items: [
                        {
                            label: '包含数组检测',
                            checked: true,
                            key: 'includeArrays'
                        },
                        {
                            label: '包含函数检测',
                            checked: true,
                            key: 'includeFunctions'
                        },
                        {
                            label: '显示对象树',
                            checked: true,
                            key: 'showTree'
                        },
                        {
                            label: '保存检测历史',
                            checked: true,
                            key: 'saveHistory'
                        }
                    ],
                    onChange: (checkedStates) => {
                        console.log('复选框状态变化:', checkedStates);
                    }
                });

                // 将复选框组容器添加到目标容器中
                const targetContainer = document.getElementById('checkboxGroupContainer');
                targetContainer.appendChild(checkboxGroup.container);

                // 保存复选框引用以便后续使用
                this.checkboxes = {
                    includeArrays: checkboxGroup.checkboxes[0],
                    includeFunctions: checkboxGroup.checkboxes[1],
                    showTree: checkboxGroup.checkboxes[2],
                    saveHistory: checkboxGroup.checkboxes[3]
                };
            }

            setupEventListeners() {
                document.getElementById('detectBtn').addEventListener('click', () => this.detectDeepFrozen());
                document.getElementById('clearBtn').addEventListener('click', () => this.clearInput());
                document.getElementById('freezeBtn').addEventListener('click', () => this.freezeObject());
                document.getElementById('analyzeBtn').addEventListener('click', () => this.analyzeObject());
            }

            detectDeepFrozen() {
                try {
                    const input = document.getElementById('objectInput').value.trim();
                    if (!input) {
                        this.showMessage('请输入要检测的对象', 'error');
                        return;
                    }

                    const obj = JSON.parse(input);
                    this.currentObject = obj;
                    
                    const startTime = performance.now();
                    const isDeepFrozenResult = isDeepFrozen(obj);
                    const isSurfaceFrozen = Object.isFrozen(obj);
                    const endTime = performance.now();
                    
                    this.displayResults({
                        deepFrozen: isDeepFrozenResult,
                        surfaceFrozen: isSurfaceFrozen,
                        objectType: this.getObjectType(obj),
                        detectionTime: `${(endTime - startTime).toFixed(2)}ms`
                    });

                    this.updateStats(isDeepFrozenResult, isSurfaceFrozen);
                    this.updateHistory(obj, isDeepFrozenResult, isSurfaceFrozen);
                    this.showMessage('检测完成', 'success');

                } catch (error) {
                    this.showMessage(`输入格式错误: ${error.message}`, 'error');
                }
            }

            freezeObject() {
                try {
                    const input = document.getElementById('objectInput').value.trim();
                    if (!input) {
                        this.showMessage('请输入要冻结的对象', 'error');
                        return;
                    }

                    const obj = JSON.parse(input);
                    const frozenObj = deepFreeze(obj);
                    
                    document.getElementById('objectInput').value = JSON.stringify(frozenObj, null, 2);
                    this.showMessage('对象已深度冻结', 'success');
                    
                    // 自动检测冻结后的状态
                    setTimeout(() => this.detectDeepFrozen(), 100);

                } catch (error) {
                    this.showMessage(`冻结失败: ${error.message}`, 'error');
                }
            }

            analyzeObject() {
                if (!this.currentObject) {
                    this.showMessage('请先检测一个对象', 'error');
                    return;
                }

                const analysis = this.performDetailedAnalysis(this.currentObject);
                this.displayAnalysis(analysis);
            }

            performDetailedAnalysis(obj) {
                const analysis = {
                    totalProperties: 0,
                    frozenProperties: 0,
                    unfrozenProperties: 0,
                    nestedObjects: 0,
                    arrays: 0,
                    functions: 0,
                    primitives: 0,
                    maxDepth: 0,
                    propertyTypes: {}
                };

                this.analyzeObjectRecursive(obj, analysis, 0);

                return analysis;
            }

            analyzeObjectRecursive(obj, analysis, depth) {
                if (obj === null || typeof obj !== 'object') {
                    analysis.primitives++;
                    return;
                }

                analysis.maxDepth = Math.max(analysis.maxDepth, depth);
                
                if (Array.isArray(obj)) {
                    analysis.arrays++;
                } else {
                    analysis.nestedObjects++;
                }

                Object.keys(obj).forEach(key => {
                    analysis.totalProperties++;
                    const value = obj[key];
                    const valueType = typeof value;
                    
                    analysis.propertyTypes[valueType] = (analysis.propertyTypes[valueType] || 0) + 1;
                    
                    if (valueType === 'function') {
                        analysis.functions++;
                    } else if (valueType === 'object' && value !== null) {
                        this.analyzeObjectRecursive(value, analysis, depth + 1);
                    } else {
                        analysis.primitives++;
                    }
                });

                if (Object.isFrozen(obj)) {
                    analysis.frozenProperties++;
                } else {
                    analysis.unfrozenProperties++;
                }
            }

            displayResults(results) {
                const resultDisplay = document.getElementById('resultDisplay');
                resultDisplay.style.display = 'block';
                
                document.getElementById('deepFrozenResult').textContent = results.deepFrozen ? '是' : '否';
                document.getElementById('deepFrozenResult').className = `result-value ${results.deepFrozen ? 'result-true' : 'result-false'}`;
                
                document.getElementById('surfaceFrozenResult').textContent = results.surfaceFrozen ? '是' : '否';
                document.getElementById('surfaceFrozenResult').className = `result-value ${results.surfaceFrozen ? 'result-true' : 'result-false'}`;
                
                document.getElementById('objectTypeResult').textContent = results.objectType;
                document.getElementById('detectionTimeResult').textContent = results.detectionTime;

                // 显示对象树
                if (this.checkboxes.showTree.isChecked()) {
                    this.displayObjectTree(this.currentObject);
                }
            }

            displayObjectTree(obj) {
                const treeContainer = document.getElementById('objectTree');
                const treeContent = document.getElementById('treeContent');
                
                treeContainer.style.display = 'block';
                treeContent.innerHTML = this.generateObjectTree(obj, 0);
            }

            generateObjectTree(obj, depth) {
                if (obj === null || typeof obj !== 'object') {
                    return `<span class="tree-value">${JSON.stringify(obj)}</span> <span class="tree-type">(${typeof obj})</span>`;
                }

                let html = '';
                const keys = Object.keys(obj);
                
                keys.forEach((key, index) => {
                    const value = obj[key];
                    const isLast = index === keys.length - 1;
                    const prefix = isLast ? '└─' : '├─';
                    
                    html += `<div class="tree-node">
                        <span class="tree-key">${key}</span>: ${this.generateObjectTree(value, depth + 1)}
                    </div>`;
                });

                return html;
            }

            displayAnalysis(analysis) {
                const modal = new Modal();
                modal.show({
                    title: '详细分析结果',
                    content: `
                        <div style="text-align: left;">
                            <h3>对象统计信息</h3>
                            <p><strong>总属性数:</strong> ${analysis.totalProperties}</p>
                            <p><strong>冻结属性数:</strong> ${analysis.frozenProperties}</p>
                            <p><strong>未冻结属性数:</strong> ${analysis.unfrozenProperties}</p>
                            <p><strong>嵌套对象数:</strong> ${analysis.nestedObjects}</p>
                            <p><strong>数组数:</strong> ${analysis.arrays}</p>
                            <p><strong>函数数:</strong> ${analysis.functions}</p>
                            <p><strong>原始值数:</strong> ${analysis.primitives}</p>
                            <p><strong>最大深度:</strong> ${analysis.maxDepth}</p>
                            
                            <h3>属性类型分布</h3>
                            ${Object.entries(analysis.propertyTypes).map(([type, count]) => 
                                `<p><strong>${type}:</strong> ${count}</p>`
                            ).join('')}
                        </div>
                    `,
                    type: 'alert'
                });
            }

            getObjectType(obj) {
                if (obj === null) return 'null';
                if (Array.isArray(obj)) return 'Array';
                if (obj instanceof Date) return 'Date';
                if (obj instanceof RegExp) return 'RegExp';
                if (obj instanceof Function) return 'Function';
                return typeof obj;
            }

            updateStats(isDeepFrozen, isSurfaceFrozen) {
                this.stats.totalDetections++;
                
                if (isDeepFrozen) {
                    this.stats.deepFrozenCount++;
                } else if (isSurfaceFrozen) {
                    this.stats.surfaceFrozenCount++;
                } else {
                    this.stats.unfrozenCount++;
                }
                
                this.updateStatsDisplay();
                this.saveStats();
            }

            updateStatsDisplay() {
                document.getElementById('totalDetections').textContent = this.stats.totalDetections;
                document.getElementById('deepFrozenCount').textContent = this.stats.deepFrozenCount;
                document.getElementById('surfaceFrozenCount').textContent = this.stats.surfaceFrozenCount;
                document.getElementById('unfrozenCount').textContent = this.stats.unfrozenCount;
            }

            updateHistory(obj, isDeepFrozen, isSurfaceFrozen) {
                if (!this.checkboxes.saveHistory.isChecked()) return;
                
                const historyItem = {
                    id: Date.now(),
                    timestamp: new Date().toLocaleString(),
                    object: JSON.stringify(obj, null, 2),
                    deepFrozen: isDeepFrozen,
                    surfaceFrozen: isSurfaceFrozen,
                    objectType: this.getObjectType(obj)
                };
                
                this.history.unshift(historyItem);
                if (this.history.length > 50) {
                    this.history = this.history.slice(0, 50);
                }
                
                this.displayHistory();
                this.saveHistory();
            }

            displayHistory() {
                const historyList = document.getElementById('historyList');
                
                if (this.history.length === 0) {
                    historyList.innerHTML = '<div style="text-align: center; color: #7f8c8d; padding: 20px;">暂无检测历史</div>';
                    return;
                }
                
                historyList.innerHTML = this.history.map(item => `
                    <div class="history-item">
                        <div class="history-info">
                            <div class="history-time">${item.timestamp}</div>
                            <div class="history-object">${item.object.substring(0, 100)}${item.object.length > 100 ? '...' : ''}</div>
                            <div class="history-result ${item.deepFrozen ? 'result-true' : 'result-false'}">
                                深度冻结: ${item.deepFrozen ? '是' : '否'} | 表面冻结: ${item.surfaceFrozen ? '是' : '否'}
                            </div>
                        </div>
                        <div class="history-actions">
                            <button class="btn btn-primary btn-small" onclick="detector.loadFromHistory('${item.id}')">加载</button>
                            <button class="btn btn-secondary btn-small" onclick="detector.deleteHistoryItem('${item.id}')">删除</button>
                        </div>
                    </div>
                `).join('');
            }

            loadFromHistory(id) {
                const item = this.history.find(h => h.id == id);
                if (item) {
                    document.getElementById('objectInput').value = item.object;
                    this.showMessage('已加载历史记录', 'success');
                }
            }

            deleteHistoryItem(id) {
                this.history = this.history.filter(h => h.id != id);
                this.displayHistory();
                this.saveHistory();
            }

            loadTemplates() {
                this.templates = [
                    {
                        title: '简单对象',
                        description: '包含基本属性的简单对象',
                        code: '{"name": "张三", "age": 25, "city": "北京"}'
                    },
                    {
                        title: '嵌套对象',
                        description: '包含嵌套结构的复杂对象',
                        code: '{"user": {"name": "李四", "profile": {"age": 30, "email": "li@example.com"}}, "settings": {"theme": "dark", "notifications": true}}'
                    },
                    {
                        title: '数组对象',
                        description: '包含数组的对象',
                        code: '{"items": [1, 2, 3], "tags": ["javascript", "web"], "matrix": [[1, 2], [3, 4]]}'
                    },
                    {
                        title: '混合类型',
                        description: '包含多种数据类型的对象',
                        code: '{"id": 1, "name": "测试", "active": true, "data": null, "items": [1, 2, 3], "config": {"debug": false}}'
                    },
                    {
                        title: '深度嵌套',
                        description: '多层嵌套的复杂对象',
                        code: '{"level1": {"level2": {"level3": {"level4": {"value": "deep"}}}}}}'
                    },
                    {
                        title: '空对象',
                        description: '空对象和null值',
                        code: '{"empty": {}, "nullValue": null, "undefinedValue": undefined}'
                    }
                ];

                const templateGrid = document.getElementById('templateGrid');
                templateGrid.innerHTML = this.templates.map((template, index) => `
                    <div class="template-card" onclick="detector.loadTemplateByIndex(${index})">
                        <div class="template-title">${template.title}</div>
                        <div class="template-desc">${template.description}</div>
                        <div class="template-code">${template.code}</div>
                    </div>
                `).join('');
            }

            loadTemplate(code) {
                document.getElementById('objectInput').value = code;
                this.showMessage('模板已加载', 'success');
            }

            loadTemplateByIndex(index) {
                if (this.templates[index]) {
                    document.getElementById('objectInput').value = this.templates[index].code;
                    this.showMessage(`已加载模板: ${this.templates[index].title}`, 'success');
                }
            }

            clearInput() {
                document.getElementById('objectInput').value = '';
                document.getElementById('resultDisplay').style.display = 'none';
                document.getElementById('objectTree').style.display = 'none';
                document.getElementById('messageArea').innerHTML = '';
                this.currentObject = null;
            }

            showMessage(message, type) {
                const messageArea = document.getElementById('messageArea');
                const messageClass = type === 'error' ? 'error-message' : 'success-message';
                messageArea.innerHTML = `<div class="${messageClass}">${message}</div>`;
                
                setTimeout(() => {
                    messageArea.innerHTML = '';
                }, 3000);
            }

            saveStats() {
                localStorage.setItem('deepFrozenStats', JSON.stringify(this.stats));
            }

            loadStats() {
                const saved = localStorage.getItem('deepFrozenStats');
                if (saved) {
                    this.stats = { ...this.stats, ...JSON.parse(saved) };
                }
            }

            saveHistory() {
                localStorage.setItem('deepFrozenHistory', JSON.stringify(this.history));
            }

            loadHistory() {
                const saved = localStorage.getItem('deepFrozenHistory');
                if (saved) {
                    this.history = JSON.parse(saved);
                    this.displayHistory();
                }
            }
        }

        // 初始化检测器
        const detector = new DeepFrozenDetector();
    </script>
</body>

</html>
