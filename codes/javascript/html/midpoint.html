<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸­ç‚¹è®¡ç®—å¯è§†åŒ–å¹³å° - midpoint</title>
    <link rel="stylesheet" href="../../demo/plugins/modal/style.css">
    <link rel="stylesheet" href="../../demo/plugins/checkbox/style.css">
    <link rel="stylesheet" href="../../demo/plugins/notification/style.css">
    <link rel="stylesheet" href="../../demo/plugins/input-number/style.css">
    <!-- Highlight.js ä»£ç é«˜äº® -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #1f2937;
            line-height: 1.6;
            padding-bottom: 40px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 36px;
            color: white;
        }

        .header h1 {
            font-size: 2.7rem;
            margin-bottom: 12px;
            font-weight: 800;
            text-shadow: 0 3px 8px rgba(15, 23, 42, 0.35);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.95;
            max-width: 900px;
            margin: 0 auto;
        }

        .main-content {
            display: grid;
            grid-template-columns: 480px 1fr;
            gap: 26px;
            margin-bottom: 28px;
        }

        .card {
            background: rgba(255, 255, 255, 0.97);
            border-radius: 20px;
            padding: 26px;
            box-shadow: 0 14px 32px rgba(15, 23, 42, 0.15);
            margin-bottom: 10px;
        }

        .card h2 {
            font-size: 1.55rem;
            margin-bottom: 20px;
            color: #1f2937;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .input-section {
            margin-bottom: 22px;
        }

        .input-group {
            margin-bottom: 18px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
            font-size: 0.98rem;
        }

        .input-field {
            width: 100%;
            padding: 14px;
            border: 2px solid #e5e7eb;
            border-radius: 14px;
            font-size: 1.05rem;
            font-family: 'Monaco', 'Menlo', monospace;
            transition: all 0.25s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.25);
        }

        .coordinate-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 16px;
        }

        .btn {
            padding: 12px 22px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #22c55e, #15803d);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #fbbf24, #d97706);
            color: white;
        }

        .btn-info {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #b91c1c);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn:active {
            transform: scale(0.97);
        }

        .btn-block {
            width: 100%;
            justify-content: center;
        }

        .canvas-container {
            background: #f8fafc;
            border-radius: 18px;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
        }

        .canvas-wrapper {
            background: white;
            border-radius: 14px;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        #coordinateCanvas {
            width: 100%;
            height: 500px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            cursor: crosshair;
        }

        .result-display {
            background: #f8fafc;
            border-radius: 18px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .result-card {
            background: linear-gradient(135deg, #e0e7ff, #c7d2fe);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.2);
            margin-bottom: 16px;
        }

        .result-label {
            font-size: 0.9rem;
            color: #4338ca;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .result-value {
            font-size: 2rem;
            font-weight: 800;
            color: #312e81;
            font-family: 'Monaco', 'Menlo', monospace;
        }

        .point-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        .info-card {
            background: white;
            border-radius: 14px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(15, 23, 42, 0.1);
        }

        .info-card h4 {
            font-size: 0.95rem;
            color: #667eea;
            margin-bottom: 10px;
        }

        .info-card p {
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9rem;
            color: #475569;
            margin: 4px 0;
        }

        .history-list {
            max-height: 320px;
            overflow-y: auto;
            background: #f1f5f9;
            border-radius: 12px;
            padding: 12px;
        }

        .history-item {
            background: white;
            padding: 14px;
            margin-bottom: 10px;
            border-radius: 12px;
            border-left: 4px solid #667eea;
            transition: transform 0.2s ease;
        }

        .history-item:hover {
            transform: translateX(4px);
        }

        .history-time {
            font-size: 0.75rem;
            color: #64748b;
            margin-bottom: 6px;
        }

        .history-summary {
            font-family: 'Monaco', monospace;
            font-size: 0.9rem;
            color: #1f2937;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        .stat-card {
            background: white;
            border-radius: 14px;
            padding: 18px;
            text-align: center;
            box-shadow: 0 3px 12px rgba(15, 23, 42, 0.1);
        }

        .stat-number {
            font-size: 1.8rem;
            font-weight: 800;
            color: #667eea;
        }

        .stat-label {
            font-size: 0.85rem;
            color: #64748b;
            margin-top: 4px;
        }

        .code-block {
            margin-top: 16px;
            border-radius: 12px;
            overflow: hidden;
        }

        .code-block pre {
            margin: 0;
            padding: 20px;
            background: #1e293b;
            overflow-x: auto;
        }

        .empty-state {
            text-align: center;
            padding: 36px 20px;
            color: #64748b;
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 12px;
            opacity: 0.5;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            border-radius: 999px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-size: 0.8rem;
            font-weight: 600;
            margin: 4px;
        }

        .point-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            margin: 4px;
        }

        .point-badge.point-a {
            background: #3b82f6;
            color: white;
        }

        .point-badge.point-b {
            background: #ef4444;
            color: white;
        }

        .point-badge.midpoint {
            background: #22c55e;
            color: white;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 2.2rem;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“ ä¸­ç‚¹è®¡ç®—å¯è§†åŒ–å¹³å°</h1>
            <p>åŸºäº midpoint å‡½æ•°çš„åæ ‡ä¸­ç‚¹è®¡ç®—å·¥å…·ï¼Œå¯è§†åŒ–å±•ç¤ºä¸¤ç‚¹ä¹‹é—´çš„ä¸­ç‚¹ä½ç½®</p>
        </div>

        <div class="main-content">
            <div class="sidebar">
                <div class="card">
                    <h2>ğŸ“ åæ ‡è¾“å…¥</h2>
                    <div class="input-section">
                        <div class="input-group">
                            <label>ç‚¹ A åæ ‡</label>
                            <div class="coordinate-inputs">
                                <input id="pointAX" class="input-field" type="number" placeholder="X" value="2" />
                                <input id="pointAY" class="input-field" type="number" placeholder="Y" value="2" />
                            </div>
                        </div>
                        <div class="input-group">
                            <label>ç‚¹ B åæ ‡</label>
                            <div class="coordinate-inputs">
                                <input id="pointBX" class="input-field" type="number" placeholder="X" value="4" />
                                <input id="pointBY" class="input-field" type="number" placeholder="Y" value="4" />
                            </div>
                        </div>
                        <div class="button-group">
                            <button class="btn btn-primary btn-block" onclick="window.midpointTool?.calculateMidpoint()">âš¡ è®¡ç®—ä¸­ç‚¹</button>
                        </div>
                        <div class="button-group">
                            <button class="btn btn-success" onclick="window.midpointTool?.loadSample()">ğŸ“„ ç¤ºä¾‹æ•°æ®</button>
                            <button class="btn btn-info" onclick="window.midpointTool?.generateRandom()">ğŸ² éšæœºç”Ÿæˆ</button>
                            <button class="btn btn-warning" onclick="window.midpointTool?.clearCanvas()">ğŸ§¹ æ¸…ç©ºç”»å¸ƒ</button>
                            <button class="btn btn-danger" onclick="window.midpointTool?.clearAll()">ğŸ—‘ï¸ æ¸…ç©ºå…¨éƒ¨</button>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2>âš™ï¸ é«˜çº§é€‰é¡¹</h2>
                    <div class="input-section">
                        <div id="checkboxGroup"></div>
                    </div>
                </div>

                <div class="card">
                    <h2>ğŸ—‚ï¸ è®¡ç®—å†å² (<span id="historyCount">0</span>)</h2>
                    <div class="history-list" id="historyList">
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ“œ</div>
                            <p>æš‚æ— è®¡ç®—å†å²</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="visualization">
                <div class="card">
                    <h2>ğŸ¨ åæ ‡å¯è§†åŒ–</h2>
                    <div class="canvas-container">
                        <div class="canvas-wrapper">
                            <canvas id="coordinateCanvas"></canvas>
                        </div>
                    </div>
                </div>

                <div class="card" id="resultCard" style="display:none;">
                    <h2>âœ¨ è®¡ç®—ç»“æœ</h2>
                    <div class="result-display" id="resultDisplay"></div>
                </div>

                <div class="card" id="analysisCard" style="display:none;">
                    <h2>ğŸ“ˆ è¯¦ç»†åˆ†æ</h2>
                    <div class="point-info" id="analysisGrid"></div>
                </div>

                <div class="card" id="codeSection" style="display:none;">
                    <h2>ğŸ’» æ‰§è¡Œä»£ç </h2>
                    <div class="code-block">
                        <pre><code class="language-javascript" id="codePreview">// ä»£ç å°†åœ¨è¿™é‡Œæ˜¾ç¤º</code></pre>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>ğŸ“Š ç»Ÿè®¡ä¿¡æ¯</h2>
            <div class="stats-grid" id="statsGrid"></div>
        </div>

        <div class="card">
            <h2>ğŸ“– å‡½æ•°è¯´æ˜</h2>
            <div style="background:#f8fafc;padding:20px;border-radius:14px;">
                <h3 style="color:#667eea;margin-bottom:12px;">midpoint å‡½æ•°ï¼ˆä¸¤å¯¹ç‚¹ä¹‹é—´çš„ä¸­ç‚¹ï¼‰</h3>
                <div class="code-block">
                    <pre><code class="language-javascript">const midpoint = ([x1, y1], [x2, y2]) => [
  (x1 + x2) / 2,
  (y1 + y2) / 2
];</code></pre>
                </div>

                <h3 style="color:#667eea;margin:20px 0 12px;">å‡½æ•°è¯´æ˜</h3>
                <p style="color:#374151;line-height:1.8;">
                    <strong>midpoint</strong> è®¡ç®—ä¸¤ä¸ªåæ ‡ç‚¹ä¹‹é—´çš„ä¸­ç‚¹ã€‚
                    é€šè¿‡å°†ä¸¤ä¸ªç«¯ç‚¹çš„ x åæ ‡å’Œ y åæ ‡åˆ†åˆ«ç›¸åŠ åé™¤ä»¥ 2ï¼Œå¾—åˆ°ä¸­ç‚¹çš„åæ ‡ã€‚
                    é€‚ç”¨äºå‡ ä½•è®¡ç®—ã€å›¾å½¢å¤„ç†ã€æ¸¸æˆå¼€å‘ç­‰åœºæ™¯ã€‚
                </p>

                <h3 style="color:#667eea;margin:20px 0 12px;">ä½¿ç”¨æ–¹å¼</h3>
                <div class="code-block">
                    <pre><code class="language-javascript">midpoint([2, 2], [4, 4]);
// [3, 3]

midpoint([1, 3], [2, 4]);
// [1.5, 3.5]

midpoint([0, 0], [10, 10]);
// [5, 5]</code></pre>
                </div>

                <h3 style="color:#667eea;margin:20px 0 12px;">å…¸å‹åœºæ™¯</h3>
                <div>
                    <span class="badge">å‡ ä½•è®¡ç®—</span>
                    <span class="badge">å›¾å½¢å¤„ç†</span>
                    <span class="badge">æ¸¸æˆå¼€å‘</span>
                    <span class="badge">åœ°å›¾å®šä½</span>
                    <span class="badge">æ•°æ®å¯è§†åŒ–</span>
                    <span class="badge">æ•™å­¦æ¼”ç¤º</span>
                </div>
            </div>
        </div>
    </div>

    <script src="../../demo/plugins/modal/index.js"></script>
    <script src="../../demo/plugins/checkbox/index.js"></script>
    <script src="../../demo/plugins/notification/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
        // ä¿®æ­£åçš„ midpoint å‡½æ•°ï¼ˆåŸæ–‡æ¡£ä¸­çš„å®ç°æœ‰è¯¯ï¼‰
        const midpoint = ([x1, y1], [x2, y2]) => [(x1 + x2) / 2, (y1 + y2) / 2];

        class MidpointTool {
            constructor() {
                this.plugins = {};
                this.pointA = [2, 2];
                this.pointB = [4, 4];
                this.midpointResult = null;
                this.canvas = null;
                this.ctx = null;
                this.history = [];
                this.stats = {
                    totalCalculations: 0,
                    totalDistance: 0,
                    averageDistance: 0,
                    maxDistance: 0
                };
                this.checkboxOptions = [
                    { id: 'showCanvas', label: 'æ˜¾ç¤ºåæ ‡ç”»å¸ƒ', checked: true },
                    { id: 'showResult', label: 'æ˜¾ç¤ºè®¡ç®—ç»“æœ', checked: true },
                    { id: 'showAnalysis', label: 'æ˜¾ç¤ºè¯¦ç»†åˆ†æ', checked: true },
                    { id: 'showCode', label: 'æ˜¾ç¤ºä»£ç é¢„è§ˆ', checked: true },
                    { id: 'showNotifications', label: 'æ˜¾ç¤ºé€šçŸ¥æé†’', checked: true }
                ];
                this.init();
            }

            async init() {
                try {
                    await this.loadPlugins();
                    this.setupCheckboxes();
                    this.initCanvas();
                    this.initHighlight();
                    this.updateStats();
                    this.showWelcomeMessage();
                } catch (error) {
                    console.error('åˆå§‹åŒ–å¤±è´¥:', error);
                    this.showError('åˆå§‹åŒ–å¤±è´¥: ' + error.message);
                }
            }

            initHighlight() {
                if (window.hljs) {
                    document.querySelectorAll('pre code').forEach((block) => hljs.highlightElement(block));
                }
            }

            async loadPlugins() {
                try {
                    this.plugins.modal = new Modal();
                    this.plugins.notification = new Notification();
                } catch (error) {
                    console.warn('éƒ¨åˆ†æ’ä»¶åŠ è½½å¤±è´¥:', error);
                }
            }

            setupCheckboxes() {
                const container = document.getElementById('checkboxGroup');
                if (!container) return;
                try {
                    const group = Checkbox.createCheckboxGroup({
                        items: this.checkboxOptions.map(option => ({
                            id: option.id,
                            label: option.label,
                            checked: option.checked
                        })),
                        onChange: () => {}
                    });
                    container.appendChild(group.container);
                    this.plugins.checkboxGroup = group;
                } catch (error) {
                    console.warn('å¤é€‰æ¡†æ’ä»¶åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨åŸç”Ÿå¤é€‰æ¡†:', error);
                    this.checkboxOptions.forEach(option => {
                        const div = document.createElement('div');
                        div.style.marginBottom = '10px';
                        div.innerHTML = `<input type="checkbox" id="${option.id}" ${option.checked ? 'checked' : ''}>` +
                            `<label for="${option.id}" style="margin-left:6px;">${option.label}</label>`;
                        container.appendChild(div);
                    });
                }
            }

            getCheckboxValue(id) {
                if (this.plugins.checkboxGroup) {
                    try {
                        const states = this.plugins.checkboxGroup.getAllChecked();
                        const index = this.checkboxOptions.findIndex(option => option.id === id);
                        if (index !== -1) {
                            return states[index] || false;
                        }
                    } catch (error) {
                        console.warn('è¯»å–å¤é€‰æ¡†çŠ¶æ€å¤±è´¥ï¼Œä½¿ç”¨åŸç”Ÿæ–¹æ³•:', error);
                    }
                }
                const checkbox = document.getElementById(id);
                return checkbox ? checkbox.checked : false;
            }

            initCanvas() {
                this.canvas = document.getElementById('coordinateCanvas');
                if (!this.canvas) return;

                this.ctx = this.canvas.getContext('2d');
                const rect = this.canvas.getBoundingClientRect();
                this.canvas.width = rect.width;
                this.canvas.height = 500;

                // ç›‘å¬ç”»å¸ƒç‚¹å‡»
                this.canvas.addEventListener('click', (e) => {
                    if (!this.getCheckboxValue('showCanvas')) return;
                    const rect = this.canvas.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    const canvasX = (x / rect.width) * 20 - 10;
                    const canvasY = 10 - (y / rect.height) * 20;

                    // å¦‚æœç‚¹ A æœªè®¾ç½®æˆ–å·²è®¾ç½®ï¼Œåˆ™è®¾ç½®ç‚¹ B
                    if (this.pointA[0] === null || (this.pointA[0] !== null && this.pointB[0] !== null)) {
                        this.pointA = [canvasX, canvasY];
                        document.getElementById('pointAX').value = canvasX.toFixed(2);
                        document.getElementById('pointAY').value = canvasY.toFixed(2);
                    } else {
                        this.pointB = [canvasX, canvasY];
                        document.getElementById('pointBX').value = canvasX.toFixed(2);
                        document.getElementById('pointBY').value = canvasY.toFixed(2);
                    }

                    this.calculateMidpoint();
                });

                this.drawCanvas();
            }

            getPoints() {
                const ax = parseFloat(document.getElementById('pointAX')?.value || 0);
                const ay = parseFloat(document.getElementById('pointAY')?.value || 0);
                const bx = parseFloat(document.getElementById('pointBX')?.value || 0);
                const by = parseFloat(document.getElementById('pointBY')?.value || 0);
                return {
                    pointA: [ax, ay],
                    pointB: [bx, by]
                };
            }

            calculateDistance([x1, y1], [x2, y2]) {
                return Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
            }

            calculateMidpoint() {
                const { pointA, pointB } = this.getPoints();
                this.pointA = pointA;
                this.pointB = pointB;

                const start = performance.now();
                this.midpointResult = midpoint(pointA, pointB);
                const end = performance.now();
                const time = Math.round((end - start) * 1000) / 1000;

                const distance = this.calculateDistance(pointA, pointB);
                this.stats.totalCalculations++;
                this.stats.totalDistance += distance;
                this.stats.averageDistance = Math.round((this.stats.totalDistance / this.stats.totalCalculations) * 100) / 100;
                this.stats.maxDistance = Math.max(this.stats.maxDistance, distance);

                this.drawCanvas();
                this.displayResult(distance, time);
                this.updateStats();
                this.addToHistory(distance, time);

                if (this.getCheckboxValue('showAnalysis')) {
                    this.displayAnalysis(distance, time);
                }

                if (this.getCheckboxValue('showCode')) {
                    this.showCode();
                }

                this.showNotification(`ä¸­ç‚¹è®¡ç®—å®Œæˆï¼åæ ‡: [${this.midpointResult[0].toFixed(2)}, ${this.midpointResult[1].toFixed(2)}]`, 'success');
            }

            drawCanvas() {
                if (!this.canvas || !this.ctx || !this.getCheckboxValue('showCanvas')) return;

                const width = this.canvas.width;
                const height = this.canvas.height;
                const padding = 40;
                const graphWidth = width - padding * 2;
                const graphHeight = height - padding * 2;

                // æ¸…ç©ºç”»å¸ƒ
                this.ctx.clearRect(0, 0, width, height);

                // ç»˜åˆ¶ç½‘æ ¼
                this.ctx.strokeStyle = '#e5e7eb';
                this.ctx.lineWidth = 1;
                for (let i = 0; i <= 20; i++) {
                    const x = padding + (i / 20) * graphWidth;
                    const y = padding + (i / 20) * graphHeight;
                    // å‚ç›´çº¿
                    this.ctx.beginPath();
                    this.ctx.moveTo(x, padding);
                    this.ctx.lineTo(x, height - padding);
                    this.ctx.stroke();
                    // æ°´å¹³çº¿
                    this.ctx.beginPath();
                    this.ctx.moveTo(padding, y);
                    this.ctx.lineTo(width - padding, y);
                    this.ctx.stroke();
                }

                // ç»˜åˆ¶åæ ‡è½´
                this.ctx.strokeStyle = '#1f2937';
                this.ctx.lineWidth = 2;
                // X è½´
                this.ctx.beginPath();
                this.ctx.moveTo(padding, height / 2);
                this.ctx.lineTo(width - padding, height / 2);
                this.ctx.stroke();
                // Y è½´
                this.ctx.beginPath();
                this.ctx.moveTo(width / 2, padding);
                this.ctx.lineTo(width / 2, height - padding);
                this.ctx.stroke();

                // ç»˜åˆ¶åæ ‡æ ‡ç­¾
                this.ctx.fillStyle = '#64748b';
                this.ctx.font = '12px monospace';
                for (let i = -10; i <= 10; i += 2) {
                    const x = padding + ((i + 10) / 20) * graphWidth;
                    const y = padding + ((10 - i) / 20) * graphHeight;
                    this.ctx.fillText(i.toString(), x - 10, height / 2 + 20);
                    this.ctx.fillText(i.toString(), width / 2 + 10, y + 4);
                }

                // è½¬æ¢åæ ‡åˆ°ç”»å¸ƒåæ ‡
                const toCanvasX = (x) => padding + ((x + 10) / 20) * graphWidth;
                const toCanvasY = (y) => padding + ((10 - y) / 20) * graphHeight;

                // ç»˜åˆ¶ç‚¹ A
                if (this.pointA && this.pointA[0] !== null) {
                    const cx = toCanvasX(this.pointA[0]);
                    const cy = toCanvasY(this.pointA[1]);
                    this.ctx.fillStyle = '#3b82f6';
                    this.ctx.beginPath();
                    this.ctx.arc(cx, cy, 8, 0, Math.PI * 2);
                    this.ctx.fill();
                    this.ctx.fillStyle = 'white';
                    this.ctx.font = 'bold 12px monospace';
                    this.ctx.fillText('A', cx - 6, cy + 4);
                }

                // ç»˜åˆ¶ç‚¹ B
                if (this.pointB && this.pointB[0] !== null) {
                    const cx = toCanvasX(this.pointB[0]);
                    const cy = toCanvasY(this.pointB[1]);
                    this.ctx.fillStyle = '#ef4444';
                    this.ctx.beginPath();
                    this.ctx.arc(cx, cy, 8, 0, Math.PI * 2);
                    this.ctx.fill();
                    this.ctx.fillStyle = 'white';
                    this.ctx.font = 'bold 12px monospace';
                    this.ctx.fillText('B', cx - 6, cy + 4);
                }

                // ç»˜åˆ¶è¿çº¿
                if (this.pointA && this.pointA[0] !== null && this.pointB && this.pointB[0] !== null) {
                    const ax = toCanvasX(this.pointA[0]);
                    const ay = toCanvasY(this.pointA[1]);
                    const bx = toCanvasX(this.pointB[0]);
                    const by = toCanvasY(this.pointB[1]);
                    this.ctx.strokeStyle = '#94a3b8';
                    this.ctx.lineWidth = 2;
                    this.ctx.setLineDash([5, 5]);
                    this.ctx.beginPath();
                    this.ctx.moveTo(ax, ay);
                    this.ctx.lineTo(bx, by);
                    this.ctx.stroke();
                    this.ctx.setLineDash([]);
                }

                // ç»˜åˆ¶ä¸­ç‚¹
                if (this.midpointResult) {
                    const cx = toCanvasX(this.midpointResult[0]);
                    const cy = toCanvasY(this.midpointResult[1]);
                    this.ctx.fillStyle = '#22c55e';
                    this.ctx.beginPath();
                    this.ctx.arc(cx, cy, 10, 0, Math.PI * 2);
                    this.ctx.fill();
                    this.ctx.strokeStyle = '#15803d';
                    this.ctx.lineWidth = 2;
                    this.ctx.beginPath();
                    this.ctx.arc(cx, cy, 10, 0, Math.PI * 2);
                    this.ctx.stroke();
                    this.ctx.fillStyle = 'white';
                    this.ctx.font = 'bold 14px monospace';
                    this.ctx.fillText('M', cx - 7, cy + 5);
                }
            }

            displayResult(distance, time) {
                const card = document.getElementById('resultCard');
                const container = document.getElementById('resultDisplay');
                if (!card || !container) return;

                if (!this.getCheckboxValue('showResult')) {
                    card.style.display = 'none';
                    return;
                }

                if (!this.midpointResult) {
                    card.style.display = 'none';
                    return;
                }

                container.innerHTML = `
                    <div class="result-card">
                        <div class="result-label">ä¸­ç‚¹åæ ‡</div>
                        <div class="result-value">[${this.midpointResult[0].toFixed(2)}, ${this.midpointResult[1].toFixed(2)}]</div>
                    </div>
                    <div class="point-info">
                        <div class="info-card">
                            <h4>ç‚¹ A</h4>
                            <p>X: ${this.pointA[0].toFixed(2)}</p>
                            <p>Y: ${this.pointA[1].toFixed(2)}</p>
                            <span class="point-badge point-a">ç‚¹ A</span>
                        </div>
                        <div class="info-card">
                            <h4>ç‚¹ B</h4>
                            <p>X: ${this.pointB[0].toFixed(2)}</p>
                            <p>Y: ${this.pointB[1].toFixed(2)}</p>
                            <span class="point-badge point-b">ç‚¹ B</span>
                        </div>
                        <div class="info-card">
                            <h4>ä¸­ç‚¹ M</h4>
                            <p>X: ${this.midpointResult[0].toFixed(2)}</p>
                            <p>Y: ${this.midpointResult[1].toFixed(2)}</p>
                            <span class="point-badge midpoint">ä¸­ç‚¹</span>
                        </div>
                        <div class="info-card">
                            <h4>è·ç¦»</h4>
                            <p>AB è·ç¦»: ${distance.toFixed(2)}</p>
                            <p>AM è·ç¦»: ${(distance / 2).toFixed(2)}</p>
                            <p>BM è·ç¦»: ${(distance / 2).toFixed(2)}</p>
                        </div>
                    </div>
                `;

                card.style.display = 'block';
            }

            displayAnalysis(distance, time) {
                const card = document.getElementById('analysisCard');
                const grid = document.getElementById('analysisGrid');
                if (!card || !grid) return;

                if (!this.midpointResult) {
                    card.style.display = 'none';
                    return;
                }

                const dx = this.pointB[0] - this.pointA[0];
                const dy = this.pointB[1] - this.pointA[1];
                const angle = Math.atan2(dy, dx) * (180 / Math.PI);

                grid.innerHTML = `
                    <div class="info-card">
                        <h4>åæ ‡è®¡ç®—</h4>
                        <p>ä¸­ç‚¹ X = (${this.pointA[0]} + ${this.pointB[0]}) / 2</p>
                        <p>ä¸­ç‚¹ X = ${this.midpointResult[0].toFixed(2)}</p>
                        <p>ä¸­ç‚¹ Y = (${this.pointA[1]} + ${this.pointB[1]}) / 2</p>
                        <p>ä¸­ç‚¹ Y = ${this.midpointResult[1].toFixed(2)}</p>
                    </div>
                    <div class="info-card">
                        <h4>å‡ ä½•ä¿¡æ¯</h4>
                        <p>X æ–¹å‘è·ç¦»: ${Math.abs(dx).toFixed(2)}</p>
                        <p>Y æ–¹å‘è·ç¦»: ${Math.abs(dy).toFixed(2)}</p>
                        <p>ç›´çº¿è·ç¦»: ${distance.toFixed(2)}</p>
                        <p>è§’åº¦: ${angle.toFixed(2)}Â°</p>
                    </div>
                    <div class="info-card">
                        <h4>éªŒè¯</h4>
                        <p>AM = BM: ${(distance / 2).toFixed(2)} = ${(distance / 2).toFixed(2)} âœ…</p>
                        <p>AM + BM = AB: ${distance.toFixed(2)} = ${distance.toFixed(2)} âœ…</p>
                        <p>ä¸­ç‚¹åœ¨ä¸­çº¿ä¸Š: âœ…</p>
                    </div>
                    <div class="info-card">
                        <h4>æ€§èƒ½</h4>
                        <p>è®¡ç®—æ—¶é—´: ${time}Î¼s</p>
                        <p>æ—¶é—´å¤æ‚åº¦: O(1)</p>
                        <p>ç©ºé—´å¤æ‚åº¦: O(1)</p>
                    </div>
                `;

                card.style.display = 'block';
            }

            addToHistory(distance, time) {
                this.history.unshift({
                    time: new Date().toLocaleString('zh-CN'),
                    pointA: [...this.pointA],
                    pointB: [...this.pointB],
                    midpoint: [...this.midpointResult],
                    distance: distance.toFixed(2),
                    execTime: time
                });
                if (this.history.length > 40) this.history.pop();
                this.updateHistoryDisplay();
            }

            updateHistoryDisplay() {
                const container = document.getElementById('historyList');
                const count = document.getElementById('historyCount');
                if (!container) return;
                if (count) count.textContent = this.history.length;

                if (this.history.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ“œ</div>
                            <p>æš‚æ— è®¡ç®—å†å²</p>
                        </div>`;
                    return;
                }

                container.innerHTML = this.history.slice(0, 20).map(item => `
                    <div class="history-item">
                        <div class="history-time">${item.time} â€¢ ${item.execTime}Î¼s</div>
                        <div class="history-summary">
                            A[${item.pointA[0].toFixed(1)},${item.pointA[1].toFixed(1)}] + 
                            B[${item.pointB[0].toFixed(1)},${item.pointB[1].toFixed(1)}] = 
                            M[${item.midpoint[0].toFixed(1)},${item.midpoint[1].toFixed(1)}] | 
                            è·ç¦»: ${item.distance}
                        </div>
                    </div>
                `).join('');
            }

            updateStats() {
                const grid = document.getElementById('statsGrid');
                if (!grid) return;
                grid.innerHTML = `
                    <div class="stat-card">
                        <div class="stat-number">${this.stats.totalCalculations}</div>
                        <div class="stat-label">è®¡ç®—æ¬¡æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${this.stats.averageDistance.toFixed(2)}</div>
                        <div class="stat-label">å¹³å‡è·ç¦»</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${this.stats.maxDistance.toFixed(2)}</div>
                        <div class="stat-label">æœ€å¤§è·ç¦»</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${this.midpointResult ? this.midpointResult[0].toFixed(1) : '-'}</div>
                        <div class="stat-label">å½“å‰ä¸­ç‚¹ X</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${this.midpointResult ? this.midpointResult[1].toFixed(1) : '-'}</div>
                        <div class="stat-label">å½“å‰ä¸­ç‚¹ Y</div>
                    </div>
                `;
            }

            showCode() {
                const section = document.getElementById('codeSection');
                const preview = document.getElementById('codePreview');
                if (!preview) return;

                if (!this.midpointResult) {
                    if (section) section.style.display = 'none';
                    return;
                }

                const code = `const midpoint = ([x1, y1], [x2, y2]) => [
  (x1 + x2) / 2,
  (y1 + y2) / 2
];

// è¾“å…¥åæ ‡ç‚¹
const pointA = ${JSON.stringify(this.pointA)};
const pointB = ${JSON.stringify(this.pointB)};

// è®¡ç®—ä¸­ç‚¹
const result = midpoint(pointA, pointB);

console.log(result);
// ${JSON.stringify(this.midpointResult)}

// è¯´æ˜ï¼š
// - midpoint è®¡ç®—ä¸¤ä¸ªåæ ‡ç‚¹ä¹‹é—´çš„ä¸­ç‚¹
// - ä¸­ç‚¹ X = (x1 + x2) / 2
// - ä¸­ç‚¹ Y = (y1 + y2) / 2
// - æ—¶é—´å¤æ‚åº¦: O(1)
// - ç©ºé—´å¤æ‚åº¦: O(1)
// - é€‚ç”¨äºå‡ ä½•è®¡ç®—ã€å›¾å½¢å¤„ç†ç­‰åœºæ™¯`;

                preview.textContent = code;
                if (window.hljs) {
                    delete preview.dataset.highlighted;
                    preview.className = 'language-javascript';
                    hljs.highlightElement(preview);
                }
                if (section) section.style.display = 'block';
            }

            clearCanvas() {
                if (this.canvas && this.ctx) {
                    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                    this.drawCanvas();
                }
                this.showNotification('ç”»å¸ƒå·²æ¸…ç©º', 'info');
            }

            clearAll() {
                this.pointA = [0, 0];
                this.pointB = [0, 0];
                this.midpointResult = null;
                document.getElementById('pointAX').value = '0';
                document.getElementById('pointAY').value = '0';
                document.getElementById('pointBX').value = '0';
                document.getElementById('pointBY').value = '0';
                this.drawCanvas();
                const resultCard = document.getElementById('resultCard');
                if (resultCard) resultCard.style.display = 'none';
                const analysisCard = document.getElementById('analysisCard');
                if (analysisCard) analysisCard.style.display = 'none';
                const codeSection = document.getElementById('codeSection');
                if (codeSection) codeSection.style.display = 'none';
                this.showNotification('å·²æ¸…ç©ºå…¨éƒ¨æ•°æ®', 'info');
            }

            loadSample() {
                const samples = [
                    { a: [2, 2], b: [4, 4] },
                    { a: [1, 3], b: [2, 4] },
                    { a: [0, 0], b: [10, 10] },
                    { a: [-5, -5], b: [5, 5] }
                ];
                const sample = samples[Math.floor(Math.random() * samples.length)];
                document.getElementById('pointAX').value = sample.a[0];
                document.getElementById('pointAY').value = sample.a[1];
                document.getElementById('pointBX').value = sample.b[0];
                document.getElementById('pointBY').value = sample.b[1];
                this.showNotification('ç¤ºä¾‹æ•°æ®å·²åŠ è½½', 'info');
            }

            generateRandom() {
                const min = -10;
                const max = 10;
                const ax = Math.floor(Math.random() * (max - min + 1)) + min;
                const ay = Math.floor(Math.random() * (max - min + 1)) + min;
                const bx = Math.floor(Math.random() * (max - min + 1)) + min;
                const by = Math.floor(Math.random() * (max - min + 1)) + min;
                document.getElementById('pointAX').value = ax;
                document.getElementById('pointAY').value = ay;
                document.getElementById('pointBX').value = bx;
                document.getElementById('pointBY').value = by;
                this.showNotification('å·²ç”Ÿæˆéšæœºåæ ‡', 'info');
            }

            showNotification(message, type) {
                if (this.plugins.notification && this.getCheckboxValue('showNotifications')) {
                    this.plugins.notification.show(message, type);
                } else {
                    console.log(`${type.toUpperCase()}: ${message}`);
                }
            }

            showError(message) {
                this.showNotification(message, 'error');
            }

            showWelcomeMessage() {
                if (this.plugins.modal) {
                    this.plugins.modal.show({
                        title: 'ğŸ‰ æ¬¢è¿ä½¿ç”¨ä¸­ç‚¹è®¡ç®—å¯è§†åŒ–å¹³å°',
                        content: `
                            <div style="padding:18px;">
                                <div style="font-size:46px;text-align:center;margin-bottom:12px;">ğŸ“</div>
                                <p style="color:#1f2937;line-height:1.8;">
                                    ä½¿ç”¨ <strong>midpoint</strong> å‡½æ•°è®¡ç®—ä¸¤ä¸ªåæ ‡ç‚¹ä¹‹é—´çš„ä¸­ç‚¹ã€‚
                                    å¯è§†åŒ–å±•ç¤ºåæ ‡ç‚¹ã€è¿çº¿å’Œä¸­ç‚¹ä½ç½®ï¼Œå¸®åŠ©ç†è§£å‡ ä½•è®¡ç®—ã€‚
                                </p>
                                <div style="background:#e0e7ff;border-left:4px solid #667eea;padding:12px;border-radius:12px;color:#4338ca;margin-top:12px;">
                                    <strong>äº®ç‚¹ï¼š</strong> äº¤äº’å¼åæ ‡ç”»å¸ƒã€å®æ—¶å¯è§†åŒ–ã€è·ç¦»è®¡ç®—ã€å‡ ä½•åˆ†æã€ä»£ç é¢„è§ˆã€å†å²è®°å½•ã€‚
                                </div>
                                <ul style="color:#1f2937;margin-left:18px;margin-top:12px;line-height:1.8;">
                                    <li>æ”¯æŒæ‰‹åŠ¨è¾“å…¥åæ ‡æˆ–ç‚¹å‡»ç”»å¸ƒè®¾ç½®ç‚¹</li>
                                    <li>å¯è§†åŒ–å±•ç¤ºç‚¹ Aã€ç‚¹ B å’Œä¸­ç‚¹ M</li>
                                    <li>è‡ªåŠ¨è®¡ç®—è·ç¦»å’Œè§’åº¦ä¿¡æ¯</li>
                                    <li>æä¾›è¯¦ç»†çš„å‡ ä½•åˆ†æå’ŒéªŒè¯</li>
                                </ul>
                            </div>
                        `,
                        type: 'alert'
                    });
                }
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            window.midpointTool = new MidpointTool();
        });

        if (document.readyState !== 'loading' && !window.midpointTool) {
            window.midpointTool = new MidpointTool();
        }
    </script>
</body>

</html>
